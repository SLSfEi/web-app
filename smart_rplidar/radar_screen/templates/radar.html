{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width,initial-scale=1'>
        <style type="text/css">
            /*
              This canvas background-color is not controlled by Scrawl-canvas
              â€” We will hide it in due course
            */
            #canvas-host {
                overflow: hidden;
                border: 1px solid red;
                width: 70vh;
                height: 70vh;
                margin: 0 auto;
                background-color: #444;
                aspect-ratio: 1 / 1;
            }
          </style>
    </head>
<body>

    <h2>Radar Screen</h2>
    <div id="canvas-host">
    </div>

</body>
<script type="text/javascript" src="{% static 'js/websocket_handler.js' %}"></script>
<script type="text/javascript" src="{% static 'js/pixi.min.js' %}"></script>
<script type="text/javascript">
    const app = new PIXI.Application({ width: 1000, height: 1000 , background: '#1099bb' });
    const canvas_host = document.getElementById("canvas-host");
    canvas_host.appendChild(app.view);

    const points_container = new PIXI.Container();
    app.stage.addChild(points_container);

    // Create a 5x5 grid of points
    for (let i = 0; i < 25; i++) {
        const point = new PIXI.Graphics();
        point.beginFill(0xFFFF00);
        point.drawCircle(0,0,2);
        point.endFill();
        point.x = (i % 5) * 40;
        point.y = Math.floor(i / 5) * 40;
        points_container.addChild(point);
    }

    //points_container.x = app.screen.width / 2;
    //points_container.y = app.screen.height / 2;

    //points_container.pivot.x = points_container.width / 2;
    //points_container.pivot.y = points_container.height / 2;

    // define event callbacks
    var on_conn_close = (event) => {
        //display.innerText = display.textContent = "connection lost"
    }
    var on_conn_update = (event) => {
        var data = JSON.parse(event.data)[0]["scan_data"];
        draw_points(data) //[TODO] find a way to clear before redraw
        canvas.render();
    }
    var on_conn_timeout = (event) => {
        //display.innerText = display.textContent = "connection timeout"
    }

    // initiate websocket handler
    var ws_url = "ws://" + window.location.host + "/ws/ticks/";
    var ticks = new WSHandler(ws_url);
    ticks.set_onmessage(on_conn_update);
    ticks.set_onclose(on_conn_close);
    ticks.set_ontimeout(on_conn_timeout);

</script>
</html>