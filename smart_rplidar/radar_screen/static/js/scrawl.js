const t={},e=[],i={},s=[],n={},r=[],o={},a=[],l={},h=[],c={},u={},d=[],f={},p={},m=[],g={},y=[],b={},S={},k=[],A={},O=[],w={},v=[],C={},x=[],P={},D=[],R={};const F={DEFAULTS:{defaults:!0},b:{weight:"bold"},"/b":{weight:"normal"},strong:{weight:"bold"},"/strong":{weight:"normal"},BOLD:{weight:"bold"},"/BOLD":{weight:"normal"},i:{style:"italic"},"/i":{style:"normal"},em:{style:"italic"},"/em":{style:"normal"},ITALIC:{style:"italic"},"/ITALIC":{style:"normal"},u:{underline:!0},"/u":{underline:!1},UNDERLINE:{underline:!0},"/UNDERLINE":{underline:!1},OVERLINE:{overline:!0},"/OVERLINE":{overline:!1},"SMALL-CAPS":{variant:"small-caps"},"/SMALL-CAPS":{variant:"normal"},HIGHLIGHT:{highlight:!0},"/HIGHLIGHT":{highlight:!1}},E={},M=Math.PI/180,I=new Set(["all","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundOrigin","backgroundPosition","backgroundRepeat","border","borderBottom","borderBottomColor","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopStyle","borderTopWidth","borderWidth","clear","color","columns","content","counterIncrement","counterReset","cursor","direction","display","emptyCells","float","font","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontSynthesis","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","grid","gridArea","gridAutoColumns","gridAutoFlow","gridAutoPosition","gridAutoRows","gridColumn","gridColumnStart","gridColumnEnd","gridRow","gridRowStart","gridRowEnd","gridTemplate","gridTemplateAreas","gridTemplateRows","gridTemplateColumns","imageResolution","imeMode","inherit","inlineSize","isolation","letterSpacing","lineBreak","lineHeight","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBlockStart","marginBlockEnd","marginInlineStart","marginInlineEnd","marginBottom","marginLeft","marginRight","marginTop","marks","mask","maskType","maxWidth","maxHeight","maxBlockSize","maxInlineSize","maxZoom","minWidth","minHeight","minBlockSize","minInlineSize","minZoom","mixBlendMode","objectFit","objectPosition","offsetBlockStart","offsetBlockEnd","offsetInlineStart","offsetInlineEnd","orphans","overflow","overflowWrap","overflowX","overflowY","pad","padding","paddingBlockStart","paddingBlockEnd","paddingInlineStart","paddingInlineEnd","paddingBottom","paddingLeft","paddingRight","paddingTop","pageBreakAfter","pageBreakBefore","pageBreakInside","pointerEvents","position","prefix","quotes","rubyAlign","rubyMerge","rubyPosition","scrollBehavior","scrollSnapCoordinate","scrollSnapDestination","scrollSnapPointsX","scrollSnapPointsY","scrollSnapType","scrollSnapTypeX","scrollSnapTypeY","shapeImageThreshold","shapeMargin","shapeOutside","tableLayout","textAlign","textDecoration","textIndent","textOrientation","textOverflow","textRendering","textShadow","textTransform","textUnderlinePosition","unicodeRange","unset","verticalAlign","widows","willChange","wordBreak","wordSpacing","wordWrap","zIndex"]),H=new Set(["alignContent","alignItems","alignSelf","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction","backfaceVisibility","backgroundImage","backgroundSize","borderBottomLeftRadius","borderBottomRightRadius","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderRadius","borderTopLeftRadius","borderTopRightRadius","boxDecorationBreak","boxShadow","boxSizing","columnCount","columnFill","columnGap","columnRule","columnRuleColor","columnRuleStyle","columnRuleWidth","columnSpan","columnWidth","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","fontFeatureSettings","fontKerning","fontLanguageOverride","hyphens","imageRendering","imageOrientation","initial","justifyContent","linearGradient","opacity","order","orientation","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","resize","tabSize","textAlignLast","textCombineUpright","textDecorationColor","textDecorationLine","textDecorationStyle","touchAction","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","whiteSpace","writingMode"]);var B=Object.freeze({__proto__:null,version:"8.9.9",anchor:t,anchornames:e,animation:i,animationnames:s,animationtickers:n,animationtickersnames:r,artefact:o,artefactnames:a,asset:l,assetnames:h,canvas:c,canvasnames:[],cell:u,cellnames:d,element:{},elementnames:[],entity:f,entitynames:[],filter:p,filternames:m,fontattribute:{},fontattributenames:[],group:g,groupnames:y,palette:{},palettenames:[],particle:b,particlenames:[],force:S,forcenames:k,spring:A,springnames:O,world:w,worldnames:v,stack:{},stacknames:[],tween:C,tweennames:x,styles:P,stylesnames:D,unstackedelement:R,unstackedelementnames:[],purge:function(c=""){const u=function(t,e,i=!1){t.forEach((t=>{const s=e[t];s&&s.kill&&s.kill(i)}))};if(c){u(a.filter((t=>0===t.indexOf(c))),o);u(h.filter((t=>0===t.indexOf(c))),l);u(y.filter((t=>0===t.indexOf(c))),g,!0);u(D.filter((t=>0===t.indexOf(c))),P);u(x.filter((t=>0===t.indexOf(c))),C);u(s.filter((t=>0===t.indexOf(c))),i);u(r.filter((t=>0===t.indexOf(c))),n);u(m.filter((t=>0===t.indexOf(c))),p);u(e.filter((t=>0===t.indexOf(c))),t);u(k.filter((t=>0===t.indexOf(c))),S);u(O.filter((t=>0===t.indexOf(c))),A);u(v.filter((t=>0===t.indexOf(c))),w)}},sectionClasses:F,constructors:E,radian:M,css:I,xcss:H});let T=!1,L=!0,$=[],j=[];const X=function(){L=!0},Y=function(){let t,e;for(L&&function(){if(L){L=!1;let t,e,s,n,r,o=Math.floor,a=[];for(s=0,n=j.length;s<n;s++)r=j[s],t=i[r],t&&(e=o(t.order)||0,a[e]||(a[e]=[]),a[e].push(t));$=a.reduce(((t,e)=>t.concat(e)),[])}}(),t=0,e=$.length;t<e;t++)$[t].fn();T&&window.requestAnimationFrame((()=>Y()))},N=function(){T=!0,Y()},G=function(){T=!1},z=(t,e)=>{if(!dt(e))throw new Error(`core/utilities addStrings() error - no delta argument supplied ${t}, ${e}`);if(null!=e){"left"===t||"top"===t?t="0%":"right"===t||"bottom"===t?t="100%":"center"===t&&(t="50%");let i=!(!t.substring&&!e.substring);return rt(t)?t+=rt(e)?e:parseFloat(e):t=parseFloat(t)+(rt(e)?e:parseFloat(e)),i?t+"%":t}return t},W=t=>{let e,i,s;if(!dt(t))throw new Error("core/utilities convertTime() error - no argument supplied");if(rt(t))return["ms",t];if(!t.substring)throw new Error(`core/utilities convertTime() error - invalid argument: ${t}`);if(e=t.match(/^\d+\.?\d*(\D*)/),i=e[1].toLowerCase?e[1].toLowerCase():"ms",s=parseFloat(t),!rt(s))throw new Error(`core/base error - convertTime() argument converts to NaN: ${t}`);switch(i){case"s":s*=1e3;break;case"%":break;default:i="ms"}return[i,s]},V=t=>!t.toFixed||isNaN(t)?(console.log(`${t} is not a valid number`),t):((t%=360)<0&&(t+=360),t),Z=t=>t.toFixed?0==t?t:isNaN(t)?0:t<-1e-6||t>1e-6?t:0:t,_=()=>{},U=function(t){return t},K=function(){return this},q=()=>Promise.resolve(!0),Q={},J=()=>performance.now().toString(36)+Math.random().toString(36).substr(2),tt=function(t,e,i){return e+t*(i-e)},et=t=>"boolean"==typeof t,it=t=>"[object HTMLCanvasElement]"===Object.prototype.toString.call(t),st=t=>!!(t&&t.querySelector&&t.dispatchEvent),nt=t=>"function"==typeof t,rt=t=>!(null==t||!t.toFixed||Number.isNaN(t)),ot=t=>"[object Object]"===Object.prototype.toString.call(t),at=t=>!(!t||!t.type||"Quaternion"!==t.type),lt=(t,e)=>{if(!ot(t)||!ot(e))throw new Error(`core/utilities mergeOver() error - insufficient arguments supplied ${t}, ${e}`);for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},ht=(t,e)=>{if(!ot(t)||!ot(e))throw new Error(`core/utilities mergeDiscard() error - insufficient arguments supplied ${t}, ${e}`);return Object.entries(e).forEach((([i,s])=>{null===s?delete t[i]:t[i]=e[i]})),t},ct=(t,e)=>{if(!ft(t,e))throw new Error(`core/utilities pushUnique() error - insufficient arguments supplied ${t}, ${e}`);if(!Array.isArray(t))throw new Error(`core/utilities pushUnique() error - argument not an array ${t}`);return Array.isArray(e)?e.forEach((e=>ct(t,e))):t.indexOf(e)<0&&t.push(e),t},ut=(t,e)=>{if(!ft(t,e))throw new Error(`core/utilities removeItem() error - insufficient arguments supplied ${t}, ${e}`);if(!Array.isArray(t))throw new Error(`core/utilities removeItem() error - argument not an array ${t}`);let i=t.indexOf(e);return i>=0&&t.splice(i,1),t},dt=t=>void 0!==t,ft=(...t)=>t.every((t=>void 0!==t)),pt=(...t)=>t.find((t=>void 0!==t)),mt=(...t)=>!!t.find((t=>void 0!==t)),gt={out:t=>1-Math.cos(t*Math.PI/2),in:t=>Math.sin(t*Math.PI/2),easeIn:t=>{let e=1-t;return 1-e*e},easeIn3:t=>{let e=1-t;return 1-e*e*e},easeIn4:t=>{let e=1-t;return 1-e*e*e*e},easeIn5:t=>{let e=1-t;return 1-e*e*e*e*e},easeOutIn:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeOutIn3:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeOutIn4:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeOutIn5:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInOut:t=>{const e=.5-t,i=t-.5;return t<.5?.5+-2*e*e:.5+Math.pow(2*i,2)/2},easeInOut3:t=>{const e=.5-t,i=t-.5;return t<.5?.5+-4*e*e*e:.5+Math.pow(2*i,3)/2},easeInOut4:t=>{const e=.5-t,i=t-.5;return t<.5?.5+-8*e*e*e*e:.5+Math.pow(2*i,4)/2},easeInOut5:t=>{const e=.5-t,i=t-.5;return t<.5?.5+-16*e*e*e*e*e:.5+Math.pow(2*i,5)/2},easeOut:t=>t*t,easeOut3:t=>t*t*t,easeOut4:t=>t*t*t*t,easeOut5:t=>t*t*t*t*t,none:t=>t,linear:t=>t,cosine:t=>.5*(1+Math.cos((1-t)*Math.PI)),hermite:t=>t*t*(2*-t+3),quintic:t=>t*t*t*(t*(6*t-15)+10),easeOutSine:t=>1-Math.cos(t*Math.PI/2),easeInSine:t=>Math.sin(t*Math.PI/2),easeOutInSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeOutQuad:t=>t*t,easeInQuad:t=>1-(1-t)*(1-t),easeOutInQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeOutCubic:t=>t*t*t,easeInCubic:t=>1-Math.pow(1-t,3),easeOutInCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeOutQuart:t=>t*t*t*t,easeInQuart:t=>1-Math.pow(1-t,4),easeOutInQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeOutQuint:t=>t*t*t*t*t,easeInQuint:t=>1-Math.pow(1-t,5),easeOutInQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeOutExpo:t=>0===t?0:Math.pow(2,10*t-10),easeInExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeOutInExpo:t=>0===t||1===t?t:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeOutCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeInCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeOutInCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeOutBack:t=>2.70158*t*t*t-1.70158*t*t,easeInBack:t=>1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeOutInBack:t=>{const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2},easeOutElastic:t=>{const e=2*Math.PI/3;return 0===t||1===t?t:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)},easeInElastic:t=>{const e=2*Math.PI/3;return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},easeOutInElastic:t=>{const e=2*Math.PI/4.5;return 0===t||1===t?t:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1},easeOutBounce:t=>{const e=7.5625,i=2.75;return(t=1-t)<1/i?1-e*t*t:t<2/i?1-(e*(t-=1.5/i)*t+.75):t<2.5/i?1-(e*(t-=2.25/i)*t+.9375):1-(e*(t-=2.625/i)*t+.984375)},easeInBounce:t=>{const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},easeOutInBounce:t=>{const e=7.5625,i=2.75;let s;return t<.5?(s=(t=1-2*t)<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375,(1-s)/2):(s=(t=2*t-1)<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375,(1+s)/2)}},yt=function(t,e,i=Q){if("function"==typeof window.IntersectionObserver&&t&&t.run){let s=new IntersectionObserver(((e,i)=>{let s,n,r;for(s=0,n=e.length;s<n;s++)r=e[s],r.isIntersecting?!t.isRunning()&&t.run():r.isIntersecting||t.isRunning()&&t.halt()}),i);return e&&e.domElement&&s.observe(e.domElement),function(){s.disconnect()}}return _},bt=function(t,e,i){if(!nt(e))throw new Error(`core/document addListener() error - no function supplied: ${t}, ${i}`);return kt(t,e,i,"removeEventListener"),kt(t,e,i,"addEventListener"),function(){St(t,e,i)}},St=function(t,e,i){if(!nt(e))throw new Error(`core/document removeListener() error - no function supplied: ${t}, ${i}`);kt(t,e,i,"removeEventListener")},kt=function(t,e,i,s){let n,r=[].concat(t);n=i.substring?document.body.querySelectorAll(i):Array.isArray(i)?i:[i],navigator.pointerEnabled||navigator.msPointerEnabled?Ot(r,e,n,s):At(r,e,n,s)},At=function(t,e,i,s){let n,r,o,a,l,h;for(n=0,r=t.length;n<r;n++)for(l=t[n],o=0,a=i.length;o<a;o++){if(h=i[o],!(st(h)||h.document||h.characterSet))throw new Error(`core/document actionMouseListener() error - bad target: ${l}, ${h}`);switch(l){case"move":h[s]("mousemove",e,!1),h[s]("touchmove",e,{passive:!1}),h[s]("touchfollow",e,{passive:!1});break;case"up":h[s]("mouseup",e,!1),h[s]("touchend",e,{passive:!1});break;case"down":h[s]("mousedown",e,!1),h[s]("touchstart",e,{passive:!1});break;case"leave":h[s]("mouseleave",e,!1),h[s]("touchleave",e,{passive:!1});break;case"enter":h[s]("mouseenter",e,!1),h[s]("touchenter",e,{passive:!1})}}},Ot=function(t,e,i,s){let n,r,o,a,l,h;for(n=0,r=t.length;n<r;n++)for(l=t[n],o=0,a=i.length;o<a;o++)if(h=i[o],st(h)||h.document||h.characterSet)switch(l){case"move":h[s]("pointermove",e,!1);break;case"up":h[s]("pointerup",e,!1);break;case"down":h[s]("pointerdown",e,!1);break;case"leave":h[s]("pointerleave",e,!1);break;case"enter":h[s]("pointerenter",e,!1)}},wt=function(t,e,i){if(!nt(e))throw new Error(`core/document addNativeListener() error - no function supplied: ${t}, ${i}`);return Ct(t,e,i,"removeEventListener"),Ct(t,e,i,"addEventListener"),function(){vt(t,e,i)}},vt=function(t,e,i){if(!nt(e))throw new Error(`core/document removeNativeListener() error - no function supplied: ${t}, ${i}`);Ct(t,e,i,"removeEventListener")},Ct=function(t,e,i,s){let n,r,o,a,l,h,c,u=[].concat(t);for(n=i.substring?document.body.querySelectorAll(i):Array.isArray(i)?i:[i],r=0,o=u.length;r<o;r++)for(h=u[r],a=0,l=n.length;a<l;a++){if(c=n[a],!(st(c)||c.document||c.characterSet))throw new Error(`core/document actionNativeListener() error - bad target: ${h}, ${c}`);c[s](h,e,!1)}};let xt=_;const Pt=t=>xt=t,Dt=function(){let t=[];return(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&t.push("old-opera"),"undefined"!=typeof InstallTrigger?t.push("firefox"):(/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString())&&t.push("safari"),document.documentMode&&t.push("internet-explorer"),t.indexOf("internet-explorer")<0&&window.StyleMedia&&t.push("edge"),window.chrome&&t.push("chrome"),(t.indexOf("chrome")>=0||t.indexOf("old-opera")>=0)&&window.CSS&&t.push("blink"),t}();window.scrawlEnvironmentBrowserDetection=Dt;let Rt=0;const Ft=()=>Rt;let Et=!1;const Mt=()=>Et,It=t=>Et=t,Ht=()=>{Rt=window.devicePixelRatio;for(const[t,e]of Object.entries(c))e.dirtyDimensions=!0;for(const[t,e]of Object.entries(u))e.dirtyDimensions=!0;for(const[t,e]of Object.entries(f))e.dirtyHost=!0;Et||xt(),Dt.indexOf("safari")<0&&matchMedia(`(resolution: ${Rt}dppx)`).addEventListener("change",Ht,{once:!0})};function Bt(t=Q){t.defs={},t.getters={},t.setters={},t.deltaSetters={},t.get=function(t){if(dt(t)){let e=this.getters[t];if(e)return e.call(this);{let e=this.defs[t];if(void 0!==e){let i=this[t];return void 0!==i?i:e}}}return null},t.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs;let r,o,a,l;for(o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!==a&&null!=l&&(r=s[a],r?r.call(this,l):void 0!==n[a]&&(this[a]=l))}return this},t.setDelta=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.deltaSetters,n=this.defs;let r,o,a,l;for(o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!==a&&null!=l&&(r=s[a],r?r.call(this,l):void 0!==n[a]&&(this[a]=z(this[a],l)))}return this};t.defs=lt(t.defs,{name:""});let e=t.getters;return e.type=function(){return this.type},e.isArtefact=function(){return this.isArtefact},e.isAsset=function(){return this.isAsset},t.packetExclusions=[],t.packetExclusionsByRegex=[],t.packetCoordinates=[],t.packetObjects=[],t.packetFunctions=[],t.saveAsPacket=function(t=Q){et(t)&&t&&(t={includeDefaults:!0});let e=this.defs,i=Object.keys(e),s=this.packetExclusions,n=this.packetExclusionsByRegex,r=this.packetCoordinates,o=this.packetObjects,a=this.packetFunctions,l=t.includeDefaults||!1,h={};return l&&!Array.isArray(l)?l=Object.keys(e):l||(l=[]),Object.entries(this).forEach((([t,e])=>{let c,u=!0;if(i.indexOf(t)<0&&(u=!1),u&&s.indexOf(t)>=0&&(u=!1),u&&(c=n.some((e=>new RegExp(e).test(t))),c&&(u=!1)),u)if(a.indexOf(t)>=0){if(dt(e)&&null!==e){let i=this.stringifyFunction(e);i&&i.length&&(h[t]=i)}}else o.indexOf(t)>=0&&this[t]&&this[t].name?h[t]=this[t].name:r.indexOf(t)>=0?(l.indexOf(t)>=0||e[0]||e[1])&&(h[t]=e):(c=this.processPacketOut(t,e,l),c&&(h[t]=e))}),this),h=this.finalizePacketOut(h,t),JSON.stringify([this.name,this.type,this.lib,h])},t.stringifyFunction=function(t){let e=t.toString().match(/\(([\s\S]*?)\)[\s\S]*?\{([\s\S]*)\}/),i=e[1],s=e[2];return!!ft(i,s)&&`${i}~~~${s}`},t.processPacketOut=function(t,e,i){let s=!0;return i.indexOf(t)<0&&e===this.defs[t]&&(s=!1),s},t.finalizePacketOut=function(t,e){return t},t.importPacket=function(t){let e=this;const i=function(t){return new Promise(((i,s)=>{let n;t.substring||s(new Error("Packet url supplied for import is not a string")),"["===t[0]?(n=e.actionPacket(t),n&&n.lib?i(n):s(n)):t.indexOf('"name":')>=0?s(new Error("Bad packet supplied for import")):fetch(t).then((t=>{if(!t.ok)throw new Error(`Packet import from server failed - ${t.status}: ${t.statusText} - ${t.url}`);return t.text()})).then((t=>{if(n=e.actionPacket(t),!n||!n.lib)throw n;i(n)})).catch((t=>s(t)))}))};if(Array.isArray(t)){let e=[];return t.forEach((t=>e.push(i(t)))),new Promise(((t,i)=>{Promise.all(e).then((e=>t(e))).catch((t=>i(t)))}))}if(t.substring)return i(t);Promise.reject(new Error("Argument supplied for packet import is not a string or array of strings"))},t.actionPacketExclusions=["Image","Sprite","Video","Canvas","Stack"],t.actionPacket=function(t){try{if(t&&t.substring){if("["===t[0]){let e,i,s,n;try{[e,i,s,n]=JSON.parse(t)}catch(t){throw new Error(`Failed to process packet due to JSON parsing error - ${t.message}`)}if(ft(e,i,s,n)){if(this.actionPacketExclusions.indexOf(i)>=0)throw new Error("Failed to process packet - Stacks, Canvases and visual assets are excluded from the packet system");let t=B[s][e];if(t)t.set(n);else{if(n.outerHTML&&n.host){let t=document.querySelector(`#${n.host}`);if(t){let i=document.createElement("div");i.innerHTML=n.outerHTML;let s=i.firstElementChild;s&&(s.id=e,t.appendChild(s),n.domElement=s)}}if(t=new E[i](n),!t)throw new Error("Failed to create Scrawl-canvas object from supplied packet")}if(t.packetFunctions.forEach((e=>this.actionPacketFunctions(t,e))),n.anchor&&t.anchor&&t.anchor.packetFunctions.forEach((e=>{t.anchor[e]=n.anchor[e],this.actionPacketFunctions(t.anchor,e),t.anchor.build()})),n.glyphStyles&&t.glyphStyles&&n.glyphStyles.forEach(((e,i)=>{ot(e)&&t.setGlyphStyles(e,i)})),t)return t;throw new Error("Failed to process supplied packet")}throw new Error("Failed to process packet - JSON string holds incomplete data")}throw new Error("Failed to process packet - JSON string does not represent an array")}throw new Error("Failed to process packet - not a JSON string")}catch(t){return console.log(t),t}},t.actionPacketFunctions=function(t,e){let i=t[e];if(dt(i)&&null!==i&&i.substring)if("~~~"===i)t[e]=_;else{let s,n,r;[s,n]=i.split("~~~"),s=s.split(","),s=s.map((t=>t.trim())),n.indexOf("[native code]")<0?(r=new Function(...s,n),t[e]=r.bind(t)):t[e]=_}},t.clone=function(t=Q){let e,i,s=this.name;this.name=t.name||"",t.useNewTicker?(i=this.ticker,this.ticker=null,e=this.saveAsPacket(),this.ticker=i):e=this.saveAsPacket(),this.name=s;let n=this.actionPacket(e);return this.packetFunctions.forEach((t=>{this[t]&&(n[t]=this[t])})),n=this.postCloneAction(n,t),n.set(t),n},t.postCloneAction=function(t,e){return t},t.kill=function(){return this.deregister()},t.makeName=function(t){return t&&t.substring&&B[`${this.lib}names`].indexOf(t)<0?this.name=t:this.name=J(),this},t.register=function(){if(!dt(this.name))throw new Error(`core/base error - register() name not set: ${this}`);let t=B[`${this.lib}names`],e=B[this.lib];return this.isArtefact&&(ct(a,this.name),o[this.name]=this),this.isAsset&&(ct(h,this.name),l[this.name]=this),ct(t,this.name),e[this.name]=this,this},t.deregister=function(){if(!dt(this.name))throw new Error(`core/base error - deregister() name not set: ${this}`);let t=B[`${this.lib}names`],e=B[this.lib];return this.isArtefact&&(ut(a,this.name),delete o[this.name]),this.isAsset&&(ut(h,this.name),delete l[this.name]),ut(t,this.name),delete e[this.name],this},t}Ht();const Animation=function(t=Q){return this.makeName(t.name),this.order=dt(t.order)?t.order:this.defs.order,this.fn=t.fn||q,this.onRun=t.onRun||_,this.onHalt=t.onHalt||_,this.onKill=t.onKill||_,this.register(),t.delay||this.run(),this};let Tt=Animation.prototype=Object.create(Object.prototype);Tt.type="Animation",Tt.lib="animation",Tt.isArtefact=!1,Tt.isAsset=!1,Tt=Bt(Tt);Tt.defs=lt(Tt.defs,{order:1,fn:null,onRun:null,onHalt:null,onKill:null}),Tt.stringifyFunction=_,Tt.processPacketOut=_,Tt.finalizePacketOut=_,Tt.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},Tt.clone=K,Tt.run=function(){return this.onRun(),ct(j,this.name),X(),setTimeout((()=>pe()),20),this},Tt.isRunning=function(){return j.indexOf(this.name)>=0},Tt.halt=function(){return this.onHalt(),ut(j,this.name),X(),this},Tt.kill=function(){return this.onKill(),ut(j,this.name),X(),this.deregister(),!0};const Lt=function(t){return!!t&&new Animation(t)};E.Animation=Animation;const $t=[];let jt=!1,Xt=!1,Yt=!1,Nt=!1,Gt=!1,zt=!1,Wt=!1,Vt=!1;const Zt={x:0,y:0,scrollX:0,scrollY:0,w:0,h:0,type:"mouse",prefersReducedMotion:!1,prefersDarkColorScheme:!1,prefersReduceTransparency:!1,prefersContrast:!1,prefersReduceData:!1,rawTouches:[]},_t=window.matchMedia("(prefers-contrast: more)");_t.addEventListener("change",(()=>{let t=_t.matches;Zt.prefersContrast!==t&&(Zt.prefersContrast=t,Nt=!0)})),Zt.prefersContrast=_t.matches;const Ut=window.matchMedia("(prefers-reduced-motion: reduce)");Ut.addEventListener("change",(()=>{let t=Ut.matches;Zt.prefersReducedMotion!==t&&(Zt.prefersReducedMotion=t,Gt=!0)})),Zt.prefersReducedMotion=Ut.matches;const Kt=window.matchMedia("(prefers-color-scheme: dark)");Kt.addEventListener("change",(()=>{let t=Kt.matches;Zt.prefersDarkColorScheme!==t&&(Zt.prefersDarkColorScheme=t,zt=!0)})),Zt.prefersDarkColorScheme=Kt.matches;const qt=window.matchMedia("(prefers-reduced-transparency: reduce)");qt.addEventListener("change",(()=>{let t=qt.matches;Zt.prefersReduceTransparency!==t&&(Zt.prefersReduceTransparency=t,Wt=!0)})),Zt.prefersReduceTransparency=qt.matches;const Qt=window.matchMedia("(prefers-reduced-data: reduce)");Qt.addEventListener("change",(()=>{let t=Qt.matches;Zt.prefersReduceData!==t&&(Zt.prefersReduceData=t,Vt=!0)})),Zt.prefersReduceData=Qt.matches;const Jt=function(t){let e=document.documentElement.clientWidth,i=document.documentElement.clientHeight;Zt.w===e&&Zt.h===i||(Zt.w=e,Zt.h=i,Xt=!0,Yt=!0)},te=function(t){let e=window.pageXOffset,i=window.pageYOffset;Zt.scrollX===e&&Zt.scrollY===i||(Zt.x+=e-Zt.scrollX,Zt.y+=i-Zt.scrollY,Zt.scrollX=e,Zt.scrollY=i,Xt=!0)},ee=function(t){let e=Math.round(t.pageX),i=Math.round(t.pageY);Zt.x===e&&Zt.y===i||(Zt.type=navigator.pointerEnabled?"pointer":"mouse",Zt.x=e,Zt.y=i,Xt=!0)};let ie=0,se=16;const ne=function(){return se},re=function(t){t&&t.toFixed&&!isNaN(t)&&(se=t)},oe=function(t,e=!0){if(Zt.rawTouches.length=0,t.touches&&t.touches.length){Zt.rawTouches.push(...t.touches);const e=t.touches[0],i=Math.round(e.pageX),s=Math.round(e.pageY);Zt.x===i&&Zt.y===s||(Zt.type="touch",Zt.x=i,Zt.y=s)}else Zt.type="touch",e&&(Zt.x=0,Zt.y=0);const i=Date.now();i>ie+se&&(ie=i,ae())},ae=function(){for(let t=0,e=$t.length;t<e;t++)le($t[t])},le=function(t){const e=o[t];if(e){e.here||(e.here={});const{here:t,domElement:i}=e;if(t.prefersContrast=Zt.prefersContrast,t.prefersReducedMotion=Zt.prefersReducedMotion,t.prefersDarkColorScheme=Zt.prefersDarkColorScheme,t.prefersReduceTransparency=Zt.prefersReduceTransparency,t.prefersReduceData=Zt.prefersReduceData,Nt&&e.contrastActions(),Gt&&e.reducedMotionActions(),zt&&e.colorSchemeActions(),Wt&&e.reducedTransparencyActions(),Vt&&e.reducedDataActions(),i){const s=i.getBoundingClientRect(),n=Math.round(s.left+window.pageXOffset),r=Math.round(s.top+window.pageYOffset),o=s.top,a=s.height,l=window.innerHeight;t.w=Math.round(s.width),t.h=Math.round(a),t.type=Zt.type;const h=o/l,c=(o+a)/l,u=(h+c)/2;t.inViewportTop=h,t.inViewportBase=c,t.inViewportCenter=u,e.localMouseListener?(t.localListener=!0,t.active=!1,t.normX=!!t.originalWidth&&t.x/t.originalWidth,t.normY=!!t.originalHeight&&t.y/t.originalHeight,t.offsetX=n,t.offsetY=r,t.x>e.activePadding&&t.x<t.originalWidth-e.activePadding&&t.y>0+e.activePadding&&t.y<t.originalHeight-e.activePadding&&(t.active=!0)):(t.localListener=!1,t.active=!0,t.x=Math.round(Zt.x-n),t.y=Math.round(Zt.y-r),t.normX=!!t.w&&t.x/t.w,t.normY=!!t.h&&t.y/t.h,t.offsetX=n,t.offsetY=r,(t.normX<0||t.normX>1||t.normY<0||t.normY>1)&&(t.active=!1));const d=Zt.rawTouches;if(d.length){t.touches||(t.touches=[]),t.touches.length=0;for(let e=0,i=d.length;e<i;e++){const i=d[e];t.touches.push([Math.round(i.pageX-n),Math.round(i.pageY-r)])}}if("Canvas"===e.type&&e.updateBaseHere(t,e.fit),e.checkForResize&&!e.dirtyDimensions&&!e.dirtyDomDimensions){let[i,s]=e.currentDimensions;if("Canvas"===e.type){e.computedStyles||(e.computedStyles=window.getComputedStyle(e.domElement));let n=e.computedStyles,r=Math.floor(t.w-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)),o=Math.floor(t.h-parseFloat(n.borderTopWidth)-parseFloat(n.borderBottomWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom));i===r&&s===o||e.set({dimensions:[r,o]})}else i===t.w&&s===t.h||e.set({dimensions:[t.w,t.h]})}}}},he=Lt({name:"coreListenersTracker",order:0,delay:!0,fn:function(){if(!$t.length)return!1;(jt&&Xt||Gt||zt||Wt||Vt)&&(ae(),jt&&Xt&&(Xt=!1),(Gt||zt||Wt||Vt)&&(Gt=!1,zt=!1,Wt=!1,Vt=!1)),Yt&&(Yt=!1,function(){for(const[t,e]of Object.entries(f))"Phrase"===e.type&&(e.dirtyDimensions=!0,e.dirtyFont=!0)}())}}),ce=function(){de("removeEventListener"),de("addEventListener"),jt=!0,Xt=!0,he.run()},ue=function(){jt=!1,Xt=!1,he.halt(),de("removeEventListener")},de=function(t){navigator.pointerEnabled||navigator.msPointerEnabled?(window[t]("pointermove",ee,!1),window[t]("pointerup",ee,!1),window[t]("pointerdown",ee,!1),window[t]("pointerleave",ee,!1),window[t]("pointerenter",ee,!1)):(window[t]("mousemove",ee,!1),window[t]("mouseup",ee,!1),window[t]("mousedown",ee,!1),window[t]("mouseleave",ee,!1),window[t]("mouseenter",ee,!1),window[t]("touchmove",oe,{passive:!0}),window[t]("touchstart",oe,{passive:!0}),window[t]("touchend",oe,{passive:!0}),window[t]("touchcancel",oe,{passive:!0})),window[t]("scroll",te,{passive:!0}),window[t]("resize",Jt,!1)},fe=function(){Jt(),Xt=!0,Yt=!0},pe=function(){Xt=!0,Yt=!0},me=function(t=Q){if(!ft(t.event,t.origin,t.updates))return!1;let e=t.target.substring&&t.targetLibrarySection?B[t.targetLibrarySection][t.target]:t.target;if(!e)return!1;let i=t.event,s=t.origin,n=t.useNativeListener?wt:bt,r=t.useNativeListener?vt:St,o=_;t.preventDefault&&(o=t=>{t.preventDefault(),t.returnValue=!1});let a=nt(t.setup)?t.setup:_,l=nt(t.callback)?t.callback:_,h=function(i){o(i);let s=!(!i||!i.target)&&i.target.id;if(s){let n=t.updates[s];if(n){a();let t,s=n[0],r=n[1],o=i.target.value,h=!0;switch(r){case"float":t=parseFloat(o);break;case"int":t=parseInt(o,10);break;case"round":t=Math.round(o);break;case"roundDown":t=Math.floor(o);break;case"roundUp":t=Math.ceil(o);break;case"raw":t=o;break;case"string":t=`${o}`;break;case"boolean":t=!!dt(o)&&(o.substring?"true"===o.toLowerCase()||"false"!==o.toLowerCase()&&!!parseFloat(o):!!o);break;default:r.substring?t=`${parseFloat(o)}${r}`:h=!1}h&&("Group"===e.type?e.setArtefacts({[s]:t}):e.set({[s]:t}),l())}}};return n(i,h,s),function(){r(i,h,s)}},ge={},ye=function(t=Q){const e=(t=Q)=>{if(t&&t.target){let e=t.target,s="";for(;!s&&(ge[e.id]&&(s=e.id),"BODY"!==e.tagName);)e=e.parentElement;const r=ge[s];if(r)for(let e=0,s=r.length;e<s;e++){const s=r[e].pickup(t);if(s.current){i=s.move,n=s.drop;break}}}};let i=_;const s=(t=Q)=>{i(t)};let n=_;const r=(t=Q)=>{n(t),i=_,n=_},o=function(t=Q,e,i){let{zone:s,coordinateSource:n,collisionGroup:r,startOn:o,endOn:a,updateOnStart:l,updateOnEnd:h,updateWhileMoving:c,updateOnShiftStart:u,updateOnShiftEnd:d,updateWhileShiftMoving:f,updateOnPrematureExit:p,exposeCurrentArtefact:m,preventTouchDefaultWhenDragging:y,resetCoordsToZeroOnTouchEnd:b,processingOrder:S}=t;if(!s)return new Error("dragZone constructor - no zone supplied");if(s.substring&&(s=artefact[s]),!s||["Canvas","Stack"].indexOf(s.type)<0)return new Error("dragZone constructor - zone object is not a Stack or Canvas wrapper");let k=s.domElement;if(!k)return new Error("dragZone constructor - zone does not contain a target DOM element");if(r?r.substring&&(r=g[r]):r="Canvas"===s.type?g[s.base.name]:g[s.name],!r||"Group"!==r.type)return new Error("dragZone constructor - unable to recover collisionGroup group");if(n?n.here?n=n.here:ft(n.x,n.y)||(n=!1):n="Canvas"===s.type?s.base.here:s.here,!n)return new Error("dragZone constructor - unable to discover a usable coordinateSource object");Array.isArray(o)||(o=["down"]),Array.isArray(a)||(a=["up"]),null==m&&(m=!1),null==y&&(y=!1),null==b&&(b=!0),ot(l)&&(l=function(){A.artefact.set(t.updateOnStart)}),nt(l)||(l=_),ot(u)&&(u=function(){A.artefact.set(t.updateOnShiftStart)}),nt(u)||(u=l),ot(h)&&(h=function(){A.artefact.set(t.updateOnEnd)}),nt(h)||(h=_),ot(d)&&(d=function(){A.artefact.set(t.updateOnShiftEnd)}),nt(d)||(d=h),nt(c)||(c=_),nt(f)||(f=c),nt(p)||(p=_),et(m)||(m=!1),null==S&&(S=0);let A=!1;const O=function(t){t&&t.cancelable&&(y&&A?(t.preventDefault(),t.returnValue=!1):y||(t.preventDefault(),t.returnValue=!1))},w=function(t=Q){A&&(O(t),"touchmove"===t.type&&oe(t),t.shiftKey?f(t):c(t))},v=function(t=Q){A&&(O(t),"touchend"===t.type&&oe(t,b),A.artefact.dropArtefact(),t.shiftKey?d(t):h(t),A=!1)};ge[s.name]||(ge[s.name]=[],e(o,a,k));const C=function(){const t=`${s.name}_${r.name}_${S}`;ge[s.name]=ge[s.name].filter((e=>e.name!==t)),ge[s.name].length||i(o,a,k)},x=function(t){if(!t)return A;"exit"===t||"drop"===t?(v(),p()):C()},P={name:`${s.name}_${r.name}_${S}`,exposeCurrentArtefact:m,target:k,processingOrder:S,pickup:function(t=Q){O(t);let e=t.type;return"touchstart"!==e&&"touchcancel"!==e||oe(t,b),A=r.getArtefactAt(n),A&&(A.artefact.pickupArtefact(n),t.shiftKey?u(t):l(t)),{current:A,move:w,drop:v}},move:w,drop:v,kill:C,getCurrent:x};return ge[s.name].push(P),ge[s.name].sort(((t,e)=>t.processingOrder-e.processingOrder)),{exposeCurrentArtefact:m,getCurrent:x,kill:C,zone:s}}(t,((t,i,n)=>{bt(t,e,n),bt("move",s,n),bt(i,r,n)}),((t,i,n)=>{St(t,e,n),St("move",s,n),St(i,r,n)}));return o.exposeCurrentArtefact?o.getCurrent:o.kill},be={},Se=function(t=Q){const e=(t=Q)=>{if(t&&t.target){let e=t.target,s="";for(;!s&&(ge[e.id]&&(s=e.id),"BODY"!==e.tagName);)e=e.parentElement;const n=be[s];n?(n.onKeyDown(t),i=n.onKeyUp):i=_}};let i=_;const s=t=>{i(t)};return function(t=Q,e,i){let{zone:s}=t;if(!s)return new Error("keyboardZone constructor - no zone supplied");if(s.substring&&(s=artefact[s]),!s||["Canvas","Stack"].indexOf(s.type)<0)return new Error("keyboardZone constructor - zone object is not a Stack or Canvas wrapper");let n=s.domElement;if(!n)return new Error("keyboardZone constructor - zone does not contain a target DOM element");let r=be[s.name];r||(be[s.name]={},r=be[s.name],e(n)),r.extraKeys||(r.extraKeys={Shift:!1,Control:!1,Alt:!1,Meta:!1});const o=["none","shiftOnly","altOnly","ctrlOnly","metaOnly","shiftAlt","shiftCtrl","shiftMeta","altCtrl","altMeta","ctrlMeta","shiftAltCtrl","shiftAltMeta","shiftCtrlMeta","altCtrlMeta","all"];if(!r.keyGroups){const t={};o.forEach((e=>t[e]={})),r.keyGroups=t}const a=r.keyGroups;return o.forEach((e=>{const i=t[e];null!=i&&ht(a[e],i)})),r.onKeyDown||(r.onKeyDown=(t=Q)=>{if(t&&t.key){t.preventDefault();const{extraKeys:e,keyGroups:i}=r,{key:s}=t;if("Tab"===s||"Escape"===s)return void n.blur();if(null!=e[s])return void(e[s]=!0);const{Shift:o,Control:a,Alt:l,Meta:h}=e;let c=i.none;(o||a||l||h)&&(c=o?l?a?h?i.all:i.shiftAltCtrl:h?i.shiftAltMeta:i.shiftAlt:a?h?i.shiftCtrlMeta:i.shiftCtrl:h?i.shiftMeta:i.shiftOnly:l?a?h?i.altCtrlMeta:i.altCtrl:h?i.altMeta:i.altOnly:a?h?i.ctrlMeta:i.ctrlOnly:h?i.altOnly:i.none),c[s]&&c[s]()}}),r.onKeyUp||(r.onKeyUp=(t=Q)=>{if(t&&t.key){t.preventDefault();const{extraKeys:e}=r,{key:i}=t;null!=e[i]&&(e[i]=!1)}}),r.kill||(r.kill=function(){delete be[s.name],i(n)}),{kill:r.kill,getMappedKeys:(t="none")=>null!=r.keyGroups[t]?Object.keys(r.keyGroups[t]):[]}}(t,(t=>{wt("keydown",e,t),wt("keyup",s,t)}),(t=>{vt("keydown",e,t),vt("keyup",s,t)}))};var ke=function(){var t=4022871197;return function(e){if(e){e=e.toString();for(var i=0;i<e.length;i++){var s=.02519603282416938*(t+=e.charCodeAt(i));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)}t=4022871197}},Ae=function(t){return function(){var e,i,s=48,n=1,r=s,o=new Array(s),a=0,l=new ke;for(e=0;e<s;e++)o[e]=l(Math.random());var h=function(){++r>=s&&(r=0);var t=1768863*o[r]+2.3283064365386963e-10*n;return o[r]=t-(n=0|t)},c=function(t){return Math.floor(t*(h()+11102230246251565e-32*(2097152*h()|0)))};c.string=function(t){var e,i="";for(e=0;e<t;e++)i+=String.fromCharCode(33+c(94));return i};var u=function(){var t=Array.prototype.slice.call(arguments);for(e=0;e<t.length;e++)for(i=0;i<s;i++)o[i]-=l(t[e]),o[i]<0&&(o[i]+=1)};return c.cleanString=function(t){return t=(t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/[\x00-\x1F]/gi,"")).replace(/\n /,"\n")},c.hashString=function(t){for(t=c.cleanString(t),l(t),e=0;e<t.length;e++)for(a=t.charCodeAt(e),i=0;i<s;i++)o[i]-=l(a),o[i]<0&&(o[i]+=1)},c.seed=function(t){var e,i,s,n;null==t&&(t=Math.random()),"string"!=typeof t&&(e=t,i=function(t,e){return"function"==typeof e?e.toString():e},t=JSON.stringify(e,function(t,e){var i=[],s=[];return null==e&&(e=function(t,e){return i[0]===e?"[Circular ~]":"[Circular ~."+s.slice(0,i.indexOf(e)).join(".")+"]"}),function(n,r){if(i.length>0){var o=i.indexOf(this);~o?i.splice(o+1):i.push(this),~o?s.splice(o,1/0,n):s.push(n),~i.indexOf(r)&&(r=e.call(this,n,r))}else i.push(r);return null==t?r:t.call(this,n,r)}}(i,n),s)),c.initState(),c.hashString(t)},c.addEntropy=function(){var t=[];for(e=0;e<arguments.length;e++)t.push(arguments[e]);u(a+++(new Date).getTime()+t.join("")+Math.random())},c.initState=function(){for(l(),e=0;e<s;e++)o[e]=l(" ");n=1,r=s},c.done=function(){l=null},void 0!==t&&c.seed(t),c.range=function(t){return c(t)},c.random=function(){return c(Number.MAX_VALUE-1)/Number.MAX_VALUE},c.floatBetween=function(t,e){return c.random()*(e-t)+t},c.intBetween=function(t,e){return Math.floor(c.random()*(e-t+1))+t},c}()};const Oe=function(t){return new Ae(t)},State=function(t=Q){return this.set(this.defs),this.lineDash=[],this};let we=State.prototype=Object.create(Object.prototype);we.type="State",we=Bt(we),we.defs={fillStyle:"rgba(0 0 0 / 1)",strokeStyle:"rgba(0 0 0 / 1)",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:null,lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0 0 0 / 0)",font:"12px sans-serif",textAlign:"left",textBaseline:"top",filter:"none",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"},we.processPacketOut=function(t,e,i){let s=!0;if("lineDash"===t)e.length||(s=i.indexOf("lineDash")>=0);else i.indexOf(t)<0&&e===this.defs[t]&&(s=!1);return s},we.finalizePacketOut=function(t,e){let i=t.fillStyle,s=t.strokeStyle;return i&&!i.substring&&(t.fillStyle=i.name),s&&!s.substring&&(t.strokeStyle=s.name),t},we.set=function(t=Q){let e,i,s=Object.keys(t),n=s.length,r=this.defs;for(i=0;i<n;i++)e=s[i],"name"!=e&&void 0!==r[e]&&(this[e]=t[e],this.dirtyFilterIdentifier=!0);return this},we.get=function(t){let e,i;return e=this.defs[t],null!=e?(i=this[t],null!=i?i:e):void 0},we.getters;let ve=we.setters;we.deltaSetters,ve.fillStyle=function(t){let e;ot(t)&&"styles"===t.lib?this.fillStyle=t:(e=P[t],e?this.fillStyle=e:t.includes("rgb")||t.includes("hsl")||t.includes("#")?this.fillStyle=t:this.fillStyle=window.scrawlEnvironmentColorChecker.checkColor(t))},ve.strokeStyle=function(t){let e;ot(t)&&"styles"===t.lib?this.strokeStyle=t:(e=P[t],e?this.strokeStyle=e:t.includes("rgb")||t.includes("hsl")||t.includes("#")?this.strokeStyle=t:this.strokeStyle=window.scrawlEnvironmentColorChecker.checkColor(t))},ve.shadowColor=function(t){t.includes("rgb")||t.includes("hsl")||t.includes("#")?this.shadowColor=t:this.shadowColor=window.scrawlEnvironmentColorChecker.checkColor(t)},we.allKeys=Object.keys(we.defs),we.mainKeys=["filter","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","shadowBlur","shadowOffsetX","shadowOffsetY"],we.lineKeys=["lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit"],we.styleKeys=["fillStyle","shadowColor","strokeStyle"],we.textKeys=["font"],we.getChanges=function(t,e){let i,s,n,r,o,a,l,h,c,u=this.mainKeys,d=this.lineKeys,p=this.styleKeys,m=this.textKeys,g=this.defs,y={},b=function(t,e){return void 0!==t[e]?t[e]:g[e]};for(t.substring&&(t=f[t]),n=0,r=u.length;n<r;n++)i=u[n],h=b(this,i),c=b(e,i),c!==h&&(y[i]=h);if(this.lineWidth||e.lineWidth)for(n=0,r=d.length;n<r;n++)if(i=d[n],h=b(this,i),c=b(e,i),"lineDash"==i){if(h.length||c.length)if(h.length!=c.length)y.lineDash=h;else{for(l=!1,o=0,a=h.length;o<a;o++)if(h[o]!=c[o]){l=!0;break}l&&(y.lineDash=h)}}else"lineWidth"==i?t.scaleOutline?(s=(h||1)*(t.scale||1),s!==c&&(y.lineWidth=s)):h!==c&&(y.lineWidth=h):c!==h&&(y[i]=h);for(n=0,r=p.length;n<r;n++)i=p[n],c=b(e,i),h=b(this,i),h.substring&&c!==h?y[i]=h:"Color"===h.type?(h=h.getData(),c!==h&&(y[i]=h)):y[i]=h;if("Phrase"===t.type)for(n=0,r=m.length;n<r;n++)i=m[n],h=b(this,i),c=b(e,i),c!==h&&(y[i]=h);return y},we.setStateFromEngine=function(t){let e,i=this.allKeys;for(let s=0,n=i.length;s<n;s++)e=i[s],this[e]=t[e];return this.lineDash=dt(t.lineDash)?t.lineDash:[],this.lineDashOffset=pt(t.lineDashOffset,0),t.textAlign=this.textAlign="left",t.textBaseline=this.textBaseline="top",this};const Ce=function(t){return!!t&&new State(t)},xe=["fillStyle","filter","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","lineCap","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle"];E.State=State;const Coordinate=function(t,e){let i=[0,0];return Object.setPrototypeOf(i,Coordinate.prototype),t&&i.set(t,e),i};let Pe=Coordinate.prototype=Object.create(Array.prototype);Pe.constructor=Coordinate,Pe.type="Coordinate",Pe.set=function(t,e){return dt(t)&&("Coordinate"===t.type?this.setFromArray(t):"Vector"===t.type?this.setFromVector(t):"Quaternion"===t.type?this.setFromVector(t.v):Array.isArray(t)?this.setFromArray(t):dt(e)&&this.setFromArray([t,e])),this},Pe.setFromArray=function(t){return this[0]=t[0],this[1]=t[1],this},Pe.setFromVector=function(t){return this[0]=t.x,this[1]=t.y,this},Pe.zero=function(){return this[0]=0,this[1]=0,this},Pe.vectorAdd=function(t){return this[0]+=t.x,this[1]+=t.y,this},Pe.vectorSubtract=function(t){return this[0]-=t.x,this[1]-=t.y,this},Pe.add=function(t){return this[0]+=t[0],this[1]+=t[1],this},Pe.subtract=function(t){return this[0]-=t[0],this[1]-=t[1],this},Pe.multiply=function(t){return this[0]*=t[0],this[1]*=t[1],this},Pe.divide=function(t){let[e,i]=t;return e&&i&&(this[0]/=e,this[1]/=i),this},Pe.scalarMultiply=function(t){return this[0]*=t,this[1]*=t,this},Pe.scalarDivide=function(t){return t&&t.toFixed&&(this[0]/=t,this[1]/=t),this},Pe.getMagnitude=function(){return Math.hypot(this[0],this[1])},Pe.rotate=function(t){let e,i,s=this[0],n=this[1];return e=Math.atan2(n,s),e+=.01745329251*t,i=Math.hypot(s,n),this[0]=i*Math.cos(e),this[1]=i*Math.sin(e),this},Pe.reverse=function(){return this[0]=-this[0],this[1]=-this[1],this},Pe.getDotProduct=function(t){return this[0]*t[0]+this[1]*t[1]},Pe.normalize=function(){let t=this.getMagnitude();return t>0&&(this[0]/=t,this[1]/=t),this};const De=[],Re=function(t,e){De.length||De.push(new Coordinate);let i=De.shift();return i.set(t,e),i},Fe=function(t){t&&"Coordinate"===t.type&&De.push(t.zero())},Ee=function(t,e){return new Coordinate(t,e)};function Me(t=Q){t.defs=lt(t.defs,{sourceLoaded:!1,source:null,subscribers:null}),t.packetExclusions=ct(t.packetExclusions,["sourceLoaded","source","subscribers"]),t.finalizePacketOut=function(t,e){return this.subscribers&&this.subscribers.length&&(t.subscribers=this.subscribers.map((t=>t.name))),t},t.kill=function(t=!1){return t&&this.source&&this.source.remove(),this.deregister()},t.getters;let e=t.setters;return t.deltaSetters,e.source=function(t){t&&this.sourceLoaded&&this.notifySubscribers()},e.subscribers=_,t.assetConstructor=function(t){return this.makeName(t.name),this.register(),this.subscribers=[],this.set(this.defs),this.set(t),t.subscribe&&this.subscribers.push(t.subscribe),this},t.subscribe=function(t){if(t&&t.name){let e=t.name;this.subscribers.every((t=>t.name!==e))&&this.subscribeAction(t)}},t.subscribeAction=function(t){t&&(this.subscribers.push(t),t.asset=this,t.source=this.source,this.notifySubscriber(t))},t.unsubscribe=function(t){if(t&&t.name){let e=t.name,i=this.subscribers.findIndex((t=>t.name===e));i>=0&&(t.source=null,t.asset=null,t.sourceNaturalHeight=0,t.sourceNaturalWidth=0,t.sourceLoaded=!1,this.subscribers.splice(i,1))}},t.notifySubscribers=function(){this.subscribers.forEach((t=>this.notifySubscriber(t)),this)},t.notifySubscriber=function(t){t.sourceNaturalWidth=this.sourceNaturalWidth,t.sourceNaturalHeight=this.sourceNaturalHeight,t.sourceLoaded=this.sourceLoaded,t.source=this.source,t.dirtyImage=!0,t.dirtyCopyStart=!0,t.dirtyCopyDimensions=!0,t.dirtyImageSubscribers=!0,t.dirtyFilterIdentifier=!0},t}E.Coordinate=Coordinate;const ImageAsset=function(t=Q){return this.assetConstructor(t)};let Ie=ImageAsset.prototype=Object.create(Object.prototype);Ie.type="Image",Ie.lib="asset",Ie.isArtefact=!1,Ie.isAsset=!0,Ie=Bt(Ie),Ie=Me(Ie);Ie.defs=lt(Ie.defs,{intrinsicDimensions:null}),Ie.saveAsPacket=function(){return[this.name,this.type,this.lib,{}]},Ie.stringifyFunction=_,Ie.processPacketOut=_,Ie.finalizePacketOut=_,Ie.clone=K;let He=Ie.getters,Be=Ie.setters;Ie.deltaSetters,He.width=function(){return this.sourceNaturalWidth||this.source.naturalWidth||0},He.height=function(){return this.sourceNaturalHeight||this.source.naturalHeight||0},Be.source=function(t){t&&(["IMG","PICTURE"].indexOf(t.tagName.toUpperCase())>=0&&(this.source=t,this.sourceNaturalWidth=t.naturalWidth,this.sourceNaturalHeight=t.naturalHeight,this.sourceLoaded=t.complete),this.sourceLoaded&&this.notifySubscribers())},Be.currentSrc=function(t){this.currentSrc=t,this.currentFile=this.currentSrc.split("/").pop()},Ie.checkSource=function(t,e){let i=this.source,s="element";if(this.sourceLoaded){let n=this.intrinsicDimensions[this.currentFile];switch(this.currentSrc!==i.currentSrc?(this.set({currentSrc:i.currentSrc}),n=this.intrinsicDimensions[this.currentFile],s=n?"intrinsic":"zero"):n&&(s="intrinsic"),s){case"zero":this.sourceNaturalWidth=0,this.sourceNaturalHeight=0,this.notifySubscribers();break;case"intrinsic":this.sourceNaturalWidth===n[0]&&this.sourceNaturalHeight===n[1]||(this.sourceNaturalWidth=n[0],this.sourceNaturalHeight=n[1],this.notifySubscribers());break;default:this.sourceNaturalWidth===i.naturalWidth&&this.sourceNaturalHeight===i.naturalHeight&&this.sourceNaturalWidth===t&&this.sourceNaturalHeight===e||(this.sourceNaturalWidth=i.naturalWidth,this.sourceNaturalHeight=i.naturalHeight,this.notifySubscribers())}}};const Te=[],Le=[],$e=function(...t){let e=/.*\/(.*?)\./,i=[];return t.forEach((t=>{let s,n,r,o,a=!1,l=!1;if(t.substring){let i=e.exec(t);s=i&&i[1]?i[1]:"",n=t,r="",o=!1,l=!0}else(t=!!ot(t)&&t)&&t.src&&(s=t.name||"",n=t.src,r=t.className||"",o=t.visibility||!1,t.parent&&(a=document.querySelector(t.parent)),l=!0);if(l){let t=Ge({name:s,intrinsicDimensions:{}}),e=document.createElement("img");e.name=s,e.className=r,e.crossorigin="anonymous",e.style.display=o?"block":"none",a&&a.appendChild(e),e.onload=()=>{t.set({source:e})},e.src=n,t.set({source:e}),i.push(s)}else i.push(!1)})),i},je=function(t){let e=/.*\/(.*?)\./;document.querySelectorAll(t).forEach((t=>{let i;if(["IMG","PICTURE"].indexOf(t.tagName.toUpperCase())>=0){if(t.id||t.name)i=t.id||t.name;else{let s=e.exec(t.src);i=s&&s[1]?s[1]:""}let s=t.dataset.dimensions||{};s.substring&&(s=JSON.parse(s));let n=Ge({name:i,source:t,intrinsicDimensions:s,currentSrc:t.currentSrc});t.onload=()=>{n.set({source:t})}}}))},Xe=function(t,e=!1){let i=t.substring?u[t]||c[t]:t;"Canvas"===i.type&&(i=i.base),"Cell"===i.type&&(i.stashOutput=!0,e&&(i.stashOutputAsAsset=e))},Ye=function(t,e=!1){let i;t&&!t.substring?"Group"===t.type?i=t:"Cell"===t.type?i=g[t.name]:"Canvas"===t.type&&(i=g[t.base.name]):t&&t.substring&&(i=g[t]),i&&(i.stashOutput=!0,e&&(i.stashOutputAsAsset=e))},Ne=function(t,e=!1){let i=t.substring?o[t]:t;i.isArtefact&&(i.stashOutput=!0,e&&(i.stashOutputAsAsset=e))},Ge=function(t){return!!t&&new ImageAsset(t)};function ze(t=Q){t.defs=lt(t.defs,{group:null,visibility:!0,calculateOrder:0,stampOrder:0,start:null,handle:null,offset:null,dimensions:null,pivoted:null,mimicked:null,particle:null,lockTo:null,bringToFrontOnDrag:!0,ignoreDragForX:!1,ignoreDragForY:!1,scale:1,roll:0,noUserInteraction:!1,noPositionDependencies:!1,noCanvasEngineUpdates:!1,noFilters:!1,noPathUpdates:!1,purge:null}),t.packetExclusions=ct(t.packetExclusions,["pathObject","mimicked","pivoted"]),t.packetExclusionsByRegex=ct(t.packetExclusionsByRegex,["^(local|dirty|current)","Subscriber$"]),t.packetCoordinates=ct(t.packetCoordinates,["start","handle","offset"]),t.packetObjects=ct(t.packetObjects,["group"]),t.packetFunctions=ct(t.packetFunctions,[]),t.processPacketOut=function(t,e,i){let s=!0;if("lockTo"===t)"start"===e[0]&&"start"===e[1]&&(s=i.indexOf("lockTo")>=0);else"entity"===this.lib?s=this.processEntityPacketOut(t,e,i):this.isArtefact&&(s=this.processDOMPacketOut(t,e,i));return s},t.handlePacketAnchor=function(t,e){if(this.anchor){let i=JSON.parse(this.anchor.saveAsPacket(e))[3];t.anchor=i}return t},t.kill=function(t=!1,e=!1){let i=this.name;return Object.entries(g).forEach((([t,e])=>{e.artefacts.indexOf(i)>=0&&e.removeArtefacts(i)})),this.anchor&&this.demolishAnchor(),Object.entries(o).forEach((([t,e])=>{e.name!==i&&(e.pivot&&e.pivot.name===i&&e.set({pivot:!1}),e.mimic&&e.mimic.name===i&&e.set({mimic:!1}),e.path&&e.path.name===i&&e.set({path:!1}),e.generateAlongPath&&e.generateAlongPath.name===i&&e.set({generateAlongPath:!1}),e.generateInArea&&e.generateInArea.name===i&&e.set({generateInArea:!1}),e.artefact&&e.artefact.name===i&&e.set({artefact:!1}),Array.isArray(e.pins)&&e.pins.forEach(((t,s)=>{ot(t)&&t.name===i&&e.removePinAt(s)})))})),Object.entries(C).forEach((([t,e])=>{e.checkForTarget(i)&&e.removeFromTargets(this)})),this.factoryKill(t,e),this.deregister(),this},t.factoryKill=_;let e=t.getters,i=t.setters,s=t.deltaSetters;return e.positionX=function(){return this.currentStampPosition[0]},e.positionY=function(){return this.currentStampPosition[1]},e.position=function(){return[].concat(this.currentStampPosition)},e.startX=function(){return this.currentStart[0]},e.startY=function(){return this.currentStart[1]},e.start=function(){return[].concat(this.currentStart)},i.startX=function(t){null!=t&&(this.start[0]=t,this.dirtyStart=!0)},i.startY=function(t){null!=t&&(this.start[1]=t,this.dirtyStart=!0)},i.start=function(t,e){this.setCoordinateHelper("start",t,e),this.dirtyStart=!0},s.startX=function(t){let e=this.start;e[0]=z(e[0],t),this.dirtyStart=!0},s.startY=function(t){let e=this.start;e[1]=z(e[1],t),this.dirtyStart=!0},s.start=function(t,e){this.setDeltaCoordinateHelper("start",t,e),this.dirtyStart=!0},e.handleX=function(){return this.currentHandle[0]},e.handleY=function(){return this.currentHandle[1]},e.handle=function(){return[].concat(this.currentHandle)},i.handleX=function(t){null!=t&&(this.handle[0]=t,this.dirtyHandle=!0)},i.handleY=function(t){null!=t&&(this.handle[1]=t,this.dirtyHandle=!0)},i.handle=function(t,e){this.setCoordinateHelper("handle",t,e),this.dirtyHandle=!0},s.handleX=function(t){let e=this.handle;e[0]=z(e[0],t),this.dirtyHandle=!0},s.handleY=function(t){let e=this.handle;e[1]=z(e[1],t),this.dirtyHandle=!0},s.handle=function(t,e){this.setDeltaCoordinateHelper("handle",t,e),this.dirtyHandle=!0},e.offsetX=function(){return this.currentOffset[0]},e.offsetY=function(){return this.currentOffset[1]},e.offset=function(){return[].concat(this.currentOffset)},i.offsetX=function(t){null!=t&&(this.offset[0]=t,this.dirtyOffset=!0)},i.offsetY=function(t){null!=t&&(this.offset[1]=t,this.dirtyOffset=!0)},i.offset=function(t,e){this.setCoordinateHelper("offset",t,e),this.dirtyOffset=!0},s.offsetX=function(t){let e=this.offset;e[0]=z(e[0],t),this.dirtyOffset=!0},s.offsetY=function(t){let e=this.offset;e[1]=z(e[1],t),this.dirtyOffset=!0},s.offset=function(t,e){this.setDeltaCoordinateHelper("offset",t,e),this.dirtyOffset=!0},e.width=function(){return this.currentDimensions[0]},e.height=function(){return this.currentDimensions[1]},e.dimensions=function(){return[].concat(this.currentDimensions)},i.width=function(t){null!=t&&(this.dimensions[0]=t,this.dirtyDimensions=!0)},i.height=function(t){null!=t&&(this.dimensions[1]=t,this.dirtyDimensions=!0)},i.dimensions=function(t,e){this.setCoordinateHelper("dimensions",t,e),this.dirtyDimensions=!0},s.width=function(t){let e=this.dimensions;e[0]=z(e[0],t),this.dirtyDimensions=!0},s.height=function(t){let e=this.dimensions;e[1]=z(e[1],t),this.dirtyDimensions=!0},s.dimensions=function(t,e){this.setDeltaCoordinateHelper("dimensions",t,e),this.dirtyDimensions=!0},e.order=function(){return this.stampOrder},i.order=function(t){this.calculateOrder=t,this.stampOrder=t},i.particle=function(t){et(t)&&!t?(this.particle=null,"particle"===this.lockTo[0]&&(this.lockTo[0]="start"),"particle"===this.lockTo[1]&&(this.lockTo[1]="start"),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0):(this.particle=t,this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0)},i.lockTo=function(t){Array.isArray(t)?(this.lockTo[0]=t[0],this.lockTo[1]=t[1]):(this.lockTo[0]=t,this.lockTo[1]=t),this.dirtyLock=!0,this.dirtyStampPositions=!0},i.lockXTo=function(t){this.lockTo[0]=t,this.dirtyLock=!0,this.dirtyStampPositions=!0},i.lockYTo=function(t){this.lockTo[1]=t,this.dirtyLock=!0,this.dirtyStampPositions=!0},e.roll=function(){return this.currentRotation},i.roll=function(t){this.roll=t,this.dirtyRotation=!0},s.roll=function(t){this.roll+=t,this.dirtyRotation=!0},e.scale=function(){return this.currentScale},i.scale=function(t){this.scale=t,this.dirtyScale=!0},s.scale=function(t){this.scale+=t,this.dirtyScale=!0},i.host=function(t){if(t){let e=o[t];e&&e.here?this.host=e.name:this.host=t}else this.host="";this.dirtyDimensions=!0,this.dirtyHandle=!0,this.dirtyStart=!0,this.dirtyOffset=!0},i.group=function(t){let e;t&&(this.group&&"Group"===this.group.type&&this.group.removeArtefacts(this.name),t.substring?(e=g[t],this.group=e||t):this.group=t),this.group&&"Group"===this.group.type&&this.group.addArtefacts(this.name)},i.noFilters=function(t){this.noFilters=t,this.dirtyFilterIdentifier=!0},t.purgeArtefact=function(t){return t.substring&&(t="all"===t?["pivot","mimic","path","filter"]:[t]),Array.isArray(t)&&t.forEach((t=>function(t,e){switch(e){case"pivot":delete t.pivot,delete t.pivotCorner,delete t.pivotPin,delete t.addPivotHandle,delete t.addPivotOffset,delete t.addPivotRotation;break;case"mimic":delete t.mimic,delete t.useMimicDimensions,delete t.useMimicScale,delete t.useMimicStart,delete t.useMimicHandle,delete t.useMimicOffset,delete t.useMimicRotation,delete t.useMimicFlip,delete t.addOwnDimensionsToMimic,delete t.addOwnScaleToMimic,delete t.addOwnStartToMimic,delete t.addOwnHandleToMimic,delete t.addOwnOffsetToMimic,delete t.addOwnRotationToMimic;break;case"path":delete t.path,delete t.pathPosition,delete t.addPathHandle,delete t.addPathOffset,delete t.addPathRotation,delete t.constantPathSpeed;break;case"filter":delete t.filter,delete t.filters,delete t.isStencil}}(this,t))),this},t.initializePositions=function(){this.dimensions=Ee(),this.start=Ee(),this.handle=Ee(),this.offset=Ee(),this.currentDimensions=Ee(),this.currentStart=Ee(),this.currentHandle=Ee(),this.currentOffset=Ee(),this.currentDragOffset=Ee(),this.currentDragCache=Ee(),this.currentStartCache=Ee(),this.currentStampPosition=Ee(),this.currentStampHandlePosition=Ee(),this.delta={},this.deltaConstraints={},this.lockTo=["start","start"],this.pivoted=[],this.mimicked=[],this.dirtyScale=!0,this.dirtyDimensions=!0,this.dirtyLock=!0,this.dirtyStart=!0,this.dirtyOffset=!0,this.dirtyHandle=!0,this.dirtyRotation=!0,this.isBeingDragged=!1,this.initializeDomPositions()},t.initializeDomPositions=_,t.setCoordinateHelper=function(t,e,i){let s=this[t];Array.isArray(e)?(s[0]=e[0],s[1]=e[1]):ot(e)?mt(e.x,e.y)?(s[0]=pt(e.x,s[0]),s[1]=pt(e.y,s[1])):(s[0]=pt(e.width,e.w,s[0]),s[1]=pt(e.height,e.h,s[1])):(s[0]=e,s[1]=i)},t.setDeltaCoordinateHelper=function(t,e,i){let s=this[t],n=s[0],r=s[1];Array.isArray(e)?(s[0]=z(n,e[0]),s[1]=z(r,e[1])):ot(e)?mt(e.x,e.y)?(s[0]=z(n,pt(e.x,0)),s[1]=z(r,pt(e.y,0))):(s[0]=z(n,pt(e.width,e.w,0)),s[1]=z(r,pt(e.height,e.h,0))):(s[0]=z(n,e),s[1]=z(r,i))},t.getHost=function(){if(this.currentHost)return this.currentHost;if(this.host){let t=o[this.host];if(t)return this.currentHost=t,this.dirtyHost=!0,this.currentHost}return Zt},t.getHere=function(){let t=this.getHost();if(t){if(t.here&&Object.keys(t.here))return t.here;if(t.currentDimensions){let e=t.currentDimensions;if(e)return{w:e[0],h:e[1]}}}return Zt},t.cleanPosition=function(t,e,i){let s,n;for(let r=0;r<2;r++)s=e[r],n=i[r],s.toFixed?t[r]=s:t[r]="left"===s||"top"===s?0:"right"===s||"bottom"===s?n:"center"===s?n/2:parseFloat(s)/100*n;this.dirtyFilterIdentifier=!0},t.cleanScale=function(){this.dirtyScale=!1;let t,e=this.scale,i=this.mimic,s=this.currentScale;i&&this.useMimicScale?i.currentScale?(t=i.currentScale,this.addOwnScaleToMimic&&(t+=e)):(t=e,this.dirtyMimicScale=!0):t=e,this.currentScale=t,this.dirtyDimensions=!0,this.dirtyHandle=!0,s!==this.currentScale&&(this.dirtyPositionSubscribers=!0),this.mimicked&&this.mimicked.length&&(this.dirtyMimicScale=!0),this.dirtyFilterIdentifier=!0},t.cleanDimensions=function(){this.dirtyDimensions=!1;let t=this.getHost(),e=this.dimensions,i=this.currentDimensions;if(t){let s=t.currentDimensions?t.currentDimensions:[t.w,t.h],[n,r]=e,o=i[0],a=i[1];n.substring&&(n=parseFloat(n)/100*s[0]),r.substring&&(r="auto"===r?0:parseFloat(r)/100*s[1]);let l,h=this.mimic;h&&h.name&&this.useMimicDimensions&&(l=h.currentDimensions),l?(i[0]=this.addOwnDimensionsToMimic?l[0]+n:l[0],i[1]=this.addOwnDimensionsToMimic?l[1]+r:l[1]):(i[0]=n,i[1]=r),this.cleanDimensionsAdditionalActions(),this.dirtyStart=!0,this.dirtyHandle=!0,this.dirtyOffset=!0,o===i[0]&&a===i[1]||(this.dirtyPositionSubscribers=!0),this.mimicked&&this.mimicked.length&&(this.dirtyMimicDimensions=!0),this.dirtyFilterIdentifier=!0}else this.dirtyDimensions=!0},t.cleanDimensionsAdditionalActions=_,t.cleanLock=function(){this.dirtyLock=!1,this.dirtyStart=!0,this.dirtyHandle=!0},t.cleanStart=function(){let t,e,i=this.getHost();i&&(this.dirtyStart=!1,ft(i.w,i.h)?(t=i.w,e=i.h):i.currentDimensions?[t,e]=i.currentDimensions:this.dirtyStart=!0),this.dirtyStart||(this.cleanPosition(this.currentStart,this.start,[t,e]),this.dirtyStampPositions=!0)},t.cleanOffset=function(){let t,e,i=this.getHost();i&&(this.dirtyOffset=!1,ft(i.w,i.h)?(t=i.w,e=i.h):i.currentDimensions?[t,e]=i.currentDimensions:this.dirtyOffset=!0),this.dirtyStart||(this.cleanPosition(this.currentOffset,this.offset,[t,e]),this.dirtyStampPositions=!0,this.mimicked&&this.mimicked.length&&(this.dirtyMimicOffset=!0))},t.cleanHandle=function(){this.dirtyHandle=!1;let t=this.currentHandle;this.cleanPosition(t,this.handle,this.currentDimensions),this.dirtyStampHandlePositions=!0,this.mimicked&&this.mimicked.length&&(this.dirtyMimicHandle=!0)},t.cleanRotation=function(){this.dirtyRotation=!1;let t,e=this.roll,i=this.currentRotation,s=this.path,n=this.mimic,r=this.pivot,o=this.lockTo;if(s&&o.indexOf("path")>=0){if(t=e,this.addPathRotation){let e=this.getPathData();e&&(t+=e.angle)}}else n&&this.useMimicRotation&&o.indexOf("mimic")>=0?dt(n.currentRotation)?(t=n.currentRotation,this.addOwnRotationToMimic&&(t+=e)):this.dirtyMimicRotation=!0:(t=e,r&&this.addPivotRotation&&o.indexOf("pivot")>=0&&(dt(r.currentRotation)?t+=r.currentRotation:this.dirtyPivotRotation=!0));this.currentRotation=t,t!==i&&(this.dirtyPositionSubscribers=!0),this.mimicked&&this.mimicked.length&&(this.dirtyMimicRotation=!0),this.dirtyFilterIdentifier=!0},t.cleanStampPositions=function(){this.dirtyStampPositions=!1;let{currentStampPosition:t,currentStart:e,currentOffset:i,currentStartCache:s,currentDragOffset:n}=this,[r,o]=t;if(this.noPositionDependencies)t[0]=e[0],t[1]=e[1];else{let{isBeingDragged:r,lockTo:o,pivot:a,pivotCorner:l,pivotPin:h,addPivotOffset:c,path:u,addPathOffset:d,mimic:f,useMimicStart:p,useMimicOffset:m,addOwnStartToMimic:g,addOwnOffsetToMimic:y,particle:S,ignoreDragForX:k,ignoreDragForY:A}=this;const O=function(t){return("pivot"!==t||a)&&("path"!==t||u)&&("mimic"!==t||f)&&("particle"!==t||b)?t:"start"},w={start:function(t){t.setFromArray(e).add(i)},path:function(t){P?(t.setFromVector(P),d||t.subtract(u.currentOffset)):t.setFromArray(e).add(i)},pivot:function(t){l&&a.getCornerCoordinate?t.setFromArray(a.getCornerCoordinate(l)):"Polyline"==a.type?t.setFromArray(a.getPinAt(h)):t.setFromArray(a.currentStampPosition),c||t.subtract(a.currentOffset),t.add(i)},mimic:function(t){p||m?(t.setFromArray(f.currentStampPosition),p&&g&&t.add(e),m&&y&&t.add(i),p||t.subtract(f.currentStart).add(e),m||t.subtract(f.currentOffset).add(i)):t.setFromArray(e).add(i)},particle:function(t){S.substring&&(S=b[S]),S?t.setFromVector(S.position):t.setFromArray(e).add(i)},mouse:function(t){t.setFromVector(x),r&&(s.setFromArray(t),t.add(n)),t.add(i)}};let v,C,x,P,D=Re(),R=!1;if(D.length=0,r)D.push(k?O(o[0]):"mouse"),D.push(A?O(o[1]):"mouse"),R=!0,this.getCornerCoordinate&&this.cleanPathObject();else for(v=0;v<2;v++)C=O(o[v]),"mouse"===C&&(R=!0),"start"!==C&&(this.dirtyFilterIdentifier=!0),D.push(C);R&&(x=this.getHere()),D.indexOf("path")>=0&&(P=this.getPathData());let[F,E]=D,M=Re(),I=Re();w[F](M),F==E?I.setFromArray(M):w[E](I),t[0]=M[0],t[1]=I[1],Fe(D)}r===t[0]&&o===t[1]||(this.dirtyPositionSubscribers=!0)},t.cleanStampHandlePositions=function(){this.dirtyStampHandlePositions=!1;let t=this.currentStampHandlePosition,e=this.currentHandle,i=t[0],s=t[1];if(this.noPositionDependencies)t[0]=e[0],t[1]=e[1];else{let i,s,n,r=this.lockTo,o=this.pivot,a=this.path,l=this.mimic;for(s=0;s<2;s++){switch(i=r[s],"pivot"!==i||o||(i="start"),"path"!==i||a||(i="start"),"mimic"!==i||l||(i="start"),n=e[s],"start"!==i&&(this.dirtyFilterIdentifier=!0),i){case"pivot":this.addPivotHandle&&(n+=o.currentHandle[s]);break;case"path":this.addPathHandle&&(n+=a.currentHandle[s]);break;case"mimic":this.useMimicHandle&&(n=l.currentHandle[s],this.addOwnHandleToMimic&&(n+=e[s]))}t[s]=n}}this.cleanStampHandlePositionsAdditionalActions(),i===t[0]&&s===t[1]||(this.dirtyPositionSubscribers=!0)},t.cleanStampHandlePositionsAdditionalActions=_,t.checkHit=function(t=[],e){if(this.noUserInteraction)return!1;this.pathObject&&!this.dirtyPathObject||this.cleanPathObject();let i=Array.isArray(t)?t:[t],s=!1;e||(e=ai(),s=!0);let n,r,o=e.engine,a=this.currentStampPosition,l=a[0],h=a[1];if(i.some((t=>{if(Array.isArray(t))n=t[0],r=t[1];else{if(!ft(t,t.x,t.y))return!1;n=t.x,r=t.y}return!(!n.toFixed||!r.toFixed||isNaN(n)||isNaN(r))&&(e.rotateDestination(o,l,h,this),o.isPointInPath(this.pathObject,n,r,this.winding))}),this)){let t=this.checkHitReturn(n,r,e);return s&&li(e),t}return s&&li(e),!1},t.checkHitReturn=function(t,e,i){return{x:t,y:e,artefact:this}},t.pickupArtefact=function(t=Q){let{x:e,y:i}=t;return ft(e,i)&&(this.isBeingDragged=!0,this.currentDragCache.set(this.currentDragOffset),"start"===this.lockTo[0]?this.currentDragOffset[0]=this.currentStart[0]-e:"pivot"===this.lockTo[0]&&this.pivot?this.currentDragOffset[0]=this.pivot.get("startX")-e:"mimic"===this.lockTo[0]&&this.mimic&&(this.currentDragOffset[0]=this.mimic.get("startX")-e),"start"===this.lockTo[1]?this.currentDragOffset[1]=this.currentStart[1]-i:"pivot"===this.lockTo[1]&&this.pivot?this.currentDragOffset[1]=this.pivot.get("startY")-i:"mimic"===this.lockTo[1]&&this.mimic&&(this.currentDragOffset[1]=this.mimic.get("startY")-i),this.bringToFrontOnDrag&&(this.stampOrder+=9999,this.group.batchResort=!0),dt(this.dirtyPathObject)&&(this.dirtyPathObject=!0)),this},t.dropArtefact=function(){return this.start.set(this.currentStartCache).add(this.currentDragOffset),this.dirtyStart=!0,this.currentDragOffset.set(this.currentDragCache),this.bringToFrontOnDrag&&(this.stampOrder-=9999,this.stampOrder<0&&(this.stampOrder=0),this.group.batchResort=!0),dt(this.dirtyPathObject)&&(this.dirtyPathObject=!0),this.isBeingDragged=!1,this},t.updatePositionSubscribers=function(){this.dirtyPositionSubscribers=!1,this.pivoted&&this.pivoted.length&&this.updatePivotSubscribers(),this.mimicked&&this.mimicked.length&&this.updateMimicSubscribers(),this.pathed&&this.pathed.length&&this.updatePathSubscribers()},t.updatePivotSubscribers=_,t.updateMimicSubscribers=_,t.updatePathSubscribers=_,t.updateImageSubscribers=_,t}function We(t=Q){let e={delta:null,noDeltaUpdates:!1,deltaConstraints:null,checkDeltaConstraints:!1,performDeltaChecks:!1};t.defs=lt(t.defs,e),lt(t,e);let i=t.setters;return t.deltaSetters,i.delta=function(t=Q){t&&(this.delta=ht(this.delta,t))},i.deltaConstraints=function(t=Q){t&&(this.deltaConstraints=ht(this.deltaConstraints,t))},t.updateByDelta=function(){return this.setDelta(this.delta),this.checkDeltaConstraints&&this.performDeltaConstraintsChecks(),this},t.reverseByDelta=function(){let t={};const e=this.delta,i=Object.keys(e),s=i.length;for(let n,r,o=0;o<s;o++)n=i[o],r=e[n],r=r.substring?-parseFloat(r)+"%":-r,t[n]=r;return this.setDelta(t),this.checkDeltaConstraints&&this.performDeltaConstraintsChecks(),this},t.performDeltaConstraintsChecks=function(){const{delta:t,deltaConstraints:e}=this;if(this.performDeltaChecks){const i=Object.keys(e),s=i.length;let n,r,o,a,l,h,c,u,d,f,p,m,g,y,b,S;for(m=0;m<s;m++)if(n=i[m],o=e[n],Array.isArray(o)&&3===o.length)if([a,l,h]=e[n],g=!!a.substring,g){if(r=["startX","startY","handleX","handleY","offsetX","offsetY","width","height"].indexOf(n),d=!1,f=0,r>=0?(r<2?d=this.start:r<4?d=this.handle:r<6?d=this.offset:r<8&&(d=this.dimensions),["startY","handleY","offsetY","height"].indexOf(n)>=0&&(f=1),p=d[f]):p=this.get(n),y=parseFloat(a),b=parseFloat(l),S=parseFloat(p),c="",S<y?(c=h,u=0):S>b&&(c=h,u=1),c)switch(c){case"reverse":t[n]=-parseFloat(t[n])+"%",this.set({[n]:S+parseFloat(t[n])+"%"});break;case"loop":u?this.set({[n]:S-(b-y)+"%"}):this.set({[n]:S+(b-y)+"%"})}}else if(p=this.get(n),c="",p<a?(c=h,u=0):p>l&&(c=h,u=1),c)switch(c){case"reverse":t[n]=-t[n],this.set({[n]:p+t[n]});break;case"loop":u?this.set({[n]:p-(l-a)}):this.set({[n]:p+(l-a)})}}else this.performDeltaChecks=!0},t.setDeltaValues=function(t=Q){const e=this.delta,i=Object.keys(t),s=i.length;for(let n,r,o,a,l,h=0;h<s;h++)switch(n=i[h],r=t[n],l=e[n],r.indexOf(":")<0?(o=r,a=!1):[o,a]=r.split(":"),o){case"newString":null!=a&&(e[n]=a);break;case"newNumber":null!=a&&(e[n]=parseFloat(a));break;case"remove":delete e[n];break;case"update":null!=a&&(e[n]=l.substring?a:parseFloat(a));break;case"reverse":a=l.substring?-parseFloat(l)+"%":-l,e[n]=a;break;case"add":l.substring?a=parseFloat(l)+parseFloat(a)+"%":a+=l,e[n]=a;break;case"multiply":l.substring?a=parseFloat(l)*parseFloat(a)+"%":a*=l,e[n]=a}return this},t}function Ve(t=Q){let e={pivot:"",pivotCorner:"",pivotPin:0,addPivotHandle:!1,addPivotOffset:!0,addPivotRotation:!1};t.defs=lt(t.defs,e),lt(t,e),t.packetObjects=ct(t.packetObjects,["pivot"]),t.getters;let i=t.setters;return t.deltaSetters,i.pivot=function(t){if(et(t)&&!t)this.pivot=null,"pivot"===this.lockTo[0]&&(this.lockTo[0]="start"),"pivot"===this.lockTo[1]&&(this.lockTo[1]="start"),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0;else{let e=this.pivot,i=this.name,s=t.substring?o[t]:t;s||(s=l[t],s&&"Cell"!==s.type&&(s=!1)),s&&s.name&&(e&&e.name!==s.name&&ut(e.pivoted,i),ct(s.pivoted,i),this.pivot=s,this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0)}},t.pivotCorners=["topLeft","topRight","bottomRight","bottomLeft"],i.pivotCorner=function(t){this.pivotCorners.indexOf(t)>=0&&(this.pivotCorner=t)},i.addPivotHandle=function(t){this.addPivotHandle=t,this.dirtyHandle=!0},i.addPivotOffset=function(t){this.addPivotOffset=t,this.dirtyOffset=!0},i.addPivotRotation=function(t){this.addPivotRotation=t,this.dirtyRotation=!0},t.updatePivotSubscribers=function(){this.pivoted.forEach((t=>{let e=o[t];e||(e=l[t],e&&"Cell"===e.type||(e=!1)),e&&(e.dirtyStart=!0,e.addPivotHandle&&(e.dirtyHandle=!0),e.addPivotOffset&&(e.dirtyOffset=!0),e.addPivotRotation&&(e.dirtyRotation=!0),"Polyline"===e.type?e.dirtyPins=!0:"Line"!==e.type&&"Quadratic"!==e.type&&"Bezier"!==e.type||e.dirtyPins.push(this.name))}),this)},t}function Ze(t=Q){let e={mimic:"",useMimicDimensions:!1,useMimicScale:!1,useMimicStart:!1,useMimicHandle:!1,useMimicOffset:!1,useMimicRotation:!1,useMimicFlip:!1,addOwnDimensionsToMimic:!1,addOwnScaleToMimic:!1,addOwnStartToMimic:!1,addOwnHandleToMimic:!1,addOwnOffsetToMimic:!1,addOwnRotationToMimic:!1};t.defs=lt(t.defs,e),lt(t,e),t.packetObjects=ct(t.packetObjects,["mimic"]),t.getters;let i=t.setters;return t.deltaSetters,i.mimic=function(t){if(et(t)&&!t)this.mimic=null,"mimic"===this.lockTo[0]&&(this.lockTo[0]="start"),"mimic"===this.lockTo[1]&&(this.lockTo[1]="start"),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0;else{let e=this.mimic,i=this.name,s=t.substring?o[t]:t;s||(s=l[t],s&&"Cell"!==s.type&&(s=!1)),s&&s.name&&(e&&e.name!==s.name&&ut(e.mimicked,i),ct(s.mimicked,i),this.mimic=s,this.useMimicDimensions&&(this.dirtyDimensions=!0),this.useMimicScale&&(this.dirtyScale=!0),this.useMimicStart&&(this.dirtyStart=!0),this.useMimicHandle&&(this.dirtyHandle=!0),this.useMimicOffset&&(this.dirtyOffset=!0),this.useMimicRotation&&(this.dirtyRotation=!0))}},i.useMimicDimensions=function(t){this.useMimicDimensions=t,this.dirtyDimensions=!0},i.useMimicScale=function(t){this.useMimicScale=t,this.dirtyScale=!0},i.useMimicStart=function(t){this.useMimicStart=t,this.dirtyStart=!0},i.useMimicHandle=function(t){this.useMimicHandle=t,this.dirtyHandle=!0},i.useMimicOffset=function(t){this.useMimicOffset=t,this.dirtyOffset=!0},i.useMimicRotation=function(t){this.useMimicRotation=t,this.dirtyRotation=!0},i.addOwnDimensionsToMimic=function(t){this.addOwnDimensionsToMimic=t,this.dirtyDimensions=!0},i.addOwnScaleToMimic=function(t){this.addOwnScaleToMimic=t,this.dirtyScale=!0},i.addOwnStartToMimic=function(t){this.addOwnStartToMimic=t,this.dirtyStart=!0},i.addOwnHandleToMimic=function(t){this.addOwnHandleToMimic=t,this.dirtyHandle=!0},i.addOwnOffsetToMimic=function(t){this.addOwnOffsetToMimic=t,this.dirtyOffset=!0},i.addOwnRotationToMimic=function(t){this.addOwnRotationToMimic=t,this.dirtyRotation=!0},t.updateMimicSubscribers=function(){let t=this.dirtyMimicHandle,e=this.dirtyMimicOffset,i=this.dirtyMimicRotation,s=this.dirtyMimicScale,n=this.dirtyMimicDimensions;this.mimicked.forEach((r=>{let a=o[r];a||(a=l[r],a&&"Cell"===a.type||(a=!1)),a&&(a.useMimicStart&&(a.dirtyStart=!0),t&&a.useMimicHandle&&(a.dirtyHandle=!0),e&&a.useMimicOffset&&(a.dirtyOffset=!0),i&&a.useMimicRotation&&(a.dirtyRotation=!0),s&&a.useMimicScale&&(a.dirtyScale=!0),n&&a.useMimicDimensions&&(a.dirtyDimensions=!0))})),this.dirtyMimicHandle=!1,this.dirtyMimicOffset=!1,this.dirtyMimicRotation=!1,this.dirtyMimicScale=!1,this.dirtyMimicDimensions=!1},t}function _e(t=Q){let e={path:"",pathPosition:0,addPathHandle:!1,addPathOffset:!0,addPathRotation:!1,constantSpeedAlongPath:!1};t.defs=lt(t.defs,e),lt(t,e),t.packetObjects=ct(t.packetObjects,["path"]);let i=t.setters,s=t.deltaSetters;return i.path=function(t){if(et(t)&&!t)this.path=null,"path"===this.lockTo[0]&&(this.lockTo[0]="start"),"path"===this.lockTo[1]&&(this.lockTo[1]="start"),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0;else{let e=this.path,i=t.substring?o[t]:t,s=this.name;i&&i.name&&i.useAsPath&&(e&&e.name!==i.name&&ut(e.pathed,s),ct(i.pathed,s),this.path=i,this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0)}},i.pathPosition=function(t){t<0&&(t=Math.abs(t)),t>1&&(t%=1),this.pathPosition=parseFloat(t.toFixed(6)),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0,this.currentPathData=!1},s.pathPosition=function(t){let e=this.pathPosition+t;e<0&&(e+=1),e>1&&(e%=1),this.pathPosition=parseFloat(e.toFixed(6)),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0,this.currentPathData=!1},i.addPathHandle=function(t){this.addPathHandle=t,this.dirtyHandle=!0},i.addPathOffset=function(t){this.addPathOffset=t,this.dirtyOffset=!0},i.addPathRotation=function(t){this.addPathRotation=t,this.dirtyRotation=!0},t.getPathData=function(){if(this.currentPathData)return this.currentPathData;let t,e=this.pathPosition,i=this.path;if(i){let s=this.constantSpeedAlongPath||this.constantPathSpeed||!1;return t=i.getPathPositionData(e,s),this.addPathRotation&&(this.dirtyRotation=!0),this.currentPathData=t,t}return!1},t}E.ImageAsset=ImageAsset;const Anchor=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.set(t),this.build(),this};let Ue=Anchor.prototype=Object.create(Object.prototype);Ue.type="Anchor",Ue.lib="anchor",Ue.isArtefact=!1,Ue.isAsset=!1,Ue=Bt(Ue);Ue.defs=lt(Ue.defs,{host:null,description:"",download:"",href:"",hreflang:"",ping:"",referrerpolicy:"",rel:"noreferrer",target:"_blank",anchorType:"",clickAction:null,focusAction:!1,blurAction:!1}),Ue.packetExclusions=ct(Ue.packetExclusions,["domElement"]),Ue.packetObjects=ct(Ue.packetExclusions,["host"]),Ue.packetFunctions=ct(Ue.packetFunctions,["clickAction"]),Ue.demolish=function(){this.domElement&&this.hold&&this.hold.removeChild(this.domElement),this.deregister()};let Ke=Ue.setters;Ke.host=function(t){let e=t.substring?o[t]:t;e&&e.name&&(this.host=e)},Ke.hold=function(t){st(t)&&(this.domElement&&this.hold&&this.hold.removeChild(this.domElement),this.hold=t,this.domElement&&this.hold.appendChild(this.domElement))},Ke.download=function(t){this.download=t,this.domElement&&this.update("download")},Ke.href=function(t){this.href=t,this.domElement&&this.update("href")},Ke.hreflang=function(t){this.hreflang=t,this.domElement&&this.update("hreflang")},Ke.ping=function(t){this.ping=t,this.domElement&&this.update("ping")},Ke.referrerpolicy=function(t){this.referrerpolicy=t,this.domElement&&this.update("referrerpolicy")},Ke.rel=function(t){this.rel=t,this.domElement&&this.update("rel")},Ke.target=function(t){this.target=t,this.domElement&&this.update("target")},Ke.anchorType=function(t){this.anchorType=t,this.domElement&&this.update("type")},Ke.description=function(t){this.description=t,this.domElement&&(this.domElement.textContent=t)},Ke.clickAction=function(t){nt(t)&&(this.clickAction=t,this.domElement&&this.domElement.setAttribute("onclick",t()))},Ue.build=function(){this.domElement&&this.hold&&this.hold.removeChild(this.domElement);let t=document.createElement("a");t.id=this.name,this.download&&t.setAttribute("download",this.download),this.href&&t.setAttribute("href",this.href),this.hreflang&&t.setAttribute("hreflang",this.hreflang),this.ping&&t.setAttribute("ping",this.ping),this.referrerpolicy&&t.setAttribute("referrerpolicy",this.referrerpolicy),this.rel&&t.setAttribute("rel",this.rel),this.target&&t.setAttribute("target",this.target),this.anchorType&&t.setAttribute("type",this.anchorType),this.clickAction&&nt(this.clickAction)&&t.setAttribute("onclick",this.clickAction()),this.description&&(t.textContent=this.description),this.focusAction&&t.addEventListener("focus",(t=>this.host.onEnter()),!1),this.blurAction&&t.addEventListener("blur",(t=>this.host.onLeave()),!1),this.domElement=t,this.hold&&this.hold.appendChild(t)},Ue.update=function(t){this.domElement&&this.domElement.setAttribute(t,this[t])},Ue.click=function(){if(this.hasBeenRecentlyClicked)return!1;{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.hasBeenRecentlyClicked=!0;let e=this;return setTimeout((()=>e.hasBeenRecentlyClicked=!1),200),this.domElement.dispatchEvent(t)}};function qe(t=Q){t.defs=lt(t.defs,{anchor:null}),t.demolishAnchor=function(){this.anchor&&this.anchor.demolish()};let e=t.getters,i=t.setters;return t.deltaSetters,e.anchorDescription=function(){return this.anchor?this.anchor.get("description"):""},i.anchorDescription=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.description(t)},e.anchorType=function(){return this.anchor?this.anchor.get("type"):""},i.anchorType=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.anchorType(t)},e.anchorTarget=function(){return this.anchor?this.anchor.get("target"):""},i.anchorTarget=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.target(t)},e.anchorRel=function(){return this.anchor?this.anchor.get("rel"):""},i.anchorRel=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.rel(t)},e.anchorReferrerPolicy=function(){return this.anchor?this.anchor.get("referrerpolicy"):""},i.anchorReferrerPolicy=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.referrerpolicy(t)},e.anchorPing=function(){return this.anchor?this.anchor.get("ping"):""},i.anchorPing=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.ping(t)},e.anchorHreflang=function(){return this.anchor?this.anchor.get("hreflang"):""},i.anchorHreflang=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.hreflang(t)},e.anchorHref=function(){return this.anchor?this.anchor.get("href"):""},i.anchorHref=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.href(t)},e.anchorDownload=function(){return this.anchor?this.anchor.get("download"):""},i.anchorDownload=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.download(t)},i.anchorFocusAction=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.focusAction(t)},i.anchorBlurAction=function(t){this.anchor||this.buildAnchor(),this.anchor&&this.anchor.setters.blurAction(t)},i.anchor=function(t){this.anchor?this.anchor.set(t):this.buildAnchor(t)},t.buildAnchor=function(t){ot(t)&&(this.anchor&&this.anchor.demolish(),t.name||(t.name=`${this.name}-anchor`),t.description||(t.description=`Anchor link for ${this.name} ${this.type}`),t.host=this,t.hold=this.getAnchorHold(),this.anchor=function(t){return!!t&&new Anchor(t)}(t))},t.getAnchorHold=function(){let t=this.currentHost;if(t){if("Canvas"===t.type)return t.navigation;if("Cell"===t.type){let e=t.currentHost?t.currentHost:c[t.host];if(e&&"Canvas"===e.type)return e.navigation}}return this.dirtyAnchorHold=!0,vs},t.rebuildAnchor=function(){this.anchor&&this.anchor.build()},t.clickAnchor=function(){this.anchor&&this.anchor.click()},t}function Qe(t=Q){t.defs=lt(t.defs,{groups:null,groupBuckets:null,batchResort:!0});let e=t.getters,i=t.setters;return e.groups=function(){return[].concat(this.groups)},i.groups=function(t){this.groups=[],this.addGroups(t)},t.sortGroups=function(t=!1){if(this.batchResort){this.batchResort=!1;let t,e,i=Math.floor,s=this.groups,n=[];s.forEach((s=>{t=g[s],e=t?i(t.order):0,n[e]||(n[e]=[]),n[e].push(t)})),this.groupBuckets=n.reduce(((t,e)=>t.concat(e)),[])}},t.initializeCascade=function(){this.groups=[],this.groupBuckets=[]},t.addGroups=function(...t){return t.forEach((t=>{t&&t.substring?ct(this.groups,t):g[t]&&ct(this.groups,t.name)}),this),this.batchResort=!0,this},t.removeGroups=function(...t){return t.forEach((t=>{t&&t.substring?ut(this.groups,t):g[t]&&ut(this.groups,t.name)}),this),this.batchResort=!0,this},t.cascadeAction=function(t,e){let i;return this.groups.forEach((s=>{i=g[s],i&&i[e](t)}),this),this},t.updateArtefacts=function(t){return this.cascadeAction(t,"updateArtefacts"),this},t.setArtefacts=function(t){return this.cascadeAction(t,"setArtefacts"),this},t.addArtefactClasses=function(t){return this.cascadeAction(t,"addArtefactClasses"),this},t.removeArtefactClasses=function(t){return this.cascadeAction(t,"removeArtefactClasses"),this},t.updateByDelta=function(){return this.cascadeAction(!1,"updateByDelta"),this},t.reverseByDelta=function(){return this.cascadeAction(!1,"reverseByDelta"),this},t.getArtefactAt=function(t){if(t=pt(t,this.here,!1)){let e,i;for(let s=this.groups.length-1;s>=0;s--)if(e=g[this.groups[s]],e&&(i=e.getArtefactAt(t),i))return i}return!1},t.getAllArtefactsAt=function(t){if(t=pt(t,this.here,!1)){let e,i,s=[];for(let n=this.groups.length-1;n>=0;n--)e=g[this.groups[n]],e&&(i=e.getAllArtefactsAt(t),i&&(s=s.concat(i)));return s}return[]},t}function Je(t=Q){t.defs=lt(t.defs,{repeat:"repeat",patternMatrix:null});let e=t.setters;return t.repeatValues=["repeat","repeat-x","repeat-y","no-repeat"],e.repeat=function(t){this.repeatValues.indexOf(t)>=0?this.repeat=t:this.repeat=this.defs.repeat},t.matrixNumberPosCheck=["a","b","c","d","e","f"],t.updateMatrixNumber=function(t,e){this.patternMatrix||(this.patternMatrix=new DOMMatrix),t=t.substring?parseFloat(t):t;let i=this.matrixNumberPosCheck.indexOf(e);rt(t)&&i>=0&&(this.patternMatrix[e]=t)},e.matrixA=function(t){this.updateMatrixNumber(t,"a")},e.matrixB=function(t){this.updateMatrixNumber(t,"b")},e.matrixC=function(t){this.updateMatrixNumber(t,"c")},e.matrixD=function(t){this.updateMatrixNumber(t,"d")},e.matrixE=function(t){this.updateMatrixNumber(t,"e")},e.matrixF=function(t){this.updateMatrixNumber(t,"f")},e.stretchX=function(t){this.updateMatrixNumber(t,"a")},e.skewY=function(t){this.updateMatrixNumber(t,"b")},e.skewX=function(t){this.updateMatrixNumber(t,"c")},e.stretchY=function(t){this.updateMatrixNumber(t,"d")},e.shiftX=function(t){this.updateMatrixNumber(t,"e")},e.shiftY=function(t){this.updateMatrixNumber(t,"f")},e.patternMatrix=function(t){if(Array.isArray(t)){let e=this.updateMatrixNumber;e(t[0],"a"),e(t[1],"b"),e(t[2],"c"),e(t[3],"d"),e(t[4],"e"),e(t[5],"f")}},t.buildStyle=function(t){if(t){t.substring&&(t=u[t]);let e=this.source,i=this.sourceLoaded,s=this.repeat,n=t.engine;if("Cell"!==this.type&&"Noise"!==this.type||(e=this.element,i=!0),n&&i){let t=n.createPattern(e,s);return t.setTransform(this.patternMatrix),t}}return"rgb(0 0 0 / 0)"},t}function ti(t=Q){t.defs=lt(t.defs,{filters:null,isStencil:!1,memoizeFilterOutput:!1});let e=t.setters;return e.filters=function(t){Array.isArray(this.filters)||(this.filters=[]),t&&(Array.isArray(t)?(this.filters=t,this.dirtyFilters=!0,this.dirtyImageSubscribers=!0):t.substring&&(ct(this.filters,t),this.dirtyFilters=!0,this.dirtyImageSubscribers=!0),this.dirtyFilterIdentifier=!0)},e.memoizeFilterOutput=function(t){this.memoizeFilterOutput=t,this.updateFilterIdentifier(!!t)},t.updateFilterIdentifier=function(t){this.dirtyFilterIdentifier=!1,this.state&&(this.state.dirtyFilterIdentifier=!1),this.memoizeFilterOutput&&t?this.filterIdentifier=(()=>{function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${t()}${t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`})():this.filterIdentifier=""},t.cleanFilters=function(){this.dirtyFilters=!1,this.dirtyFiltersCache=!0,this.filters||(this.filters=[]);let t,e,i=this.filters,s=Math.floor,n=[];i.forEach((i=>{t=p[i],t&&(e=s(t.order)||0,n[e]||(n[e]=[]),n[e].push(t))})),this.currentFilters=n.reduce(((t,e)=>t.concat(e)),[])},t.addFilters=function(...t){return Array.isArray(this.filters)||(this.filters=[]),t.forEach((t=>{t&&"Filter"===t.type&&(t=t.name),ct(this.filters,t)}),this),this.dirtyFilters=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0,this},t.removeFilters=function(...t){return Array.isArray(this.filters)||(this.filters=[]),t.forEach((t=>{t&&"Filter"===t.type&&(t=t.name),ut(this.filters,t)}),this),this.dirtyFilters=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0,this},t.clearFilters=function(){return Array.isArray(this.filters)||(this.filters=[]),this.filters.length=0,this.dirtyFilters=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0,this},t.preprocessFilters=function(t){for(let e,i=0,s=t.length;i<s;i++){e=t[i];for(let t,i=0,s=e.actions.length;i<s;i++)if(t=e.actions[i],"process-image"==t.action){let e=!0,i=l[t.asset];if(i){"Image"!==i.type&&(i.checkSource(),this.dirtyFilterIdentifier=!0),"Video"!==i.type&&"Sprite"!==i.type&&"Noise"!==i.type&&"Cell"!==i.type&&"RawAsset"!==i.type&&"RdAsset"!==i.type||i.checkSource();let s=i.sourceNaturalWidth,n=i.sourceNaturalHeight,r=i.sourceNaturalDimensions,o=i.currentDimensions;if(s&&n||(r&&r[0]&&r[1]?(s=s||r[0],n=n||r[1]):o&&o[0]&&o[1]&&(s=s||o[0],n=n||o[1])),s&&n){e=!1;let r=t.copyX||0,o=t.copyY||0,a=t.copyWidth||1,l=t.copyHeight||1,h=t.width||1,c=t.height||1;r.substring&&(r=parseFloat(r)/100*s),o.substring&&(o=parseFloat(o)/100*n),a.substring&&(a=parseFloat(a)/100*s),l.substring&&(l=parseFloat(l)/100*n),h.substring&&(h=parseFloat(h)/100*s),c.substring&&(c=parseFloat(c)/100*n),r=Math.abs(r),o=Math.abs(o),a=Math.abs(a),l=Math.abs(l),h=Math.abs(h),c=Math.abs(c),r>s&&(r=s-2,a=1),o>n&&(o=n-2,l=1),a>s&&(a=s-1,r=0),l>n&&(l=n-1,o=0),r+a>s&&(r=s-a-1),o+l>n&&(o=n-l-1);let u=ai(),d=u.engine,f=u.element;f.width=h,f.height=c,d.setTransform(1,0,0,1,0,0),d.globalCompositeOperation="source-over",d.globalAlpha=1;let p=i.source||i.element;d.drawImage(p,r,o,a,l,0,0,h,c),t.assetData=d.getImageData(0,0,h,c),li(u)}}e&&(t.assetData={width:1,height:1,data:new Uint8ClampedArray(4)})}e.dirtyFilterIdentifier&&(this.dirtyFilterIdentifier=!0)}const e=this.state;if(e)if(e.dirtyFilterIdentifier)this.dirtyFilterIdentifier=!0;else{let{fillStyle:t,strokeStyle:i}=e;(P[t]&&P[t].dirtyFilterIdentifier||P[i]&&P[i].dirtyFilterIdentifier)&&(this.dirtyFilterIdentifier=!0)}(this.dirtyFilterIdentifier||this.state&&this.state.dirtyFilterIdentifier)&&this.updateFilterIdentifier(!0)},t}E.Anchor=Anchor;const Cell=function(t=Q){if(this.makeName(t.name),t.isPool||this.register(),this.initializePositions(),this.initializeCascade(),!it(t.element)){let e=document.createElement("canvas");e.id=this.name,e.width=300,e.height=150,t.element=e}return this.installElement(t.element),t.isPool?this.set(this.poolDefs):this.set(this.defs),this.set(t),this.state.setStateFromEngine(this.engine),t.isPool||xi({name:this.name,host:this.name}),this.subscribers=[],this.sourceNaturalDimensions=Ee(),this.dirtyDimensionsOverride=!0,this.sourceLoaded=!0,this.here={},this};let ei=Cell.prototype=Object.create(Object.prototype);ei.type="Cell",ei.lib="cell",ei.isArtefact=!1,ei.isAsset=!0,ei=Bt(ei),ei=Me(ei),ei=ze(ei),ei=We(ei),ei=Ve(ei),ei=Ze(ei),ei=_e(ei),ei=qe(ei),ei=Qe(ei),ei=Je(ei),ei=ti(ei);ei.defs=lt(ei.defs,{cleared:!0,compiled:!0,shown:!0,compileOrder:0,showOrder:0,backgroundColor:"",clearAlpha:0,alpha:1,composite:"source-over",scale:1,flipReverse:!1,flipUpend:!1,filter:"none",isBase:!1,useAsPattern:!1,controller:null,includeInCascadeEventActions:!1}),delete ei.defs.source,delete ei.defs.sourceLoaded,ei.stringifyFunction=_,ei.processPacketOut=_,ei.finalizePacketOut=_,ei.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},ei.clone=K,ei.factoryKill=function(){let t=this.name;Object.entries(c).forEach((([e,i])=>{i.cells.indexOf(t)>=0&&i.removeCell(t),i.base&&i.base.name===t&&i.set({visibility:!1})})),Object.entries(o).forEach((([e,i])=>{if(i.name!==t){let e=i.state;if(e){let i=e.fillStyle,s=e.strokeStyle;i.name&&i.name===t&&(e.fillStyle=e.defs.fillStyle),s.name&&s.name===t&&(e.strokeStyle=e.defs.strokeStyle)}}})),g[t]&&g[t].kill()};let ii=ei.getters,si=ei.setters,ni=ei.deltaSetters;ei.get=function(t){let e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t],s=this.state;return null!=i?(e=this[t],null!=e?e:i):(i=s.defs[t],null!=i?(e=s[t],null!=e?e:i):undef)}},ii.width=function(){return this.currentDimensions[0]||this.element.getAttribute("width")},si.width=function(t){null!=t&&(this.dimensions[0]=t,this.dirtyDimensions=!0,this.dirtyDimensionsOverride=!0)},ii.height=function(){return this.currentDimensions[1]||this.element.getAttribute("height")},si.height=function(t){null!=t&&(this.dimensions[1]=t,this.dirtyDimensions=!0,this.dirtyDimensionsOverride=!0)},ii.dimensions=function(){return[this.currentDimensions[0]||this.element.getAttribute("width"),this.currentDimensions[1]||this.element.getAttribute("height")]},si.dimensions=function(t,e){this.setCoordinateHelper("dimensions",t,e),this.dirtyDimensions=!0,this.dirtyDimensionsOverride=!0},si.source=function(){},si.engine=function(t){},si.state=function(t){},si.element=function(t){it(t)&&this.installElement(t)},si.backgroundColor=function(t){"rgb(0 0 0 / 0)"!==t&&"rgba(0 0 0 / 0)"!==t&&"rgba(0,0,0,0)"!==t&&"rgba(0, 0, 0, 0)"!==t&&"transparent"!==t&&"#00000000"!==t&&"#0000"!==t||(t=""),this.backgroundColor=t},si.cleared=function(t){this.cleared=t,this.updateControllerCells()},si.compiled=function(t){this.compiled=t,this.updateControllerCells()},si.shown=function(t){this.shown=t,this.updateControllerCells()},si.compileOrder=function(t){this.compileOrder=t,this.updateControllerCells()},si.showOrder=function(t){this.showOrder=t,this.updateControllerCells()},si.stashX=function(t){this.stashCoordinates||(this.stashCoordinates=[0,0]),this.stashCoordinates[0]=t},si.stashY=function(t){this.stashCoordinates||(this.stashCoordinates=[0,0]),this.stashCoordinates[1]=t},si.stashWidth=function(t){if(!this.stashDimensions){let t=this.currentDimensions;this.stashDimensions=[t[0],t[1]]}this.stashDimensions[0]=t},si.stashHeight=function(t){if(!this.stashDimensions){let t=this.currentDimensions;this.stashDimensions=[t[0],t[1]]}this.stashDimensions[1]=t},ni.stashX=function(t){this.stashCoordinates||(this.stashCoordinates=[0,0]);let e=this.stashCoordinates;e[0]=addStrings(e[0],t)},ni.stashY=function(t){this.stashCoordinates||(this.stashCoordinates=[0,0]);let e=this.stashCoordinates;e[1]=addStrings(e[1],t)},ni.stashWidth=function(t){if(!this.stashDimensions){let t=this.currentDimensions;this.stashDimensions=[t[0],t[1]]}let e=this.stashDimensions;e[0]=addStrings(e[0],t)},ni.stashHeight=function(t){if(!this.stashDimensions){let t=this.currentDimensions;this.stashDimensions=[t[0],t[1]]}let e=this.stashDimensions;e[1]=addStrings(e[1],t)},si.clearAlpha=function(t){t.toFixed&&(t>1?t=1:t<0&&(t=0),this.clearAlpha=t)},ni.clearAlpha=function(t){t.toFixed&&((t+=this.clearAlpha)>1?t=1:t<0&&(t=0),this.clearAlpha=t)},si.smoothFont=function(t){const{element:e}=this;if(e){const{style:i}=e;i&&(t?(i.webkitFontSmoothing="auto",i.mozOsxFontSmoothing="auto",i.smoothFont="auto"):(i.webkitFontSmoothing="none",i.mozOsxFontSmoothing="grayscale",i.smoothFont="never"))}},si.checkForEntityHover=function(t){g[this.name].set({checkForEntityHover:t})},si.onEntityHover=function(t){g[this.name].set({onEntityHover:t})},si.onEntityNoHover=function(t){g[this.name].set({onEntityNoHover:t})},ii.group=function(){return g[this.name]},ei.checkSource=function(t,e){this.currentDimensions[0]===t&&this.currentDimensions[1]===e||this.notifySubscribers()},ei.getData=function(t,e){return this.checkSource(this.sourceNaturalDimensions[0],this.sourceNaturalDimensions[1]),this.buildStyle(e)},ei.updateArtefacts=function(t=Q){const e=this.groupBuckets;let i,s,n,r,o,a;for(n=0,r=e.length;n<r;n++)for(s=e[n].artefactCalculateBuckets,o=0,a=s.length;o<a;o++)i=s[o],t.dirtyScale&&(i.dirtyScale=!0),t.dirtyDimensions&&(i.dirtyDimensions=!0),t.dirtyLock&&(i.dirtyLock=!0),t.dirtyStart&&(i.dirtyStart=!0),t.dirtyOffset&&(i.dirtyOffset=!0),t.dirtyHandle&&(i.dirtyHandle=!0),t.dirtyRotation&&(i.dirtyRotation=!0),t.dirtyPathObject&&(i.dirtyPathObject=!0)},ei.cleanDimensionsAdditionalActions=function(){let t=this.element;if(t){let e=this.controller,i=this.currentDimensions,s=this.isBase,n=Mt(),r=Ft();if(this.cleared||this.dirtyDimensionsOverride){if(this.dirtyDimensionsOverride=!1,n){if(s&&e&&(e.baseMatchesCanvasDimensions||e.isComponent)){let t=this.controller.currentDimensions,e=this.dimensions;e[0]=i[0]=t[0],e[1]=i[1]=t[1]}let[n,r]=i;t.width=n,t.height=r}else{if(s&&e&&(e.baseMatchesCanvasDimensions||e.isComponent)){let t=this.controller.currentDimensions,e=this.dimensions;e[0]=i[0]=t[0],e[1]=i[1]=t[1]}let[o,a]=i;n?(t.width=o,t.height=a):(t.width=o*r,t.height=a*r)}this.setEngineFromState(this.engine),s&&e&&e.updateBaseHere(),this.groupBuckets&&this.updateArtefacts({dirtyDimensions:!0})}}},ei.notifySubscriber=function(t){t.sourceNaturalDimensions||(t.sourceNaturalDimensions=[]),t.sourceNaturalWidth=this.currentDimensions[0],t.sourceNaturalHeight=this.currentDimensions[1],t.sourceLoaded=!0,t.dirtyImage=!0,t.dirtyCopyStart=!0,t.dirtyCopyDimensions=!0},ei.subscribeAction=function(t={}){this.subscribers.push(t),t.asset=this,t.source=this.element,this.notifySubscriber(t)},ei.installElement=function(t){return this.element=t,this.engine=this.element.getContext("2d"),this.state=Ce({engine:this.engine}),this},ei.updateControllerCells=function(){const{controller:t,currentHost:e}=this;if(t)t.dirtyCells=!0;else if(e){let t=e.getHost();t&&(t.dirtyCells=!0)}},ei.setEngineFromState=function(t){const e=this.state,i=e.allKeys,s=i.length;let n,r,o,a;for(n=0;n<s;n++)r=i[n],o=t[r],a=e[r],"lineDash"===r?(t.lineDash=a,t.setLineDash(t.lineDash)):o!==a&&(t[r]=a);return"left"!==t.textAlign&&(t.textAlign="left"),"top"!==t.textBaseline&&(t.textBaseline="top"),this},ei.setToDefaults=function(){let t=this.state.defs,e=this.state,i=this.engine,s=Array.isArray;return Object.entries(t).forEach((([t,n])=>{"lineDash"===t?(s(i.lineDash)?i.lineDash.length=0:i.lineDash=[],s(e.lineDash)?e.lineDash.length=0:e.lineDash=[]):(i[t]=n,e[t]=n)})),i.textAlign=e.textAlign="left",i.textBaseline=e.textBaseline="top",this},ei.stylesArray=["Gradient","RadialGradient","Pattern"],ei.setEngine=function(t){const e=this.state,i=t.state;if(i){let s,n,r=i.getChanges(t,e),o=this.setEngineActions,a=this.stylesArray;if(Object.keys(r).length)for(n in s=this.engine,r)o[n](r[n],s,a,t,this),e[n]=r[n]}return t},ei.setEngineActions={fillStyle:function(t,e,i,s,n){if(t.substring){let i=!1;D.indexOf(t)>=0?i=P[t]:d.indexOf(t)>=0&&(i=u[t]),i?(s.state.fillStyle=i,e.fillStyle=i.getData(s,n)):e.fillStyle=t}else e.fillStyle=t.getData(s,n)},filter:function(t,e){e.filter=t},font:function(t,e){e.font=t},globalAlpha:function(t,e){e.globalAlpha=t},globalCompositeOperation:function(t,e){e.globalCompositeOperation=t},imageSmoothingEnabled:function(t,e){e.imageSmoothingEnabled=t},imageSmoothingQuality:function(t,e){e.imageSmoothingQuality=t},lineCap:function(t,e){e.lineCap=t},lineDash:function(t,e){e.lineDash=t,e.setLineDash&&e.setLineDash(t)},lineDashOffset:function(t,e){e.lineDashOffset=t},lineJoin:function(t,e){e.lineJoin=t},lineWidth:function(t,e){e.lineWidth=t},miterLimit:function(t,e){e.miterLimit=t},shadowBlur:function(t,e){e.shadowBlur=t},shadowColor:function(t,e){e.shadowColor=t},shadowOffsetX:function(t,e){e.shadowOffsetX=t},shadowOffsetY:function(t,e){e.shadowOffsetY=t},strokeStyle:function(t,e,i,s,n){if(t.substring){let i=!1;D.indexOf(t)>=0?i=P[t]:d.indexOf(t)>=0&&(i=u[t]),i?(s.state.strokeStyle=i,e.strokeStyle=i.getData(s,n)):e.strokeStyle=t}else e.strokeStyle=t.getData(s,n)}},ei.clearShadow=function(){return this.engine.shadowOffsetX=0,this.engine.shadowOffsetY=0,this.engine.shadowBlur=0,this.state.shadowOffsetX=0,this.state.shadowOffsetY=0,this.state.shadowBlur=0,this},ei.restoreShadow=function(t){let e=t.state;return this.engine.shadowOffsetX=e.shadowOffsetX,this.engine.shadowOffsetY=e.shadowOffsetY,this.engine.shadowBlur=e.shadowBlur,this.state.shadowOffsetX=e.shadowOffsetX,this.state.shadowOffsetY=e.shadowOffsetY,this.state.shadowBlur=e.shadowBlur,this},ei.setToClearShape=function(){return this.engine.fillStyle="rgb(0 0 0 / 0)",this.engine.strokeStyle="rgb(0 0 0 / 0)",this.engine.shadowColor="rgb(0 0 0 / 0)",this.state.fillStyle="rgb(0 0 0 / 0)",this.state.strokeStyle="rgb(0 0 0 / 0)",this.state.shadowColor="rgb(0 0 0 / 0)",this},ei.saveEngine=function(){return this.engine.save(),this},ei.restoreEngine=function(){return this.engine.restore(),this},ei.getComputedFontSizes=function(){let t=this.getHost();if(t&&t.domElement){let e=window.getComputedStyle(t.domElement),i=window.getComputedStyle(document.documentElement);return[parseFloat(e.fontSize),parseFloat(i.fontSize),window.innerWidth,window.innerHeight]}return!1};const ri=function(t){if(t){if(t.setTransform(1,0,0,1,0,0),!Mt()){const e=Ft();return t.scale(e,e),e}t.scale(1,1)}return 1};ei.clear=function(){const{element:t,engine:e,backgroundColor:i,clearAlpha:s,currentDimensions:n}=this,[r,o]=n;this.prepareStamp();let a=ri(e),l=r*a,h=o*a;if(this.useAsPattern&&(t.width=r,t.height=o),i)e.save(),e.fillStyle=i,e.globalCompositeOperation="source-over",e.globalAlpha=1,e.fillRect(0,0,r,o),e.restore();else if(s){e.save();let i=ai(),{engine:n,element:a}=i;this.useAsPattern?(a.width=r,a.height=o,n.drawImage(t,0,0,r,o,0,0,r,o),e.clearRect(0,0,r,o),e.globalAlpha=s,e.drawImage(a,0,0,r,o,0,0,r,o)):(a.width=l,a.height=h,n.drawImage(t,0,0,r,o,0,0,r,o),e.clearRect(0,0,r,o),e.globalAlpha=s,e.drawImage(a,0,0,l,h,0,0,r,o)),e.restore(),li(i)}else e.clearRect(0,0,r,o)},ei.compile=function(){this.stashOutput,this.sortGroups(),this.cleared||this.prepareStamp(),!this.dirtyFilters&&this.currentFilters||this.cleanFilters(),ri(this.engine);const t=this.groupBuckets,e=t.length;for(let i,s=0;s<e;s++)i=t[s],i&&i.stamp&&i.stamp();!this.noFilters&&this.filters&&this.filters.length&&this.applyFilters(),this.stashOutputAction()},ei.show=function(){let t=this.getHost(),e=!(!t||!t.engine)&&t.engine;if(e){let i=Math.floor,s=t.currentDimensions,n=i(s[0]),r=i(s[1]);if(!n||!r)return!1;let o,{currentScale:a,currentDimensions:l,composite:h,alpha:c,controller:u,element:d,isBase:f,currentStampHandlePosition:p,currentStampPosition:m}=this,g=i(l[0]),y=i(l[1]);if(e.save(),ri(e),e.filter=this.filter,f){let t,s;switch(this.basePaste||(this.basePaste=[]),o=this.basePaste,this.cleared||this.compiled||this.prepareStamp(),e.globalCompositeOperation="source-over",e.globalAlpha=1,e.clearRect(0,0,n,r),e.globalCompositeOperation=h,e.globalAlpha=c,u?u.fit:"none"){case"contain":t=n/(g||1),s=r/(y||1),t>s?(o[0]=i((n-g*s)/2),o[1]=0,o[2]=i(g*s),o[3]=i(y*s)):(o[0]=0,o[1]=i((r-y*t)/2),o[2]=i(g*t),o[3]=i(y*t));break;case"cover":t=n/(g||1),s=r/(y||1),t<s?(o[0]=i((n-g*s)/2),o[1]=0,o[2]=i(g*s),o[3]=i(y*s)):(o[0]=0,o[1]=i((r-y*t)/2),o[2]=i(g*t),o[3]=i(y*t));break;case"fill":o[0]=0,o[1]=0,o[2]=i(n),o[3]=i(r);break;default:o[0]=i((n-g)/2),o[1]=i((r-y)/2),o[2]=g,o[3]=y}}else a>0&&(this.paste||(this.paste=[]),o=this.paste,this.noDeltaUpdates||this.setDelta(this.delta),this.cleared||this.compiled||this.prepareStamp(),e.globalCompositeOperation=h,e.globalAlpha=c,o[0]=i(-p[0]*a),o[1]=i(-p[1]*a),o[2]=i(g*a),o[3]=i(y*a),this.rotateDestination(e,...m));e.drawImage(d,0,0,g,y,...o),e.restore()}},ei.applyFilters=function(){let t=this.engine,e=t.getImageData(0,0,this.currentDimensions[0],this.currentDimensions[1]);this.preprocessFilters(this.currentFilters);let i=Oi.action({identifier:this.filterIdentifier,image:e,filters:this.currentFilters});i&&t.putImageData(i,0,0)},ei.stashOutputAction=function(){if(this.stashOutput){this.stashOutput=!1;let{currentDimensions:t,stashCoordinates:e,stashDimensions:i,engine:s}=this,[n,r]=t,o=e?e[0]:0,a=e?e[1]:0,l=i?i[0]:n,h=i?i[1]:r;if((l.substring||h.substring||o.substring||a.substring||o||a||l!==n||h!==r)&&(l.substring&&(l=parseFloat(l)/100*n),(isNaN(l)||l<=0)&&(l=1),l>n&&(l=n),h.substring&&(h=parseFloat(h)/100*r),(isNaN(h)||h<=0)&&(h=1),h>r&&(h=r),o.substring&&(o=parseFloat(o)/100*n),(isNaN(o)||o<0)&&(o=0),o+l>n&&(o=n-l),a.substring&&(a=parseFloat(a)/100*r),(isNaN(a)||a<0)&&(a=0),a+h>r&&(a=r-h)),s.save(),s.setTransform(1,0,0,1,0,0),this.stashedImageData=s.getImageData(o,a,l,h),s.restore(),this.stashOutputAsAsset){const t=this.stashOutputAsAsset.substring?this.stashOutputAsAsset:`${this.name}-image`;let e,i;if(this.stashOutputAsAsset=!1,i=ai(),e=i.element,e.width=l,e.height=h,i.engine.putImageData(this.stashedImageData,0,0),this.stashedImage)this.stashedImage.src=e.toDataURL();else{let i=this.stashedImage=document.createElement("img");i.id=t,i.onload=function(){ws.appendChild(i),je(`#${t}`)},i.src=e.toDataURL()}li(i)}}},ei.getHost=function(){if(this.currentHost)return this.currentHost;if(this.host){let t=l[this.host]||o[this.host];return t&&(this.currentHost=t),!!t&&this.currentHost}return!1},ei.updateBaseHere=function(t,e){if(this.isBase){this.here||(this.here={});let i=this.here,s=this.currentDimensions,n=t.active,r=t.localListener?t.originalWidth:t.w,o=t.localListener?t.originalHeight:t.h;if(s[0]!==r||s[1]!==o){this.basePaste||(this.basePaste=[]);let a,l,h=this.basePaste[0],c=s[0],u=s[1],d=r,f=o,p=t.x,m=t.y,g=c/d||1,y=u/f||1,b=Math.round;switch(i.w=c,i.h=u,e){case"contain":case"cover":h?(a=(d-c/y)/2,i.x=b((p-a)*y),i.y=b(m*y)):(l=(f-u/g)/2,i.x=b(p*g),i.y=b((m-l)*g));break;case"fill":i.x=b(p*g),i.y=b(m*y);break;default:a=(d-c)/2,l=(f-u)/2,i.x=b(p-a),i.y=b(m-l)}(i.x<0||i.x>c)&&(n=!1),(i.y<0||i.y>u)&&(n=!1),i.active=n}else i.x=t.x,i.y=t.y,i.w=r,i.h=o,i.active=n;t.baseActive=n}},ei.prepareStamp=function(){(this.dirtyScale||this.dirtyDimensions||this.dirtyStart||this.dirtyOffset||this.dirtyHandle)&&(this.dirtyPathObject=!0),this.dirtyScale&&this.cleanScale(),this.dirtyDimensions&&(this.cleanDimensions(),this.dirtyAssetSubscribers=!0),this.dirtyLock&&this.cleanLock(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyHandle&&this.cleanHandle(),this.dirtyRotation&&this.cleanRotation(),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0)&&(this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtyStampHandlePositions&&this.cleanStampHandlePositions(),this.dirtyPathObject&&this.cleanPathObject(),this.dirtyPositionSubscribers&&this.updatePositionSubscribers(),this.dirtyAssetSubscribers&&(this.dirtyAssetSubscribers=!1,this.notifySubscribers())},ei.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){let t=this.pathObject=new Path2D,e=this.currentStampHandlePosition,i=this.currentScale,s=this.currentDimensions,n=-e[0]*i,r=-e[1]*i,o=s[0]*i,a=s[1]*i;t.rect(n,r,o,a)}},ei.updateHere=function(){this.here||(this.here={});let t=this.here,[e,i]=this.currentDimensions;t.w=e,t.h=i,t.x=-1e4,t.y=-1e4,t.active=!1;let s=this.currentHost;if(s){let e=s.here;if(e&&e.active){let{x:i,y:s,w:n,h:r}=e;this.pathObject&&!this.dirtyPathObject||this.cleanPathObject();let o=ai(),a=o.engine,[l,h]=this.currentStampPosition;o.rotateDestination(a,l,h,this);let c=a.isPointInPath(this.pathObject,i,s);if(li(o),t.active=c,c){let[e,n]=this.currentStampHandlePosition,{flipUpend:r,flipReverse:o,roll:a,scale:c}=this;if(c){let u=(i-l)/c,d=(s-h)/c;if(o&&(u=-u),r&&(d=-d),a){(o&&!r||!o&&r)&&(a=-a);let t=Re(u,d);t.rotate(-a),[u,d]=t,Fe(t)}u+=e,d+=n,t.x=u,t.y=d}}}}},ei.getEntityHits=function(){let t=[],e=[],i=[];return this.groupBuckets&&this.groupBuckets.forEach((t=>{t.visibility&&e.push(t.getAllArtefactsAt(this.here))}),this),e.length&&(e=e.reduce(((t,e)=>t.concat(e)),[]),e.forEach((e=>{let s=e.artefact;s.visibility&&i.indexOf(s.name)<0&&(i.push(s.name),t.push(s))}))),t},ei.rotateDestination=function(t,e,i,s){let n,r,o=s||this,a=o.mimic,l=o.pivot,h=o.currentRotation;if(a&&a.name&&o.useMimicFlip?(n=a.flipReverse?-1:1,r=a.flipUpend?-1:1):(n=o.flipReverse?-1:1,r=o.flipUpend?-1:1),a&&a.name&&o.useMimicRotation?h=a.currentRotation:l&&l.name&&o.addPivotRotation&&(h=l.currentRotation),h){h*=M;let s=Math.cos(h),o=Math.sin(h);t.setTransform(s*n,o*n,-o*r,s*r,e,i)}else t.setTransform(n,0,0,r,e,i);return this};const oi=[];ei.poolDefs={element:null,engine:null,state:null,width:300,height:100,alpha:1,composite:"source-over"};const ai=function(){oi.length||oi.push(hi({name:`pool_${J()}`,isPool:!0}));let t=oi.shift();return t.engine.save(),t},li=function(t){t&&"Cell"===t.type&&(t.engine.restore(),oi.push(t))},hi=function(t){return!!t&&new Cell(t)};E.Cell=Cell;const Color=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.rgb=[],this.rgb_max=[],this.rgb_min=[],this.hsl=[],this.hsl_max=[],this.hsl_min=[],this.hwb=[],this.hwb_max=[],this.hwb_min=[],this.xyz=[],this.xyz_max=[],this.xyz_min=[],this.lab=[],this.lab_max=[],this.lab_min=[],this.lch=[],this.lch_max=[],this.lch_min=[],this.oklab=[],this.oklab_max=[],this.oklab_min=[],this.oklch=[],this.oklch_max=[],this.oklch_min=[],this.easingFunction=U,this.convert("transparent"),this.convert("black","_min"),this.convert("white","_max"),this.set(t),this};let ci=Color.prototype=Object.create(Object.prototype);ci.type="Color",ci.lib="styles",ci.isArtefact=!1,ci.isAsset=!1,ci=Bt(ci);ci.defs=lt(ci.defs,{rgb:null,rgb_max:null,rgb_min:null,hsl:null,hsl_max:null,hsl_min:null,hwb:null,hwb_max:null,hwb_min:null,xyz:null,xyz_max:null,xyz_min:null,lab:null,lab_max:null,lab_min:null,lch:null,lch_max:null,lch_min:null,oklab:null,oklab_max:null,oklab_min:null,oklch:null,oklch_max:null,oklch_min:null,easing:"linear",easingFunction:null,colorSpace:"RGB",returnColorAs:"RGB"}),ci.packetFunctions=ct(ci.packetFunctions,["easingFunction"]),ci.kill=function(){let t=this.name;return Object.entries(f).forEach((([e,i])=>{let s=i.state;if(s){let e=s.fillStyle,i=s.strokeStyle,n=s.shadowColor;ot(e)&&e.name===t&&(s.fillStyle=s.defs.fillStyle),ot(i)&&i.name===t&&(s.strokeStyle=s.defs.strokeStyle),ot(n)&&n.name===t&&(s.shadowColor=s.defs.shadowColor)}})),this.deregister(),this},ci.get=function(t){if(dt(t)){if(t.toFixed)return this.getRangeColor(t);if("min"===t)return this.getMinimumColor();if("max"===t)return this.getMaximumColor();if("random"===t)return this.generateRandomColor(),this.getCurrentColor();{let e=this.getters[t];if(e)return e.call(this);{let e=this.defs[t];if(void 0!==e){let i=this[t];return void 0!==i?i:e}return undef}}}return this.getCurrentColor()},ci.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs;let r,o,a,l;for(o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!==a&&null!=l&&(r=s[a],r?r.call(this,l):void 0!==n[a]&&(this[a]=l));t.random&&this.generateRandomColor()}return this};let ui=ci.setters;ui.color=function(t){this.convert(t)},ci.setColor=function(t){return this.convert(t),this},ui.minimumColor=function(t){this.convert(t,"_min")},ci.setMinimumColor=function(t){return this.convert(t,"_min"),this},ui.maximumColor=function(t){this.convert(t,"_max")},ci.setMaximumColor=function(t){return this.convert(t,"_max"),this},ui.easing=function(t){this.setEasingHelper(t)},ui.easingFunction=ui.easing,ci.setEasing=function(t){return this.setEasingHelper(t),this},ci.setEasingFunction=ci.setEasing,ci.setEasingHelper=function(t){nt(t)?(this.easing="function",this.easingFunction=t):t.substring&&gt[t]?(this.easing=t,this.easingFunction=U):(this.easing="linear",this.easingFunction=U)},ci.internalColorSpaces=["RGB","HSL","HWB","XYZ","LAB","LCH","OKLAB","OKLCH"],ui.colorSpace=function(t){this.setColorSpaceHelper(t)},ci.setColorSpace=function(t){return this.setColorSpaceHelper(t),this},ci.setColorSpaceHelper=function(t){if(t.substring&&(t=t.toUpperCase(),this.internalColorSpaces.includes(t))){const e=this.getCurrentColor(),i=this.getMinimumColor(),s=this.getMaximumColor();this.colorSpace=t.toUpperCase(),this.updateColorConversions(e,i,s)}},ci.returnedColorSpaces=["RGB","HSL","HWB","LAB","LCH","OKLAB","OKLCH"],ui.returnColorAs=function(t){this.setReturnColorAsHelper(t)},ci.setReturnColorAs=function(t){return this.setReturnColorAsHelper(t),this},ci.setReturnColorAsHelper=function(t){if(t.substring&&(t=t.toUpperCase(),this.returnedColorSpaces.includes(t))){const e=this.getCurrentColor(),i=this.getMinimumColor(),s=this.getMaximumColor();this.returnColorAs=t.toUpperCase(),this.updateColorConversions(e,i,s)}},ci.updateColorConversions=function(t,e,i){this.convert(t),this.convert(e,"_min"),this.convert(i,"_max")},ci.getData=function(){return this.getCurrentColor()},ci.getCurrentColor=function(){const{rgb:t,hsl:e,hwb:i,lab:s,lch:n,oklab:r,oklch:o}=this;return this.returnColor(t,e,i,s,n,r,o)},ci.getMinimumColor=function(){const{rgb_min:t,hsl_min:e,hwb_min:i,lab_min:s,lch_min:n,oklab_min:r,oklch_min:o}=this;return this.returnColor(t,e,i,s,n,r,o)},ci.getMaximumColor=function(){const{rgb_max:t,hsl_max:e,hwb_max:i,lab_max:s,lch_max:n,oklab_max:r,oklch_max:o}=this;return this.returnColor(t,e,i,s,n,r,o)},ci.returnColor=function(t,e,i,s,n,r,o){null==t&&({rgb:t,hsl:e,hwb:i,lab:s,lch:n,oklab:r,oklch:o}=this);const{buildColorString:a,returnColorAs:l}=this;switch(l){case"RGB":return a(...t,"RGB");case"HSL":return a(...e,"HSL");case"HWB":return di?a(...i,"HWB"):a(...t,"RGB");case"LAB":return fi?a(...s,"LAB"):a(...t,"RGB");case"LCH":return pi?a(...n,"LCH"):a(...t,"RGB");case"OKLAB":return mi?a(...r,"OKLAB"):a(...t,"RGB");case"OKLCH":return gi?a(...o,"OKLCH"):a(...t,"RGB");default:return"rgba(0 0 0 / 0)"}},ci.returnColorFromValues=function(t,e,i,s){const{colorSpace:n,returnColorAs:r}=this;let o=this.buildColorString(t,e,i,s,n),a=!1;return"XYZ"===n||n!==r?a=!0:("HWB"!==r||di)&&("LAB"!==r||fi)&&("LCH"!==r||pi)&&("OKLAB"!==r||mi)&&("OKLCH"!==r||gi)||(a=!0),a?(this.setColor(o),this.returnColor()):o},ci.buildColorString=function(t,e,i,s,n){switch(n||(n=this.returnColorAs),n){case"RGB":return`rgb(${Math.round(t)} ${Math.round(e)} ${Math.round(i)} / ${s})`;case"HSL":return`hsl(${t} ${e}% ${i}% / ${s})`;case"HWB":return`hwb(${t} ${e}% ${i}% / ${s})`;case"LAB":return`lab(${t}% ${e} ${i} / ${s})`;case"LCH":return`lch(${t}% ${e} ${i} / ${s})`;case"OKLAB":return`oklab(${100*t}% ${e} ${i} / ${s})`;case"OKLCH":return`oklch(${100*t}% ${e} ${i} / ${s})`;case"XYZ":return`xyz(${t} ${e} ${i} / ${s})`;default:return"rgb(0 0 0 / 0)"}},ci.generateRandomColor=function(){let t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),i=Math.floor(256*Math.random());t>255&&(t=255),e>255&&(e=255),i>255&&(i=255),this.setColor(`rgb(${t} ${e} ${i})`)},ci.checkColor=function(t){if(t.substring){let e="RGB";return t.includes("hsl")?e="HSL":t.includes("hwb")?e="HWB":t.includes("oklab")?e="OKLAB":t.includes("oklch")?e="OKLCH":t.includes("lab")?e="LAB":t.includes("lch")?e="LCH":t.includes("xyz")&&(e="XYZ"),"RGB"===e||"HSL"===e?t:(this.colorSpace=e,this.returnColorAs=e,this.convert(t),this.returnColor())}return"rgba(0 0 0 / 0)"},ci.getRangeColor=function(t,e=!1){if(dt(t)&&t.toFixed){let i=this.colorSpace;e&&["HSL","HWB"].includes(i)?i="RGB":e&&"LCH"===i?i="LAB":e&&"OKLCH"===i&&(i="OKLAB");const s=this.calculateRangeColorValues(t,e),n=this.buildColorString(...s,i);this.setColor(n)}return this.getCurrentColor()},ci.calculateRangeColorValues=function(t,e=!1){const{colorSpace:i,easing:s,easingFunction:n}=this;let r,o,a,l,h,c=i.toLowerCase();e&&["HSL","HWB"].includes(i)?c="rgb":e&&"LCH"===i?c="lab":e&&"OKLCH"===i&&(c="oklab");const[u,d,f,p]=this[`${c}_min`],[m,g,y,b]=this[`${c}_max`];let S=n;!e&&"function"!==s&&gt[s]&&(S=gt[s]);const k=e?t:S(t);switch(c){case"hsl":case"hwb":return h=m-u,o=u===m?u:tt(k,h>180||h<-180?h>0?u+360:u-360:u,m),r=p===b?p:tt(k,p,b),a=d===g?d:tt(k,d,g),l=f===y?f:tt(k,f,y),[o,a,l,r];case"lch":case"oklch":return h=y-f,l=f===y?f:tt(k,h>180||h<-180?h>0?f+360:f-360:f,y),r=p===b?p:tt(k,p,b),a=d===g?d:tt(k,d,g),o=u===m?u:tt(k,u,m),[o,a,l,r];default:return r=p===b?p:tt(k,p,b),o=u===m?u:tt(k,u,m),a=d===g?d:tt(k,d,g),l=f===y?f:tt(k,f,y),[o,a,l,r]}},ci.getAlphaValue=function(t){let e=1;return null!=t&&(e=t.indexOf("%")>0?parseFloat(t)/100:parseFloat(t)),isNaN(e)||e>1?e=1:e<0&&(e=0),e},ci.getHueValue=function(t){return"none"===t?0:(t=t.indexOf("deg")>=0?parseFloat(t):t.indexOf("rad")>=0?parseFloat(t)/M:t.indexOf("grad")>=0?parseFloat(t)/400*360:t.indexOf("turn")>=0?360*parseFloat(t):parseFloat(t),isNaN(t)?0:V(t))},ci.getColorValuesFromString=function(t,e){const i=(t=(t=(t=(t=t.replace(e,"")).replace("(","")).replace(")","")).replace("/","")).split(" ").filter((t=>null!=t&&""!==t));return null!=i[0]&&"none"!==i[0]||(i[0]="0"),null!=i[1]&&"none"!==i[1]||(i[1]="0"),null!=i[2]&&"none"!==i[2]||(i[2]="0"),i},ci.extractFromHwbColorString=function(t){const{getAlphaValue:e,getHueValue:i,getColorValuesFromString:s}=this;let n,r,o,a,l,h,c,u;return n=s(t,"hwb"),h=i(n[0]),c=parseFloat(n[1]),u=parseFloat(n[2]),r=e(n[3]),[o,a,l]=this.convertHWBtoRGB(h,c,u),o=Math.floor(255*o),o>255&&(o=255),o<0&&(o=0),a=Math.floor(255*a),a>255&&(a=255),a<0&&(a=0),l=Math.floor(255*l),l>255&&(l=255),l<0&&(l=0),[r,o,a,l]},ci.extractFromXyzColorString=function(t){const{getAlphaValue:e,getColorValuesFromString:i}=this;let s,n,r,o,a;return s=i(t,"xyz"),r=parseFloat(s[0]),o=parseFloat(s[1]),a=parseFloat(s[2]),n=e(s[3]),[n,r,o,a]},ci.extractFromLabColorString=function(t){const{getAlphaValue:e,getColorValuesFromString:i}=this;let s,n,r,o,a;return s=i(t,"lab"),r=parseFloat(s[0]),r>100&&(r=100),r<0&&(r=0),o=s[1].indexOf("%")>0?1.25*parseFloat(s[1]):parseFloat(s[1]),o>160&&(o=160),o<-160&&(o=-160),a=s[2].indexOf("%")>0?1.25*parseFloat(s[2]):parseFloat(s[2]),a>160&&(a=160),a<-160&&(a=-160),n=e(s[3]),[n,r,o,a]},ci.extractFromOklabColorString=function(t){const{getAlphaValue:e,getColorValuesFromString:i}=this;let s,n,r,o,a;return s=i(t,"oklab"),r=s[0].indexOf("%")>0?parseFloat(s[0])/100:parseFloat(s[0]),r>1&&(r=1),r<0&&(r=0),o=s[1].indexOf("%")>0?parseFloat(s[1])/100*.4:parseFloat(s[1]),o>.5&&(o=.5),o<-.5&&(o=-.5),a=s[2].indexOf("%")>0?parseFloat(s[2])/100*.4:parseFloat(s[2]),a>.5&&(a=.5),a<-.5&&(a=-.5),n=e(s[3]),[n,r,o,a]},ci.extractFromLchColorString=function(t){const{getAlphaValue:e,getHueValue:i,getColorValuesFromString:s}=this;let n,r,o,a,l;return n=s(t,"lch"),o=parseFloat(n[0]),o>100&&(o=100),o<0&&(o=0),a=n[1].indexOf("%")>0?1.5*parseFloat(n[1]):parseFloat(n[1]),a>230&&(a=230),a<0&&(a=0),l=i(n[2]),r=e(n[3]),[r,o,a,l]},ci.extractFromOklchColorString=function(t){const{getAlphaValue:e,getHueValue:i,getColorValuesFromString:s}=this;let n,r,o,a,l;return n=s(t,"oklch"),o=o=n[0].indexOf("%")>0?parseFloat(n[0])/100:parseFloat(n[0]),o>1&&(o=1),o<0&&(o=0),a=n[1].indexOf("%")>0?parseFloat(n[1])/100*.4:parseFloat(n[1]),a>.4&&(a=.4),a<0&&(a=0),l=i(n[2]),r=e(n[3]),[r,o,a,l]},ci.convert=function(t,e=""){t=t.toLowerCase();const i=this[`rgb${e}`],s=this[`hsl${e}`],n=this[`hwb${e}`],r=this[`xyz${e}`],o=this[`lab${e}`],a=this[`lch${e}`],l=this[`oklab${e}`],h=this[`oklch${e}`];if(!i)return this;let c,u,d,f;return i.length=0,s.length=0,n.length=0,r.length=0,o.length=0,a.length=0,l.length=0,h.length=0,t.indexOf("hwb")>=0&&!di?([c,u,d,f]=this.extractFromHwbColorString(t),i.push(u,d,f,c),s.push(...this.convertRGBtoHSL(u,d,f),c),n.push(hue,white,black,c),r.push(...this.convertRGBtoXYZ(u,d,f),c),o.push(...this.convertXYZtoLAB(r[0],r[1],r[2]),c),a.push(...this.convertLABtoLCH(o[0],o[1],o[2]),c),l.push(...this.convertXYZtoOKLAB(r[0],r[1],r[2]),c),h.push(...this.convertOKLABtoOKLCH(l[0],l[1],l[2]),c)):t.indexOf("xyz")>=0?([c,u,d,f]=this.extractFromXyzColorString(t),i.push(...this.convertXYZtoRGB(u,d,f),c),s.push(...this.convertRGBtoHSL(i[0],i[1],i[2]),c),n.push(...this.convertRGBHtoHWB(i[0],i[1],i[2],s[0]),c),r.push(u,d,f,c),o.push(...this.convertXYZtoLAB(u,d,f),c),a.push(...this.convertLABtoLCH(o[0],o[1],o[2]),c),l.push(...this.convertXYZtoOKLAB(r[0],r[1],r[2]),c),h.push(...this.convertOKLABtoOKLCH(l[0],l[1],l[2]),c)):t.indexOf("oklab")>=0&&!mi?([c,u,d,f]=this.extractFromOklabColorString(t),l.push(u,d,f,c),h.push(...this.convertOKLABtoOKLCH(u,d,f),c),r.push(...this.convertOKLABtoXYZ(u,d,f),c),o.push(...this.convertXYZtoLAB(r[0],r[1],r[2]),c),a.push(...this.convertLABtoLCH(o[0],o[1],o[2]),c),i.push(...this.convertXYZtoRGB(r[0],r[1],r[2]),c),s.push(...this.convertRGBtoHSL(i[0],i[1],i[2]),c),n.push(...this.convertRGBHtoHWB(i[0],i[1],i[2],s[0]),c)):t.indexOf("oklch")>=0&&!gi?([c,u,d,f]=this.extractFromOklchColorString(t),h.push(u,d,f,c),l.push(...this.convertOKLCHtoOKLAB(u,d,f),c),r.push(...this.convertOKLABtoXYZ(l[0],l[1],l[2]),c),o.push(...this.convertXYZtoLAB(r[0],r[1],r[2]),c),a.push(...this.convertLABtoLCH(o[0],o[1],o[2]),c),i.push(...this.convertXYZtoRGB(r[0],r[1],r[2]),c),s.push(...this.convertRGBtoHSL(i[0],i[1],i[2]),c),n.push(...this.convertRGBHtoHWB(i[0],i[1],i[2],s[0]),c)):t.indexOf("lab")>=0&&!fi?([c,u,d,f]=this.extractFromLabColorString(t),o.push(u,d,f,c),r.push(...this.convertLABtoXYZ(u,d,f),c),i.push(...this.convertXYZtoRGB(r[0],r[1],r[2]),c),s.push(...this.convertRGBtoHSL(i[0],i[1],i[2]),c),n.push(...this.convertRGBHtoHWB(i[0],i[1],i[2],s[0]),c),a.push(...this.convertLABtoLCH(u,d,f),c),l.push(...this.convertXYZtoOKLAB(r[0],r[1],r[2]),c),h.push(...this.convertOKLABtoOKLCH(l[0],l[1],l[2]),c)):t.indexOf("lch")>=0&&!pi?([c,u,d,f]=this.extractFromLchColorString(t),a.push(u,d,f,c),o.push(...this.convertLCHtoLAB(u,d,f),c),r.push(...this.convertLABtoXYZ(o[0],o[1],o[2]),c),i.push(...this.convertXYZtoRGB(r[0],r[1],r[2]),c),s.push(...this.convertRGBtoHSL(i[0],i[1],i[2]),c),n.push(...this.convertRGBHtoHWB(i[0],i[1],i[2],s[0]),c),l.push(...this.convertXYZtoOKLAB(r[0],r[1],r[2]),c),h.push(...this.convertOKLABtoOKLCH(l[0],l[1],l[2]),c)):([u,d,f,c]=this.getColorFromCanvas(t),i.push(u,d,f,c),s.push(...this.convertRGBtoHSL(u,d,f),c),n.push(...this.convertRGBHtoHWB(u,d,f,s[0]),c),r.push(...this.convertRGBtoXYZ(u,d,f),c),o.push(...this.convertXYZtoLAB(r[0],r[1],r[2]),c),a.push(...this.convertLABtoLCH(o[0],o[1],o[2]),c),l.push(...this.convertXYZtoOKLAB(r[0],r[1],r[2]),c),h.push(...this.convertOKLABtoOKLCH(l[0],l[1],l[2]),c)),this},ci.extractRGBfromColor=function(t){let e,i,s,n;return(t=t.toLowerCase()).includes("hwb")&&!di?([e,i,s,n]=this.extractFromHwbColorString(t),[i,s,n,e]):t.includes("xyz")?([e,i,s,n]=this.extractFromXyzColorString(t),[...this.convertXYZtoRGB(i,s,n),e]):t.includes("oklab")&&!mi?([e,i,s,n]=this.extractFromOklabColorString(t),[...this.convertXYZtoRGB(...this.convertOKLABtoXYZ(i,s,n)),e]):t.indexOf("oklch")>=0&&!gi?([e,i,s,n]=this.extractFromOklchColorString(t),[...this.convertXYZtoRGB(...this.convertOKLABtoXYZ(...this.convertOKLCHtoOKLAB(i,s,n))),e]):t.includes("lab")&&!fi?([e,i,s,n]=this.extractFromLabColorString(t),[...this.convertXYZtoRGB(...this.convertLABtoXYZ(i,s,n)),e]):t.indexOf("lch")>=0&&!pi?([e,i,s,n]=this.extractFromLchColorString(t),[...this.convertXYZtoRGB(...this.convertLABtoXYZ(...this.convertLCHtoLAB(i,s,n))),e]):this.getColorFromCanvas(t)},ci.convertRGBtoHex=function(t,e,i){if(t.substring&&(t=parseInt(t,10)),e.substring&&(e=parseInt(e,10)),i.substring&&(i=parseInt(i,10)),!isNaN(t)&&!isNaN(e)&&!isNaN(i)){return`#${("0"+t.toString(16)).slice(-2)}${("0"+e.toString(16)).slice(-2)}${("0"+i.toString(16)).slice(-2)}`}return"#000000"},ci.getColorFromCanvas=function(t){let e=0,i=0,s=0,n=0;const r=ai(),{element:o,engine:a}=r;o.width=1,o.height=1,a.save(),a.globalAlpha=1,a.globalCompositeOperation="source-over",a.fillStyle=t,a.fillRect(0,0,1,1);const l=a.getImageData(0,0,1,1);return l&&l.data&&([e,i,s,n]=l.data,n/=255),a.restore(),li(r),[e,i,s,n]},ci.convertRGBtoHSL=function(t,e,i){t/=255,e/=255,i/=255;let s=Math.max(t,e,i),n=Math.min(t,e,i),[r,o,a]=[0,0,(n+s)/2],l=s-n;if(0!==l){switch(o=0===a||1===a?0:(s-a)/Math.min(a,1-a),s){case t:r=(e-i)/l+(e<i?6:0);break;case e:r=(i-t)/l+2;break;case i:r=(t-e)/l+4}r*=60}return[r,100*o,100*a]},ci.convertHSLtoRGB=function(t,e,i){t=V(t),e/=100,i/=100;const s=function(s){let n=(s+t/30)%12,r=e*Math.min(i,1-i);return i-r*Math.max(-1,Math.min(n-3,9-n,1))};return[s(0),s(8),s(4)]},ci.convertRGBtoHWB=function(t,e,i){let s=this.convertRGBtoHSL(t,e,i,suffix);t/=256,e/=256,i/=256;let n=Math.min(t,e,i),r=1-Math.max(t,e,i);return[s[0],100*n,100*r]},ci.convertRGBHtoHWB=function(t,e,i,s){return t/=256,e/=256,i/=256,[s,100*Math.min(t,e,i),100*(1-Math.max(t,e,i))]},ci.convertHWBtoRGB=function(t,e,i){if((e/=100)+(i/=100)>=1){let t=e/(e+i);return[t,t,t]}let s=this.convertHSLtoRGB(t,100,50);for(let t=0;t<3;t++)s[t]*=1-e-i,s[t]+=e;return s},ci.multiplyMatrices=function(t,e){const i=t.length;Array.isArray(t[0])||(t=[t]),Array.isArray(e[0])||(e=e.map((t=>[t])));const s=e[0].length,n=e[0].map(((t,i)=>e.map((t=>t[i]))));let r=t.map((t=>n.map((e=>Array.isArray(t)?t.reduce(((t,i,s)=>t+i*(e[s]||0)),0):e.reduce(((e,i)=>e+i*t),0)))));return 1===i&&(r=r[0]),1===s?r.map((t=>t[0])):r},ci.D50=[.3457/.3585,1,.2958/.3585],ci.D65=[.3127/.329,1,.3583/.329],ci.D65_to_D50_matrix=[[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],ci.D50_to_D65_matrix=[[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],ci.convertRGBtoXYZ_matrix=[[506752/1228815,87881/245763,12673/70218],[87098/409605,175762/245763,12673/175545],[7918/409605,87881/737289,1001167/1053270]],ci.lin_sRGB=function(t){return t.map((t=>{let e=t<0?-1:1,i=Math.abs(t);return i<.04045?t/12.92:e*Math.pow((i+.055)/1.055,2.4)}))},ci.convertRGBtoXYZ=function(t,e,i){const s=[t/255,e/255,i/255],n=this.lin_sRGB(s);return this.multiplyMatrices([...this.convertRGBtoXYZ_matrix],[...n])},ci.convertRGBtoOKLAB=function(t,e,i){const[s,n,r]=this.lin_sRGB([t/255,e/255,i/255]),o=.4122214708*s+.5363325363*n+.0514459929*r,a=.2119034982*s+.6806995451*n+.1073969566*r,l=.0883024619*s+.2817188376*n+.6299787005*r,h=this.cbrt(o),c=this.cbrt(a),u=this.cbrt(l);return[.2104542553*h+.793617785*c-.0040720468*u,1.9779984951*h-2.428592205*c+.4505937099*u,.0259040371*h+.7827717662*c-.808675766*u]},ci.convertXYZtoRGB_matrix=[[12831/3959,-329/214,-1974/3959],[-851781/878810,1648619/878810,36519/878810],[705/12673,-2585/12673,705/667]],ci.gam_sRGB=function(t){return t.map((t=>{let e=t<0?-1:1,i=Math.abs(t);return i>.0031308?e*(1.055*Math.pow(i,1/2.4)-.055):12.92*t}))},ci.convertXYZtoRGB=function(t,e,i){const s=this.multiplyMatrices([...this.convertXYZtoRGB_matrix],[t,e,i]),n=this.gam_sRGB(s),r=Math.round;return[r(255*n[0]),r(255*n[1]),r(255*n[2])]},ci.E=216/24389,ci.K=24389/27,ci.cbrt=null!=Math.cbrt?Math.cbrt:t=>Math.pow(t,1/3),ci.convertXYZtoLAB=function(t,e,i){const{D50:s,K:n,E:r,cbrt:o}=this,a=this.multiplyMatrices([...this.D65_to_D50_matrix],[t,e,i]).map(((t,e)=>t/s[e])).map((t=>t>r?o(t):(n*t+16)/116));return[116*a[1]-16,500*(a[0]-a[1]),200*(a[1]-a[2])]},ci.convertLABtoXYZ=function(t,e,i){const{D50:s,K:n,E:r,cbrt:o}=this,a=[],l=Math.pow;a[1]=(t+16)/116,a[0]=e/500+a[1],a[2]=a[1]-i/200;const h=[l(a[0],3)>r?l(a[0],3):(116*a[0]-16)/n,t>n*r?l((t+16)/116,3):t/n,l(a[2],3)>r?l(a[2],3):(116*a[2]-16)/n].map(((t,e)=>t*s[e]));return this.multiplyMatrices([...this.D50_to_D65_matrix],[...h])},ci.convertLABtoLCH=function(t,e,i){const s=Math.pow,n=180*Math.atan2(i,e)/Math.PI;return[t,Math.sqrt(s(e,2)+s(i,2)),n>=0?n:n+360]},ci.convertLCHtoLAB=function(t,e,i){const s=Math.PI;return[t,e*Math.cos(i*s/180),e*Math.sin(i*s/180)]},ci.XYZtoLMS=[[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],ci.LMStoOKLab=[[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],ci.convertXYZtoOKLAB=function(t,e,i){const s=this.cbrt,n=this.multiplyMatrices([...this.XYZtoLMS],[t,e,i]);return this.multiplyMatrices([...this.LMStoOKLab],n.map((t=>s(t))))},ci.LMStoXYZ=[[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],ci.OKLabtoLMS=[[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]],ci.convertOKLABtoXYZ=function(t,e,i){const s=this.multiplyMatrices([...this.OKLabtoLMS],[t,e,i]);return this.multiplyMatrices([...this.LMStoXYZ],s.map((t=>t**3)))},ci.convertOKLABtoOKLCH=function(t,e,i){const s=180*Math.atan2(i,e)/Math.PI;return[t,Math.sqrt(e**2+i**2),s>=0?s:s+360]},ci.convertOKLCHtoOKLAB=function(t,e,i){return[t,e*Math.cos(i*Math.PI/180),e*Math.sin(i*Math.PI/180)]},ci.calculateColorBlend=function(t,e,i,s,n,r){const[o,a,l]=this.convertRGBtoHSL(t,e,i),[h,c,u]=this.convertRGBtoHSL(s,n,r),[d,f,p]=this.convertHSLtoRGB(o,a,u);return[Math.round(255*d),Math.round(255*f),Math.round(255*p)]},ci.calculateHueBlend=function(t,e,i,s,n,r){const[o,a,l]=this.convertRGBtoHSL(t,e,i),[h,c,u]=this.convertRGBtoHSL(s,n,r),[d,f,p]=this.convertHSLtoRGB(o,c,u);return[Math.round(255*d),Math.round(255*f),Math.round(255*p)]},ci.calculateSaturationBlend=function(t,e,i,s,n,r){const[o,a,l]=this.convertRGBtoHSL(t,e,i),[h,c,u]=this.convertRGBtoHSL(s,n,r),[d,f,p]=this.convertHSLtoRGB(h,a,u);return[Math.round(255*d),Math.round(255*f),Math.round(255*p)]},ci.calculateLuminosityBlend=function(t,e,i,s,n,r){const[o,a,l]=this.convertRGBtoHSL(t,e,i),[h,c,u]=this.convertRGBtoHSL(s,n,r),[d,f,p]=this.convertHSLtoRGB(h,c,l);return[Math.round(255*d),Math.round(255*f),Math.round(255*p)]};let di=!1,fi=!1,pi=!1,mi=!1,gi=!1;!function(){let t,e=0,i=0,s=0,n=0,r="#ffffff00";const o=ai(),{element:a,engine:l}=o;a.width=1,a.height=1,l.save(),l.globalAlpha=1,l.globalCompositeOperation="source-over",l.fillStyle="hwb(90 10% 10%)",l.fillRect(0,0,1,1),t=l.getImageData(0,0,1,1),t&&t.data&&([e,i,s,n]=t.data),(e||i||s)&&(di=!0),di&&r===l.fillStyle?di=!1:r=l.fillStyle,l.fillStyle="lab(29.2345% 39.3825 20.0664)",l.clearRect(0,0,1,1),l.fillRect(0,0,1,1),t=l.getImageData(0,0,1,1),t&&t.data&&([e,i,s,n]=t.data),(e||i||s)&&(fi=!0),fi&&r===l.fillStyle?fi=!1:r=l.fillStyle,l.fillStyle="lch(52.2345% 72.2 56.2)",l.clearRect(0,0,1,1),l.fillRect(0,0,1,1),t=l.getImageData(0,0,1,1),t&&t.data&&([e,i,s,n]=t.data),(e||i||s)&&(pi=!0),pi&&r===l.fillStyle?pi=!1:r=l.fillStyle,l.fillStyle="oklab(59.686% 0.1009 0.1192)",l.clearRect(0,0,1,1),l.fillRect(0,0,1,1),t=l.getImageData(0,0,1,1),t&&t.data&&([e,i,s,n]=t.data),(e||i||s)&&(mi=!0),mi&&r===l.fillStyle?mi=!1:r=l.fillStyle,l.fillStyle="oklch(59.686% 0.15619 49.7694)",l.clearRect(0,0,1,1),l.fillRect(0,0,1,1),t=l.getImageData(0,0,1,1),t&&t.data&&([e,i,s,n]=t.data),(e||i||s)&&(gi=!0),gi&&r===l.fillStyle?gi=!1:r=l.fillStyle,l.restore(),li(o)}();const yi=function(t){return!!t&&new Color(t)};E.Color=Color;const bi=[.37,.69,.62,.78,.06,.84,.27,.14,.46,1,.58,.28,.62,.8,.3,.7,.93,.53,.76,.24,.15,.51,.79,.28,.99,.16,.22,.45,.03,.73,.34,.96,.5,.3,.07,.84,.51,.27,.89,.8,.66,.25,.54,.94,.08,.66,.36,.85,.69,.93,.26,.79,.68,.36,.23,.5,.83,.34,.64,.91,.73,.8,.95,.59,.1,.76,.82,.03,.62,.47,.09,.55,.33,.22,.45,.04,.76,.52,.69,.24,.78,.12,.59,.37,.03,.82,.93,.69,.42,.34,.89,.62,.27,1,.53,.09,.38,.71,.13,.52,.19,.66,.33,.42,.63,.28,.36,.61,.73,.06,.56,.97,.35,.72,.91,.3,.98,.53,.2,.08,.5,.22,.87,.93,.08,.44,.91,.56,.12,.99,.01,.49,.37,.68,.89,.55,.3,.84,.17,.67,.1,.48,.89,.23,.47,.06,.29,.61,.67,.91,.2,.47,.64,.05,.77,.94,.62,.09,.58,.12,.77,.47,.93,.39,.73,.09,.47,.58,.15,.39,.02,.64,.32,.77,.98,.03,.28,.44,.11,.01,.73,.44,.88,.02,.76,.53,.41,.05,.25,.36,.02,.31,.52,.39,.28,.57,.91,.7,.98,0,.76,.94,.66,.85,.33,.18,.88,.01,.99,.46,.69,.94,.32,.51,.45,.07,.55,.22,.11,.8,.42,.17,.87,.47,.81,.23,.88,.43,.6,.11,.75,.06,.88,.72,.47,.92,.13,.31,.84,.47,.27,.16,.5,.09,.78,.44,.34,.56,.95,.69,.36,.13,.64,.29,.04,.87,.41,.53,.31,.87,.22,.6,.09,.77,.22,.72,.4,.88,.37,.75,.06,.58,.65,.86,.99,.42,.37,.58,.04,.74,.35,.57,.83,.39,.5,.91,.42,.27,.69,.02,.8,.22,.63,.97,.04,.34,.69,.97,.51,.83,.45,.24,.56,.49,.64,.81,.99,.55,.31,.17,.62,.1,.69,.15,.86,.2,.52,.67,.77,.19,.7,.85,.45,.18,.12,.4,.3,.82,.37,.53,.07,.27,.56,.64,.44,.34,.56,.25,.2,.08,.76,.64,.15,.78,.95,.72,.87,.51,.36,.02,.74,.3,.07,.64,.34,0,.82,.28,.97,.22,.5,.81,.02,.25,.41,.69,.2,.03,.76,.42,.69,.85,.59,.14,.91,.76,.28,.06,.61,.47,.73,.8,.55,.25,.61,.82,.19,.72,.13,.98,.41,.03,.64,.96,.12,.52,.27,.17,.97,.42,.13,.35,.2,.78,.11,.86,.82,.24,.95,.49,.14,.25,.17,.69,.85,.21,.95,.58,.35,.15,.44,.29,.78,.84,.2,.28,.88,.09,.2,.92,.13,.75,.17,.37,.23,.52,.89,.82,.47,1,.39,.29,.75,.59,.96,.14,.42,.92,.63,.04,1,.67,.78,.5,.24,.61,.17,.71,.92,.41,.11,.96,.74,.07,.83,.66,.89,.4,.85,.23,.55,.36,.27,.19,.04,.67,.94,.58,.63,.2,.97,.75,.55,.92,.72,.46,.55,.69,.34,.17,.67,.56,.88,.96,.52,.62,.94,.88,.21,.04,.37,.25,.72,.02,.81,.16,.91,.4,.21,1,.16,.7,.94,.1,.78,.55,.45,.7,.51,.86,.29,.48,.05,.93,.59,.81,.72,.29,.83,.59,.73,0,.49,.3,.64,.39,.11,.71,.32,.97,.78,.34,.05,.37,.49,.12,.9,.68,.56,.92,.49,.14,.55,.76,.6,.34,.72,.64,.4,.03,.88,.6,.71,.13,.65,.05,.27,.56,.22,.94,.47,.09,.33,.84,.47,.27,.09,.57,.23,.34,.07,.95,.56,.87,.11,.46,.2,.77,.87,.5,.18,.29,.79,.14,.61,.51,.29,.99,.01,.91,.65,.47,.58,.3,.23,.13,.83,.4,.49,.15,.25,.36,.17,.84,.13,.41,.07,1,.44,.77,.09,.35,.73,.3,.11,.34,.57,.47,.93,.63,.41,.53,.49,.32,.86,.55,.02,.84,.51,.34,.26,.04,.39,.92,.33,.25,.84,.17,.35,.8,.43,.67,.31,.03,.51,.47,.08,.94,.25,.55,.91,.71,.15,.45,.58,.89,.67,.02,.47,.57,.62,.82,.73,.53,.27,.81,.07,.19,.65,.4,.92,0,.44,.16,1,.53,.8,.33,.96,.29,.07,.44,.94,.34,.74,.84,.67,0,.84,.64,.71,.04,.55,.89,.39,.72,.53,.82,.42,.65,.02,.36,.94,.29,.63,0,.37,.25,.67,.93,.51,.37,.04,.74,.12,.68,.44,.81,.11,.38,.78,.99,.45,.71,.89,.33,.59,.91,.69,.51,.05,.64,.27,.89,.61,.84,.31,.24,.5,.04,.18,.44,.8,.66,.14,.75,.82,.11,.18,.99,.65,.12,.77,.25,.62,.32,.09,.75,.65,.47,.58,.16,.05,.65,.08,.94,.56,.73,.25,.84,.14,.38,.87,.64,.16,.78,.4,.64,.2,.33,.99,.02,.86,.2,.53,.42,.86,.1,.94,.14,.23,.99,.03,.4,.88,.72,.24,.07,.8,.32,.69,.83,.04,.25,.68,.22,.48,.55,.76,.86,.39,.17,.53,.09,.42,.34,.5,.26,.23,1,.18,.77,.31,.94,.15,.88,.29,.73,.21,.8,.69,.53,.95,.76,.56,.11,.6,.05,.44,.23,.96,.82,.56,.35,.21,.72,.52,.88,.16,.82,.08,.52,.27,.8,.1,.02,.84,.3,.78,.98,.43,.73,.19,.52,.14,.89,.65,.79,.6,.92,.52,.07,.98,.27,.51,.3,.78,.88,.23,.42,.7,.1,.91,.77,.43,.96,.22,.87,.71,.8,.95,.55,.76,.45,.15,.02,.99,.54,.2,.73,.96,.24,.55,.36,.05,.95,.13,.75,.55,.77,.25,.36,.13,.8,.19,.29,.71,.36,.45,.65,.33,.61,.51,.37,1,.56,.46,.89,.23,.5,.4,.91,.58,.07,.83,.65,.12,.25,.61,.79,.14,.97,.63,.78,.12,.89,.43,.38,.61,.69,0,.45,.19,.6,.02,.92,.5,.42,.09,.24,.42,.16,.89,.48,.99,.76,.66,.87,.27,.45,.16,.62,.89,.25,.04,.33,.22,.62,.37,0,.67,.18,.45,.75,.62,.42,.18,.57,.01,.36,.8,.05,.68,.4,1,.27,.86,.4,.22,.37,.83,.44,.68,.05,.56,.35,.06,.59,.94,.49,.38,.58,.16,.53,.13,.29,.36,.51,.2,.26,.36,.89,.69,.31,.42,.63,.91,.5,.04,.31,.85,.72,.47,.83,.61,.36,.48,.07,.93,.64,.72,1,.6,.49,.89,.54,.08,.76,.92,.16,.09,.82,.29,.14,.61,.18,.75,.65,.11,.29,.78,.15,.42,.36,.99,.01,.49,.69,.31,.89,.25,.18,.94,.58,.7,.85,.09,.5,.22,.85,.69,.39,.33,.78,.15,.58,.85,.04,.72,.35,.84,.28,.4,.16,.33,.56,.01,.69,.96,.06,.47,.83,.56,.69,.93,.54,.74,.94,.86,.53,.98,.38,.24,.95,.11,.67,.86,.51,.3,.96,.46,.57,.34,.05,.15,.71,.31,.77,.03,.6,.2,.94,.72,.45,.82,.17,.31,.8,.2,.05,.69,.84,.76,.01,1,.09,.84,.44,.62,.11,.22,.5,.81,.05,.29,.45,.77,.68,.09,.91,.2,.28,0,.89,.18,.69,.32,.51,.44,.03,.35,.25,.67,.03,.84,.2,.56,.46,.89,.23,.69,.78,.95,.37,.09,.55,.87,.44,.73,.95,.52,.82,.23,.73,.91,.44,.04,.55,.46,.73,.41,.03,.31,.14,.78,.36,.97,.56,.8,.11,.99,.52,.27,.91,.64,.95,.49,.19,.66,.03,.55,.85,.13,.62,.8,.41,.29,.75,.39,.13,.99,.45,.05,.27,.47,.12,.41,.63,.29,.15,.84,.54,.32,.74,.22,.13,.64,.85,.08,.16,.75,.51,.47,.64,.95,.58,.14,.91,.51,.39,.13,.25,.97,.69,.01,.56,.87,.28,.93,.38,.62,.44,.67,.57,.7,.01,.8,.98,.6,.89,.73,.16,.71,.12,.59,.36,.54,.15,.57,.67,.45,.25,.95,.83,.11,.22,.84,.09,.77,.92,.16,.41,.96,.35,.25,.75,.65,0,.44,.53,.06,.28,.83,.99,.23,0,.59,.24,.05,.63,.28,.55,.36,.16,.83,.72,.31,.08,.66,.81,.53,.22,.9,.62,.28,.05,.45,.64,.22,.71,.07,.35,.45,.31,.1,.77,.6,.95,.24,.73,.49,.99,.22,.1,.55,.91,.63,.24,.74,.41,.79,.16,.81,.33,.22,.04,.81,.67,.48,.04,.8,.44,.99,.41,.78,.25,.6,.94,.28,.82,.91,.2,.11,.44,.73,.34,.79,.06,.85,.63,.51,.42,.9,.73,.44,.64,.05,.49,.24,.9,.2,.33,.93,.15,.48,.34,.19,0,.45,.34,.97,.84,.21,.95,.26,.41,.82,.98,.72,.54,.34,.62,.39,.57,.93,.69,.53,.44,.8,.64,.53,.71,.11,.94,.37,.58,.87,.2,.73,.47,.42,.67,.34,.49,.91,.38,.72,.13,.89,.77,.08,.96,.64,.19,1,.85,.47,.25,.96,.71,.47,.12,.76,.16,.91,.3,.51,.85,.8,.15,.75,.55,.89,.36,.46,.07,.89,.43,.04,.36,.87,.48,.85,.17,.02,.52,.31,.09,.87,.64,.97,.58,.71,.91,.51,.1,.9,.59,.27,.16,.62,.57,.01,.49,.38,.73,.42,0,.6,.38,.86,.28,.64,.24,1,.56,.3,.76,.18,.1,.35,.23,.14,.98,.31,.8,.72,.15,.84,.53,.25,.4,.73,.85,.55,.67,.91,.25,.55,.51,.03,.69,.88,.75,.03,.34,.09,.16,.78,.05,.75,.88,.28,.2,.37,.13,.3,.22,.04,.87,.44,.54,.15,.25,1,.32,.64,.93,.25,.13,.64,.8,.16,.55,.97,.41,.48,.24,.61,.4,.27,.53,.12,.36,.16,.6,.36,.05,.4,.58,.82,.37,.69,.95,0,.56,.39,.66,.23,0,.81,.18,.69,.32,.8,.28,.67,.62,.26,.73,.58,.27,.67,.83,.94,.55,.2,.36,.5,.08,.84,.42,.35,.2,.74,.38,.93,.71,.08,.3,.97,.83,.19,.88,.15,.67,.24,.8,.07,.51,.84,.02,.18,.69,.45,.04,.91,.58,.8,.47,.71,.6,.08,.56,.41,.04,.36,.77,.09,.9,.58,.05,.31,.39,.09,.75,.63,.31,.82,.45,.12,.61,.51,.22,.63,.93,.51,.2,.47,.32,.06,.66,.59,.97,.9,.69,.58,.16,.31,.82,.06,.76,.41,.1,.82,.02,.58,.89,.05,.28,.84,.08,.3,.77,.02,.67,.33,.81,.02,.67,.75,.57,.91,.8,.09,.85,.67,.99,.25,.51,.13,.45,.25,.12,.88,.46,.95,.6,.28,.98,.49,.16,.57,.18,.95,.81,.16,.04,.98,.44,.35,.77,.04,.61,.7,.29,.01,.67,.16,.27,.99,.63,.47,0,.2,.83,.47,.88,.13,.66,.54,.08,.98,.5,.32,.56,.97,.69,.4,.61,.48,.94,.37,.83,.6,.29,.94,.03,.87,.37,.16,.91,.65,.49,.97,.45,.64,.67,.22,.13,1,.84,.49,.16,.94,.07,.42,.19,.28,.94,.36,.89,.46,.83,.29,.7,.91,.14,.42,.8,.73,.07,.47,.75,.38,.97,.63,.69,.91,.47,.69,.56,.14,.47,.76,.52,.97,.44,.75,.5,.64,.19,.84,.99,.13,.5,.91,.86,.32,.05,.23,.42,.52,.3,.17,.33,.04,.89,.61,.73,.34,.93,.75,.15,.31,.7,.41,.07,.64,.84,.75,.41,.08,.48,.32,.39,.7,.11,.87,.14,.47,.27,.95,.77,.47,.93,.62,.53,.77,.12,.31,.96,.67,.49,.38,.73,.24,.4,.33,.6,.78,.39,.85,.15,.44,.2,.11,.89,.78,.09,.24,.73,.14,.45,.67,.22,.53,.83,.27,.75,.3,.2,.85,0,.28,.83,.37,.52,.78,.71,.6,.22,.37,.89,.66,.78,.57,.03,.68,.74,.17,.38,.03,.59,.81,.63,.98,.52,.22,.35,.27,.12,.85,.01,.25,.35,.19,.6,.3,.92,.8,.35,.3,.17,.36,.7,.23,.1,.88,.38,.55,.28,.72,.57,.17,.38,.47,.98,.72,.63,.89,.75,.55,.93,.64,.08,.78,.82,.19,.62,.53,.37,.05,.84,.49,.94,.23,.35,.01,.99,.53,.66,.76,.95,.57,.23,.64,.31,.89,.4,.12,.86,.16,.41,.31,.81,.03,.86,.56,.81,.25,.11,.58,.19,.8,.93,.05,.84,.25,.11,.73,.02,.67,.93,.36,.55,.31,.66,.2,.51,.41,.86,.06,.33,.63,.42,.01,.98,.59,.1,.7,.57,.18,.44,.92,.64,.27,.42,.04,.81,.54,.71,.25,.99,.49,.82,.11,.25,.55,.66,.95,.12,.24,.38,.03,.28,.88,.57,.92,.42,.53,.59,.77,.44,.12,.88,.02,.24,.7,.09,.86,.67,.03,.93,.58,.33,.95,.6,.06,.44,.9,.08,.24,.63,.14,.79,.28,.16,.02,.39,.12,.8,.44,.36,.28,.49,.42,.02,.24,.91,.66,.13,.59,.2,.73,.47,.6,.3,.21,.89,.26,.07,.48,.79,.01,.95,.52,.66,.07,.55,.73,.89,.07,.2,.49,.38,.61,.17,.4,.78,.97,.01,.62,.48,.69,.22,.47,.97,.59,.52,.8,.26,.72,.05,.42,.89,.8,.03,1,.76,.17,.93,.78,.09,.69,.45,.89,.39,.82,.34,.98,.75,.1,.04,.34,.17,.9,.32,.11,.49,.05,.15,.33,.38,.61,.97,.07,.85,.34,.44,.77,.54,.73,.17,.69,.8,.05,.65,.19,.93,.09,.83,.51,.97,.36,.53,.43,.62,.97,.51,.81,.16,.45,.03,.75,.27,.16,.8,.35,.67,.77,.85,.53,.11,.56,.36,.96,.6,.24,.48,.69,.23,.91,.12,1,.69,.8,.55,.44,.98,.31,.8,.08,.89,.69,.84,.39,.12,.62,.18,.88,.31,.7,.56,.2,.78,.35,.62,.24,.58,.97,.65,.7,.95,.04,.49,.91,.33,.68,.47,.29,.38,.95,.16,.67,.37,.29,.19,.89,.49,.61,.16,.95,.56,.48,.27,.62,.34,.56,.48,.28,.92,.55,.15,.77,.05,.63,.24,.12,.49,.59,.84,.97,.53,.75,.64,.97,.44,.86,.62,.91,.22,.79,.44,.31,.72,.52,.19,.93,.09,.88,.49,.41,.11,.98,.31,.72,.28,.41,.58,.3,.74,.66,.15,.84,.05,.2,.41,.27,.62,.87,.82,.53,.67,.47,.86,.58,.04,.42,.94,.33,.69,.88,.45,.83,.67,.05,.86,.98,.01,.66,.57,.3,.85,.05,.22,.27,.71,.03,.37,.53,.27,.16,.03,.57,.69,.82,.42,.53,.99,.36,.09,.83,.28,.98,.02,.46,.15,.33,.43,.18,.28,.75,.24,.82,.08,.22,.89,.85,.13,.76,.58,.07,.89,.77,.07,.42,.04,.83,.22,.7,.34,.13,.9,.7,.06,.25,.74,.11,.83,.35,.25,.52,.43,.94,.53,.86,.72,.31,.2,.7,.56,.36,.27,.2,.58,.36,.74,.1,.5,.69,.16,.93,.04,.78,.6,.28,.65,.34,.96,.23,.62,.36,.47,.88,.06,.72,.95,.21,.04,.79,.27,.91,.59,.33,.77,.1,.69,.31,.21,.36,.12,.95,.31,.2,1,.28,.48,.03,.24,.76,.07,.19,.34,.76,.15,.33,.55,.39,.76,.16,.48,.37,.94,.51,.84,.62,.92,.67,.42,.94,.79,.45,.97,.36,.03,.75,.13,.24,.46,.73,.14,.4,.85,.69,.5,.83,.76,.09,.89,.45,.68,.56,.4,.64,.52,.05,.23,.53,.34,.81,.44,.24,.67,.56,.98,.37,.52,.78,.02,.4,.21,.81,.45,.87,.59,.4,.2,.66,1,.08,.29,.2,.67,.01,.39,.27,.79,.45,.09,0,.78,.94,.07,.8,.28,.66,.02,.88,.39,.58,.23,.42,.91,.13,.38,.82,.03,.56,.77,.16,.82,.54,.16,.61,.33,.12,.63,.44,.37,.48,.73,0,.91,.56,1,.44,.07,.92,.63,0,.77,.52,.12,.8,.18,.59,.4,.99,.29,.56,.52,.94,.42,.62,.84,.08,.95,.25,.6,.74,.65,.11,.16,.45,.21,.06,.76,.32,.49,.18,.07,.66,.27,.61,.86,.66,.91,.48,.61,.89,.19,.75,.29,.04,.91,.54,.6,.34,.01,.99,.14,.31,.72,.81,.41,.99,.62,.05,.49,.96,.73,.33,.13,.67,.27,.88,.59,.94,.65,.16,.37,.99,.05,.81,.53,0,.73,.6,.85,.8,.36,.47,.09,.94,.64,.13,.91,.84,.47,.67,.53,.22,.42,.96,.55,.34,.76,.12,.48,.69,.04,.75,.53,.47,.2,.71,.9,.26,0,.67,.85,.42,.91,.78,.55,.87,.19,.11,.97,.66,.37,.48,.16,.65,.8,.56,.27,.72,.4,.61,.47,.71,.92,.67,.83,.15,.64,.92,.05,.47,.12,.28,.73,.2,.51,.82,.42,0,.32,.77,.56,.29,.8,.98,.59,.11,.63,.27,.87,.54,.92,.19,.42,.02,.8,.18,.07,.53,.32,.13,.99,.63,.38,.24,.15,.84,.77,.18,.85,.49,.93,.59,.16,.69,.27,.84,.12,.59,.18,.89,.45,.83,.19,.44,.11,.75,.5,.56,.09,.31,.65,.25,.92,.44,.35,.7,.13,.55,.97,.76,.59,.86,.55,.36,.25,.62,.17,.32,.11,.61,.85,.13,.45,.23,.64,.84,.99,.34,.86,.29,.98,.78,.09,.63,.31,.5,1,.38,.22,.08,.49,.26,.02,.99,.71,.59,.31,.22,.13,.84,.24,.04,.35,.84,.44,.17,.89,.05,.86,.38,.25,.07,.53,.45,.36,.25,.7,.8,.66,.91,.5,.36,.06,.69,.89,.2,.82,1,.39,.7,.09,.36,.19,.91,.72,.37,.78,.16,.47,.81,.34,.56,.29,.95,.37,.8,.67,.44,.58,.2,.49,.71,.96,.29,.49,.71,.44,.25,.11,.34,.01,.46,.91,.22,.37,.55,.28,.01,.79,.59,.05,.98,.36,.29,.23,.85,.78,.71,.47,.11,.76,.87,.22,.96,.39,.28,.09,.23,.17,.31,.05,.46,1,.69,.39,.88,.77,.98,.36,.05,.73,.94,.06,.18,.44,.57,.1,.17,.59,.25,.35,.94,.42,.08,.59,.74,.33,.95,.61,.81,.41,.33,.08,.52,.79,.45,.91,.72,.58,.95,.75,.49,.17,.99,.33,.23,.65,.15,.55,.31,.84,0,.76,.87,.17,.38,.22,0,.87,.99,.63,.3,.11,.54,.5,.05,.24,.86,.52,.64,.47,.4,0,1,.61,.33,.69,.08,.98,.52,.12,.71,.43,.25,.92,.02,.86,.35,.78,.05,.65,.41,.1,.63,.05,.77,.65,.96,.4,.81,.66,.09,.78,.71,.86,.42,.35,.22,.72,.52,.86,.71,.04,.97,.4,.19,.95,.15,.37,.57,.06,.79,.46,.65,.72,.51,.93,.69,.82,.74,.07,.57,.28,.03,.43,.72,.56,.3,.81,.52,.4,.7,.28,.81,.66,.42,.91,.67,.12,.82,.55,.87,.18,.45,.77,.09,.69,.16,.77,.65,.24,.92,.39,.64,.08,.51,.32,.41,.23,.09,.7,.58,.8,.49,.1,.79,.96,.72,.2,.95,.53,.09,.61,.98,.52,.33,.54,.15,.78,.39,.94,.73,.17,.66,.6,.12,.92,.77,.27,.83,.57,.11,.23,.43,.03,.87,.25,.75,.63,.84,.08,.61,.76,.15,.53,.94,.27,.08,.91,.53,.22,.94,.36,.9,.5,.21,.56,.16,.56,.34,.97,.49,.1,.62,.67,.93,.49,.14,.62,.2,.58,.12,.34,.63,.55,.84,.68,.3,.51,.2,.91,.02,.89,.38,.45,.13,.27,.41,.18,.79,.94,.52,.11,.25,.19,.66,.89,.14,.59,.88,.02,.49,.21,.78,.51,0,.47,.75,.21,.03,.7,.84,.27,.54,.38,.22,.91,.56,.84,.02,.73,.18,.28,.83,.02,.92,.64,.88,.29,.04,.44,.75,.93,.45,.39,.61,.11,.67,.42,.28,.47,.82,.06,.75,.69,.43,.23,.04,.58,.33,.45,.96,.32,.41,.22,.05,.32,.16,.91,.49,.81,.95,.65,.55,.38,.21,.47,.17,1,.31,.49,.22,.69,.42,.69,.56,.84,.34,.73,.82,.56,.13,.3,.84,.73,.89,.29,.44,.03,.24,.92,.21,.84,.06,.28,.38,.81,.42,.94,.48,.82,.27,.01,.44,.23,.94,.05,.56,.33,.62,.3,.05,.8,.98,.61,.51,.86,.14,.36,.62,.81,.94,.48,.08,.4,.22,.31,.95,.73,.35,.99,.06,.3,.87,.62,.37,.27,.92,.36,.12,.64,.02,.88,.47,.29,.13,.44,.36,.88,.49,.99,.6,.7,.12,.47,.8,.36,.95,.65,.28,.19,.02,.27,.86,.49,.27,.77,.92,.15,.63,.43,.29,.12,.84,.94,.48,.8,.86,.06,.77,.37,.58,.8,.98,.62,.75,.68,.27,.18,.35,.73,.14,.9,.8,.01,.35,.56,.89,.36,.08,.84,.3,.12,.21,.44,.16,0,.29,.47,.17,.71,.04,.27,.06,.94,.62,.83,.69,.53,.36,.15,.56,.77,.97,0,.25,.75,.09,.67,.76,.89,.09,.72,.59,.83,.69,.23,.84,.16,.72,.56,.33,0,.25,.91,.67,.47,.22,.74,.38,.59,.96,.7,.77,.55,.11,.62,.14,.82,.58,.27,.72,.15,.98,.58,.67,.52,.43,.99,.57,.76,.95,.03,.61,.78,.18,.58,.09,.23,.42,.36,.2,.55,.25,.6,.18,.13,.55,.84,.63,.7,.06,.18,.84,.35,.04,.7,.2,.88,.97,.36,.62,.08,.64,.19,.27,.1,.63,.89,.01,.71,.53,.47,.04,.4,.58,.78,.51,.08,.26,.68,.49,.6,.83,.7,.11,.67,.57,.97,.64,.76,.48,1,.6,.76,.66,.88,.99,.61,.4,.47,.69,.51,.17,.13,.32,.58,.78,1,.45,.33,.59,.88,.52,.31,1,.37,.14,.59,.96,.42,.32,.12,.99,.42,.54,.95,.49,.18,.83,.64,.73,.37,.09,.84,.03,.3,.16,.84,.34,.01,.84,.17,.44,.29,.54,.39,.66,.89,.43,.11,.83,.06,.78,.2,.88,.3,.15,.41,.33,.73,.51,.97,.67,.31,.92,.65,.75,.84,.98,.74,0,.9,.49,.77,.36,.89,.4,.52,.96,.75,.42,.58,1,.5,.33,.01,.67,.18,.53,.33,.7,.39,.55,.93,.22,.51,.15,.28,.35,.23,.89,.13,.96,0,.88,.44,.99,.33,.09,.95,.28,.21,.45,.78,.16,.33,0,.91,.36,.82,.08,.4,.53,.09,.35,.53,.78,.93,.34,.84,.76,.43,.87,.08,.27,.02,.66,.22,.69,.1,.16,.64,.55,.22,.47,.31,.51,.18,.78,.46,.09,.8,.03,.67,.26,.4,.88,.12,.45,.28,.58,.97,.48,.79,.65,.11,.5,.27,.47,.94,.67,.86,.94,.19,.06,.8,.2,.53,.33,.47,.41,.09,.71,.81,.23,.71,.1,.83,.25,.14,.37,.81,.03,.51,.11,.33,.06,.42,.82,.31,.69,1,.08,.25,.12,.81,.33,.09,.65,.24,.09,.75,.86,.58,.47,.78,.27,.89,.06,1,.47,.79,.68,.42,.86,.95,.06,.83,.77,.55,.31,.23,.67,.63,.8,.2,.73,.41,.65,.04,.98,.84,.27,.47,.53,.09,.24,.69,.31,.94,.2,.24,.85,.03,.16,.22,.1,.38,.01,.66,.95,.48,.73,.88,.4,.12,.89,.45,.8,.4,.85,.03,.89,.8,.66,.01,.88,.25,.58,.18,.36,.75,.91,.08,.52,.76,.97,.18,.75,.24,.42,.55,1,.22,.77,.63,.38,.05,.58,.23,.02,.75,.48,.35,.59,.93,.74,.24,.96,.62,.02,.52,.46,.88,.22,.56,.42,.05,.86,.58,.45,.18,.88,.27,.63,.58,.41,.09,.21,.44,.58,.73,.47,.2,.92,.56,.37,.91,.46,.17,.26,.38,.95,.09,.83,.42,.74,.15,.6,.31,.04,.33,.73,.56,.46,.66,.18,.44,.73,.48,.16,.38,.51,.03,.59,.13,.88,.52,.35,.14,.62,.95,.8,.73,.44,.57,.15,.76,.59,.73,.44,.78,.89,.66,.6,1,.27,.55,.22,.36,.16,.53,.63,.84,.35,.28,.95,.05,.7,.61,.13,.7,.25,.95,.55,.69,.92,.49,.86,.14,.31,.58,.22,.33,.04,.55,.68,.12,.88,.06,.35,.45,.93,.83,.15,.7,.32,.77,.42,.69,.98,.12,.86,0,.66,.16,.82,.44,.33,.93,.58,.05,.99,.64,.75,.93,.26,.71,.34,1,.69,.51,.92,.7,.16,.95,.64,.81,.02,.86,.68,.59,.28,.02,.84,.69,.31,.82,.63,.06,.69,.16,.56,.63,.36,.22,.87,.09,.97,.18,.62,.11,.32,1,.02,.64,.94,.84,.11,.91,.22,.84,.93,.45,.73,.31,.58,.71,.05,.38,.29,.19,.97,.87,0,.46,.93,.11,.39,.57,.28,.49,.73,.45,.8,.06,.72,.84,.78,.31,.92,.05,.57,.73,.53,.24,.33,.98,.49,.41,.34,.06,.44,.31,.71,.07,.64,.44,.81,.7,.95,.65,.42,.91,.81,.33,.62,.16,.72,.59,.28,.09,.51,.97,.88,.12,.53,.28,.61,.25,.4,.52,.3,.58,.89,.22,.76,.18,.38,.7,.29,.36,.47,.18,.55,.11,.22,.8,.39,.14,.05,.24,.86,.53,.33,.51,.27,.37,.11,.98,.4,.75,.14,.49,.02,.92,.54,.73,.31,.96,.45,.02,.84,.49,.67,.44,.53,.84,.89,.25,.52,.8,.39,.25,.06,.77,.29,.67,.61,.42,.34,.25,.8,.07,.18,.91,.49,.87,.67,.12,.62,.33,.52,.81,.32,.66,.19,.96,.06,.35,.08,.2,.9,.64,.48,.13,.05,.44,.22,.5,.18,.65,.13,.45,.78,.16,.25,.76,.92,.63,.84,.15,.38,.22,.98,.27,.53,.01,.16,.79,.62,.27,.06,.41,.53,.94,.26,.03,.87,.42,.24,.6,.35,.21,.83,.56,.04,.78,.7,.97,.07,.37,.11,.53,.65,.08,.85,.5,.12,.8,.01,.87,.41,.75,.63,.01,.56,.77,.36,.45,.8,.04,.69,.14,.95,.44,.83,.16,.53,.67,.24,.99,.61,.41,.23,.12,.38,.78,.21,.3,.92,.11,.8,.27,.72,.37,.45,.04,.73,.87,.16,.6,.51,.34,.56,.02,.76,.12,.69,0,.63,1,.42,.77,.24,.56,.02,.46,.84,.27,.69,.07,.23,.84,.48,.76,.68,.85,.94,.53,.16,.31,.38,.98,.6,.67,.76,.96,.08,.88,.38,.95,.67,.56,.87,.06,.2,.52,.11,.77,.47,.55,.69,.09,.91,.39,.48,.24,.13,.45,.91,.19,.84,.75,.48,.78,.55,.66,.75,.02,.44,.65,.96,.16,.91,.34,.45,.19,.84,.7,.78,.41,.28,.93,.42,.74,.24,.91,.6,.68,.31,.84,.95,.48,.29,.86,.94,.61,.29,.41,.72,.87,.2,.58,.77,.3,.05,.88,.44,.35,.19,.77,.96,.49,.91,.62,.53,.7,.38,.58,.31,.95,.06,.16,.65,.93,.21,.42,.67,.95,.21,.89,.46,.97,.27,.49,.95,.88,.17,.51,.36,.84,.16,.31,.7,.96,.2,.75,.42,.15,.98,.55,.01,.31,.22,.42,.6,.25,.76,.44,.89,.23,.55,.16,.33,.85,.28,.71,.59,.03,.3,.09,.63,.34,.58,.7,.23,.96,0,.33,.82,.18,.74,.31,.87,.98,.56,.77,.7,.58,.06,.3,.12,.98,.19,.13,.95,.31,.8,.09,.49,.39,.76,.08,.55,.28,.62,.46,1,.13,.84,.57,.03,.64,.34,.52,.09,.22,.46,.16,.07,.24,.66,.18,.12,.7,.21,.99,.07,.34,.62,.04,.73,.38,.94,.62,.81,.09,.69,.07,.66,.27,0,.83,.09,.99,.66,.05,.19,.75,.61,.5,.78,.31,.56,.08,.48,.33,.82,.12,.71,.16,.86,.2,.36,.55,.45,.28,.69,.09,.61,.94,.78,.37,.53,.05,.9,.57,.71,.36,.88,.63,.09,.48,.82,.02,.72,.67,.11,.74,.84,.4,0,.62,.47,.36,.2,.82,.49,.92,.41,.82,1,.45,.31,.88,.66,.14,.94,.45,.58,.64,.07,.69,.37,.02,.33,.96,.43,.67,.56,.35,.4,.84,.5,.56,.71,.9,.26,.67,.23,.64,.82,.93,.04,.23,.34,.07,.49,.31,.96,.17,.83,.39,.73,.99,.8,.36,.55,.92,.73,.44,.53,.02,.85,.56,.47,.79,.26,.97,.49,.22,.12,.57,.28,.38,.87,.53,.84,.44,.57,.35,.24,.14,.77,.47,.91,.41,.25,1,.35,.13,.73,.96,.61,0,.73,.24,.59,.42,.62,.75,.08,.82,.1,.74,.96,.01,.5,.42,.17,.09,.3,.63,.45,.81,.28,.11,.44,.77,1,.71,.36,.18,.96,.49,.03,.29,.93,.52,.7,.89,.13,.54,.99,.76,.13,.69,.25,.17,0,.77,.09,.59,.55,.42,.71,.24,.05,.93,.19,.44,.82,.14,.51,.23,.82,.16,.91,.61,.04,.7,.24,.05,.17,.34,.55,.03,.98,.5,.13,.39,.71,.57,.91,.64,.75,.21,.7,.11,.45,.92,.26,.04,.51,.63,.87,.02,.33,.8,.93,.39,.31,.65,.15,.43,.87,.11,.67,.35,.85,.72,.01,.95,.45,.31,.13,.19,.75,.68,.86,.44,.26,.58,.86,.09,.55,.83,.02,.88,.53,.38,.16,.9,.53,.37,.95,.09,.3,.55,.67,.33,.23,.86,.4,.62,.25,.85,.58,.66,.98,.86,.12,.19,.66,.94,.2,.53,.16,.06,.58,.87,.33,.54,.86,.36,.17,.11,.45,.23,.79,.07,.42,.27,.48,.36,.88,.55,.66,.4,.22,.84,.18,.29,.87,.5,.33,.78,.51,.27,.95,.62,.88,.09,.4,.77,.27,.47,.8,.91,.32,.64,.98,.41,.84,.78,.42,.31,.88,.1,.77,.43,.18,.85,.55,.39,.88,.78,.56,.15,.64,.3,.75,.18,.69,.42,.21,.6,.15,.74,.25,.89,.05,.71,.3,.56,.92,.44,.78,.2,.5,.69,.22,.64,1,.38,.93,.05,.53,.95,.35,.02,.69,.33,.15,.67,.45,.27,.81,.23,.84,.31,.66,.05,.83,.49,.89,.01,.44,1,.6,.48,.14,.91,.32,.74,.03,.45,.24,.72,.35,.41,.51,.04,.74,.33,.84,.27,.75,.44,.24,.16,.61,.76,.64,.99,.75,.31,.94,.65,.85,.05,.64,.96,.07,.32,.57,.92,.49,.92,.7,.05,.99,.11,.6,.88,.04,.72,.11,.47,.75,.64,.53,0,.71,.22,.08,.53,.43,.76,.5,.13,.61,.06,.18,.58,.67,.25,.53,.3,.81,.02,.11,.43,.29,.04,.34,.85,.6,.44,.91,.12,.27,.5,.99,.06,.69,.45,.52,.94,.61,.79,.39,.19,.01,.61,.07,.39,.96,.16,.76,.04,.6,.78,.28,.49,.11,.64,.21,.8,.5,.96,.39,.77,.62,.08,.42,.68,.11,.49,.42,.78,.19,.71,.23,.93,.8,.18,.7,.05,.55,.77,.2,.95,.36,.82,.49,.02,.94,.57,.88,.84,.59,.41,.93,.5,.63,.02,.8,.89,.39,.47,.28,.55,.03,.6,.38,.16,.54,.31,.72,.19,.79,.84,.27,.75,.06,.34,.81,.56,.37,.75,.19,.45,.39,.85,.59,.22,.36,.27,.94,.34,.97,.59,.86,.17,.97,.03,.22,.88,.29,.7,.95,.82,.34,.92,.06,.97,.49,.34,.93,.77,.64,.96,.51,.21,.82,.02,.99,.35,.56,.88,.76,.36,.27,.87,0,.35,.12,.22,.67,1,.81,.26,.65,.89,.29,.53,.36,.86,.45,.08,.22,.67,.83,.4,.73,.91,.23,.12,.58,.89,.2,1,.55,.76,.94,.59,.15,1,.63,.35,.57,.13,.28,.41,.87,.24,.35,.69,.07,.5,.11,.89,.6,.21,.7,.08,.3,.15,.26,.04,.67,.13,.39,.98,.7,.09,.67,.05,.89,.15,.84,.48,.71,.12,.77,.95,.57,.03,.44,.58,.12,.17,.43,.63,.11,.22,.66,.31,.94,.69,.24,.33,.95,.05,.78,.13,.85,.18,.49,.42,.3,.66,.37,.59,.78,.68,.36,.52,.24,.03,.45,.15,.59,.65,.21,.7,.59,.15,.23,.67,.08,.36,.7,.23,.47,.63,.73,.04,.17,.53,.64,.8,.19,.44,.83,.57,.46,.32,.5,.75,.11,.47,.8,.03,.7,.25,.91,.51,.73,.97,.33,.05,.56,.08,.42,.78,.27,.02,.49,.3,.14,.33,.03,.88,.25,.32,0,.45,.75,.64,.51,.09,.64,.96,.45,.84,.6,.42,.66,.16,.28,.78,.43,.84,.64,.47,.73,.96,.22,.83,.29,.17,.52,.34,.22,.96,.31,.78,.36,.22,.96,.28,.44,.22,.67,.4,.98,.48,.67,.86,.97,.51,.86,.95,.45,.55,.08,.79,.15,.55,.67,.5,.91,.59,.45,.66,.09,.81,.73,.13,.84,.27,.08,.46,.91,.12,.64,.55,.75,.83,.4,.87,.27,.08,.96,.33,.83,.43,.91,.78,.14,.52,.84,.09,.22,.43,.84,.97,.09,.31,.73,.99,.66,.03,.87,.08,.16,.95,.35,.22,.58,.78,.42,.19,.65,.33,.16,.42,.58,.18,.95,.35,.66,.62,.85,.36,.75,.92,.84,.64,.47,.38,.74,.55,.89,.81,.16,.98,.38,.78,.57,.11,.31,.19,.87,.25,.98,.73,.39,.55,.11,.99,.18,.38,.89,.53,.45,.76,.58,.87,.46,.78,.58,.73,.5,.42,.67,.08,.63,.87,.5,.09,.91,.14,.29,.21,.36,.77,.24,.3,.74,.15,.03,.83,.27,.63,.99,0,.41,.26,.73,.04,.25,.56,.9,0,.22,.55,.48,.94,.64,.33,.17,.83,.4,.99,.21,.33,.11,.73,.53,.43,.78,.48,.09,.55,.31,.59,.95,.31,.75,.4,.92,.67,.33,.24,.43,.61,.53,.15,.41,.28,.94,.71,.61,.38,.83,.7,.09,.98,.51,.11,.94,.8,.03,.87,.27,.75,.86,.48,.15,.99,.07,.44,.68,.11,.56,.22,.86,.18,.64,.8,.08,.39,.27,.05,.84,.23,.91,.73,.5,.01,.76,.33,.09,.46,.02,.91,.27,.49,.73,.01,.56,.09,.31,.7,.02,.24,.1,.93,.39,.01,.62,.11,.89,.55,.73,.02,.81,.35,.77,.62,.83,.73,.01,.55,.06,.38,.48,.67,.35,.89,.42,.49,.33,.77,.88,.18,.46,.98,.38,.76,.29,.63,1,.4,.76,.2,.01,.98,.58,.77,.05,.3,.68,.5,0,.94,.19,.65,.05,.88,.37,.73,0,.18,.47,.07,.65,.27,.86,.13,.51,.71,.87,.03,.92,.24,.77,.49,.34,.2,.78,.02,.49,.91,.16,.32,.75,.59,.28,.39,.55,.95,.65,.46,0,.7,.31,.23,.8,.2,.53,.25,.39,0,.51,.95,.11,.22,.5,.94,.62,.69,.47,.33,.16,.41,.96,.64,.54,.91,.59,.8,.69,.87,.62,.31,.67,.8,.28,.85,.15,.48,1,.6,.66,.29,.15,.86,.2,.99,.27,.33,.16,.4,.66,.19,.58,.07,.54,.94,.45,.63,.81,.59,.04,.25,.57,.76,.08,.18,.59,.8,.09,.29,.64,.81,.15,.53,.86,.45,.32,.05,.89,.66,.42,.72,.24,.48,.35,.88,.61,.81,.45,.58,.84,.36,.25,.63,.22,.99,.66,.84,.36,.91,.56,.15,.45,.59,.02,.79,.2,.47,.37,.82,.59,.06,.86,.44,.56,.31,.53,.25,.62,.44,.01,.82,.2,.69,.48,.09,.37,.21,.82,.42,.9,.58,.45,.93,.64,.87,.98,.75,.7,.29,.44,.58,.31,.72,.18,.55,.88,0,.61,.27,.82,.19,.38,.13,.27,.45,.19,.34,.15,.08,.4,.96,.23,.64,.91,.41,.2,.81,.42,.92,.75,.49,.35,.75,.52,.45,.89,.96,.29,.45,.94,.24,.33,.13,.27,.99,.19,.9,.79,.96,.22,.71,.86,.94,.24,.45,.69,.91,.58,.33,.07,.69,.18,.12,.71,.59,.14,.52,.3,.83,.15,.86,.62,.09,.16,.97,.23,.29,.91,.12,.78,.94,.44,.15,.53,.8,.24,.72,.05,.96,.81,.29,.37,1,.64,.27,.07,.69,.15,.97,.64,.11,.8,.98,.07,.88,.73,.37,.89,.55,1,.06,.77,.15,.88,.55,.07,.63,.11,.34,.75,.05,.33,.12,.46,.36,.05,.62,.82,.97,.03,.87,.11,.28,.42,.78,.93,.7,.06,.45,.67,.9,.63,.07,.97,.53,.77,.92,.48,.12,.36,.53,.8,.04,.7,.34,.06,.53,.23,.66,.59,.08,.82,.69,.05,.55,.09,.86,.69,.43,.78,.86,.7,.38,.14,.33,.63,.52,.4,.13,.31,.67,.04,.39,.52,.21,.02,.75,.92,.61,.42,.95,.8,.25,.86,.34,.94,.05,.45,.69,.22,.75,.44,.38,.71,.05,.66,.46,.53,.7,.03,.57,.29,.11,.61,.42,.52,.19,.69,.92,.07,.55,.85,.41,.95,.79,.45,.3,.4,.24,.69,.15,.42,.79,.2,.11,.67,.14,.28,.42,.61,.31,.69,.98,.3,.76,.94,.52,.85,.09,.59,.7,.19,.57,.91,.23,.15,.75,.37,.47,.79,.99,.62,.09,.5,.36,.56,.86,.01,.25,.75,.39,.81,.65,.22,.58,.87,.72,.02,.62,.44,.28,.92,.5,.12,.85,.33,.04,.94,.4,.14,.23,.6,.8,.24,.73,.02,.16,.6,.5,.04,.55,.72,.44,.07,.86,0,.6,.47,.54,.84,.95,.14,.86,.41,.48,.24,.29,.54,.01,.65,.48,.09,.74,.2,.61,.37,1,.31,.91,.55,.06,.86,.58,.4,.21,.09,.31,.82,.4,.87,.49,.93,.76,.33,.11,.44,.64,.22,.14,.73,.32,.12,.58,.5,.01,.86,.93,.51,.36,.6,.3,.56,.95,.34,.48,.85,.73,.92,.24,.81,.41,.57,.15,.22,.68,.27,.41,.78,.95,.29,.84,.68,.49,.41,.09,.65,.58,.24,.05,.38,.84,.23,.13,.97,.3,.77,.51,.96,.31,.1,.46,.03,.39,.29,.18,.82,.97,.3,.17,.67,.76,.6,.99,.44,.8,.26,.89,.31,.73,.38,.92,.34,.52,.39,.99,.3,.91,.23,.67,.94,.28,.17,.73,.36,1,.77,.27,.07,.75,.28,.61,.99,.8,.11,.84,.91,.36,.22,.98,.38,.68,.56,.78,.11,.53,0,.66,.25,.76,.17,.49,.99,.81,.89,.6,.25,.95,.75,.05,.17,.27,.84,.56,.88,.35,.84,.45,.52,.62,.2,.86,.27,.73,.59,.17,.75,.05,.92,.71,.09,.51,.75,.63,.09,.36,.02,.5,.13,.04,.49,.87,.38,.02,.99,.54,.23,.5,.39,.02,.13,.8,.27,.9,.51,.19,.85,.69,.54,.17,.76,.64,.43,.6,.18,.45,.13,.58,.91,.27,.8,.99,.67,.51,.72,.08,.88,.56,.08,.39,.28,.2,.7,.09,.56,.64,.51,1,.08,.48,.13,.63,.87,.54,.09,.8,.35,.1,.58,.81,.48,.92,.57,.22,.15,.9,.42,.48,.68,.09,.36,.17,.64,.58,.73,.16,.78,.55,.29,.03,.93,.27,.85,.72,.17,.81,.45,.92,.31,.64,0,.28,.72,.16,.53,.08,.36,.69,.59,1,.01,.49,.16,.76,.06,.27,.95,.02,.99,.68,.36,.11,.67,.08,.47,.81,.26,.44,.86,.02,.25,.91,.19,.56,.84,.65,.95,.73,.31,.8,.62,.45,.72,.16,.87,.09,.76,.61,.99,.34,.71,.95,.03,.73,.3,.42,.94,.58,.88,.33,.09,.94,.85,.34,.66,.87,.18,.72,.62,.16,.08,.42,.24,.34,.47,.69,.85,.96,.02,.5,.89,.36,.17,.75,.01,.82,.2,.67,.96,.04,.75,.27,.15,.63,.47,.89,.39,.23,.65,.35,.83,.04,.66,.79,.32,.18,.55,.77,.25,.53,.39,.05,.33,.45,.09,.62,.89,.48,.14,.44,.33,.95,.41,.6,.35,.11,.7,.22,.84,.38,.47,.44,.66,.82,.22,.45,.54,.38,.86,.69,.28,.95,.55,.68,.81,.39,.16,.77,.42,.91,.84,.42,.32,.64,.13,.19,.98,.61,.39,.8,.69,.3,.46,.26,.37,.6,.22,.95,.05,.31,.89,.59,.36,.66,.88,.43,.22,.56,.45,.17,.61,.34,.91,.12,.07,.24,.47,.8,.56,.05,.69,.23,.06,.53,.4,.48,.36,.84,.56,.91,.64,.97,.13,.2,.43,.24,.79,.62,.72,.4,.97,.47,.24,.58,.42,.3,.81,.22,.45,.69,.36,.84,.71,.15,1,.02,.52,.11,.29,.43,.49,.11,.61,.95,.86,.01,.92,.71,.88,.97,.27,.69,.93,.84,.17,.35,.78,.65,.05,.51,.14,.88,.04,.73,.96,.43,.58,.13,.96,.04,.86,.31,.94,.14,.77,.23,.09,.64,.2,.47,.37,.12,.6,.31,.49,.09,.56,.3,.22,.52,.97,.87,.56,.74,.38,.28,.12,.53,.98,.14,.75,.09,.87,.17,.55,.69,.12,.52,.8,.19,.05,.29,.51,.15,.73,.03,.86,.38,.11,.8,.47,.66,.77,.41,.01,.71,.18,.27,.49,.79,1,.75,.25,0,.95,.2,.76,.33,.03,.8,.59,.75,.55,.34,.89,.15,.55,.22,.07,.78,.33,.94,.72,.59,.35,.55,.85,.03,.98,.5,.05,.31,.6,.76,.18,.69,.88,.75,.97,.24,.71,.37,.14,.43,.32,.6,.12,.22,.75,.5,.02,.24,.44,.7,.56,.89,.21,.69,.76,.28,.62,.22,.53,.07,.82,.67,.25,.75,.59,.4,.49,.91,.72,.32,.42,.94,.8,.02,.91,.71,.2,.84,.91,.63,.03,1,.8,.06,.16,.72,.01,.48,.78,.66,.89,.43,.03,.36,.93,.67,.81,.01,.44,.92,.24,.65,.4,.47,.74,.96,.23,.8,.92,.32,.65,.25,.58,.97,.19,.28,.61,.86,.99,.36,.61,.94,.41,.58,.31,.15,.95,.68,.44,.09,.48,.72,.16,.4,.29,.91,.03,.67,.47,.07,.3,.91,.68,.6,.85,.12,.05,.77,.08,.93,.29,.13,.57,.2,.75,.26,.44,.85,.95,.41,.63,.15,.55,.84,.04,.46,.75,.53,.83,.05,.47,.56,.82,.36,.59,.75,.13,.95,.08,.28,.85,.55,.08,.99,.48,.88,.37,.75,.3,.91,.2,.36,.07,.64,.17,.01,.62,.85,.55,.15,.58,.34,.85,.44,.07,.55,.26,.73,.38,.6,.45,.67,.37,.27,.43,.1,.94,.19,.07,.73,.63,.21,.53,.58,.3,.48,.77,.37,.84,.15,.96,.08,.89,.69,.37,.57,.07,.48,.78,.88,.7,.43,.05,.94,.55,.14,.22,.5,.76,.11,.88,.04,.46,.64,.53,.82,.29,.61,.91,.24,.84,.52,.65,.11,.95,.19,.56,.99,.83,.42,.02,.52,.19,.39,.51,.84,.15,.47,.62,.8,.42,.89,.65,.95,.37,.08,.22,.48,.01,.27,.36,.19,.64,.28,1,.18,.24,.67,.96,.36,.06,.16,.97,.31,.52,.78,.38,.48,.16,.4,.83,.36,.19,.65,.12,.18,.45,.61,.5,.95,.82,.23,.78,.45,.27,.05,.96,.39,.69,.23,.53,.17,.77,.98,.36,.14,.84,.2,.12,.73,.58,.99,.81,.62,.32,.24,.56,.81,.27,.87,.41,.05,.92,.25,.62,.08,.76,.56,.33,.62,.42,0,.16,.63,.39,.97,.19,.16,.03,.53,.33,.74,.39,.69,.09,.84,.44,.17,.67,.73,.2,.36,.09,.89,.16,.69,.37,.06,.58,.97,.24,.36,.8,.4,.26,.77,.36,.16,.75,.31,.98,.65,.27,.97,.41,.68,.25,.73,.32,.12,.51,.02,.72,.58,.88,.82,.67,.93,.42,.91,.8,.11,.58,.89,.38,.76,.31,.71,.92,.64,.44,.84,.2,.62,.02,.99,.72,.64,.45,.03,.71,.8,.6,1,.02,.72,.09,.42,.71,.32,.98,.88,.37,.73,.18,.51,.77,.03,1,.62,.41,0,.67,.47,.94,.52,.32,.89,.48,.23,.14,.89,.52,.78,.39,1,.49,.12,.77,.18,.68,.13,1,.2,.52,.05,.27,.78,.22,.54,.82,.92,.11,.27,.53,.37,.77,.89,.24,.85,.03,.47,.31,.96,.57,.25,.34,.97,.85,.27,.76,.59,.03,.5,.99,.74,.44,0,.73,.47,.6,.71,.01,.49,.66,.59,.25,.88,.45,.1,.71,.21,.55,0,.9,.09,1,.48,.18,.82,.63,.29,.34,.11,.53,.75,.05,.7,.49,.33,.69,0,.84,.44,.09,.19,.5,.27,.04,.69,.15,.5,.66,.33,.24,.12,.91,.56,.26,.42,.91,.51,.3,.38,.89,.16,.54,.02,.41,.58,.66,.11,.81,.28,.88,.13,.66,.82,.29,.87,.57,.09,.77,.26,.03,.93,.09,.41,.66,.02,.47,.67,.05,.16,.31,.72,.96,.61,.36,.84,.55,.42,.67,.93,.89,.7,.13,1,.35,.47,.68,.75,.6,.94,.45,.63,.16,.58,.78,.9,.63,.73,.03,.81,.53,.59,.03,.49,.98,.41,.23,.8,.34,.16,.82,.2,.93,.3,.14,.86,.95,.21,.11,.94,.78,.06,.55,.81,.36,.9,.74,.37,.83,.28,.59,.69,.25,.92,.4,.17,.65,1,.18,.59,.29,.14,.58,.97,.27,.51,.15,.58,.95,.63,.41,.88,.77,.34,.92,.42,.81,.88,.59,.79,.31,.96,.15,.06,.35,.23,.86,.67,.78,.25,.63,.84,.11,.21,.51,.97,.59,.44,.2,.38,.48,.34,.13,.52,.2,.89,.39,.63,.7,.55,.18,.73,.86,.3,.96,.21,.89,.44,.64,.55,.02,.47,.25,.73,.05,.8,.35,.18,.47,.38,.51,.74,.27,.07,.86,.31,.02,.83,.09,.28,.98,.11,.41,.19,.26,.13,.39,.89,.22,.42,.12,.67,.32,.72,.11,.91,.64,.27,.38,.66,.51,.8,.05,.34,.45,.55,.85,.33,.4,.17,.7,.59,.13,.09,.63,.16,.51,.42,.03,.76,.39,.52,.05,.78,.45,.23,.39,.85,.47,.22,.87,.09,.36,.77,.71,.33,.01,.8,.55,.11,.58,1,.05,.27,.19,.09,.52,.05,.69,.47,.82,.71,.63,.75,.56,.04,.21,.99,.47,.31,.75,.8,.27,.33,0,.72,.91,.56,.93,.05,.74,.96,.3,.72,.07,.36,.97,.42,.8,.35,.59,.51,.13,.35,.6,.81,.08,.25,.83,.33,.9,.51,.29,.1,.88,.59,.03,.84,.07,.62,.42,.78,.15,.53,.24,.39,.67,.48,.71,.36,.67,.53,.87,.5,.67,.09,.62,.93,.8,.87,.2,.62,.47,.84,.53,.07,.59,.88,.12,.27,.58,.93,.67,.27,.03,.7,.48,.91,.28,.96,.42,.49,.31,.97,.78,.64,.22,.85,.12,.97,.71,.53,.87,.73,.04,.92,.67,.78,.42,.63,.2,.91,.44,1,.22,.76,.34,.25,.16,.45,.63,.55,.75,.36,.95,.42,.22,.36,.89,.52,.07,.95,.13,.47,.36,.58,.07,.9,.68,.05,.91,.42,.15,.64,.08,.78,.19,.69,.6,.4,.8,.53,.17,.83,.22,.05,.64,.27,.98,.07,.73,.78,.52,.93,.31,.75,.96,.17,.11,.64,.97,.4,.71,.25,.66,.31,.95,.22,.92,.55,.64,.98,.77,.9,.17,.03,.83,.24,.94,.02,.79,.34,1,.77,.29,.07,.36,.55,.09,.9,.36,0,.21,.79,.44,.94,.36,.72,.64,.41,.15,.78,.89,.57,.12,.63,.02,.23,.77,.88,.7,.25,.1,.94,.34,.56,.65,.31,.22,.08,.32,.63,.13,.55,.28,0,.95,.73,.51,.05,.27,.66,.47,.09,.94,.65,.73,.83,.31,.92,.69,.12,.84,.63,.73,.09,.25,.39,.2,.44,.3,.91,.82,.75,.16,.45,.37,.61,.53,.75,.87,.5,.33,.28,.42,.84,.23,.12,.03,.45,.93,.59,.5,.88,.11,.55,.16,.83,.41,.25,.16,.02,.38,.59,.49,.68,.42,.8,.56,.19,.77,.97,.53,.16,.77,.48,.02,.31,.38,.12,.44,.59,.34,.96,.58,.47,.74,.11,.6,.22,.45,.16,.58,.71,.25,.45,.77,.28,.56,.74,1,.69,.33,.03,.17,.47,.99,.2,.09,.51,.36,.22,.76,.86,.51,.37,.66,.2,.03,.45,.37,.68,.06,.89,.46,.4,.8,.93,.49,.69,.19,.8,.36,.49,.16,.34,.82,.61,.12,.86,.56,.38,.9,.49,.03,.38,.09,.2,.57,.47,.27,.15,.92,.57,1,.76,.6,.84,.7,.64,.08,.32,.55,.97,.22,.14,.28,1,.2,.67,.83,.98,0,.55,.48,.88,.64,.27,.76,.13,.32,.4,.71,.89,.47,.68,.57,.97,.66,.84,.71,.12,.22,.86,.01,.28,.33,.14,.49,.08,.44,.87,.36,.59,.82,.71,.95,.05,.25,.62,.12,.78,.22,.13,.42,.31,.71,.86,.04,.39,.9,.48,.97,.64,.05,.95,.18,.42,.28,.14,.86,.63,.76,.84,.01,.87,.76,.65,.97,.05,.44,.31,1,.1,.83,.56,.91,.59,.84,.55,.27,.16,.75,0,.58,.15,.37,.91,.42,.98,.65,.87,.58,.1,.42,.98,.35,.76,.18,.69,.14,.31,.6,.95,.78,.42,0,.99,.81,.3,.49,.04,.45,.15,.3,.02,.49,.23,.4,.69,.85,0,.67,.83,.48,.08,.39,.11,.45,.58,.15,.79,.34,.71,1,.38,.2,.67,.96,.78,.27,.2,.37,0,.29,.09,.34,.55,.45,1,.36,.6,.76,.92,.69,.88,.64,.37,.81,.21,.69,.11,.4,.18,.5,.67,.86,.74,.5,.36,.69,.87,.65,.98,.18,.52,.95,.66,.8,.2,.11,.83,.33,.69,.5,.86,.65,.55,.39,.23,.5,.27,.39,.55,.33,.25,.47,.82,.2,.61,.71,.16,.3,.73,.34,.14,.2,.76,.99,.62,.25,.95,.67,.27,.05,.78,.09,.3,.05,.24,.7,.92,.22,.69,.49,.03,.31,.8,.44,.85,.2,.71,.51,.87,.34,.67,.07,.4,.87,.71,.82,.67,.95,.55,.78,.12,1,.19,.49,.78,.28,.94,.73,.56,.8,.25,.36,.73,.66,.91,.29,.17,.04,.81,.58,.08,.46,.03,.55,.87,.75,.95,.8,.5,.86,.2,.04,.78,.31,.08,.51,.18,.44,.84,.03,.27,.67,.05,1,.26,.9,.86,.34,.22,.97,.42,.06,.92,.27,.02,.77,.49,.26,.57,.1,.3,0,.59,.27,.41,.54,.21,.82,.11,.02,.48,.78,.92,.07,.61,.7,.11,.92,.59,.15,.72,.9,.05,.58,.48,.42,.06,.97,.64,.44,.02,.37,.51,.83,.13,.54,.83,.22,.56,.63,.75,.46,.81,.55,.4,.13,.85,.25,.92,.62,.95,.08,.56,.36,.12,.25,.59,.17,.75,.53,.61,.12,.37,.29,.22,.07,.88,.35,.58,.89,.03,.56,.38,.11,.45,.33,.03,.64,.95,.84,.03,.21,.42,.06,.61,.52,.43,.87,.33,.89,.64,.14,.42,.09,.6,.2,.4,.74,.92,.28,.64,.83,.91,.39,.13,.59,.25,.53,.93,.79,.57,.45,.51,.65,.08,.61,.57,.16,.29,.82,.16,.55,.61,.35,.06,.84,.42,.69,.34,.76,.52,.85,.91,.02,.75,.38,.6,.31,.95,.11,.67,.35,.97,.45,.19,.85,.03,.38,.55,.28,.35,.94,.75,.89,.25,.49,.8,.31,.91,.71,.06,.42,.35,.74,.45,.86,.97,.52,.19,.14,.98,.31,.05,.77,.47,.57,.06,.41,.51,.25,.91,.64,.8,.08,.45,.94,.84,.24,.93,.2,.96,.52,.59,.41,.18,.46,.27,.75,.65,.31,.95,.62,.18,.75,.89,.48,.15,.53,.31,.95,.56,.76,.94,.7,.13,.23,.73,.53,.25,.97,.69,.31,.51,.65,.16,.05,.59,.53,.13,.22,.67,.56,.79,.99,.09,.75,.17,.39,.12,.33,.77,.03,.73,.4,.8,.01,.72,.47,.67,1,.45,.89,.16,.76,.92,.2,.82,.95,.45,.09,.67,.47,.97,.25,.89,.73,.19,.43,.74,.17,.86,.24,.73,.49,.77,1,.65,.08,.79,.23,.14,.62,0,.59,.73,.09,.23,.55,.87,.18,.59,.93,.13,.4,.33,.28,.69,.41,.84,.63,.25,.95,.67,.35,.75,.2,.67,.76,0,.48,.99,.73,.3,.14,.37,.05,.47,.78,.65,0,.76,.95,.72,.84,.09,.51,.43,.14,.87,.52,.81,.22,.31,.11,.42,.76,.63,.09,.49,.24,.35,.78,.29,.94,.04,.8,.38,.19,.75,.88,.11,.98,.78,.38,.69,.97,.43,.47,.03,.34,.27,.66,.44,.32,.48,.7,.89,.2,.96,.44,.23,.92,.44,.88,.64,.35,.24,.12,.7,.21,.53,.38,.03,.64,.47,.16,.25,.71,.31,.18,.59,.14,.45,.53,.84,.29,.57,.01,.52,.64,.09,.37,.28,.21,.88,.44,.51,.69,.38,.84,.95,.34,.16,.85,.64,.47,.76,.96,.3,.64,.02,.77,.07,.82,.95,.01,.57,.18,.73,.43,.09,.16,.99,.84,.12,.37,.32,.18,.41,.87,.52,.7,.64,.56,.27,.41,.1,.33,.85,.48,.04,.63,.2,.97,.8,.25,.7,.01,.47,.99,.68,.58,.89,.24,.39,.78,.87,.13,.4,0,.55,.64,.45,.11,.6,.48,.03,.54,.34,.44,.27,.87,.31,0,.82,.75,.94,.88,.2,.78,.02,.92,.85,.08,.59,.82,.1,.67,.29,.11,.51,.19,.09,.95,.78,.4,.07,.81,.95,.68,.31,.55,.07,.88,.37,.55,.09,.78,.85,.41,.07,.69,.05,1,.39,.79,.31,.81,.92,.69,.58,.12,.63,.16,.95,.05,.29,.47,.18,.53,.42,.98,.37,.13,.32,.07,.22,.49,.71,.17,.56,.65,.46,.35,.89,.08,.51,.87,.81,.54,.29,.47,.92,.59,.87,.67,.56,.04,.22,.94,.09,.82,.98,.72,.89,.58,.15,.26,.31,.55,.89,.35,.04,.59,.93,.38,.09,.56,.36,.02,.72,.96,.05,.69,.19,.98,.58,.82,.89,.2,.73,.31,.92,.85,.28,.95,.22,.81,.64,.09,.55,.18,.36,.26,.6,.13,.72,.47,.55,.63,.22,.28,.52,.35,.72,.53,.88,.59,.98,.69,.29,.55,.89,.52,.31,.61,.46,.25,.12,1,.75,.27,.67,.89,.99,.52,.3,.64,.93,.32,.2,.61,.89,.47,.23,.13,.42,.05,.86,.75,.41,.32,.72,.91,.59,.75,.11,.69,.78,.27,.02,.51,.73,.8,.57,.92,.45,.28,1,.11,.22,.78,.28,.67,.39,.24,0,.36,.65,.09,.53,.04,.8,.27,.17,.62,.34,.77,.42,.31,.15,.66,.2,.45,.98,.7,.39,.77,.13,.67,.47,.16,.33,.67,.28,.76,.84,.2,.48,.14,.56,.35,.51,.67,.29,.47,.09,.38,1,.56,.05,.64,.42,.7,.58,.05,.71,.5,.93,.77,.64,.11,.53,.4,.05,.95,.36,.14,.69,.99,.41,0,.47,.17,.79,.02,.35,.75,.44,.14,.02,.73,.2,.85,.09,.76,.91,.4,.49,.79,.02,.45,.34,.19,0,.72,.88,.48,.77,.26,.08,.71,.59,.99,.55,.27,.49,.94,0,.81,.27,.56,.16,.81,.24,.91,.08,.62,.84,.93,.68,.43,.06,.37,.84,.23,.87,.44,.73,.53,.16,1,.76,.6,.95,.71,.83,.24,.73,.33,.45,.92,.71,.82,.48,.1,.92,.55,0,.5,.34,.06,.78,.53,.03,.95,.43,.28,.95,.55,.78,.89,.61,.17,.43,.94,.33,.81,.22,.45,.91,.09,.74,.16,.69,.26,.83,.51,.15,.23,.78,.14,.36,.89,.16,.41,.22,.88,.44,1,.84,.67,.25,.85,.29,.79,.44,.16,.77,.86,.96,.27,.39,.83,.05,.25,.84,.5,.63,.98,.36,.64,.42,.58,.19,.68,.34,.22,.62,.16,.76,.68,.42,.25,.56,.13,.37,.53,.92,.05,.36,.84,.72,.17,.35,.56,.2,.64,.49,.08,.35,.99,.41,.47,.31,.67,.21,.33,.15,.27,.98,.12,.64,.03,.58,.37,.05,.91,.64,.44,.11,.33,.18,.48,.42,.15,.99,.17,.51,.09,.39,1,.27,.2,.73,.61,.27,.95,.84,.64,.28,.9,.66,.15,.84,.6,.73,.04,.22,.13,.5,.97,.08,.52,.67,.61,.86,.73,.03,.4,.84,.94,.63,.42,.05,.76,.3,.87,.53,.02,.47,.99,.3,.69,.03,.57,.29,.07,.33,.16,.5,.73,.07,.58,.89,.09,.64,.3,.58,.15,.67,.45,.56,.64,.94,.31,.7,.25,.13,.93,0,.29,.84,.04,.94,.11,.86,.56,.95,.09,.89,.8,.04,.97,.67,.82,.3,.42,.65,.23,.02,.8,.91,.7,.12,.76,.87,.42,.71,.64,.03,.57,.87,.44,.11,.56,.48,.85,.63,.75,.51,.8,.93,.7,.31,.83,.25,.06,.8,.55,.84,.04,.91,.56,.77,.67,.86,.22,.02,.56,.67,.06,.39,.84,.69,.12,.77,.41,.09,.21,.35,.49,.24,.09,.4,.86,.47,.33,.81,.6,.25,.79,.04,.37,.09,.98,.3,.57,.23,.33,.54,.14,.92,.63,.38,.96,.6,.74,.82,.25,.55,.8,.73,.13,.48,.69,.78,.91,.63,.44,.2,.93,.35,.7,.23,.52,.07,.75,.91,.33,.97,.09,.16,.78,.09,.4,.55,.8,.51,.73,.39,.62,.53,.79,.27,.38,.3,.61,.51,.35,.28,.58,.21,.07,.73,.19,.87,.5,.41,.63,.3,.45,1,.38,.05,.95,.2,.28,.84,.75,.15,1,.69,.78,.89,.04,.31,.38,.16,.29,.45,.13,.19,.48,.57,.39,.94,.65,.23,.69,.34,.27,.05,.45,.61,.31,.73,.89,.49,.79,.97,.45,.33,.2,.58,.47,.71,.82,.58,.98,.72,.34,.64,.96,.55,.7,.02,.39,.72,.2,.89,.29,.48,.17,.67,.79,.51,.01,.89,.8,.19,.69,.47,.09,.33,.22,.42,.64,.09,.34,.96,.38,.86,.22,.56,.01,.36,.83,.65,.03,.48,.37,.81,1,.41,.84,.2,.6,.27,.71,.38,.58,.84,.45,.89,.22,.33,.96,.1,.23,.45,.99,.7,.49,.06,.8,.16,.45,.72,.91,.4,.49,.96,.56,.11,.68,.94,.11,.58,.06,.23,.54,.3,.8,.45,.53,.1,.23,.36,.3,.01,.39,.22,.72,.47,.93,.7,.05,.55,.91,.66,.77,.85,.17,.31,.45,.75,.09,.6,.92,.4,.15,.95,.83,.44,.13,.35,.16,.22,.03,.53,.92,.04,.96,.31,.14,.41,0,.8,.46,.2,.11,.27,.92,.16,.32,.99,.45,.57,.72,.8,.6,.39,.11,.96,.64,.36,.3,.59,.25,.02,.85,.15,.69,.94,.04,.86,.19,.5,.66,.27,.97,.41,.11,.29,1,.15,.28,.56,.85,.19,.03,.58,.37,.11,.53,0,.87,.48,.23,1,.04,.71,.62,.13,.67,.91,.58,.31,.16,.01,.64,.91,.24,1,.2,.85,.11,.32,.78,.62,.28,.89,.33,.2,.48,.71,.88,.82,.67,.61,.14,.9,.68,.96,.72,.51,.81,.92,.64,.33,.07,.56,.2,.83,.63,.41,.24,.98,.1,.34,.71,.04,1,.36,.88,.44,.82,.69,.2,.55,.05,.67,.29,.65,.87,.58,.68,.85,.37,.65,.23,.87,.62,.69,.93,.14,.58,.89,.67,.42,.78,.61,.86,.65,.12,.34,.94,0,.22,.91,.47,.2,.08,.75,.43,.95,.53,.77,.9,.56,.49,.28,.77,.59,.43,.91,.1,.05,.62,.74,.88,.6,.51,.77,.69,.96,.11,.61,.73,.28,.69,.96,.79,.42,.81,.67,.12,.31,.53,.11,.26,.84,.47,.03,.79,.71,.88,.38,.2,.75,.42,.58,.68,.01,.56,.83,.14,.03,.37,.71,.06,.78,.98,.25,.36,.17,.41,.74,.02,.25,.34,.4,.63,.07,.6,.11,.53,.86,.78,.99,.14,.35,.75,.83,.33,.03,.52,.43,.89,.59,.08,.53,.26,.17,.02,.49,.91,.33,.18,.93,.46,.95,.07,.42,.76,.15,.27,.81,.44,.18,.53,.23,.37,.28,.52,.82,.04,.25,.52,.09,.47,.04,.24,.78,.42,.09,.88,.31,.71,.83,.62,.85,.16,.07,.35,.63,.42,.25,.97,.36,.67,.12,.23,.7,.33,.81,.53,.33,.2,.25,.05,.89,.41,.22,.46,.33,.92,.49,.23,.16,.63,.07,.34,.95,.59,.76,.36,.94,.78,.41,.55,.2,.28,.51,.11,.6,.83,.53,.07,.31,.77,.39,.65,.51,.25,1,.47,.82,.53,.41,.12,.54,.63,.05,.95,.49,.87,.56,.08,.87,.18,.31,.85,.47,.25,.17,.66,.44,.53,.88,.05,.15,.48,.68,.79,.27,.65,.22,.84,.77,.63,.97,.31,.58,.75,.41,.8,.56,.22,.75,.52,.3,.97,.1,.49,.73,.59,.03,.76,.95,.09,.67,.75,.4,.33,1,.73,.35,.79,.94,.55,.67,.17,.51,.63,.56,.06,.36,.28,.48,.69,.99,.83,.12,.19,.71,0,.1,.84,.54,1,.39,.76,.16,.47,.94,.67,.78,.48,.31,.07,.64,.77,.15,.87,.06,.76,.39,.92,.55,.24,.18,.04,.67,.5,.23,.7,.01,.34,.95,.81,.41,.93,.47,.27,.88,.14,.49,.96,.27,.2,.92,.75,.66,.11,.22,.58,.3,.87,.75,.45,.82,.28,.2,.36,.8,.64,.47,.77,.94,.2,.73,.97,.38,.01,.31,.22,.66,.27,.97,.6,.86,.18,.97,.11,.5,.33,.4,.13,.47,.67,.84,.09,.27,.66,.11,.38,0,.82,.2,.56,.4,.89,.05,.98,.32,.39,.82,.44,.2,.92,.09,.16,.58,.89,.2,.26,.4,.86,.32,.98,.83,.38,.78,.17,.99,.53,0,.24,.57,.31,.47,.88,.6,.8,.47,.2,.31,.8,.01,.58,.93,.29,.06,.11,.64,.39,.85,.58,.95,.35,.56,.66,.4,.58,.83,.3,.47,.75,.84,.42,.91,.83,.17,.57,.88,.64,.07,.72,.15,.65,.05,.34,.62,.73,.9,.09,.82,.45,.05,.58,.36,.87,.92,.67,.01,.67,.22,.09,.92,.58,.7,.11,.99,.16,.27,0,.66,.4,.05,.67,.56,.82,.75,.93,.5,.38,.77,.11,.28,.55,.37,.77,.67,.93,.03,.73,.9,.21,.38,.04,.98,.48,.86,.69,.91,.34,.65,.88,.6,.25,.69,.2,.55,.89,.62,0,.56,.85,.63,.49,.69,0,.56,.12,.71,.49,.08,.22,.72,.27,.12,.89,.43,.75,.91,.38,.79,.08,.67,.93,.33,.38,.95,.74,.61,.08,.49,.2,.65,.84,.42,.55,.99,.13,.72,.2,.01,.83,.24,.09,.99,.19,.03,.69,.09,.88,.58,.28,.07,.31,.45,1,.08,.5,.25,.56,.86,.23,.75,.99,.19,.41,.24,.67,.6,.13,.86,.41,.28,.06,.43,.17,.97,.37,.89,.33,.51,.01,.42,.76,.31,.5,.92,.55,.84,.35,.49,.11,.9,.47,.15,.09,.57,.2,.91,.42,.72,.05,.45,.06,.28,.85,.56,.35,.05,.55,.93,.44,.58,.16,.29,.53,.14,.23,.45,.05,.15,.35,.84,.47,.11,.28,.16,.73,.33,.41,.24,.8,.37,.97,.44,.63,.76,.05,.35,.59,.45,.03,.49,.67,.31,.11,.62,.16,.73,.52,.22,.06,.53,.16,.23,.67,.44,.95,.87,.37,.14,.72,.31,.78,.24,.88,.51,.28,.67,.46,.77,.31,.7,.5,.59,.95,.15,.36,.71,.48,.81,.13,.73,.2,.38,.78,.92,.43,.32,.51,.07,.8,.56,.01,.53,.36,.31,.97,.77,.19,.64,.8,.52,.73,.27,.47,.62,.8,.25,.67,.88,.19,.61,.73,.39,.24,.11,.61,.86,.2,.31,.25,.61,.82,.72,.01,.51,.25,.64,.85,.92,.62,.53,.15,.22,.67,.8,.28,.76,.7,.24,.77,.93,.44,.63,1,.78,.71,.95,.45,.77,.66,.95,.78,.69,.51,.99,.13,.91,.28,.07,.8,.33,.92,.18,.97,.81,.66,.94,.84,.58,.94,.2,.8,.47,.9,.34,.97,.84,.3,.69,.56,.86,.04,.36,.16,.26,.56,.98,.52,.19,.59,0,.34,.45,.95,.12,.57,.91,.16,.87,.35,.27,.78,.44,.22,0,.97,.6,.68,.53,.85,.29,.66,.12,.18,.97,.6,.48,.38,.29,.85,.95,.76,.47,.05,.68,.49,.93,.13,.57,.34,.84,.08,.55,.14,.41,.96,.34,.54,.1,.91,.03,.67,.95,.29,.79,.66,1,.54,.4,.95,.31,.66,.81,.98,.35,.08,.22,.79,.41,1,.44,.91,.49,.17,.11,.52,.87,.02,.37,.73,.06,.2,.51,.3,.11,.55,.02,.28,.4,.06,.34,.24,.82,.04,.58,.71,.53,.2,.11,.68,.38,.25,.53,.14,.31,.08,.4,.73,.06,.53,.27,.03,.4,.11,.61,.45,.99,.76,.11,.48,.83,.77,.69,.07,.8,.05,.94,.47,.81,.7,.09,.63,.85,.37,.05,.62,.41,.8,.05,.91,.52,.63,.83,.17,.34,.25,.95,.04,.59,.81,.47,.01,.67,.83,.14,.92,.72,.63,.1,.16,.83,.2,.55,.36,.02,.87,.23,.97,.03,.69,.92,.73,.06,.82,.14,.27,.83,.44,.32,.8,.16,.48,.41,.02,.8,.07,.73,.13,.44,.61,.09,.16,.7,.5,.31,.66,.02,.76,.29,.09,.62,.95,.41,.31,.64,.09,.48,.28,.84,.6,.38,.88,.63,.23,.97,.59,.18,.87,.56,.43,.62,.78,.47,.15,.88,.43,.84,.57,.49,.08,.88,.42,.76,.28,.17,.65,.37,1,.84,.69,.56,.77,.17,.36,0,.25,.41,.92,.55,.31,.47,.61,.38,.35,.64,.27,.89,.55,.22,.78,.34,.49,.73,.22,.47,.12,.57,.65,.32,.75,.93,.41,.06,.87,.41,.15,.34,.9,.53,.35,.75,.28,.2,.44,.07,.26,.42,.58,.91,.65,.29,.83,.3,.7,.42,.64,.2,.38,.31,.22,.51,.63,.7,.59,.97,.19,.63,.51,.91,.08,.56,.23,.35,.62,.18,.29,.9,.36,.49,.27,.78,.42,.96,.55,.15,.87,.69,.36,0,.85,.67,.25,.99,.58,.84,.68,.17,.91,.09,.8,.35,.73,.13,.85,.53,.71,.98,.09,.19,.37,.97,.31,.61,.75,0,.28,.95,.73,.59,.2,.52,.81,.95,.78,.42,.13,.6,.09,.22,.95,.51,.69,.89,.8,.16,.66,.22,.01,.91,.16,.85,.22,.74,.1,.16,.39,.95,.02,.27,.18,1,.85,.69,.97,.18,.4,.04,.13,.25,.53,.73,.66,.78,.48,.2,.71,.26,.99,.1,.58,.89,.66,.97,.51,.78,.34,.03,.43,.11,.96,.61,.17,.47,.81,.51,.89,.66,.44,1,.19,.3,.38,.47,.06,.78,.25,.38,.75,.64,.95,.88,.49,.85,.56,.78,.02,.86,.94,.57,.12,.85,.2,.47,.28,.58,.78,.2,.47,.58,.13,.75,.18,.39,.96,.34,.5,.44,.04,.53,.9,.47,.38,.24,0,.77,.29,.85,.67,.03,.25,.12,.97,.45,.69,.16,.35,.04,.99,.7,.1,.56,0,.25,.51,.76,.33,.88,.64,.28,.08,.6,.47,.33,.64,.99,.38,.69,.25,.94,.45,.58,.85,.49,.66,.6,.75,.89,.55,.64,.03,.31,.33,.88,.71,.49,.96,.61,.45,.08,.31,.58,.1,.91,.62,.05,.84,.42,.52,.34,.02,.73,.16,.88,.29,.99,.75,.51,.77,.39,.06,.91,.1,.59,.05,.77,.11,.56,.87,.01,.92,.75,.14,.87,.56,.01,.84,.31,.16,.42,.69,.05,.96,.24,.67,.41,.18,.64,.05,.73,.34,.64,.93,.09,.51,.98,.29,.8,.06,.89,.45,.01,.55,.12,.75,.7,.27,.18,.69,.05,.62,.81,.34,.47,.16,.5,.93,.55,.8,.65,.36,.51,.24,.79,.84,.65,.46,.25,.35,.46,.89,.71,.92,.2,.45,.39,.04,.82,.91,.22,.53,.85,.07,.73,.09,.58,.51,.73,.02,.37,.99,.3,.06,.35,.45,.14,.43,.36,.1,.53,.62,.78,.23,.85,.16,.69,.89,.21,1,.83,.38,.75,.45,.31,.18,.64,.8,.16,.54,.39,.6,.09,.49,.64,.14,.2,.86,.55,.25,.76,.28,.36,.16,.91,.26,.35,.78,.69,.23,.6,.32,.66,.42,1,.22,.47,.78,.1,.25,.33,.42,.16,.75,.53,.33,.99,.25,.39,.91,.01,.8,.41,.19,.88,.33,.71,.41,.54,.27,.73,.64,.25,.94,.62,.84,.99,.4,.29,.12,.96,.64,.92,.59,.73,.09,.42,.2,.91,.06,.86,.11,.4,.53,.32,.12,.91,.72,.62,.13,.33,.65,.03,.97,.72,.53,.16,.35,.72,.12,.95,.29,.48,.88,.81,.19,.32,.63,.07,.69,.2,.81,.87,.23,.72,.8,.91,.76,.45,.16,.06,.43,.58,.3,.38,.79,.02,.34,.69,.23,0,.96,.56,.73,.87,.09,.95,.3,.85,.94,.24,.7,.83,.35,.59,.08,.32,.69,.98,.66,.83,.45,.69,.6,.42,.51,.07,.47,.54,.95,.08,.28,.7,.08,.58,.54,.95,.71,.81,.62,.89,.28,.8,.01,.45,.83,.52,.6,.7,.31,.45,.75,.64,.03,.13,.61,.92,.34,.87,.8,.08,.41,.15,.35,.55,.78,.89,.73,.53,.21,.09,.37,.25,.31,.84,.48,.71,.29,.56,.96,.62,.03,.93,.78,.37,.06,.86,.21,.42,.84,.57,.27,.12,.9,.62,.44,.78,.02,.4,.59,.23,.43,.34,.09,.95,.81,.53,.91,.42,.61,.52,.95,.08,.31,.58,.2,.92,.85,.64,1,0,.75,.11,.51,.63,.48,.16,.9,.52,.13,.37,.25,.47,.23,.63,.7,.45,.11,.56,.39,.01,.25,.95,.42,.9,.49,.01,.4,.22,.54,.95,.02,.21,.97,.14,.82,.36,.18,.83,.49,.91,.75,.34,.87,.19,.01,.59,.49,.1,.96,.62,.12,.7,.77,.1,.2,.14,.99,.08,.23,.56,.48,.95,.22,.65,.09,.18,.49,.29,.89,.53,.01,.22,.09,.49,.17,.27,.42,.88,.8,.66,.98,.02,.6,.14,.43,.75,.2,.27,.49,.71,.2,.52,.27,.8,.55,.97,.08,.38,.78,.69,.47,.25,.99,.31,.67,.9,.78,.16,.94,.64,.77,.26,.45,.11,.25,.77,0,.16,.38,.64,.02,.5,.24,.68,.27,.35,.5,.22,.86,.93,.25,.74,.96,.31,.6,.78,.64,.84,.93,.04,.41,.76,.08,.26,.78,.17,.93,.88,.5,.73,.79,.18,.64,.14,.56,.89,.11,.31,.73,.86,.64,.28,.9,.76,0,.62,.37,.16,.25,.44,.65,.41,.28,.94,.2,.38,.47,.24,.91,.42,.27,.95,.37,.48,.57,.83,.91,.37,.8,.42,.84,.31,.55,1,.67,.44,.59,.96,.72,.63,.34,.94,.67,.56,.75,.01,.49,.14,.45,.77,.27,.95,.05,.82,.67,.36,.84,.09,.59,.98,.65,.44,.16,.7,.49,.62,.16,.33,.02,.84,.09,.55,.19,.51,.06,.69,.53,.01,.4,.58,.69,.85,.33,.48,.98,.29,.72,.83,.34,.96,.73,.4,.09,.55,.84,.67,.45,.58,.4,.19,.05,.86,.42,.21,.08,.31,.7,.58,.99,.53,.87,.36,.49,.73,.33,.64,.12,.22,.04,.38,.28,.85,.76,.45,.25,.67,.17,.47,.35,.71,.59,.44,.25,.72,.97,.58,.02,.81,.13,.91,.73,.42,.84,.05,.71,.86,.2,.55,.06,.62,.87,.78,.67,.32,.02,.7,.27,.16,.05,.75,.4,.07,.82,.2,.1,.28,.78,.44,.89,.05,.38,.1,.97,.34,.62,.92,.18,.36,.88,.66,.39,.49,.12,.91,.42,.78,.25,.31,.02,.9,.09,.28,.78,.24,.97,.87,.52,.39,.66,.79,.45,.95,.31,.24,.61,.84,.09,.89,.17,.37,.74,.09,.67,.44,.85,.55,.48,.14,.8,.62,.04,.94,.18,.29,.08,.15,.66,.83,.53,.12,.69,.45,.9,.15,.5,.12,.33,.19,.67,.01,.97,.63,.08,.44,.55,.84,.67,.99,.53,.71,.33,.04,.99,.8,.4,.54,.04,.23,.09,.94,.12,.33,.45,.86,.69,.53,.33,.04,.61,.15,.53,.78,.02,.38,.64,1,.35,.71,.05,.26,.11,.42,.19,.64,.98,.55,.69,.9,.51,.25,.63,.75,.91,.36,.16,.85,.26,.6,.8,.45,.86,.22,.71,.3,.56,.73,.13,.53,.2,.33,1,.03,.62,.16,.89,.47,.76,.62,.35,.93,.45,.04,.59,.44,.74,.18,.92,.27,.13,.85,.37,.75,.97,.3,.21,.52,1,.05,.59,.91,.54,.12,.27,.2,.08,.89,.31,.44,.91,.77,.38,.72,.89,.97,.33,.77,.36,.27,.78,.98,.56,.37,.75,.81,.24,.84,.44,.56,.2,.83,.25,.39,.95,.31,.6,.42,.07,.94,.2,.65,.49,.61,.12,.86,.75,.98,.46,.66,.53,.81,.22,.09,.28,.95,.77,.56,.99,.26,.65,.33,.57,.29,.12,.79,.51,.16,.45,.89,.95,.58,.5,.88,.11,.33,.45,.21,.95,.13,.34,.55,.01,.49,.66,.08,.53,.2,.72,.31,.16,.54,.08,.82,.05,.47,.94,.25,.69,.8,.58,.24,.71,.37,.55,.12,.82,.22,.56,.84,.67,.15,.89,.29,.07,.71,.35,.01,.71,.58,.05,.48,.12,.43,.71,.35,.78,.45,.28,.18,.83,.34,.95,.78,.58,.67,.17,.52,.25,.13,.58,.46,.24,.53,.02,.46,.93,.62,.15,.34,.04,.86,.42,.64,.04,.72,.92,.12,.3,.72,.89,.05,.75,.19,.1,.8,.25,.47,.13,.88,.36,.24,.95,.31,.42,.78,.18,.38,.84,.05,.62,.75,.38,.17,.47,.22,.34,.81,.11,.95,.89,.45,.75,.04,.9,.58,.65,.2,.36,.73,.07,.77,.4,.8,.59,.01,.66,.83,.44,.96,.71,.33,.58,.99,.75,.43,.93,.01,.67,.88,.42,.98,.42,.63,.83,0,.44,.87,.07,.46,.93,.66,.29,.96,.4,.51,.02,.28,.39,.72,.51,.22,.8,.55,.98,.48,.6,.89,.19,.67,.9,.79,.6,.06,.65,.23,.94,.7,.42,.62,.02,.72,.39,1,.05,.87,.7,.35,.82,.06,.63,.82,.69,.2,.87,.07,.52,.73,.22,.61,.11,.96,.27,.55,.37,.8,.47,.52,.15,.6,.82,.48,.37,.91,.61,.68,.55,.78,.03,.7,.17,.64,.08,.61,.25,.9,.51,.3,1,.43,.58,.84,.66,.08,.45,.85,.5,.19,.43,.61,.83,.23,.31,.42,.1,.82,.52,.85,.3,.23,.64,.17,.89,.28,.71,.37,.05,.2,.82,.88,.23,.05,.33,.13,.49,.78,.36,.58,.21,.76,.25,.13,.35,.6,.75,.15,.63,.31,.19,.77,.03,.85,.14,.71,.78,.17,.99,.32,.64,.92,.47,.15,.83,.22,.41,.29,.8,.53,.04,.27,.15,.87,.53,.83,.12,.47,.06,.91,.5,.27,.47,.35,.22,.59,.48,.96,.19,.92,.44,.35,.11,.58,.25,.44,.67,.84,.29,.91,.2,.34,.49,.76,.08,.23,.99,.05,.69,.43,.28,.89,.21,.73,0,.32,.4,.96,.3,.46,.84,.53,.92,.34,.05,.71,.15,.67,.24,.89,.02,.13,.78,.91,.63,0,.29,.74,.06,.15,.36,.53,.67,.96,.76,.28,.04,.15,.45,.96,.5,.93,.11,.41,.79,.5,.59,.29,.12,.41,.48,.64,.9,.84,.61,.27,.95,.12,.31,.67,.53,.91,.18,.97,.29,.39,.94,.81,.07,.45,.58,.24,.63,.31,.91,.47,.55,.09,.01,.37,.65,.31,.05,.75,.07,.95,.16,.35,.42,.98,.74,.31,.41,.02,.77,.57,.31,.77,.15,.86,.09,.75,.82,.41,.01,.67,.11,.27,.73,.16,.78,.91,.39,.75,.97,.01,.36,.78,.53,.69,.83,.15,.65,.61,.39,.85,.32,.95,.03,.65,.55,.44,.86,.18,.84,.08,.58,.76,.38,.13,.69,.43,.81,.56,.41,.09,.49,.82,.56,.31,.27,.4,.72,.35,.56,.91,.23,.69,.98,.11,.86,.16,.5,.69,.63,.89,.58,.67,.01,.35,.53,.23,.97,.16,.91,.76,.65,.95,.16,.8,.28,.55,.18,.05,.69,.47,.84,.02,.73,.37,.8,.64,.51,.11,.69,.53,.89,.35,.5,.74,.95,.37,.06,.67,.86,.75,.81,.23,.97,.58,.89,.53,.69,.47,.65,.84,.59,.5,.66,.19,.47,.91,.27,.68,.98,.22,.38,.64,.93,.53,.92,.14,.72,.38,.85,.55,.9,.48,.65,.31,.55,.16,.11,.58,.48,.66,.14,.97,.03,.43,.95,.29,.74,.19,.78,.56,.4,.15,.79,.09,1,.24,.66,.52,.2,.94,.02,.25,.84,.5,.2,.97,.86,.76,.35,.19,.64,.97,.52,.08,.99,.22,.8,.66,.36,.5,.78,.45,.61,0,.37,.22,1,.4,.34,.13,.75,.83,.62,.67,.05,.47,.2,.55,.31,.5,0,.7,.37,.07,.46,.91,.38,.8,.16,.95,.58,.1,.44,.06,.89,.22,.37,.25,.72,.15,.87,.01,.41,.54,.15,.28,.22,.42,.53,.12,.71,.19,.44,.35,.13,.89,.27,.05,.22,.11,.82,.05,.96,.6,.37,.11,.44,.81,.6,.3,.05,.2,.62,.27,.78,.31,.46,.6,.24,.01,1,.05,.84,.34,.8,.26,.92,.06,.41,.24,.33,.56,.9,0,.52,.11,.48,.24,.71,.92,.29,.48,.59,.35,.74,.44,.88,.31,.68,.55,.98,.09,.3,.63,0,.25,.94,.71,.04,.44,.75,.6,.16,.45,.12,.86,.56,.03,.19,.27,.34,.89,.56,.84,.08,.78,.2,.86,.27,.45,.16,.88,.3,.84,.69,.39,.08,.84,.56,.22,.98,.74,.85,.65,.25,.55,.34,.27,.44,.23,.7,.31,.77,.56,.84,.03,.62,.3,.99,.2,.69,.82,.93,.46,.62,.98,.3,.89,.46,.05,.64,.99,.21,.78,.58,.93,.76,.89,.34,.54,.69,.24,.87,.17,.54,0,.88,.73,.51,.42,.37,.07,.52,.98,.15,.09,.77,.37,.42,.2,.72,.48,.63,.86,.18,.7,.83,.62,.75,.22,.8,.35,.64,.84,.98,.06,.62,.83,.4,.2,.69,.05,.82,.11,.15,.61,.8,.29,.74,.38,.15,.68,.53,.44,.61,.15,.88,.35,.22,.83,.67,.89,.52,.31,.95,.88,.73,.93,.64,.73,.19,.43,.53,.03,.66,.59,.98,.04,.75,.51,.36,.01,.81,.99,.26,.77,.93,.42,.11,.52,.33,.12,1,.05,.62,.74,.92,.84,.6,1,.15,.45,.75,.96,.44,.51,.66,.1,.25,.59,.16,.8,.71,.04,.17,.58,.76,.85,.29,.73,.51,.01,.31,.4,.52,.43,.29,.79,.14,.43,.75,.64,.96,.47,.24,.14,.98,.81,.87,.69,.91,.22,.82,.72,.93,.53,.82,.6,.1,.95,.04,.44,.3,.58,.36,.91,.06,.5,.7,.12,.41,.27,.67,.33,.17,.53,.02,.88,.94,.55,.29,.97,.5,.39,.05,.46,.05,.64,.78,.92,.23,.06,.83,.31,.55,.11,.91,.29,.01,.35,.73,.08,.66,.15,.55,.4,.05,.13,.96,.29,.72,.92,.47,.31,.53,.4,.13,.96,.61,.58,.44,.16,.12,.62,.36,.18,.67,.8,.28,.6,.42,.69,.83,.13,.51,.05,.27,.4,.02,.64,.28,.11,.18,.81,.76,.33,.47,.73,.39,.09,.33,.84,.39,.67,.24,.36,.07,.4,.81,.63,.18,.72,.07,.17,.64,.99,.01,.51,.31,.08,.74,.34,.42,.69,.08,.31,.59,0,.45,.58,.4,.04,.33,.67,.16,.92,.41,.23,.53,.75,.98,.01,.51,.16,.94,.27,.58,1,.17,.53,.8,.89,.42,.75,.23,.65,.13,.45,.23,.64,.91,.73,.19,.95,.88,.5,.35,.89,.41,.74,.38,.96,.68,.78,.48,.39,.55,.94,.22,.42,.27,.84,.36,.24,.51,.66,.85,.57,.36,.16,.89,.07,.24,.81,.73,.28,.09,.23,.91,.52,.72,.47,.29,.9,.56,.03,.95,.2,.87,.08,.33,.37,.18,.66,.83,.53,.92,.88,.33,.58,.92,.05,.36,.91,.83,.02,.97,.24,.52,.59,.94,.02,.45,.98,.6,.16,.93,.45,.85,.98,.67,.82,.25,.6,.37,.84,.94,.26,.61,.2,.91,.76,.55,.22,.75,.28,.13,.33,.65,.26,.49,.14,.27,.77,.73,.33,.67,.15,.8,.23,.66,.4,.76,.45,.03,.85,.72,.09,.38,.03,.58,.99,.31,.81,.37,.77,.71,0,.36,.25,.82,.59,.22,.14,.56,.03,.19,.67,.13,.47,.2,.04,.65,.71,.14,.81,.61,.48,.76,.08,.61,.99,.76,.47,.22,.01,.62,.25,.69,.77,.61,.93,.45,.53,.85,.76,.33,.67,.95,.02,.82,.08,.48,.37,.72,.45,.78,.53,.95,.47,.89,.76,.31,.11,.7,.5,.22,.67,.47,.55,.23,.62,.15,.52,.64,.89,.75,.13,.28,.8,.17,.71,.87,.55,.24,.08,.36,.26,.55,.03,.47,.91,.72,.19,.56,.05,.83,.52,.11,.86,.16,.39,1,.81,.68,.87,.95,.75,.84,.98,.45,0,.57,.09,.85,.36,.45,.58,.87,.09,.66,.22,.36,.64,.31,.51,.96,.22,.7,.11,.49,.59,.07,.53,.16,.86,.56,.11,.69,.34,.43,.7,.28,.99,.6,.83,.25,.58,.93,.33,.18,.99,.27,.04,.86,.18,.32,.57,.03,.88,.3,.09,.41,.89,.8,.46,.41,.12,.34,.19,0,.67,.14,.42,.05,.22,.37,.6,.25,.69,1,.22,.65,.05,.34,.14,.65,.22,.01,.58,.44,.25,.15,.8,.08,.84,.29,.73,.09,.44,.96,.21,.33,.42,.17,.48,.93,.63,.33,.52,.11,.29,.67,.73,.6,.14,.87,.41,.76,.31,.11,.45,.71,.4,.99,.44,.3,.6,.47,.64,.44,.1,.51,.18,.02,.44,.09,.62,.35,.88,.49,.94,.2,.96,.07,.73,.26,.33,.97,.83,.58,.9,.24,.75,.61,.8,.29,.41,.91,.19,.87,1,.41,.3,.94,.45,.49,.97,0,.78,.85,.36,.1,.49,.9,.02,.74,.55,.81,.47,.37,.69,.52,.98,.71,.93,.45,.18,.69,.6,.95,.75,.09,.52,1,.84,.66,.5,.89,.38,.8,.5,1,.8,.13,.44,.86,.77,.12,.42,.85,.91,.26,.56,.85,.71,.29,.94,.55,.96,.36,.6,.4,1,.14,.91,.8,.29,.69,.56,.05,.81,.67,.06,.56,.42,.07,.84,.77,.37,.47,.9,.79,.32,.51,.94,.2,.06,.62,.89,.25,.78,.14,.73,0,.68,.95,.05,.24,.92,.35,.62,.37,.55,.22,.7,.19,.65,.25,.6,.43,.29,.63,.12,.91,.54,.18,0,.49,.14,.06,.46,.35,.16,.65,.85,0,.67,.35,.25,.58,.66,.05,.88,.17,.75,.08,.64,.45,.54,.76,.31,.71,.42,.37,.88,.08,.62,.91,.3,.1,.41,.64,.12,.25,.55,.84,.16,.34,.54,.19,.29,.02,.56,.25,.96,.06,.3,.62,.25,.69,.58,.93,.53,.18,.33,.53,.58,.16,.78,.38,.98,.08,.42,.79,.16,.04,.85,.73,.28,.52,0,.64,.39,.51,.05,.77,.88,.47,1,.36,.79,.22,.71,.96,.25,.16,1,.01,.19,.45,.04,.71,.65,.34,.58,.97,.51,.33,.07,.59,.36,.89,.2,.34,.77,.58,.83,.48,.75,.88,.28,.79,.94,.42,.05,.8,.16,.72,.55,.78,.48,.82,.44,.62,.75,.4,.8,1,.7,.04,.93,.49,.56,.24,.44,.75,.12,.8,.09,.76,.24,.61,.33,.91,.25,.21,.15,.92,.06,.22,.17,.64,.28,.13,.22,.73,.55,.85,.22,.47,.88,.39,.77,.48,.05,.42,.64,.85,.73,.92,.17,.39,.75,.58,.8,.94,.1,.35,.04,.3,.64,.73,.01,.92,.28,.08,.48,.7,.03,.61,.52,.35,.69,.65,.45,.07,.89,.66,.77,.25,.55,.18,.94,.35,.14,.27,.11,.63,.29,.92,.03,.61,.45,.69,.59,.81,.29,.63,.98,.16,.25,.84,.78,.12,.42,.83,.65,.95,.27,.45,.8,.53,.14,.7,.02,.22,.14,.98,.7,.06,.53,.34,.75,1,.09,.34,.88,.02,.24,.37,.05,.29,.95,.25,.67,.41,.53,.21,.84,.37,.09,.78,.63,.93,.52,.91,.47,.34,.55,.82,.38,.48,.59,.96,.4,.68,.61,.84,.99,.78,.53,.68,.93,.4,.16,.04,.78,.53,.72,.01,.98,.27,.92,.79,.23,.05,.6,.32,.78,.64,.08,.45,.2,.16,.53,.77,.45,.83,.09,.39,.69,.45,.83,.64,.72,.24,.31,.89,.23,.11,1,.22,.34,.56,.12,.18,.36,.95,.11,.83,.62,.41,.56,.67,.85,.4,.15,.48,.86,.35,.21,.49,.12,.36,.73,.52,.84,.07,.53,.45,0,.28,.73,.19,.48,.11,.56,.85,.07,.41,.28,.97,.36,.65,.43,.1,.58,.47,.16,.91,.58,.44,.52,.84,.4,.17,.99,.67,.87,.72,.56,.09,.18,.88,.31,.75,.27,.63,1,.33,.15,.05,.28,.39,.19,.64,.99,.14,.05,.87,.71,.02,.82,.28,.37,.55,.44,.07,.34,.83,.02,.49,.97,.64,.27,.19,.33,.11,.62,.68,.12,.58,.98,.44,.38,.12,.47,.87,.25,.51,.85,.67,.42,.9,.23,.98,.61,.25,.89,.2,.97,.36,.13,.54,.95,.43,.77,.84,.51,.37,.94,.82,.45,.86,.5,.69,.31,.47,.02,.73,.95,.2,.51,.78,.7,.56,.09,.66,.78,.95,.88,.07,.92,.22,.41,.33,.76,.9,.38,.98,.63,.05,.93,.3,.76,.16,.61,.67,.89,.46,.56,.85,.78,.23,.35,.87,.64,.25,.11,.2,.69,.25,.64,.74,.59,.5,.15,.22,.46,.91,.35,.6,.06,.81,.47,.05,.72,.42,.89,.56,.67,.84,.01,.73,.27,.44,.65,.17,.33,.78,.1,.52,.73,.03,.2,.94,.42,.59,.26,.66,.76,.38,.91,.95,.6,.84,.22,.41,.36,.52,.17,.76,.88,.53,.23,.97,.03,.71,.36,.95,.02,.32,.72,.15,.49,.76,.11,.56,.03,.44,.78,.86,.18,.66,.06,.27,.59,.01,.75,.16,.28,.94,.04,.6,.77,.9,.23,.83,.3,.09,.89,0,.24,.97,.82,.27,.03,.42,.3,.64,.45,.13,.69,.97,.6,.19,.66,.22,.52,.87,.42,.69,.39,.99,.3,.06,.75,.18,.1,.3,.49,.95,.71,.02,.81,.4,.73,.86,.05,.95,.11,.42,.29,.08,.93,.41,.83,0,.76,.52,.98,.13,.58,.89,.19,.53,.82,.33,.22,.76,.52,.95,.09,.78,.91,.56,.29,.47,.64,.95,.18,.88,.72,.63,.12,.9,.2,.33,.08,.45,.11,.68,.42,.53,.79,.9,.71,.02,.84,.27,.04,.69,.83,.57,.31,.75,.12,.25,.78,.63,.55,.05,.42,.87,.33,.52,.71,.24,.61,.3,.02,.57,.74,.47,.87,.09,.66,.51,.71,.56,.08,.4,.16,.53,.12,.6,.41,.68,.45,.31,.63,.36,.44,.18,.59,.7,.23,.53,.77,.86,.27,.05,.5,.09,.31,.78,.11,.34,.8,.02,.21,.64,.49,.92,.24,.82,.62,.03,.89,.17,.61,.22,.53,.95,.34,.63,.48,.36,.55,.82,.89,.25,.76,.56,.65,.27,.71,.45,.22,.34,.69,.4,.11,.25,.66,.08,.95,.42,.16,.33,.6,.5,.22,.76,.98,.16,.85,.24,.42,.33,.49,.28,.76,.53,.86,.72,.56,.8,.23,.77,.07,.29,.16,.1,.96,.6,.32,.64,.92,.35,.07,.19,.39,.95,.59,.49,.19,.37,.81,.27,.94,.64,.18,.82,.91,.09,.98,.47,.41,.92,.35,.25,.96,.34,.78,.11,.37,.23,.82,.96,.27,.87,.35,.7,.49,.17,.8,.93,.56,.06,.75,.94,.49,.84,.99,.15,.04,.59,.37,.8,.9,.42,.71,.94,.48,.58,.25,.9,.55,.12,.78,.36,.44,.55,.99,.39,.66,.46,.12,.75,.44,.06,.18,.78,.28,.9,.2,.06,.7,.36,.61,.07,.33,.18,.95,.06,.64,.85,.28,.78,.97,.47,.73,.04,.47,.61,.86,.25,.7,.36,.04,.42,.09,.58,.37,.05,.67,.78,.89,.09,.36,.05,.42,.94,.02,.51,.86,.27,.63,.99,.55,.44,.25,.75,.46,.15,.43,.5,.61,.8,.46,.85,.56,.07,.86,1,.51,.11,.74,.46,.02,.6,.38,.15,.75,.65,.22,.8,.15,.69,.42,.17,.87,.44,.61,.91,.32,.64,.67,.45,.09,1,.89,.03,.27,.73,.14,.22,.87,.52,.13,.06,.35,.67,.42,.95,.2,.64,.24,.56,.03,.83,.17,.66,.05,.73,.45,.86,.27,0,.69,.13,.33,.71,.27,.77,.37,.31,.91,.67,.59,.93,.11,.75,.6,.42,.95,.5,.16,1,.85,.6,.38,.82,.17,.94,.53,.02,.61,.36,.88,.3,.8,.12,.55,.91,.07,.81,.63,.89,.69,.49,.71,.94,.54,0,.59,.24,1,.68,.17,.63,.29,.38,.15,.92,.37,0,.83,.67,.4,.06,.87,.2,1,.78,.24,.93,.05,.14,.28,.68,.43,.7,.16,.6,.36,.23,.97,.29,.69,.45,.34,.88,.08,.84,.54,0,.63,.58,.27,.99,.03,.75,.15,.5,0,.55,.76,.21,.62,.54,.85,.41,.49,.8,.31,.66,.25,.38,.6,.91,.3,.51,.71,.12,.31,.99,.63,.38,.27,.89,.42,.33,1,.19,.61,.94,.75,.57,.22,.92,.08,.55,1,.83,.1,.48,.25,.4,.01,.52,.68,.22,.1,.78,.4,.73,.45,.12,.52,.75,.49,.11,.45,.2,.84,.13,.58,.24,.98,.36,.66,.2,.45,.97,.16,.27,.85,.3,.19,.81,.37,.16,.45,.84,.56,.8,.47,.22,.97,.69,.6,.21,.71,.5,.78,.19,.94,.53,.81,.69,.55,.13,.28,.66,.38,.74,.98,.33,.24,0,.3,.91,.86,.58,.76,.12,.83,.55,.05,.27,.57,.44,.29,.75,.92,.09,.5,.72,.23,.54,.42,.87,.17,.82,.31,.05,.42,.33,.11,.6,.98,.07,.62,.42,.89,.7,.82,.21,.79,.07,.41,.87,.76,.45,.2,.09,.96,.55,.77,.14,.69,.39,.56,.11,.39,.8,.05,.87,.45,.69,.02,.62,.2,.75,.86,.69,.47,.99,.34,.85,.28,.57,.01,.21,.27,.91,.04,.31,.24,.62,.79,.33,.93,.39,.7,.18,.49,.72,0,.27,.77,.5,.35,.56,.03,.44,.08,.62,.27,.97,.73,.33,.11,.27,.72,.34,.83,.06,.46,.09,.81,.33,.12,.28,.63,.09,.36,.3,.01,.41,.89,.49,.56,.21,.61,.78,.89,.58,.75,.47,.17,.06,.5,.41,.96,.2,.79,.92,.73,.11,.98,.33,.83,.19,.67,.37,.81,.27,.06,.99,.71,.37,.94,.65,.79,.95,.19,.7,.35,.23,.91,.03,.17,.53,.02,.47,.15,.59,.93,.02,.53,.15,.84,.73,.51,.22,.01,.82,.49,.05,.26,.84,.47,.3,.52,.6,.16,.23,.4,.51,.95,.36,.04,.31,.82,.17,.09,.93,.64,.53,.89,.82,.63,.77,.68,.95,.87,.4,.72,.05,.65,.53,.92,.05,.8,.33,.6,.95,.43,.06,.73,.62,.95,.78,.91,.53,.11,.88,.68,.19,.41,.94,.03,.58,.13,.89,.55,.96,.61,.41,.94,.84,.47,.22,.97,.65,.83,.71,.18,.95,.03,.82,.11,.45,.09,.52,.79,.4,.67,.33,.89,.65,.01,.31,.62,.51,.38,.19,.61,.47,.23,.41,.88,.04,.95,.57,.64,.36,.26,.53,.12,.5,.27,.71,.46,.07,.84,.58,.46,.73,.98,.33,.85,.25,.95,.66,.37,.22,.68,.28,.43,.65,.34,.6,.94,.31,.62,.9,.69,.94,.16,.66,.96,.35,.78,.94,.72,.29,.16,.58,.91,.64,.22,.55,.4,.75,.44,.2,.69,.32,.08,.44,.36,.18,.58,.14,.99,.5,.25,.09,.29,.64,.44,.92,.13,.84,.64,.22,.86,.13,.36,.25,.69,.32,.42,.55,.06,.5,.62,.91,.66,.51,.8,.42,.31,.77,.13,.23,.7,.56,.01,.78,.44,.15,.5,.26,.61,.44,.33,.93,.5,.37,.2,.96,.25,.04,1,.22,.78,.44,.73,.16,.87,.42,.04,.78,.89,.05,.77,.56,.31,.47,.13,.7,.44,.84,.1,.61,.8,.17,.08,.88,.53,.92,.15,.3,.8,.39,.12,.65,.44,.56,.74,.3,.5,.82,.59,.91,.96,.02,.81,.11,.45,.4,.19,.78,.44,.33,.2,.02,.74,.25,.09,.49,.05,.88,.8,.43,.11,.49,.77,.86,.61,.03,.26,.12,.99,.46,.56,.15,.86,.51,.05,.83,.35,.18,.76,.86,.39,.8,.2,.24,.56,.37,.16,.48,.32,.69,.45,.17,.84,.02,.73,.24,.82,.3,.76,.17,.25,.39,.19,.67,.27,.64,.51,.07,.73,.34,.64,.89,.7,.57,.06,.9,.77,.08,.7,.24,.66,.86,.71,.33,.65,.13,.71,.6,.09,.25,.36,.59,.97,.67,.25,.55,.27,.69,.13,.97,.62,.8,.25,.9,.18,.01,.74,.91,.41,.96,.56,.35,.25,.41,.66,.01,.52,.19,.6,.76,.07,.39,.1,.89,.16,.1,.38,.06,.49,.17,.26,.87,.71,1,.11,.54,.04,.6,.8,.55,.87,.42,.58,.84,.63,.33,.55,.67,.25,.99,.03,.29,.47,.95,.8,.37,.86,.07,.65,.95,.27,.75,.45,.29,.62,.91,.56,.67,.13,.99,.53,.69,.05,.89,.72,1,.81,.08,.93,.55,.6,.98,.49,.89,.36,.97,0,.47,.88,.08,1,.83,.03,.92,.87,.42,1,.18,.11,.3,.19,.38,.99,.34,.2,.53,.87,.16,.59,.28,.02,.55,.86,.49,.4,.88,.53,.95,.82,.48,.07,.14,.82,.94,.43,.5,.37,.19,.72,.01,.53,.38,.77,.56,.49,.22,.28,.68,.64,.02,.78,.74,.6,.98,.86,.69,.26,.87,.94,.2,.69,.45,.98,.79,.72,.64,.32,.76,.53,.66,.06,.57,.31,.85,.27,.72,.39,.99,.06,.67,.15,.38,.22,.95,.07,.19,.74,.43,.35,.13,.7,.19,.53,.58,.73,.24,.39,.73,.02,.87,.64,.22,.7,.02,.44,.22,.35,.74,.06,.33,.76,.47,.27,.02,.58,.42,.75,.06,.34,.14,.27,.62,.09,.67,.41,.59,.73,.33,.55,.49,.37,.57,.33,.27,.79,.52,.4,.93,.5,.81,.09,.47,.69,.38,.8,.42,.1,.99,.8,.44,.16,.93,.29,.33,.18,.02,.67,.22,.3,.52,.34,.63,0,.75,.84,.25,.94,.43,.09,.98,.33,.64,.94,.35,.05,.83,.47,.22,.94,.12,.44,.31,.08,.41,.15,.46,.31,.81,.61,.03,.53,.27,.47,.22,.84,.92,.44,.36,.23,.77,.16,.66,.92,.11,.18,.47,.3,.52,.91,.05,.75,.47,.37,.85,.9,.6,.55,.83,.89,.33,.64,.03,.29,.94,.5,.18,.6,.35,.1,.95,.8,.47,.09,.95,.61,.44,.58,.91,.41,.61,.2,.36,.64,.25,.89,.28,.81,.71,.42,.8,.18,.53,.27,.93,.21,.8,.65,.09,.16,.78,.12,.65,.01,.61,.85,.71,.04,.62,.75,.88,.56,.01,.28,.91,.5,.67,.36,.22,.75,.05,.8,.55,.73,.64,.37,.93,.76,.88,.7,.16,.22,.9,.58,.15,.53,.84,.67,.6,.16,.25,.86,.14,.55,.76,.14,.52,.85,.28,.17,.48,.77,.91,.55,.01,.65,.48,.24,.34,.67,.14,.9,.01,.56,.11,.14,.83,.95,.45,.88,.4,.49,.83,.64,.78,.24,.84,.6,.8,.27,.58,.71,0,.29,.14,.23,.69,.41,.09,1,.45,.13,.63,.81,.29,.98,.55,.4,.14,.51,.33,.89,.27,.78,0,.2,.83,.12,.53,.96,.8,.13,.5,.19,.63,.46,.9,.06,.51,.92,.74,.83,.14,.05,.43,.94,.25,.71,.95,.2,.38,.94,.47,.24,.16,.55,.31,.28,.13,.16,.96,.74,.61,.21,.06,.53,.96,.6,.67,.09,.47,.99,.12,.83,.43,.58,.04,.42,1,.31,.47,.09,.34,.65,.29,.21,.81,.45,.05,.79,.67,.41,.99,.33,.71,.37,.56,.67,.84,.25,.63,.35,.98,.77,.11,.88,.95,.78,.51,.4,.75,.61,.29,.71,.49,.01,.28,.6,.05,.23,.58,.36,.01,.95,.12,.34,.44,.97,.13,.89,.51,.63,.8,.99,.03,.49,.26,.78,.87,.35,.71,.05,.44,.08,.78,.67,.24,.98,.73,.16,.51,.67,.97,.39,.24,.88,.05,.73,.44,.85,.7,.98,0,.54,.21,.67,.33,.03,.25,.47,.36,.67,.52,.29,.87,.42,.49,.55,.71,.82,.07,.34,.7,.89,.45,.94,.66,.41,.52,.09,.34,.77,.25,.88,.11,.32,.41,.19,.89,.25,.31,.51,.19,.09,.24,.66,.53,.78,.69,.92,.82,.49,.05,.73,.36,.95,.52,.59,.19,.89,.07,.25,.64,.01,.9,.09,1,.03,.72,.19,.83,.38,.17,.58,.39,.04,.85,.18,.99,.34,.8,.9,.21,.64,.75,.13,.79,.99,.08,.91,.42,.65,.54,.74,.03,.19,.67,.35,.25,.43,.11,.33,.76,.62,.15,.72,.51,.21,.56,.84,.91,.49,.31,.86,.61,.08,.6,.41,.72,.11,.3,.44,.65,.71,.35,.29,.61,.09,.4,.33,.75,.13,.95,.84,.6,.44,.99,.63,.91,.61,.83,.16,0,.63,.08,.89,.15,.29,.56,.75,.96,0,.22,.53,.82,.71,.23,.84,.55,.96,.62,.44,.72,.47,.84,.56,.73,.64,0,.8,.69,.95,.87,.47,.12,.37,.03,.25,.41,.98,.13,.91,.57,0,.72,.29,.35,.47,.58,.81,.92,.49,.75,.34,.39,.47,.54,.3,.05,.69,.45,.74,.2,.62,.29,.69,.08,.23,.47,.41,.07,.53,.92,.37,.43,.69,.28,.51,.73,.18,.27,.87,.49,.61,.82,.05,.96,.72,.46,.87,.57,.37,.96,.29,.09,.94,.42,.13,.25,.73,.18,.02,.45,.36,.82,.05,.23,.56,.84,.78,.54,.09,.49,.92,.16,.24,.9,.47,.84,.44,.25,.36,.15,.78,.11,.31,.04,.17,.37,.97,.67,.32,.8,.25,.44,.93,.19,.49,.39,.63,.77,.08,.35,.04,.94,.45,.15,.01,.37,.18,.83,.03,.95,.35,.08,.42,.89,.55,.36,.58,.28,.81,.19,.87,.6,.7,.19,.58,.68,.33,.19,.42,.92,.1,.84,.73,.16,.42,.23,.11,.55,.18,.61,.86,.14,.95,.58,.93,.28,.07,.98,.47,.13,.45,.53,.88,.15,.66,.98,.33,.23,.84,.17,.65,.87,.13,.58,1,.36,.08,.92,.4,.3,.53,.83,.16,.65,.27,.2,.03,.83,.66,.49,0,.75,.67,.33,.59,.95,.58,.92,.28,.78,.99,.48,.89,.15,.04,.99,.22,.81,.41,.67,.77,.05,.58,.18,.64,.04,.72,.89,.67,.42,.81,.55,.73,.25,.51,.77,.18],FilterEngine=function(){return this.cache=null,this.actions=[],this};let Si=FilterEngine.prototype=Object.create(Object.prototype);Si.type="FilterEngine";let ki=1e3;const Ai=function(t){t.toFixed&&!isNaN(t)&&t>=200&&t<=1e4&&(ki=t)};Si.action=function(t){let{identifier:e,filters:i,image:s}=t,{workstoreLastAccessed:n,workstore:r,actions:o,theBigActionsObject:a}=this,l=Object.keys(r),h=Date.now()-ki;for(let t,e=0,i=l.length;e<i;e++)t=l[e],n[t]<h&&(delete r[t],delete n[t]);if(e&&r[e])return n[e]=Date.now(),r[e];o.length=0;for(let t=0,e=i.length;t<e;t++)o.push(...i[t].actions);let c=o.length;if(c){this.unknit(s);for(let t,e,i=0;i<c;i++)t=o[i],e=a[t.action],e&&e.call(this,t);return e&&(r[e]=this.cache.work,n[e]=Date.now()),this.cache.work}return s},Si.workstore={},Si.workstoreLastAccessed={},Si.colorSpaceIndices=function(){this.tfx||(this.tfx=256,this.tfx2=256*this.tfx,this.tfx3=256*this.tfx2,this.indicesLen=3*this.tfx3,this.labIndicesMultiplier=512,this.rgbIndices=new Uint8ClampedArray(this.indicesLen),this.labIndices=new Float32Array(this.indicesLen),this.indicesMemoRecord=new Uint8ClampedArray(this.tfx3))},Si.unknit=function(t){this.cache={};let e=this.cache,{width:i,height:s,data:n}=t;n.length,e.source=new ImageData(n,i,s),e.work=new ImageData(n,i,s)},Si.getAlphaData=function(t){let{width:e,height:i,data:s}=t,n=s.length,r=new ImageData(e,i),o=r.data;for(let t=0;t<n;t+=4){let e=s[t+3];o[t]=0,o[t+1]=0,o[t+2]=0,o[t+3]=e>0?255:0}return r},Si.buildImageGrid=function(t){let{cache:e,workstore:i,workstoreLastAccessed:s}=this;t||(t=e.source);let{width:n,height:r}=t;if(n&&r){let t=`grid-${n}-${r}`;if(i[t])return s[t]=Date.now(),i[t];let e=[],o=0;for(let t=0;t<r;t++){let t=[];for(let e=0;e<n;e++)t.push(o),o++;e.push(t)}return i[t]=e,s[t]=Date.now(),e}return!1},Si.getOrAddWorkstore=function(t){const{workstore:e,workstoreLastAccessed:i}=this;return e[t]?(i[t]=Date.now(),e[t]):(e[t]=[],i[t]=Date.now(),e[t])},Si.getRandomNumbers=function(t={}){let{seed:e="some-random-string-or-other",length:i=0,imgWidth:s=0,type:n="random"}=t;const r=`random-${e}-${i}-${n}`,{workstore:o,workstoreLastAccessed:a}=this;if(o[r])return a[r]=Date.now(),o[r];const l=[];if("bluenoise"===n&&s){const t=bi.length,e=Math.sqrt(t),n=i/s,r=[];for(let i=0;i<t;i+=e){let t=bi.slice(i,i+e);r.push(t)}for(let t=n;t>0;t-=e)for(let t=0;t<e;t++){let i=r[t];for(let t=s;t>0;t-=e)t<e?l.push(...i.slice(0,t)):l.push(...i)}}else if("ordered"===n&&s){const t=[0,.5,.13,.63,.03,.53,.16,.66,.75,.25,.88,.38,.78,.28,.91,.41,.19,.69,.06,.56,.22,.72,.09,.59,.94,.44,.81,.31,.97,.47,.84,.34,.05,.55,.17,.67,.02,.52,.14,.64,.8,.3,.92,.42,.77,.27,.89,.39,.23,.73,.11,.61,.2,.7,.08,.58,.98,.48,.86,.36,.95,.45,.83,.33],e=t.length,n=Math.sqrt(e),r=i/s,o=[];for(let i=0;i<e;i+=n){let e=t.slice(i,i+n);o.push(e)}for(let t=r;t>0;t-=n)for(let t=0;t<n;t++){let e=o[t];for(let t=s;t>0;t-=n)t<n?l.push(...e.slice(0,t)):l.push(...e)}}else{const t=Oe(e);for(let e=0;e<i;e++)l.push(t.random())}return o[r]=l,a[r]=Date.now(),o[r]},Si.buildImageCoordinateLookup=function(t){const{cache:e,workstore:i,workstoreLastAccessed:s}=this;t||(t=e.source);const{width:n,height:r}=t;if(n&&r){const t=`coords-lookup-${n}-${r}`;if(i[t])return s[t]=Date.now(),i[t];const e=[];for(let t=0;t<r;t++)for(let i=0;i<n;i++)e.push([i,t]);return i[t]=e,s[t]=Date.now(),e}return!1},Si.buildAlphaTileSets=function(t,e,i,s,n,r,o,a){const{cache:l,workstore:h,workstoreLastAccessed:c}=this;a||(a=l.source);const{width:u,height:d}=a;if(u&&d){(t=t.toFixed&&!isNaN(t)?t:1)<1&&(t=1),(e=e.toFixed&&!isNaN(e)?e:1)<1&&(e=1),t+(i=i.toFixed&&!isNaN(i)?i:1)>=u&&(t=u-i-1),e+(s=s.toFixed&&!isNaN(s)?s:1)>=d&&(e=d-s-1),t<1&&(t=1),e<1&&(e=1),t+i>=u&&(i=u-t-1),e+s>=d&&(s=d-e-1);let o=t+i,a=e+s;(n=n.toFixed&&!isNaN(n)?n:0)<0&&(n=0),n>=o&&(n=o-1),(r=r.toFixed&&!isNaN(r)?r:0)<0&&(r=0),r>=a&&(r=a-1);const l=`alphatileset-${u}-${d}-${t}-${e}-${i}-${s}-${n}-${r}`;if(h[l])return c[l]=Date.now(),h[l];let f,p,m,g,y,b,S,k=[];for(g=r-a,y=d;g<y;g+=a)for(p=n-o,m=u;p<m;p+=o){for(f=[],b=g,S=g+e;b<S;b++)if(b>=0&&b<d)for(let e=p,i=p+t;e<i;e++)e>=0&&e<u&&f.push(4*(b*u+e)+3);for(k.push([].concat(f)),f=[],b=g+e,S=g+e+s;b<S;b++)if(b>=0&&b<d)for(let e=p,i=p+t;e<i;e++)e>=0&&e<u&&f.push(4*(b*u+e)+3);for(k.push([].concat(f)),f=[],b=g,S=g+e;b<S;b++)if(b>=0&&b<d)for(let e=p+t,s=p+t+i;e<s;e++)e>=0&&e<u&&f.push(4*(b*u+e)+3);for(k.push([].concat(f)),f=[],b=g+e,S=g+e+s;b<S;b++)if(b>=0&&b<d)for(let e=p+t,s=p+t+i;e<s;e++)e>=0&&e<u&&f.push(4*(b*u+e)+3);k.push([].concat(f))}return h[l]=k,c[l]=Date.now(),k}return!1},Si.buildImageTileSets=function(t,e,i,s,n){const{cache:r,workstore:o,workstoreLastAccessed:a}=this;n||(n=r.source);const{width:l,height:h}=n;if(l&&h){(t=t.toFixed&&!isNaN(t)?t:1)<1&&(t=1),t>=l&&(t=l-1),(e=e.toFixed&&!isNaN(e)?e:1)<1&&(e=1),e>=h&&(e=h-1),(i=i.toFixed&&!isNaN(i)?i:0)<0&&(i=0),i>=t&&(i=t-1),(s=s.toFixed&&!isNaN(s)?s:0)<0&&(s=0),s>=e&&(s=e-1);const n=`simple-tileset-${l}-${h}-${t}-${e}-${i}-${s}`;if(o[n])return a[n]=Date.now(),o[n];const r=[];for(let n=s-e,o=h;n<o;n+=e)for(let s=i-t,o=l;s<o;s+=t){let i=[];for(let r=n,o=n+e;r<o;r++)if(r>=0&&r<h)for(let e=s,n=s+t;e<n;e++)e>=0&&e<l&&i.push(4*(r*l+e));i.length&&r.push(i)}return o[n]=r,a[n]=Date.now(),r}return!1},Si.buildGeneralTileSets=function(t,e,i,s,n,r,o,a,l){const{cache:h,workstore:c,workstoreLastAccessed:u}=this;l||(l=h.source);const{width:d,height:f}=l;if(d&&f){let l=1,h=1,p=1,m=0,g=0,y=0,b="unset";if(t.substring?b=t:Array.isArray(t)?b="points-array":t.toFixed&&!isNaN(t)&&(b="random-points"),"unset"===b)return[];e.substring?l=Math.round(parseFloat(e)/100*d):e.toFixed&&!isNaN(e)&&(l=e),l<1&&(l=1),i.substring?h=Math.round(parseFloat(i)/100*f):i.toFixed&&!isNaN(i)&&(h=i),h<1&&(h=1),s.substring?p=Math.round(parseFloat(s)/100*d):s.toFixed&&!isNaN(s)&&(p=s),p<1&&(p=1),n.substring?m=Math.round(parseFloat(n)/100*d):n.toFixed&&!isNaN(n)&&(m=n),m<0?m=0:m>=d&&(m=d-1),r.substring?g=Math.round(parseFloat(r)/100*f):r.toFixed&&!isNaN(r)&&(g=r),g<0?g=0:g>=f&&(g=f-1),o.toFixed&&!isNaN(o)&&(y=o);let S=`${b}-tileset-${d}-${f}-${l}-${h}-${p}-${m}-${g}-${y}`;if("points-array"===b?S+=`-${t.join(",")}`:"random-points"===b&&(S+=`-${t}-${a}`),c[S])return u[S]=Date.now(),c[S];if("rect-grid"===b&&1===l&&1===h)return c[S]=[],u[S]=Date.now(),[];const k=Re(),A=[m,g],O=[0,0];let w,v,C,x,P,D,R,F,E=[],M=[],I=[],H=[],B="";"hex-grid"===b&&h/p<1.05&&(h=1.05*p);let T,L,$,j,X,Y,N,G,z,W=0,V=Math.floor(l/2),Z=Math.floor(h/2),_=2*p,U=Math.round(h/p*p),K=0;switch(b){case"rect-grid":if(B=`rect-grid-points-${d}-${f}-${l}-${h}-${m}-${g}`,c[B])u[B]=Date.now(),M=c[B];else{for(R=g-2*f+Z,F=g+2*f+Z;R<F;R+=h)for(P=m-2*d+V,D=m+2*d+V;P<D;P+=l)M.push(P,R);u[B]=Date.now(),c[B]=M}break;case"hex-grid":if(B=`hex-grid-points-${d}-${f}-${p}-${m}-${g}`,c[B])u[B]=Date.now(),M=c[B];else{for(W=0,R=g-2*f+p,F=g+2*f+p;R<F;R+=U){for(K=W%2==0?p:0,P=m-2*d+p+K,D=m+2*d+p;P<D;P+=_)M.push(P,R);W++}u[B]=Date.now(),c[B]=M}l=2*_,h=2*U;break;case"random-points":if(B=`random-points-${d}-${f}-${p}-${m}-${g}-${M}-${a}`,c[B])u[B]=Date.now(),M=c[B];else{const e=this.getRandomNumbers({seed:a,length:3*t});let i=-1;for(T=0;T<t;T++)k.zero().add([e[++i],e[++i]]).rotate(360*e[++i]).rotate(y).scalarMultiply(p),[P,R]=k,M.push(Math.round(P),Math.round(R))}l=p,h=p;break;case"points-array":B=`defined-points-${d}-${f}-${p}-${t}`,c[B]?(u[B]=Date.now(),M=c[B]):M.push(...t),l=p,h=p}for(W=0,T=0,L=M.length;T<L;T+=2)if(O[0]=M[T],O[1]=M[T+1],k.zero().add(O).rotate(y).add(A),[P,R]=k,P=Math.round(P),R=Math.round(R),P>-l&&P<d+l&&R>-h&&R<f+h){for($=2*d*(2*f)+(R+Math.floor(f/2))*d+(P+Math.floor(d/2)),I[W]=[P,R,$],E[$]=[],w=R-h,v=R+h;w<v;w++)for(C=P-l,x=P+l;C<x;C++)if(C>=0&&C<d&&w>=0&&w<f){if("random-points"===b&&k.zero().subtract(A).add([C,w]).getMagnitude()>p)continue;j=w*d+C,H[j]||(H[j]=[]),H[j].push(W)}W++}if(!I.length)return I;for(w=0;w<f;w++)for(C=0;C<d;C++)N=w*d+C,O[0]=C,O[1]=w,G=H[N],X=-1,Y=0,G&&G.forEach((t=>{[P,R,$]=I[t],z=k.zero().add(O).subtract([P,R]).getMagnitude(),(X<0||z<Y)&&(X=$,Y=z)})),X>=0&&E[X].push(N);return Fe(k),E=E.filter((t=>null!=t)),c[S]=E,u[S]=Date.now(),E}return[]},Si.buildHorizontalBlur=function(t,e){const{workstore:i,workstoreLastAccessed:s}=this;e&&e.toFixed&&!isNaN(e)||(e=0);const n=t.length,r=t[0].length,o=`blur-h-${r}-${n}-${e}`;if(i[o])return s[o]=Date.now(),i[o];let a=[];for(let i=0;i<n;i++)for(let s=0;s<r;s++){let n=[];for(let o=s-e,a=s+e+1;o<a;o++)o>=0&&o<r&&n.push(4*t[i][o]);a[i*r+s]=n}return i[o]=a,s[o]=Date.now(),a},Si.buildVerticalBlur=function(t,e){const{workstore:i,workstoreLastAccessed:s}=this;e&&e.toFixed&&!isNaN(e)||(e=0);const n=t.length,r=t[0].length,o=`blur-v-${r}-${n}-${e}`;if(i[o])return s[o]=Date.now(),i[o];let a=[];for(let i=0;i<r;i++)for(let s=0;s<n;s++){let o=[];for(let r=s-e,a=s+e+1;r<a;r++)r>=0&&r<n&&o.push(4*t[r][i]);a[s*r+i]=o}return i[o]=a,s[o]=Date.now(),a},Si.buildMatrixGrid=function(t,e,i,s,n){const{cache:r,workstore:o,workstoreLastAccessed:a}=this;n||(n=r.source);const{width:l,height:h,data:c}=n;(null==t||t<1)&&(t=1),(null==e||e<1)&&(e=1),null==i||i<0?i=0:i>=t&&(i=t-1),null==s||s<0?s=0:s>=e&&(s=e-1);const u=`matrix-${l}-${h}-${t}-${e}-${i}-${s}`;if(o[u])return a[u]=Date.now(),o[u];let d,f,p,m,g,y,b,S,k,A=c.length,O=[],w=[];for(p=-s,m=e-s;p<m;p++)for(d=-i,f=t-i;d<f;d++)O.push(4*(p*l+d));for(p=0;p<h;p++)for(d=0;d<l;d++){for(b=4*(p*l+d),S=[],g=0,y=O.length;g<y;g++)k=b+O[g],k<0?k+=A:k>=A&&(k-=A),S.push(k);w.push(S)}return o[u]=w,a[u]=Date.now(),w},Si.checkChannelLevelsParameters=function(t){const e=function(t,e=!1){if(t.toFixed)return t<0?[[0,255,0]]:t>255?[[0,255,255]]:isNaN(t)?e?[[0,255,255]]:[[0,255,0]]:[[0,255,t]];if(t.substring&&(t=t.split(",")),Array.isArray(t)){if(!t.length)return t;if(Array.isArray(t[0]))return t;if((t=t.map((t=>parseInt(t,10)))).sort(((t,e)=>t-e)),1==t.length)return[[0,255,t[0]]];let e,i,s=[];for(let n=0,r=t.length;n<r;n++)e=0,i=255,0!=n&&(e=Math.ceil(t[n-1]+(t[n]-t[n-1])/2)),n!=r-1&&(i=Math.floor(t[n]+(t[n+1]-t[n])/2)),s.push([e,i,t[n]]);return s}return e?[[0,255,255]]:[[0,255,0]]};t.red=e(t.red),t.green=e(t.green),t.blue=e(t.blue),t.alpha=e(t.alpha,!0)},Si.cacheOutput=function(t,e,i){cache[t]=e},Si.getInputAndOutputLines=function(t){let e,{cache:i}=this,s=i.work,n=!1,r=i.source,o=!1;return"source-alpha"!==t.lineIn&&"source-alpha"!==t.lineMix||(o=this.getAlphaData(r)),t.lineIn&&("source"===t.lineIn?s=r:"source-alpha"==t.lineIn?s=o:i[t.lineIn]&&(s=i[t.lineIn])),t.lineMix&&("source"==t.lineMix?n=r:"source-alpha"==t.lineMix?n=o:"current"==t.lineMix?n=i.work:i[t.lineMix]&&(n=i[t.lineMix])),t.lineOut&&i[t.lineOut]?e=i[t.lineOut]:(e=new ImageData(s.width,s.height),t.lineOut&&(i[t.lineOut]=e)),[s,e,n]},Si.getGrayscaleValue=function(t,e,i){return Math.floor(.2126*t+.7152*e+.0722*i)},Si.processResults=function(t,e,i){let s,n=t.data,r=e.data;if(1===i)for(let t=0,e=n.length;t<e;t++)n[t]=r[t];else if(i>0){s=1-i;for(let t=0,e=n.length;t<e;t++)n[t]=n[t]*s+r[t]*i}},Si.colorEngine=yi({name:"filterEngine-colorEngine-do-not-overwrite"}),Si.getGradientData=function(t){const{workstore:e,workstoreLastAccessed:i}=this,s=`gradient-data-${t.name}`;if(!e[s]||t.dirtyFilterIdentifier||t.animateByDelta){const i=ai(),{engine:n,element:r}=i;r.width=256,r.height=1,t.palette.recalculate();const o=n.createLinearGradient(0,0,255,0);t.addStopsToGradient(o,t.paletteStart,t.paletteEnd,t.cyclePalette),n.fillStyle=o,n.fillRect(0,0,256,1);let a=n.getImageData(0,0,256,1).data;li(i),e[s]=a}return e[s]?(i[s]=Date.now(),e[s]):[]},Si.transferDataUnchanged=function(t,e,i){let s,n,r,o,a;for(a=0;a<i;a+=4)s=a,n=s+1,r=n+1,o=r+1,t[s]=e[s],t[n]=e[n],t[r]=e[r],t[o]=e[o]},Si.newspaperPatterns=[[0,0,0,0],[0,0,0,180],[180,0,0,0],[180,0,0,180],[0,180,180,180],[180,180,180,0],[180,180,180,180],[180,180,180,255],[255,180,180,180],[255,180,180,255],[180,255,255,255],[255,255,255,180],[255,255,255,255]],Si.theBigActionsObject={"alpha-to-channels":function(t){let e,i,s,n,r,o,[a,l]=this.getInputAndOutputLines(t),h=a.data,c=l.data,u=h.length,{opacity:d,includeRed:f,includeGreen:p,includeBlue:m,excludeRed:g,excludeGreen:y,excludeBlue:b,lineOut:S}=t;for(null==d&&(d=1),null==f&&(f=!0),null==p&&(p=!0),null==m&&(m=!0),null==g&&(g=!0),null==y&&(y=!0),null==b&&(b=!0),o=0;o<u;o+=4)e=o,i=e+1,s=i+1,n=s+1,r=h[n],r&&(c[e]=f?r:g?0:h[e],c[i]=p?r:y?0:h[i],c[s]=m?r:b?0:h[s],c[n]=255);S?this.processResults(l,a,1-d):this.processResults(this.cache.work,l,d)},"area-alpha":function(t){let e,i,s,n,[r,o]=this.getInputAndOutputLines(t),a=r.data,l=o.data,h=a.length,{opacity:c,tileWidth:u,tileHeight:d,offsetX:f,offsetY:p,gutterWidth:m,gutterHeight:g,areaAlphaLevels:y,lineOut:b}=t;null==c&&(c=1),null==u&&(u=1),null==d&&(d=1),null==f&&(f=0),null==p&&(p=0),null==m&&(m=1),null==g&&(g=1),null==y&&(y=[255,0,0,0]);let S=this.buildAlphaTileSets(u,d,m,g,f,p,y);this.transferDataUnchanged(l,a,h),S.forEach(((t,r)=>{for(e=y[r%4],i=0,s=t.length;i<s;i++)n=t[i],a[n]&&(l[n]=e)})),b?this.processResults(o,r,1-c):this.processResults(this.cache.work,o,c)},"average-channels":function(t){let e,i,s,n,r,o,[a,l]=this.getInputAndOutputLines(t),h=a.data,c=l.data,u=h.length,{opacity:d,includeRed:f,includeGreen:p,includeBlue:m,excludeRed:g,excludeGreen:y,excludeBlue:b,lineOut:S}=t;null==d&&(d=1),null==f&&(f=!0),null==p&&(p=!0),null==m&&(m=!0),null==g&&(g=!1),null==y&&(y=!1),null==b&&(b=!1);let k=0;for(f&&k++,p&&k++,m&&k++,e=0;e<u;e+=4)s=e,n=s+1,r=n+1,o=r+1,h[o]?k?(i=0,f&&(i+=h[s]),p&&(i+=h[n]),m&&(i+=h[r]),i=Math.floor(i/k),c[s]=g?0:i,c[n]=y?0:i,c[r]=b?0:i,c[o]=h[o]):(c[s]=g?0:h[s],c[n]=y?0:h[n],c[r]=b?0:h[r],c[o]=h[o]):(c[s]=h[s],c[n]=h[n],c[r]=h[r],c[o]=h[o]);S?this.processResults(l,a,1-d):this.processResults(this.cache.work,l,d)},blend:function(t){const e=function(t,e,i){let s=t+1,n=s+1,r=n+1,o=e+1,a=o+1,l=a+1;p[e]=i[t],p[o]=i[s],p[a]=i[n],p[l]=i[r]},i=function(t,e){let i=t-Y,s=e-N,n=-1;return i>=0&&i<m&&s>=0&&s<g&&(n=4*(s*m+i)),[4*(e*h+t),n]},s=function(t,e){let i=t+1,s=i+1,n=s+1,r=e+1,o=r+1,a=o+1;return[u[t]/255,u[i]/255,u[s]/255,u[n]/255,y[e]/255,y[r]/255,y[o]/255,y[a]/255]},n=(t,e)=>255*(t+e*(1-t)),r=this.colorEngine;let[o,a,l]=this.getInputAndOutputLines(t),{width:h,height:c,data:u}=o,{width:d,height:f,data:p}=a,{width:m,height:g,data:y}=l;u.length;let b,S,k,A,O,w,v,C,x,P,D,R,F,E,M,I,H,B,T,L,$,{opacity:j,blend:X,offsetX:Y,offsetY:N,lineOut:G}=t;switch(null==j&&(j=1),null==X&&(X=""),null==Y&&(Y=0),null==N&&(N=0),X){case"color-burn":const t=(t,e)=>1==e?255:0==t?0:255*(1-Math.min(1,(1-e)/t));for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,B=M+3,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=t(k,v),p[R]=t(A,C),p[F]=t(O,x),p[E]=n(w,P)):e(D,D,u):e(M,D,y));break;case"color-dodge":const o=(t,e)=>0==e?0:1==t?255:255*Math.min(1,e/(1-t));for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,B=M+3,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=o(k,v),p[R]=o(A,C),p[F]=o(O,x),p[E]=n(w,P)):e(D,D,u):e(M,D,y));break;case"darken":const a=(t,e)=>t<e?t:e;for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,B=M+3,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?(R=D+1,F=R+1,I=M+1,H=I+1,p[D]=a(u[D],y[M]),p[R]=a(u[R],y[I]),p[F]=a(u[F],y[H]),p[E]=n(u[E]/255,y[B]/255)):e(D,D,u):e(M,D,y));break;case"difference":const l=(t,e)=>255*Math.abs(t-e);for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=l(k,v),p[R]=l(A,C),p[F]=l(O,x),p[E]=n(w,P)):e(M,D,y));break;case"exclusion":const d=(t,e)=>255*(t+e-2*e*t);for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=d(k,v),p[R]=d(A,C),p[F]=d(O,x),p[E]=n(w,P)):e(M,D,y));break;case"hard-light":const f=(t,e)=>t<=.5?t*e*255:255*(e+(t-e*t));for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=f(k,v),p[R]=f(A,C),p[F]=f(O,x),p[E]=n(w,P)):e(M,D,y));break;case"lighten":const m=(t,e)=>t>e?t:e;for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[D]?(R=D+1,F=R+1,I=M+1,H=I+1,B=H+1,p[D]=m(u[D],y[M]),p[R]=m(u[R],y[I]),p[F]=m(u[F],y[H]),p[E]=n(u[E]/255,y[B]/255)):e(M,D,y));break;case"lighter":const g=(t,e)=>255*(t+e);for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=g(k,v),p[R]=g(A,C),p[F]=g(O,x),p[E]=n(w,P)):e(M,D,y));break;case"multiply":const j=(t,e)=>t*e*255;for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,B=M+3,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=j(k,v),p[R]=j(A,C),p[F]=j(O,x),p[E]=n(w,P)):e(D,D,u):e(M,D,y));break;case"overlay":const X=(t,e)=>t>=.5?t*e*255:255*(e+(t-e*t));for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=X(k,v),p[R]=X(A,C),p[F]=X(O,x),p[E]=n(w,P)):e(M,D,y));break;case"screen":const Y=(t,e)=>255*(e+(t-e*t));for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=Y(k,v),p[R]=Y(A,C),p[F]=Y(O,x),p[E]=n(w,P)):e(M,D,y));break;case"soft-light":const N=(t,e)=>{let i=e<=.25?((16*e-12)*e+4)*e:Math.sqrt(e);return t<=.5?255*(e-(1-2*t)*e*(1-e)):255*(e+(2*t-1)*(i-e))};for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,B=M+3,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([k,A,O,w,v,C,x,P]=s(D,M),R=D+1,F=R+1,p[D]=N(k,v),p[R]=N(A,C),p[F]=N(O,x),p[E]=n(w,P)):e(D,D,u):e(M,D,y));break;case"color":for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),R=D+1,F=R+1,E=F+1,I=M+1,H=I+1,B=H+1,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([T,L,$]=r.calculateColorBlend(u[D],u[R],u[F],y[M],y[I],y[H]),p[D]=T,p[R]=L,p[F]=$,p[E]=n(u[E]/255,y[B]/255)):e(D,D,u):e(M,D,y));break;case"hue":for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),R=D+1,F=R+1,E=F+1,I=M+1,H=I+1,B=H+1,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([T,L,$]=r.calculateHueBlend(u[D],u[R],u[F],y[M],y[I],y[H]),p[D]=T,p[R]=L,p[F]=$,p[E]=n(u[E]/255,y[B]/255)):e(D,D,u):e(M,D,y));break;case"luminosity":for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),R=D+1,F=R+1,E=F+1,I=M+1,H=I+1,B=H+1,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([T,L,$]=r.calculateLuminosityBlend(u[D],u[R],u[F],y[M],y[I],y[H]),p[D]=T,p[R]=L,p[F]=$,p[E]=n(u[E]/255,y[B]/255)):e(D,D,u):e(M,D,y));break;case"saturation":for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),R=D+1,F=R+1,E=F+1,I=M+1,H=I+1,B=H+1,u[E]&&(M<0?e(D,D,u):u[E]?y[B]?([T,L,$]=r.calculateSaturationBlend(u[D],u[R],u[F],y[M],y[I],y[H]),p[D]=T,p[R]=L,p[F]=$,p[E]=n(u[E]/255,y[B]/255)):e(D,D,u):e(M,D,y));break;default:const G=(t,e,i,s)=>e*t+s*i*(1-e);for(S=0;S<c;S++)for(b=0;b<h;b++)[D,M]=i(b,S),E=D+3,u[E]&&(M<0?e(D,D,u):u[E]?(R=D+1,F=R+1,I=M+1,H=I+1,B=H+1,w=u[E]/255,P=y[B]/255,p[D]=G(u[D],w,y[M],P),p[R]=G(u[R],w,y[I],P),p[F]=G(u[F],w,y[H],P),p[E]=n(w,P)):e(M,D,y))}G?this.processResults(a,o,1-j):this.processResults(this.cache.work,a,j)},blur:function(t){const e=function(t,e,i,s,n){if(t){let t=e[i];if(null!=t){let e,i,r=t.length,o=0,a=0;for(i=0;i<r;i+=x)e=t[i]+n,a+=s[e],o++;return a/o}}return s[4*i+n]};let i,s,n,r,o,a,l,h,[c,u]=this.getInputAndOutputLines(t),d=c.data,f=u.data,p=d.length,m=Math.floor(p/4),{opacity:g,radius:y,passes:b,processVertical:S,processHorizontal:k,includeRed:A,includeGreen:O,includeBlue:w,includeAlpha:v,excludeTransparentPixels:C,step:x,lineOut:P}=t;if(null==g&&(g=1),null==y&&(y=0),null==b&&(b=1),null==S&&(S=!0),null==k&&(k=!0),null==A&&(A=!0),null==O&&(O=!0),null==w&&(w=!0),null==v&&(v=!1),null==C&&(C=!1),null==x&&(x=1),k||S){let t=this.buildImageGrid(c);k&&(l=this.buildHorizontalBlur(t,y)),S&&(h=this.buildVerticalBlur(t,y))}f.set(d);const D=new Uint8ClampedArray(d),R=C?function(t,e,i,s,n){if(t){let t=e[i];if(null!=t){let e,i,r,o,a=t.length,l=0,h=0;for(i=0;i<a;i+=x)o=t[i],r=o+3,s[r]&&(e=o+n,h+=s[e],l++);if(l)return h/l}}return s[4*i+n]}:e;for(a=0;a<b;a++){if(k){for(i=0;i<m;i++)s=4*i,n=s+1,r=n+1,o=r+1,(v||D[o])&&(f[s]=R(A,l,i,D,0),f[n]=R(O,l,i,D,1),f[r]=R(w,l,i,D,2),f[o]=e(v,l,i,D,3));(S||a<b-1)&&D.set(f)}if(S){for(i=0;i<m;i++)s=4*i,n=s+1,r=n+1,o=r+1,(v||D[o])&&(f[s]=R(A,h,i,D,0),f[n]=R(O,h,i,D,1),f[r]=R(w,h,i,D,2),f[o]=e(v,h,i,D,3));a<b-1&&D.set(f)}}P?this.processResults(u,c,1-g):this.processResults(this.cache.work,u,g)},"channels-to-alpha":function(t){let e,i,s,n,r,o,a,l,h,[c,u]=this.getInputAndOutputLines(t),d=c.data,f=u.data,p=d.length,{opacity:m,includeRed:g,includeGreen:y,includeBlue:b,lineOut:S}=t;null==m&&(m=1),null==g&&(g=!0),null==y&&(y=!0),null==b&&(b=!0);let k=0;for(g&&k++,y&&k++,b&&k++,l=0;l<p;l+=4)e=l,i=e+1,s=i+1,n=s+1,r=d[e],o=d[i],a=d[s],f[e]=r,f[i]=o,f[s]=a,k?(h=0,g&&(h+=r),y&&(h+=o),b&&(h+=a),f[n]=Math.floor(h/k)):f[n]=d[n];S?this.processResults(u,c,1-m):this.processResults(this.cache.work,u,m)},chroma:function(t){let e,i,s,n,r,o,a,l,h,c,[u,d]=this.getInputAndOutputLines(t),f=u.data,p=d.data,m=f.length,{opacity:g,ranges:y,lineOut:b}=t;null==g&&(g=1),null==y&&(y=[]);for(let t=0;t<m;t+=4){for(c=!1,e=t,i=e+1,s=i+1,n=s+1,r=f[e],o=f[i],a=f[s],l=0,h=y.length;l<h;l++){let[t,e,i,s,n,h]=y[l];if(r>=t&&r<=s&&o>=e&&o<=n&&a>=i&&a<=h){c=!0;break}}p[e]=r,p[i]=o,p[s]=a,p[n]=c?0:f[n]}b?this.processResults(d,u,1-g):this.processResults(this.cache.work,d,g)},"clamp-channels":function(t){let e,i,s,n,r,o,a,l,h,[c,u]=this.getInputAndOutputLines(t),d=c.data,f=u.data,p=d.length,{opacity:m,lowRed:g,lowGreen:y,lowBlue:b,highRed:S,highGreen:k,highBlue:A,lineOut:O}=t;null==m&&(m=1),null==g&&(g=0),null==y&&(y=0),null==b&&(b=0),null==S&&(S=255),null==k&&(k=255),null==A&&(A=255);const w=S-g,v=k-y,C=A-b;for(h=0;h<p;h+=4)e=h,i=e+1,s=i+1,n=s+1,r=d[e],o=d[i],a=d[s],l=d[n],l?(r/=255,o/=255,a/=255,f[e]=g+r*w,f[i]=y+o*v,f[s]=b+a*C):(f[e]=r,f[i]=o,f[s]=a),f[n]=l;O?this.processResults(u,c,1-m):this.processResults(this.cache.work,u,m)},"colors-to-alpha":function(t){const e=function(t,e,i){let s=(Math.abs(m-t)+Math.abs(g-e)+Math.abs(y-i))/3;return s<O?0:s>w?255:(s-O)/v*255};let i,s,n,r,o,a,l,[h,c]=this.getInputAndOutputLines(t),u=h.data,d=c.data,f=u.length,{opacity:p,red:m,green:g,blue:y,opaqueAt:b,transparentAt:S,lineOut:k}=t;null==p&&(p=1),null==m&&(m=0),null==g&&(g=255),null==y&&(y=0),null==b&&(b=1),null==S&&(S=0);let A=Math.max((m+g+y)/3,(255-m+(255-g)+(255-y))/3),O=S*A,w=b*A,v=w-O;for(let t=0;t<f;t+=4)i=t,s=i+1,n=s+1,r=n+1,u[r]&&(o=u[i],a=u[s],l=u[n],d[i]=o,d[s]=a,d[n]=l,d[r]=e(o,a,l));k?this.processResults(c,h,1-p):this.processResults(this.cache.work,c,p)},compose:function(t){const e=function(t,e,i){let s=t+1,n=s+1,r=n+1,o=e+1,a=o+1,l=a+1;u[e]=i[t],u[o]=i[s],u[a]=i[n],u[l]=i[r]},i=function(t,e){let i=t-R,s=e-F,n=-1;return i>=0&&i<d&&s>=0&&s<f&&(n=4*(s*d+i)),[4*(e*o+t),n]};let[s,n,r]=this.getInputAndOutputLines(t),{width:o,height:a,data:l}=s,{width:h,height:c,data:u}=n,{width:d,height:f,data:p}=r;l.length;let m,g,y,b,S,k,A,O,w,v,C,x,{opacity:P,compose:D,offsetX:R,offsetY:F,lineOut:E}=t;switch(null==P&&(P=1),null==D&&(D=""),null==R&&(R=0),null==F&&(F=0),D){case"source-only":n.data.set(l);break;case"source-atop":const t=(t,e,i,s)=>e*t*s+s*i*(1-e);for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S>=0&&(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=t(l[m],C,p[S],x),u[g]=t(l[g],C,p[k],x),u[y]=t(l[y],C,p[A],x),u[b]=255*(C*x+x*(1-C)));break;case"source-in":const s=(t,e,i)=>e*t*i;for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S>=0&&(g=m+1,y=g+1,b=y+1,O=S+3,C=l[b]/255,x=p[O]/255,u[m]=s(l[m],C,x),u[g]=s(l[g],C,x),u[y]=s(l[y],C,x),u[b]=C*x*255);break;case"source-out":const r=(t,e,i)=>e*t*(1-i);for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S<0?e(m,m,l):(g=m+1,y=g+1,b=y+1,O=S+3,C=l[b]/255,x=p[O]/255,u[m]=r(l[m],C,x),u[g]=r(l[g],C,x),u[y]=r(l[y],C,x),u[b]=C*(1-x)*255);break;case"destination-only":for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S>=0&&e(S,m,p);break;case"destination-atop":const h=(t,e,i,s)=>e*t*(1-s)+s*i*e;for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S<0?e(m,m,l):(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=h(l[m],C,p[S],x),u[g]=h(l[g],C,p[k],x),u[y]=h(l[y],C,p[A],x),u[b]=255*(C*(1-x)+x*C));break;case"destination-over":const c=(t,e,i,s)=>e*t*(1-s)+s*i;for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S<0?e(m,m,l):(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=c(l[m],C,p[S],x),u[g]=c(l[g],C,p[k],x),u[y]=c(l[y],C,p[A],x),u[b]=255*(C*(1-x)+x));break;case"destination-in":const d=(t,e,i)=>e*t*i;for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S>=0&&(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=d(p[S],C,x),u[g]=d(p[k],C,x),u[y]=d(p[A],C,x),u[b]=C*x*255);break;case"destination-out":const f=(t,e,i)=>i*t*(1-e);for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S>=0&&(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=f(p[S],C,x),u[g]=f(p[k],C,x),u[y]=f(p[A],C,x),u[b]=x*(1-C)*255);break;case"clear":break;case"xor":const P=(t,e,i,s)=>e*t*(1-s)+s*i*(1-e);for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S<0?e(m,m,l):(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=P(l[m],C,p[S],x),u[g]=P(l[g],C,p[k],x),u[y]=P(l[y],C,p[A],x),u[b]=255*(C*(1-x)+x*(1-C)));break;default:const D=(t,e,i,s)=>e*t+s*i*(1-e);for(v=0;v<a;v++)for(w=0;w<o;w++)[m,S]=i(w,v),S<0?e(m,m,l):(g=m+1,y=g+1,b=y+1,k=S+1,A=k+1,O=A+1,C=l[b]/255,x=p[O]/255,u[m]=D(l[m],C,p[S],x),u[g]=D(l[g],C,p[k],x),u[y]=D(l[y],C,p[A],x),u[b]=255*(C+x*(1-C)))}E?this.processResults(n,s,1-P):this.processResults(this.cache.work,n,P)},corrode:function(t){const e=function(t,e,i){let s,n,r=0,o=255,l=e.length;for(n=0;n<l;n++)s=t[e[n]+i],s<o?o=s:s>r&&(r=s);switch(y){case"lowest":return o;case"highest":return r;default:return a(o+(r-o)/2)}};let[i,s]=this.getInputAndOutputLines(t),n=i.data,r=s.data,o=n.length,a=Math.floor,{opacity:l,includeRed:h,includeGreen:c,includeBlue:u,includeAlpha:d,width:f,height:p,offsetX:m,offsetY:g,operation:y,lineOut:b}=t;null==l&&(l=1),null==h&&(h=!1),null==c&&(c=!1),null==u&&(u=!1),null==d&&(d=!0),(null==f||f<1)&&(f=3),(null==p||p<1)&&(p=3),null==m&&(m=1),null==g&&(g=1),null==y&&(y="mean");let S,k,A,O,w,v=this.buildMatrixGrid(f,p,m,g,i),C=a(o/4);for(w=0;w<C;w++)S=4*w,k=S+1,A=k+1,O=A+1,r[S]=h?e(n,v[w],0):n[S],r[k]=c?e(n,v[w],1):n[k],r[A]=u?e(n,v[w],2):n[A],r[O]=d?e(n,v[w],3):n[O];b?this.processResults(s,i,1-l):this.processResults(this.cache.work,s,l)},displace:function(t){const e=function(t,e,i){t<0?u[e+3]=0:(u[e]=i[t],t++,e++,u[e]=i[t],t++,e++,u[e]=i[t],t++,e++,u[e]=i[t])},i=function(t,e){let i=t+k,s=e+A,n=-1;return i>=0&&i<d&&s>=0&&s<f&&(n=4*(s*d+i)),[4*(e*o+t),n]};let[s,n,r]=this.getInputAndOutputLines(t),{width:o,height:a,data:l}=s,{width:h,height:c,data:u}=n,{width:d,height:f,data:p}=r,{opacity:m,channelX:g,channelY:y,scaleX:b,scaleY:S,offsetX:k,offsetY:A,transparentEdges:O,lineOut:w}=t;null==m&&(m=1),null==g&&(g="red"),null==y&&(y="green"),null==b&&(b=1),null==S&&(S=1),null==k&&(k=0),null==A&&(A=0),null==O&&(O=!1);let v=3;"red"==g?v=0:"green"==g?v=1:"blue"==g&&(v=2);let C,x,P,D,R,F,E,M=3;for("red"==y?M=0:"green"==y?M=1:"blue"==y&&(M=2),x=0;x<a;x++)for(C=0;C<o;C++)[F,E]=i(C,x),E>=0?(P=Math.floor(C+(127-p[E+v])/127*b),D=Math.floor(x+(127-p[E+M])/127*S),O?R=P<0||P>=o||D<0||D>=a?-1:4*(D*o+P):(P<0&&(P=0),P>=o&&(P=o-1),D<0&&(D=0),D>=a&&(D=a-1),R=4*(D*o+P)),e(R,F,l)):e(F,F,l);w?this.processResults(n,s,1-m):this.processResults(this.cache.work,n,m)},emboss:function(t){const e=function(t,e,i){let s=0;for(let n=0,r=e.length;n<r;n++)g[n]&&(s+=t[e[n]+i]*g[n]);return s};let[i,s]=this.getInputAndOutputLines(t),n=i.data,r=s.data,o=n.length,{opacity:a,strength:l,angle:h,tolerance:c,keepOnlyChangedAreas:u,postProcessResults:d,lineOut:f}=t;for(null==a&&(a=1),null==l&&(l=1),null==h&&(h=0),null==c&&(c=0),null==u&&(u=!1),null==d&&(d=!1),l=Math.abs(l);h<0;)h+=360;h%=360;let p=Math.floor(h/45),m=h%45/45*l,g=new Array(9);g=g.fill(0,0,9),g[4]=1,0==p?(g[5]=l-m,g[8]=m,g[3]=-g[5],g[0]=-g[8]):1==p?(g[8]=l-m,g[7]=m,g[0]=-g[8],g[1]=-g[7]):2==p?(g[7]=l-m,g[6]=m,g[1]=-g[7],g[2]=-g[6]):3==p?(g[6]=l-m,g[3]=m,g[2]=-g[6],g[5]=-g[3]):4==p?(g[3]=l-m,g[0]=m,g[5]=-g[3],g[8]=-g[0]):5==p?(g[0]=l-m,g[1]=m,g[8]=-g[0],g[7]=-g[1]):6==p?(g[1]=l-m,g[2]=m,g[7]=-g[1],g[6]=-g[2]):(g[2]=l-m,g[5]=m,g[6]=-g[2],g[3]=-g[5]);const y=this.buildMatrixGrid(3,3,1,1,i);let b,S,k,A,O,w,v,C,x,P,D,R,F;for(b=0;b<o;b+=4)S=b,k=S+1,A=k+1,O=A+1,w=n[S],v=n[k],C=n[A],x=n[O],x&&(F=Math.floor(b/4),r[S]=e(n,y[F],0),r[k]=e(n,y[F],1),r[A]=e(n,y[F],2),r[O]=n[O],d&&(P=r[S],D=r[k],R=r[A],P>=w-c&&P<=w+c&&D>=v-c&&D<=v+c&&R>=C-c&&R<=C+c&&(u?r[O]=0:(r[S]=127,r[k]=127,r[A]=127))));f?this.processResults(s,i,1-a):this.processResults(this.cache.work,s,a)},flood:function(t){let e,i,s,[n,r]=this.getInputAndOutputLines(t),o=n.data,a=r.data,l=o.length,{opacity:h,red:c,green:u,blue:d,alpha:f,excludeAlpha:p,lineOut:m}=t;for(null==h&&(h=1),null==c&&(c=0),null==u&&(u=0),null==d&&(d=0),null==f&&(f=255),null==p&&(p=!1),e=0;e<l;e+=4)s=e+3,o[s]&&(i=e,a[i]=c,i++,a[i]=u,i++,a[i]=d,i++,a[i]=p?o[s]:f);m?this.processResults(r,n,1-h):this.processResults(this.cache.work,r,h)},"gaussian-blur":function(t){let e,i,s,n,r,o,a,l;const h=function(t,e,i,s,n,r){let o,a,l,h,c,u,d,f,p,m,g,y,b,S,k,A,O,w,v,C,x,P,D,R,F,E,M,I,H,B;for(F=0;F<r;F++){for(P=F*n,D=F,R=0,o=t[P],a=255&o,l=o>>8&255,h=o>>16&255,c=o>>24&255,w=a*s[6],v=l*s[6],C=h*s[6],x=c*s[6],S=w,k=v,A=C,O=x,M=s[0],I=s[1],H=s[4],B=s[5],E=0;E<n;E++)o=t[P],u=255&o,d=o>>8&255,f=o>>16&255,p=o>>24&255,m=u*M+a*I+S*H+w*B,g=d*M+l*I+k*H+v*B,y=f*M+h*I+A*H+C*B,b=p*M+c*I+O*H+x*B,w=S,v=k,C=A,x=O,S=m,k=g,A=y,O=b,a=u,l=d,h=f,c=p,i[R]=S,i[R+1]=k,i[R+2]=A,i[R+3]=O,R+=4,P++;for(P--,R-=4,D+=r*(n-1),o=t[P],a=255&o,l=o>>8&255,h=o>>16&255,c=o>>24&255,w=a*s[7],v=l*s[7],C=h*s[7],x=c*s[7],S=w,k=v,A=C,O=x,u=a,d=l,f=h,p=c,M=s[2],I=s[3],E=n-1;E>=0;E--)m=u*M+a*I+S*H+w*B,g=d*M+l*I+k*H+v*B,y=f*M+h*I+A*H+C*B,b=p*M+c*I+O*H+x*B,w=S,v=k,C=A,x=O,S=m,k=g,A=y,O=b,a=u,l=d,h=f,c=p,o=t[P],u=255&o,d=o>>8&255,f=o>>16&255,p=o>>24&255,o=(i[R]+S<<0)+(i[R+1]+k<<8)+(i[R+2]+A<<16)+(i[R+3]+O<<24),e[D]=o,P--,R-=4,D-=r}};let[c,u]=this.getInputAndOutputLines(t),d=c.data,f=u.data,{width:p,height:m}=c,{opacity:g,radius:y,lineOut:b}=t;null==g&&(g=1),null==y&&(y=1);const S=new Uint8ClampedArray(d),k=new Uint32Array(S.buffer),A=new Uint32Array(k.length),O=new Float32Array(4*Math.max(p,m)),w=function(t){t<.5&&(t=.5);let h=Math.exp(.527076)/t,c=Math.exp(-h),u=Math.exp(-2*h),d=(1-c)*(1-c)/(1+2*h*c-u);return e=d,i=d*(h-1)*c,s=d*(h+1)*c,n=-d*u,r=2*c,o=-u,a=(e+i)/(1-r-o),l=(s+n)/(1-r-o),new Float32Array([e,i,s,n,r,o,a,l])}(y);h(k,A,O,w,p,m),h(A,k,O,w,m,p),f.set(S),b?this.processResults(u,c,1-g):this.processResults(this.cache.work,u,g)},glitch:function(t){let e,i,s,n,r,o,a,l,h,c,u,d,f,p,m,g,y,b,S,k,A,O,w,v,C,[x,P]=this.getInputAndOutputLines(t),D=x.data,R=P.data,F=D.length,E=x.width,M=x.height,{opacity:I,useMixedChannel:H,seed:B,level:T,step:L,offsetMin:$,offsetMax:j,offsetRedMin:X,offsetRedMax:Y,offsetGreenMin:N,offsetGreenMax:G,offsetBlueMin:z,offsetBlueMax:W,offsetAlphaMin:V,offsetAlphaMax:Z,transparentEdges:_,lineOut:U}=t;null==I&&(I=1),null==H&&(H=!0),null==B&&(B="some-random-string-or-other"),null==T&&(T=0),null==L&&(L=1),null==$&&($=0),null==j&&(j=0),null==X&&(X=0),null==Y&&(Y=0),null==N&&(N=0),null==G&&(G=0),null==z&&(z=0),null==W&&(W=0),null==V&&(V=0),null==Z&&(Z=0),null==_&&(_=!1);const K=this.getRandomNumbers({seed:B,length:5*M}),q=j-$,Q=Y-X,J=G-N,tt=W-z,et=Z-V;let it=-1;const st=[];for(L=Math.floor(L),L<1&&(L=1),e=0;e<M;e+=L)if(s=K[++it]<T,s)if(H)for(n=4*($+Math.floor(K[++it]*q)),i=0;i<L;i++)st.push(n,n,n,n);else for(r=4*(X+Math.floor(K[++it]*Q)),o=4*(N+Math.floor(K[++it]*J)),a=4*(z+Math.floor(K[++it]*tt)),l=4*(V+Math.floor(K[++it]*et)),i=0;i<L;i++)st.push(r,o,a,l);else for(i=0;i<L;i++)st.push(0,0,0,0);for(e=0;e<F;e+=4)h=e,c=h+1,u=c+1,d=u+1,f=4*E,p=Math.floor(e/f),y=4*p,b=st[y],S=st[++y],k=st[++y],A=st[++y],O=h+b,w=c+S,v=u+k,C=d+A,R[h]=D[O],R[c]=D[w],R[u]=D[v],_?(m=p*f,g=m+f,R[d]=O<m||O>g||w<m||w>g||v<m||v>g||C<m||C>g?0:D[C]):R[d]=D[C];U?this.processResults(P,x,1-I):this.processResults(this.cache.work,P,I)},grayscale:function(t){let e,i,s,n,r,o,[a,l]=this.getInputAndOutputLines(t),h=a.data,c=l.data,u=h.length,{opacity:d,lineOut:f}=t;null==d&&(d=1);const p=this.getGrayscaleValue;for(r=0;r<u;r+=4)e=r,i=e+1,s=i+1,n=s+1,o=p(h[e],h[i],h[s]),c[e]=o,c[i]=o,c[s]=o,c[n]=h[n];f?this.processResults(l,a,1-d):this.processResults(this.cache.work,l,d)},"invert-channels":function(t){let e,i,s,n,r,[o,a]=this.getInputAndOutputLines(t),l=o.data,h=a.data,c=l.length,{opacity:u,includeRed:d,includeGreen:f,includeBlue:p,includeAlpha:m,lineOut:g}=t;for(null==u&&(u=1),null==d&&(d=!0),null==f&&(f=!0),null==p&&(p=!0),null==m&&(m=!1),r=0;r<c;r+=4)e=r,i=e+1,s=i+1,n=s+1,h[e]=d?255-l[e]:l[e],h[i]=f?255-l[i]:l[i],h[s]=p?255-l[s]:l[s],h[n]=m?255-l[n]:l[n];g?this.processResults(a,o,1-u):this.processResults(this.cache.work,a,u)},"lock-channels-to-levels":function(t){const e=function(t,e){if(!e.length)return t;for(let i=0,s=e.length;i<s;i++){let[s,n,r]=e[i];if(t>=s&&t<=n)return r}};this.checkChannelLevelsParameters(t);let i,s,n,r,o,[a,l]=this.getInputAndOutputLines(t),h=a.data,c=l.data,u=h.length,{opacity:d,red:f,green:p,blue:m,alpha:g,lineOut:y}=t;for(null==d&&(d=1),null==f&&(f=[0]),null==p&&(p=[0]),null==m&&(m=[0]),null==g&&(g=[255]),o=0;o<u;o+=4)i=o,s=i+1,n=s+1,r=n+1,c[i]=e(h[i],f),c[s]=e(h[s],p),c[n]=e(h[n],m),c[r]=e(h[r],g);y?this.processResults(l,a,1-d):this.processResults(this.cache.work,l,d)},"map-to-gradient":function(t){let e,i,s,n,r,o,a,[l,h]=this.getInputAndOutputLines(t),c=l.data,u=h.data,d=c.length,{opacity:f,useNaturalGrayscale:p,gradient:m,lineOut:g}=t;if(null==f&&(f=1),null==p&&(p=!1),null==m&&(m=!1),m){let t=this.getGradientData(m);if(t.length){const l=this.getGrayscaleValue;for(e=0;e<d;e+=4)s=e,n=s+1,r=n+1,o=r+1,c[o]&&(i=p?l(c[s],c[n],c[r]):Math.floor(.3333*c[s]+.3333*c[n]+.3333*c[r]),a=4*i,u[s]=t[a],a++,u[n]=t[a],a++,u[r]=t[a],a++,u[o]=t[a])}else this.transferDataUnchanged(u,c,d)}else this.transferDataUnchanged(u,c,d);g?this.processResults(h,l,1-f):this.processResults(this.cache.work,h,f)},matrix:function(t){const e=function(t,e,i){let s,n=0;for(let r=0,o=e.length;r<o;r++)O[r]&&(s=e[r]+i,n+=t[s]*O[r]);return n};let i,s,n,r,o,a,[l,h]=this.getInputAndOutputLines(t),c=l.data,u=h.data,d=c.length,{opacity:f,includeRed:p,includeGreen:m,includeBlue:g,includeAlpha:y,width:b,height:S,offsetX:k,offsetY:A,weights:O,lineOut:w}=t;null==f&&(f=1),null==p&&(p=!0),null==m&&(m=!0),null==g&&(g=!0),null==y&&(y=!1),(null==b||b<1)&&(b=3),(null==S||S<1)&&(S=3),null==k&&(k=1),null==A&&(A=1),null==O&&(O=[].fill(0,0,b*S-1),O[Math.floor(O.length/2)+1]=1);let v=this.buildMatrixGrid(b,S,k,A,l);for(a=Math.floor(d/4),o=0;o<a;o++)i=4*o,s=i+1,n=s+1,r=n+1,c[r]&&(u[i]=p?e(c,v[o],0):c[i],u[s]=m?e(c,v[o],1):c[s],u[n]=g?e(c,v[o],2):c[n],u[r]=y?e(c,v[o],3):c[r]);w?this.processResults(h,l,1-f):this.processResults(this.cache.work,h,f)},"modulate-channels":function(t){let e,i,s,n,r,o,a,l,h,[c,u]=this.getInputAndOutputLines(t),d=c.data,f=u.data,p=d.length,{opacity:m,red:g,green:y,blue:b,alpha:S,saturation:k,lineOut:A}=t;if(null==m&&(m=1),null==g&&(g=1),null==y&&(y=1),null==b&&(b=1),null==S&&(S=1),null==k&&(k=!1),k){const t=this.getGrayscaleValue;for(h=0;h<p;h+=4)e=h,i=e+1,s=i+1,n=s+1,o=d[e],a=d[i],l=d[s],r=t(o,a,l),f[e]=r+(o-r)*g,f[i]=r+(a-r)*y,f[s]=r+(l-r)*b,f[n]=d[n]*S}else for(h=0;h<p;h+=4)e=h,i=e+1,s=i+1,n=s+1,f[e]=d[e]*g,f[i]=d[i]*y,f[s]=d[s]*b,f[n]=d[n]*S;A?this.processResults(u,c,1-m):this.processResults(this.cache.work,u,m)},newsprint:function(t){let[e,i]=this.getInputAndOutputLines(t);e.width,e.height;let s=e.data,n=i.data;s.length;let{opacity:r,width:o,lineOut:a}=t;null==r&&(r=1),null==o&&(o=1),o<1&&(o=1);const l=2*o,h=this.buildImageTileSets(l,l,0,0),c=this.getGrayscaleValue,u=this.newspaperPatterns,d=[],f=[];h.forEach((t=>function(t,e,i){d.length=0,f.length=0;let s,n,r,a,l,h,p,m=0,g=i.length;for(i[0],s=0;s<g;s++)n=i[s],r=n+1,a=r+1,h=c(t[n],t[r],t[a]),m+=h;if(m/=g,p=u[Math.floor(m/255*13)],1===o)d.push(...p);else{for(h=p[0],s=0;s<o;s++)f.push(h);for(h=p[1],s=0;s<o;s++)f.push(h);for(s=0;s<o;s++)d.push(...f);for(h=p[2],f.length=0,s=0;s<o;s++)f.push(h);for(h=p[3],s=0;s<o;s++)f.push(h);for(s=0;s<o;s++)d.push(...f)}for(s=0;s<g;s++)h=d[s],n=i[s],r=n+1,a=r+1,l=a+1,e[n]=h,e[r]=h,e[a]=h,e[l]=t[l]}(s,n,t))),a?this.processResults(i,e,1-r):this.processResults(this.cache.work,i,r)},offset:function(t){let[e,i]=this.getInputAndOutputLines(t),s=e.data,n=i.data;s.length;let{opacity:r,offsetRedX:o,offsetRedY:a,offsetGreenX:l,offsetGreenY:h,offsetBlueX:c,offsetBlueY:u,offsetAlphaX:d,offsetAlphaY:f,lineOut:p}=t;if(null==r&&(r=1),null==o&&(o=0),null==a&&(a=0),null==l&&(l=0),null==h&&(h=0),null==c&&(c=0),null==u&&(u=0),null==d&&(d=0),null==f&&(f=0),o||l||c||d||a||h||u||f){let t=!1;o==l&&o==c&&o==d&&a==h&&a==u&&a==f&&(t=!0);let i,r,p,m,g,y,b,S,k,A,O=this.buildImageGrid(e),w=O[0].length,v=O.length;for(let e=0;e<v;e++)for(let C=0;C<w;C++)k=4*O[e][C],t?(i=C+o,r=e+a,i>=0&&i<w&&r>=0&&r<v&&(A=4*O[r][i],n[A]=s[k],n[A+1]=s[k+1],n[A+2]=s[k+2],n[A+3]=s[k+3])):(i=C+o,r=e+a,p=C+l,m=e+h,g=C+c,y=e+u,b=C+d,S=e+f,i>=0&&i<w&&r>=0&&r<v&&(A=4*O[r][i],n[A]=s[k]),p>=0&&p<w&&m>=0&&m<v&&(A=4*O[m][p],n[A+1]=s[k+1]),g>=0&&g<w&&y>=0&&y<v&&(A=4*O[y][g],n[A+2]=s[k+2]),b>=0&&b<w&&S>=0&&S<v&&(A=4*O[S][b],n[A+3]=s[k+3]))}p?this.processResults(i,e,1-r):this.processResults(this.cache.work,i,r)},pixelate:function(t){const e=function(t,e,i,s){let n=i.reduce(((e,i)=>e+t[i+s]),0);n=Math.floor(n/i.length);for(let t=0,r=i.length;t<r;t++)e[i[t]+s]=n},i=function(t,e,i,s){let n;for(let r=0,o=i.length;r<o;r++)n=i[r],e[n+s]=t[n+s]};let[s,n]=this.getInputAndOutputLines(t),r=s.data,o=n.data;r.length;let{opacity:a,tileWidth:l,tileHeight:h,offsetX:c,offsetY:u,includeRed:d,includeGreen:f,includeBlue:p,includeAlpha:m,lineOut:g}=t;null==a&&(a=1),null==d&&(d=!0),null==f&&(f=!0),null==p&&(p=!0),null==m&&(m=!1),null==l&&(l=1),null==h&&(h=1),null==c&&(c=0),null==u&&(u=0);this.buildImageTileSets(l,h,c,u).forEach((t=>{d?e(r,o,t,0):i(r,o,t,0),f?e(r,o,t,1):i(r,o,t,1),p?e(r,o,t,2):i(r,o,t,2),m?e(r,o,t,3):i(r,o,t,3)})),g?this.processResults(n,s,1-a):this.processResults(this.cache.work,n,a)},"process-image":function(t){const{assetData:e,lineOut:i}=t;if(i&&i.substring&&i.length){let{width:t,height:s,data:n}=e;if(t&&s&&n){let{width:e,height:r}=this.cache.source;if(e!==t||r!==s){let i,o,a,l,h=new ImageData(e,r).data,c=(e-t)/2,u=(r-s)/2;for(c<0&&(c=0),u<0&&(u=0),o=0;o<r;o++)for(i=0;i<e;i++)i<t&&o<s&&(a=4*((o+u)*e+(i+c)),l=4*(o*t+i),h[a]=n[l],a++,l++,h[a]=n[l],a++,l++,h[a]=n[l],a++,l++,h[a]=n[l]);n=h,t=e,s=r}this.cache[i]=new ImageData(n,t,s)}}},"random-noise":function(t){let e,i,s,n,r,o,a,l,[h,c]=this.getInputAndOutputLines(t),u=h.data,d=c.data,f=u.length,p=h.width,{opacity:m,width:g,height:y,level:b,seed:S,noiseType:k,noWrap:A,includeRed:O,includeGreen:w,includeBlue:v,includeAlpha:C,excludeTransparentPixels:x,lineOut:P}=t;null==m&&(m=1),null==g&&(g=1),null==y&&(y=1),null==b&&(b=.5),null==S&&(S="some-random-string-or-other"),null==k&&(k="random"),null==A&&(A=!1),null==O&&(O=!0),null==w&&(w=!0),null==v&&(v=!0),null==C&&(C=!0),null==x&&(x=!0);const D=this.getRandomNumbers({seed:S,length:Math.ceil(f/4*3),imgWidth:p,type:k});let R,F,E,M=-1;const I=g/2,H=y/2;for(r=0;r<f;r+=4){if(e=r,i=e+1,s=i+1,n=s+1,"random"===k)R=D[++M],F=D[++M],E=D[++M];else{const t=D[++M];R=t,F=t,E=t}R<b?(o=Math.floor(F*g-I),a=Math.floor(E*y-H),l=r+4*(a*p+o),A&&(l<0||l>=f)?(d[e]=u[e],d[i]=u[i],d[s]=u[s],d[n]=u[n]):(l<0?l+=f:l>=f&&(l-=f),!x||u[n]&&u[l+3]?(d[e]=O?u[l]:u[e],l++,d[i]=w?u[l]:u[i],l++,d[s]=v?u[l]:u[s],l++,d[n]=C?u[l]:u[n]):(d[e]=u[e],d[i]=u[i],d[s]=u[s],d[n]=u[n]))):(d[e]=u[e],d[i]=u[i],d[s]=u[s],d[n]=u[n])}P?this.processResults(c,h,1-m):this.processResults(this.cache.work,c,m)},"reduce-palette":function(t,e){this.predefinedPalette||(this.predefinedPalette={});this.colorSpaceIndices();const{rgbIndices:i,labIndices:s,indicesMemoRecord:n,colorEngine:r,predefinedPalette:o,getGrayscaleValue:a,tfx:l,tfx2:h,tfx3:c,indicesLen:u,labIndicesMultiplier:d}=this;let f;const p=(t,e)=>{if(t||(t=e.join(",")),t&&o[t])return o[t];const a=[];return e.forEach((t=>{r.convert(t);const[e,o,c]=r.rgb,u=e*h+o*l+c;if(a.push(u),!n[u]){n[u]=1;const[t,a,l]=r.convertRGBtoOKLAB(e,o,c);let h=3*u;i[h]=e,s[h]=t*d,h++,i[h]=o,s[h]=a*d,h++,i[h]=c,s[h]=l*d}})),o[t]=a.sort(((t,e)=>t-e)),a};o["black-white"]||(p("black-white",["#000","#fff"]),p("monochrome-4",["#222","#777","#bbb","#fff"]),p("monochrome-8",["#000","#333","#555","#777","#999","#bbb","#ddd","#fff"]),p("monochrome-16",["#000","#111","#222","#333","#444","#555","#666","#777","#888","#999","#aaa","#bbb","#ccc","#ddd","#eee","#fff"]));const m=function(t,e){const s=e.length;if(!s)return 0;if(1===s)return e[0];const n=i[3*t];let r,o,a;const l=[];for(let t=0;t<s;t++)o=e[t],r=i[3*o],a=n-r,l.push([o,Math.sqrt(a*a*3)]);l.sort(((t,e)=>t[1]-e[1]));const[h,c]=l[0],[u,d]=l[1],f=c+d,p=f-c;return _[D]*f<p?h:u},g=function(t,e){const i=e.length;let n,r,o,a,l,h,c,u,d,f,p,m,g,y,b;if(!i)return 0;if(1===i)return e[0];r=3*t,o=s[r],r++,a=s[r],r++,l=s[r];const S=[];for(g=0;g<i;g++)n=e[g],r=3*n,h=s[r],r++,c=s[r],r++,u=s[r],f=o-h,p=a-c,m=l-u,d=f*f+p*p+m*m,S.push([n,d]);S.sort(((t,e)=>t[1]-e[1]));const[k,A]=S[0],[O,w]=S[1];let v=_[D];return y=A+w,b=y-A,v*=y,v<b?k:O};let y,b,S,k,A,O,w,v,C,x,P,D,R,F,E,[M,I]=this.getInputAndOutputLines(t),H=M.data,B=M.width,T=M.height,L=I.data,$=H.length,j=$/4,{opacity:X,palette:Y,seed:N,noiseType:G,useBluenoise:z,minimumColorDistance:W,useLabForPaletteDistance:V,lineOut:Z}=t;null==X&&(X=1),null==N&&(N="some-random-string-or-other"),null==G&&(G="random"),null==z&&(z=!1),null==V&&(V=!1),null==Y&&(Y="black-white"),null==W&&(W=1e3),z&&(G="bluenoise");const _=this.getRandomNumbers({seed:N,length:j,imgWidth:B,type:G});D=-1;const U=["black-white","monochrome-4","monochrome-8","monochrome-16"].includes(Y),K=new ImageData(B,T),q=K.data;for(K.width,K.height,y=0;y<$;y+=4)S=y,k=S+1,A=k+1,O=A+1,U?(P=a(H[S],H[k],H[A]),q[S]=P,q[k]=P,q[A]=P,q[O]=H[O]):(q[S]=H[S],q[k]=H[k],q[A]=H[A],q[O]=H[O]);const Q=new Int32Array($/4),J={};for(y=0;y<j;y++)S=4*y,k=S+1,A=k+1,O=A+1,w=q[S],v=q[k],C=q[A],x=q[O],x?(b=w*h+v*l+C,Q[y]=b,null==J[b]&&(J[b]=0,n[b]||(n[b]=1,f=r.convertRGBtoOKLAB(w,v,C),R=3*b,i[R]=w,s[R]=f[0]*d,R++,i[R]=v,s[R]=f[1]*d,R++,i[R]=C,s[R]=f[2]*d)),J[b]=J[b]+1):Q[y]=-1;for(E=Y.substring?o[Y]||[]:Array.isArray(Y)?p("",Y):Y.toFixed?function(t,e,n){const r=[],o=[];let a,l,h,c,u,d,f,p,m,g,y,b,S,k,A,O;for(const[e,i]of Object.entries(t))i&&r.push([e,i]);for(r.sort(((t,e)=>e[1]-t[1])),f=0,p=r.length;f<p;f++){let t=r[f];if(f)if(m=3*t[0],V){for(g=s[m],m++,y=s[m],m++,b=s[m],O=!0,a=0,l=o.length;a<l;a++)if(h=3*o[a],c=s[h],h++,u=s[h],h++,d=s[h],S=g-c,k=y-u,A=b-d,S*S+k*k+A*A<e){O=!1;break}if(O&&o.push(t[0]),o.length>=n)break}else{for(g=i[m],m++,y=i[m],m++,b=i[m],O=!0,a=0,l=o.length;a<l;a++)if(h=3*o[a],c=i[h],h++,u=i[h],h++,d=i[h],S=g-c,k=y-u,A=b-d,S*S+k*k+A*A<e){O=!1;break}if(O&&o.push(t[0]),o.length>=n)break}else o.push(t[0])}return o}(J,W,Y):[],E.length||(E=o["black-white"]),y=0;y<j;y++)D++,b=Q[y],F=4*y,b<0?(L[F]=q[F],F++,L[F]=q[F],F++,L[F]=q[F],F++,L[F]=q[F]):(R=U?3*m(b,E):3*g(b,E),L[F]=i[R],F++,R++,L[F]=i[R],F++,R++,L[F]=i[R],F++,L[F]=q[F]);Z?this.processResults(I,M,1-X):this.processResults(this.cache.work,I,X)},"set-channel-to-level":function(t){let e,i,s,n,r,[o,a]=this.getInputAndOutputLines(t),l=o.data,h=a.data,c=l.length,{opacity:u,includeRed:d,includeGreen:f,includeBlue:p,includeAlpha:m,level:g,lineOut:y}=t;for(null==u&&(u=1),null==d&&(d=!1),null==f&&(f=!1),null==p&&(p=!1),null==m&&(m=!1),null==g&&(g=0),r=0;r<c;r+=4)e=r,i=e+1,s=i+1,n=s+1,h[e]=d?g:l[e],h[i]=f?g:l[i],h[s]=p?g:l[s],h[n]=m?g:l[n];y?this.processResults(a,o,1-u):this.processResults(this.cache.work,a,u)},"step-channels":function(t){let e,i,s,n,r,[o,a]=this.getInputAndOutputLines(t),l=o.data,h=a.data,c=l.length,u=Math.floor,d=Math.ceil,f=Math.round,{opacity:p,red:m,green:g,blue:y,clamp:b,lineOut:S}=t;for(null==p&&(p=1),null==m&&(m=1),null==g&&(g=1),null==y&&(y=1),null==b&&(b="down"),r=0;r<c;r+=4){switch(e=r,i=e+1,s=i+1,n=s+1,b){case"up":h[e]=d(l[e]/m)*m,h[i]=d(l[i]/g)*g,h[s]=d(l[s]/y)*y;break;case"round":h[e]=f(l[e]/m)*m,h[i]=f(l[i]/g)*g,h[s]=f(l[s]/y)*y;break;default:h[e]=u(l[e]/m)*m,h[i]=u(l[i]/g)*g,h[s]=u(l[s]/y)*y}h[n]=l[n]}S?this.processResults(a,o,1-p):this.processResults(this.cache.work,a,p)},swirl:function(t){const e=function(t,e){return t.substring?F(parseFloat(t)/100*e):t};let i,s,n,r,o,a,l,h,c,u,d,f,p,m,g,y,b,S,k,A,O,[w,v]=this.getInputAndOutputLines(t),C=w.data,x=v.data,P=C.length,D=w.width,R=w.height,F=Math.floor,E=new ImageData(D,R),M=E.data,I=E.width,H=E.height,{opacity:B,swirls:T,lineOut:L}=t;for(null==B&&(B=1),null==T&&(T=[]),f=0;f<P;f+=4)i=f,s=i+1,n=s+1,r=n+1,M[i]=C[i],M[s]=C[s],M[n]=C[n],M[r]=C[r],x[i]=C[i],x[s]=C[s],x[n]=C[n],x[r]=C[r];if(Array.isArray(T)&&T.length){let t=this.buildImageGrid(w);for(o=0,a=T.length;o<a;o++){const[a,w,v,C,P,E]=T[o],B=e(a,D),L=e(w,R);let $=e(C,D),j=e(v,D);if(j>$){let t=j;j=$,$=t}const X=$-j;if(h=B-$,h<0&&(h=0),u=B+$,u>I&&(u=I),c=L-$,c<0&&(c=0),d=L+$,d>=H&&(d=H),h<u&&c<d&&h<I&&u>0&&c<H&&d>0){let e=E,o=E;nt(e)?o=`ude-${e(0)}-${e(.1)}-${e(.2)}-${e(.3)}-${e(.4)}-${e(.5)}-${e(.6)}-${e(.7)}-${e(.8)}-${e(.9)}-${e(1)}`:e=null!=gt[e]?gt[e]:gt.linear;const I=`swirl-${a}-${w}-${v}-${C}-${P}-${o}-${D}-${R}`,H=this.getOrAddWorkstore(I);if(!H.length){const s=Re(),n=Re();for(s.setFromArray([B,L]),f=c;f<d;f++)for(p=h;p<u;p++)l=[p,f],i=4*t[f][p],m=n.set(l).subtract(s).getMagnitude(),m>$?g=i:m<j?(n.rotate(P).add(s),k=F(n[0]),A=F(n[1]),k<0?k+=D:k>=D&&(k-=D),A<0?A+=R:A>=R&&(A-=R),g=4*t[A][k]):(O=1-(m-j)/X,O=e(O),n.rotate(P*O).add(s),k=F(n[0]),A=F(n[1]),k<0?k+=D:k>=D&&(k-=D),A<0?A+=R:A>=R&&(A-=R),g=4*t[A][k]),H.push(g);Fe(n),Fe(s)}let T=-1;for(f=c;f<d;f++)for(p=h;p<u;p++)i=4*t[f][p],s=i+1,n=s+1,r=n+1,g=H[++T],y=g+1,b=y+1,S=b+1,x[i]=M[g],x[s]=M[y],x[n]=M[b],x[r]=M[S];for(f=c;f<d;f++)for(p=h;p<u;p++)i=4*t[f][p],s=i+1,n=s+1,r=n+1,M[i]=x[i],M[s]=x[s],M[n]=x[n],M[r]=x[r]}}}L?this.processResults(v,w,1-B):this.processResults(this.cache.work,v,B)},threshold:function(t){let e,i,s,n,r,o,a,l,h,c,[u,d]=this.getInputAndOutputLines(t),f=u.data,p=d.data,m=f.length,{opacity:g,low:y,high:b,level:S,red:k,green:A,blue:O,alpha:w,includeRed:v,includeGreen:C,includeBlue:x,includeAlpha:P,useMixedChannel:D,lineOut:R}=t;null==g&&(g=1),null==y&&(y=[0,0,0,0]),null==b&&(b=[255,255,255,255]),null==S&&(S=128),null==k&&(k=128),null==A&&(A=128),null==O&&(O=128),null==w&&(w=128),null==v&&(v=!0),null==C&&(C=!0),null==x&&(x=!0),null==P&&(P=!1),null==D&&(D=!0);let[F,E,M,I]=y,[H,B,T,L]=b;const $=this.getGrayscaleValue;for(r=0;r<m;r+=4)e=r,i=e+1,s=i+1,n=s+1,o=f[e],a=f[i],l=f[s],h=f[n],D?(c=$(o,a,l),c<S?(p[e]=v?F:o,p[i]=C?E:a,p[s]=x?M:l,p[n]=P?I:h):(p[e]=v?H:o,p[i]=C?B:a,p[s]=x?T:l,p[n]=P?L:h)):(p[e]=v?o<k?F:H:o,p[i]=C?a<A?E:B:a,p[s]=x?l<O?M:T:l,p[n]=P?h<w?I:L:h);R?this.processResults(d,u,1-g):this.processResults(this.cache.work,d,g)},tiles:function(t){const e=function(t,e,i,s){let n=i.reduce(((e,i)=>e+t[4*i+s]),0);n=Math.floor(n/i.length);for(let t=0,r=i.length;t<r;t++)e[4*i[t]+s]=n},i=function(t,e,i,s){let n;for(let r=0,o=i.length;r<o;r++)n=4*i[r]+s,e[n]=t[n]};let[s,n]=this.getInputAndOutputLines(t),r=s.data,o=n.data,a=r.length,{opacity:l,tileWidth:h,tileHeight:c,tileRadius:u,offsetX:d,offsetY:f,angle:p,points:m,seed:g,includeRed:y,includeGreen:b,includeBlue:S,includeAlpha:k,lineOut:A}=t;null==l&&(l=1),null==y&&(y=!0),null==b&&(b=!0),null==S&&(S=!0),null==k&&(k=!1),null==h&&(h=1),null==c&&(c=1),null==u&&(u=1),null==d&&(d=0),null==f&&(f=0),null==p&&(p=0),null==m&&(m="rect-grid"),null==g&&(g="some-random-string-or-other");const O=this.buildGeneralTileSets(m,h,c,u,d,f,p,g);O.length?O.forEach((t=>{y?e(r,o,t,0):i(r,o,t,0),b?e(r,o,t,1):i(r,o,t,1),S?e(r,o,t,2):i(r,o,t,2),k?e(r,o,t,3):i(r,o,t,3)})):this.transferDataUnchanged(o,r,a),A?this.processResults(n,s,1-l):this.processResults(this.cache.work,n,l)},"tint-channels":function(t){let e,i,s,n,r,o,a,l,[h,c]=this.getInputAndOutputLines(t),u=h.data,d=c.data,f=u.length,{opacity:p,redInRed:m,redInGreen:g,redInBlue:y,greenInRed:b,greenInGreen:S,greenInBlue:k,blueInRed:A,blueInGreen:O,blueInBlue:w,lineOut:v}=t;for(null==p&&(p=1),null==m&&(m=1),null==g&&(g=0),null==y&&(y=0),null==b&&(b=0),null==S&&(S=1),null==k&&(k=0),null==A&&(A=0),null==O&&(O=0),null==w&&(w=1),r=0;r<f;r+=4)e=r,i=e+1,s=i+1,n=s+1,o=u[e],a=u[i],l=u[s],d[e]=Math.floor(o*m+a*b+l*A),d[i]=Math.floor(o*g+a*S+l*O),d[s]=Math.floor(o*y+a*k+l*w),d[n]=u[n];v?this.processResults(c,h,1-p):this.processResults(this.cache.work,c,p)},"user-defined-legacy":function(t){let[e,i]=this.getInputAndOutputChannels(t),{opacity:s,lineOut:n}=t;null==s&&(s=1),this.transferDataUnchanged(e,i),n?this.processResults(i,e,1-s):this.processResults(this.cache.work,i,s)},"vary-channels-by-weights":function(t){let e,i,s,n,r,o,a,l,h,c,u,d,f,p,[m,g]=this.getInputAndOutputLines(t),y=m.data,b=g.data,S=y.length,{opacity:k,weights:A,useMixedChannel:O,lineOut:w}=t;null==k&&(k=1),null==O&&(O=!0),null==A&&(A=!1),A&&1024===A.length||(A=new Array(1024),A.fill(0));const v=this.getGrayscaleValue;for(e=0;e<S;e+=4)i=e,s=i+1,n=s+1,r=n+1,o=y[i],a=y[s],l=y[n],h=y[r],O?(c=v(o,a,l),u=A[4*c+3],d=.2126*u,f=.7152*u,p=.0722*u,b[i]=o+d,b[s]=a+f,b[n]=l+p,b[r]=y[r]):(b[i]=o+A[4*o],b[s]=a+A[4*a+1],b[n]=l+A[4*l+2],b[r]=h+A[4*h+3]);w?this.processResults(g,m,1-k):this.processResults(this.cache.work,g,k)}},Lt({name:"filters-cleanup-action",order:999,fn:function(){m.forEach((t=>{const e=p[t];e&&(e.dirtyFilterIdentifier=!1)})),D.forEach((t=>{const e=P[t];e&&(e.dirtyFilterIdentifier=!1)}))}}),E.FilterEngine=FilterEngine;const Oi=new FilterEngine,Group=function(t=Q){return this.makeName(t.name),this.register(),this.artefacts=[],this.artefactCalculateBuckets=[],this.artefactStampBuckets=[],this.set(this.defs),this.onEntityHover=_,this.onEntityNoHover=_,this.isHovering=null,this.set(t),this};let wi=Group.prototype=Object.create(Object.prototype);wi.type="Group",wi.lib="group",wi.isArtefact=!1,wi.isAsset=!1,wi=Bt(wi),wi=ti(wi);wi.defs=lt(wi.defs,{artefacts:null,order:0,visibility:!0,regionRadius:0,checkForEntityHover:!1,onEntityHover:null,onEntityNoHover:null}),wi.packetExclusions=ct(wi.packetExclusions,["artefactCalculateBuckets","artefactStampBuckets","batchResort"]),wi.packetFunctions=ct(wi.packetFunctions,["onEntityHover","onEntityNoHover"]),wi.postCloneAction=function(t,e){let i;return i=e.host?o[e.host]:this.currentHost?this.currentHost:!!this.host&&o[this.host],i&&(i.addGroups(t.name),t.host||(t.host=i.name)),this.onEntityHover&&(t.onEntityHover=this.onEntityHover),this.onEntityNoHover&&(t.onEntityNoHover=this.onEntityNoHover),t},wi.kill=function(t=!1){t&&this.artefactCalculateBuckets.forEach((t=>t.kill()));let e=this.name;return Object.entries(o).forEach((([t,i])=>{Array.isArray(i.groups)&&i.groups.indexOf(e)>=0&&(ut(i.groups,e),i.batchResort=!0)})),Object.entries(u).forEach((([t,i])=>{Array.isArray(i.groups)&&i.groups.indexOf(e)>=0&&(ut(i.groups,e),i.batchResort=!0)})),this.deregister()},wi.killArtefacts=function(){return this.artefactCalculateBuckets.forEach((t=>t.kill())),this};let vi=wi.getters,Ci=wi.setters;vi.artefacts=function(){return[].concat(this.artefacts)},Ci.artefacts=function(t){this.artefacts=[],this.addArtefacts(t)},Ci.host=function(t){let e=this.getHost(t);e&&e.addGroups&&(this.host=t,e.addGroups(this.name),this.dirtyHost=!0)},Ci.order=function(t){let e=this.getHost(this.host);this.order=t,e&&e.set({batchResort:!0})},Ci.noFilters=function(t){this.noFilters=t,this.dirtyFilterIdentifier=!0},wi.getHost=function(t){let e=this.currentHost;return!e||e.substring?o[t]||u[t]||o[e]||u[e]||null:e},wi.forceStamp=function(){let t=this.visibility;this.visibility=!0,this.stamp(),this.visibility=t},wi.stamp=function(){if(this.dirtyHost||!this.currentHost){this.dirtyHost=!1;let t=this.getHost(this.host);t?this.currentHost=t:this.dirtyHost=!0}if(this.visibility){let{currentHost:t,stashOutput:e,noFilters:i,filters:s}=this;if(t){this.sortArtefacts();let n=!!(e||!i&&s&&s.length)&&ai();if(n&&n.element){let e=t.currentDimensions,i=n.currentDimensions,s=n.element;e&&i&&s&&(i[0]=e[0],i[1]=e[1],s.width=e[0],s.height=e[1])}else t.engine&&t.engine.save();this.prepareStamp(n),this.stampAction(n),n?li(n):t.engine&&(t.engine.restore(),t.setEngineFromState(t.engine))}}},wi.sortArtefacts=function(){if(this.batchResort){this.batchResort=!1;let t=Math.floor,e=[];this.artefacts.forEach((i=>{let s=o[i],n=t(s.calculateOrder)||0;e[n]||(e[n]=[]),e[n].push(s)})),this.artefactCalculateBuckets=e.reduce(((t,e)=>t.concat(e)),[]),e.length=0,this.artefacts.forEach((i=>{let s=o[i],n=t(s.stampOrder)||0;e[n]||(e[n]=[]),e[n].push(s)})),this.artefactStampBuckets=e.reduce(((t,e)=>t.concat(e)),[])}},wi.prepareStamp=function(t){let e=this.currentHost;t&&(e=t),this.artefactCalculateBuckets.forEach((i=>{"entity"===i.lib&&(i.currentHost&&i.currentHost.name===e.name||(i.currentHost=e,t||(i.dirtyHost=!0))),i.noDeltaUpdates||i.updateByDelta(),i.prepareStamp()}))},wi.stampAction=function(t){!this.currentHost||this.currentHost.stashOutput;let{dirtyFilters:e,currentFilters:i,artefactStampBuckets:s,noFilters:n,filters:r,stashOutput:o,currentHost:a}=this;if(!e&&i||this.cleanFilters(),s.forEach((t=>{t&&t.stamp&&t.stamp()})),t)if(!n&&r&&r.length){let e=this.applyFilters(t);this.stashAction(e)}else if(o){let e=t.element,i=t.engine,s=!(!a||!a.engine)&&a.engine;if(s){s.save(),s.globalCompositeOperation="source-over",s.globalAlpha=1,s.setTransform(1,0,0,1,0,0),s.drawImage(e,0,0),s.restore();let t=i.getImageData(0,0,e.width,e.height);this.stashAction(t)}}},wi.applyFilters=function(t){let e=this.currentHost,i=t;if(!e||!i)return!1;let s=e.element,n=e.engine,r=i.element,o=i.engine;this.isStencil&&(o.save(),o.globalCompositeOperation="source-in",o.globalAlpha=1,o.setTransform(1,0,0,1,0,0),o.drawImage(s,0,0),o.restore(),this.dirtyFilterIdentifier=!0),o.setTransform(1,0,0,1,0,0);let a=o.getImageData(0,0,r.width,r.height);this.preprocessFilters(this.currentFilters);let l=Oi.action({identifier:this.filterIdentifier,image:a,filters:this.currentFilters});return l&&(o.globalCompositeOperation="source-over",o.globalAlpha=1,o.setTransform(1,0,0,1,0,0),o.putImageData(l,0,0)),n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,0,0),n.restore(),l},wi.stashAction=function(t){if(!t)return!1;if(this.stashOutput){this.stashOutput=!1;let[e,i,s,n]=this.getCellCoverage(t),r=ai(),o=r.engine,a=r.element;if(a.width=s,a.height=n,o.putImageData(t,-e,-i),this.stashedImageData=o.getImageData(0,0,s,n),this.stashOutputAsAsset){const t=this.stashOutputAsAsset.substring?this.stashOutputAsAsset:`${this.name}-groupimage`;if(this.stashOutputAsAsset=!1,this.stashedImage)this.stashedImage.src=a.toDataURL();else{let e=this.stashedImage=document.createElement("img");e.id=t,e.onload=function(){ws.appendChild(e),je(`#${t}`)},e.src=a.toDataURL()}}li(r)}},wi.getCellCoverage=function(t){let e,i,s=t.width,n=t.height,r=t.data,o=0,a=0,l=s,h=n,c=3;for(i=0;i<n;i++)for(e=0;e<s;e++)r[c]&&(l>e&&(l=e),o<e&&(o=e),h>i&&(h=i),a<i&&(a=i)),c+=4;return l<o&&h<a?[l,h,o-l,a-h]:[0,0,s,n]},wi.addArtefacts=function(...t){return t&&Array.isArray(t[0])&&(t=t[0]),t.forEach((t=>{t&&(t.substring?ct(this.artefacts,t):t.name&&ct(this.artefacts,t.name))}),this),this.batchResort=!0,this},wi.getArtefact=function(t){return this.artefacts.indexOf(t)>=0&&o[t]||!1},wi.removeArtefacts=function(...t){return t.forEach((t=>{t&&(t.substring?ut(this.artefacts,t):t.name&&ut(this.artefacts,t.name))}),this),this.batchResort=!0,this},wi.moveArtefactsIntoGroup=function(...t){let e,i;return t.forEach((t=>{t&&(i=t.substring?o[t]:t,i&&i.isArtefact&&(e=i.group?i.group:!!i.host&&g[i.host]),e&&(e.removeArtefacts(t),e.batchResort=!0),ct(this.artefacts,t))}),this),this.batchResort=!0,this},wi.clearArtefacts=function(){return this.artefacts.length=0,this.artefactCalculateBuckets.length=0,this.artefactStampBuckets.length=0,this.batchResort=!0,this},wi.updateArtefacts=function(t){return this.cascadeAction(t,"setDelta"),this},wi.setArtefacts=function(t){return this.cascadeAction(t,"set"),this},wi.updateByDelta=function(){return this.cascadeAction(!1,"updateByDelta"),this},wi.reverseByDelta=function(){return this.cascadeAction(!1,"reverseByDelta"),this},wi.addArtefactClasses=function(t){return this.cascadeAction(t,"addClasses"),this},wi.removeArtefactClasses=function(t){return this.cascadeAction(t,"removeClasses"),this},wi.cascadeAction=function(t,e){return this.artefacts.forEach((i=>{let s=o[i];s&&s[e]&&s[e](t)})),this},wi.setDeltaValues=function(t=Q){return this.artefactCalculateBuckets.forEach((e=>e.setDeltaValues(t))),this},wi.addFiltersToEntitys=function(...t){return this.artefacts.forEach((e=>{let i=f[e];i&&i.addFilters&&i.addFilters(t)})),this},wi.removeFiltersFromEntitys=function(...t){return this.artefacts.forEach((e=>{let i=f[e];i&&i.removeFilters&&i.removeFilters(t)})),this},wi.clearFiltersFromEntitys=function(){return this.artefacts.forEach((t=>{let e=f[t];e&&e.clearFilters&&e.clearFilters()})),this},wi.getArtefactAt=function(t){this.sortArtefacts();let e=ai(),i=this.artefactStampBuckets;for(let s=i.length-1;s>=0;s--){let n=i[s];if(n){let i=n.checkHit(t,e);if(i)return li(e),i}}return li(e),!1},wi.getAllArtefactsAt=function(t){this.sortArtefacts();let e=ai(),i=this.artefactStampBuckets,s=[],n=[];for(let r=i.length-1;r>=0;r--){let o=i[r];if(o){let i=o.checkHit(t,e);if(i&&i.artefact){let t=i.artefact;s.indexOf(t.name)<0&&(s.push(t.name),n.push(i))}}}if(li(e),this.checkForEntityHover){const t=!!n.length;this.isHovering!==t&&(this.isHovering=t,t?this.onEntityHover():this.onEntityNoHover())}return n};const xi=function(t){return!!t&&new Group(t)};E.Group=Group;const Vector=function(t,e,i){return this.x=0,this.y=0,this.z=0,dt(t)&&this.set(t,e,i),this};let Pi=Vector.prototype=Object.create(Object.prototype);Pi.type="Vector",Pi.getXYCoordinate=function(){return[this.x,this.y]},Pi.getXYZCoordinate=function(){return[this.x,this.y,this.z]},Pi.setX=function(t){if(!dt(t))throw new Error(`${this.name} Vector error - setX() arguments error: ${t}`);return this.x=t,this},Pi.setY=function(t){if(!dt(t))throw new Error(`${this.name} Vector error - setY() arguments error: ${t}`);return this.y=t,this},Pi.setZ=function(t){if(!dt(t))throw new Error(`${this.name} Vector error - setZ() arguments error: ${t}`);return this.z=t,this},Pi.setXY=function(t,e){if(!ft(t,e))throw new Error(`${this.name} Vector error - setXY() arguments error: ${t}, ${e}`);return this.x=t,this.y=e,this},Pi.set=function(t,e,i){return ot(t)?this.setFromVector(t):Array.isArray(t)?this.setFromArray(t):ft(t,e)?this.setFromArray([t,e,i]):this},Pi.setFromArray=function(t){if(!Array.isArray(t))throw new Error(`${this.name} Vector error - setFromArray() arguments error: ${t}`);let[e,i,s]=t;return rt(e)&&(this.x=e),rt(i)&&(this.y=i),rt(s)&&(this.z=s),this},Pi.setFromVector=function(t){if(!ot(t))throw new Error(`${this.name} Vector error - setFromVector() arguments error: ${JSON.stringify(t)}`);let{x:e,y:i,z:s}=t;return rt(e)&&(this.x=e),rt(i)&&(this.y=i),rt(s)&&(this.z=s),this},Pi.zero=function(){return this.x=0,this.y=0,this.z=0,this},Pi.vectorAdd=function(t=Q){if(Array.isArray(t))return this.vectorAddArray(t);let{x:e,y:i,z:s}=t;return rt(e)&&(this.x+=e),rt(i)&&(this.y+=i),rt(s)&&(this.z+=s),this},Pi.vectorAddArray=function(t=[]){let[e,i,s]=t;return rt(e)&&(this.x+=e),rt(i)&&(this.y+=i),rt(s)&&(this.z+=s),this},Pi.vectorSubtract=function(t=Q){if(Array.isArray(t))return this.vectorSubtractArray(t);let{x:e,y:i,z:s}=t;return rt(e)&&(this.x-=e),rt(i)&&(this.y-=i),rt(s)&&(this.z-=s),this},Pi.vectorSubtractArray=function(t){let[e,i,s]=t;return rt(e)&&(this.x-=e),rt(i)&&(this.y-=i),rt(s)&&(this.z-=s),this},Pi.scalarMultiply=function(t){if(!rt(t))throw new Error(`${this.name} Vector error - scalarMultiply() argument not a number: ${t}`);return this.x*=t,this.y*=t,this.z*=t,this},Pi.vectorMultiply=function(t=Q){if(Array.isArray(t))return this.vectorMultiplyArray(t);let{x:e,y:i,z:s}=t;return rt(e)&&(this.x*=e),rt(i)&&(this.y*=i),rt(s)&&(this.z*=s),this},Pi.vectorMultiplyArray=function(t){let[e,i,s]=t;return rt(e)&&(this.x*=e),rt(i)&&(this.y*=i),rt(s)&&(this.z*=s),this},Pi.scalarDivide=function(t){if(!rt(t))throw new Error(`${this.name} Vector error - scalarDivide() argument not a number: ${t}`);if(!t)throw new Error(`${this.name} Vector error - scalarDivide() division by zero: ${t}`);return this.x/=t,this.y/=t,this.z/=t,this},Pi.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Pi.rotate=function(t){if(!rt(t))throw new Error(`${this.name} Vector error - rotate() argument not a number: ${t}`);let e=Math.atan2(this.y,this.x);e+=.01745329251*t;let i=this.getMagnitude();return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this},Pi.reverse=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},Pi.normalize=function(){let t=this.getMagnitude();return t>0&&(this.x/=t,this.y/=t,this.z/=t),this};const Di=[],Ri=function(t,e,i){Di.length||Di.push(new Vector);let s=Di.shift();return s.set(t,e,i),s},Fi=function(t){t&&"Vector"===t.type&&Di.push(t.zero())},Ei=function(t,e,i){return new Vector(t,e,i)};E.Vector=Vector;const Quaternion=function(t=Q){return this.name=t.name||"generic",this.n=t.n||1,this.v=Ei(),this.set(t),this};let Mi=Quaternion.prototype=Object.create(Object.prototype);Mi.type="Quaternion",Mi.set=function(t=Q){if(at(t))return this.setFromQuaternion(t);if(mt(t.pitch,t.yaw,t.roll))return this.setFromEuler(t);let e,i,s,n,r,o=this.v;return r=!(!dt(t.vector)&&!dt(t.v))&&(t.vector||t.v),n=!(!dt(t.scalar)&&!dt(t.n))&&(t.scalar||t.n||0),e=r?r.x||0:t.x||!1,i=r?r.y||0:t.y||!1,s=r?r.z||0:t.z||!1,this.n=rt(n)?n:this.n,o.x=rt(e)?e:o.x,o.y=rt(i)?i:o.y,o.z=rt(s)?s:o.z,this},Mi.setFromQuaternion=function(t){if(!at(t))throw new Error(`${this.name} Quaternion error - setFromQuaternion() bad argument: ${t}`);let e=this.v,i=t.v;return this.n=t.n,e.x=i.x,e.y=i.y,e.z=i.z,this},Mi.setFromEuler=function(t=Q){let e,i,s,n,r,o,a,l,h,c=Math.cos,u=Math.sin,d=this.v;return e=(t.pitch||t.x||0)*M,i=(t.yaw||t.y||0)*M,s=(t.roll||t.z||0)*M,n=c(e/2),r=c(i/2),o=c(s/2),a=u(e/2),l=u(i/2),h=u(s/2),d.x=a*r*o+n*l*h,d.y=n*l*o+a*r*h,d.z=n*r*h-a*l*o,this.n=n*r*o-a*l*h,this},Mi.zero=function(){let t=this.v;return this.n=1,t.x=0,t.y=0,t.z=0,this},Mi.getMagnitude=function(){let t=this.v;return Math.sqrt(this.n*this.n+t.x*t.x+t.y*t.y+t.z*t.z)},Mi.normalize=function(){let t=this.getMagnitude(),e=this.v;if(!t)throw new Error(`${this.name} Quaternion error - normalize() division by zero: ${t}`);return this.n/=t,this.n=this.n>-1e-6&&this.n<1e-6?0:this.n,e.x/=t,e.x=e.x>-1e-6&&e.x<1e-6?0:e.x,e.y/=t,e.y=e.y>-1e-6&&e.y<1e-6?0:e.y,e.z/=t,e.z=e.z>-1e-6&&e.z<1e-6?0:e.z,this},Mi.quaternionMultiply=function(t){if(!at(t))throw new Error(`${this.name} Quaternion error - quaternionMultiply() bad argument: ${t}`);let e=this.v,i=t.v,s=this.n,n=e.x,r=e.y,o=e.z,a=t.n,l=i.x,h=i.y,c=i.z;return this.n=s*a-n*l-r*h-o*c,e.x=s*l+n*a+r*c-o*h,e.y=s*h+r*a+o*l-n*c,e.z=s*c+o*a+n*h-r*l,this},Mi.getAngle=function(t){let e;return t=!!dt(t)&&t,e=2*Math.acos(this.n),t&&(e*=1/M),e>-1e-6&&e<1e-6?0:e},Mi.quaternionRotate=function(t){if(!at(t))throw new Error(`${this.name} Quaternion error - quaternionRotate() bad argument: ${t}`);let e=Hi(t),i=Hi(this);return this.setFromQuaternion(e.quaternionMultiply(i)),Bi(e),Bi(i),this};const Ii=[],Hi=function(t){Ii.length||Ii.push(Ti({name:"pool"}));let e=Ii.shift();return e.set(t),e},Bi=function(t){t&&"Quaternion"===t.type&&Ii.push(t.zero())},Ti=function(t){return new Quaternion(t)};function Li(t=Q){(t=qe(t=_e(t=Ze(t=Ve(t=We(t=ze(t))))))).defs=lt(t.defs,{domElement:"",pitch:0,yaw:0,offsetZ:0,css:null,classes:"",position:"absolute",smoothFont:!0,checkForResize:!1,trackHere:"",activePadding:5,includeInTabNavigation:!1,moreContrastAction:null,otherContrastAction:null,reduceMotionAction:null,noPreferenceMotionAction:null,colorSchemeLightAction:null,colorSchemeDarkAction:null,reduceTransparencyAction:null,noPreferenceTransparencyAction:null,reduceDataAction:null,noPreferenceDataAction:null}),t.packetExclusions=ct(t.packetExclusions,["domElement","pathCorners","rotation"]),t.packetFunctions=ct(t.packetFunctions,["onEnter","onLeave","onDown","onUp"]),t.processDOMPacketOut=function(t,e,i){return this.processFactoryPacketOut(t,e,i)},t.processFactoryPacketOut=function(t,e,i){let s=!0;return i.indexOf(t)<0&&e===this.defs[t]&&(s=!1),s},t.finalizePacketOut=function(t,e){if(st(this.domElement)){let e=this.domElement,i=e.cloneNode(!0);i.querySelectorAll('[data-scrawl-corner-div="sc"]').forEach((t=>i.removeChild(t))),t.outerHTML=i.outerHTML,t.host=e.parentElement.id}return t=this.handlePacketAnchor(t,e)},t.postCloneAction=function(t,e){return this.onEnter&&(t.onEnter=this.onEnter),this.onLeave&&(t.onLeave=this.onLeave),this.onDown&&(t.onDown=this.onDown),this.onUp&&(t.onUp=this.onUp),t};let e=t.setters,i=t.deltaSetters;e.trackHere=function(t){var e;dt(t)&&(t?(ct($t,this.name),"local"===t&&(ot(e=this)&&(e.localMouseListener&&e.localMouseListener(),e.here||(e.here={}),e.here.originalWidth=e.currentDimensions[0],e.here.originalHeight=e.currentDimensions[1],e.localMouseListener=bt("move",(function(t){e.here&&(e.here.x=Math.round(parseFloat(t.offsetX)),e.here.y=Math.round(parseFloat(t.offsetY)))}),e.domElement)))):(ut($t,this.name),function(t){ot(t)&&(t.localMouseListener&&t.localMouseListener(),t.localMouseListener=!1)}(this)),this.trackHere=t)},e.position=function(t){this.position=t,this.dirtyPosition=!0},e.smoothFont=function(t){this.smoothFont=t,this.dirtySmoothFont=!0},e.visibility=function(t){this.visibility=t,this.dirtyVisibility=!0},e.offsetZ=function(t){this.offsetZ=t,this.dirtyOffsetZ=!0},i.offsetZ=function(t){this.offsetZ+=t,this.dirtyOffsetZ=!0},e.roll=function(t){this.roll=this.checkRotationAngle(t),this.dirtyRotation=!0},i.roll=function(t){this.roll=this.checkRotationAngle(this.roll+t),this.dirtyRotation=!0},e.pitch=function(t){this.pitch=this.checkRotationAngle(t),this.dirtyRotation=!0},i.pitch=function(t){this.pitch=this.checkRotationAngle(this.pitch+t),this.dirtyRotation=!0},e.yaw=function(t){this.yaw=this.checkRotationAngle(t),this.dirtyRotation=!0},i.yaw=function(t){this.yaw=this.checkRotationAngle(this.yaw+t),this.dirtyRotation=!0},e.css=function(t){this.css=this.css?lt(this.css,t):t,this.dirtyCss=!0},e.classes=function(t){this.classes=t,this.dirtyClasses=!0},e.domAttributes=function(t){this.updateDomAttributes(t)},e.includeInTabNavigation=function(t){const e=this.domElement;e&&(this.includeInTabNavigation=t,t?e.setAttribute("tabindex",0):e.setAttribute("tabindex",-1))},t.checkRotationAngle=function(t){return(t<-180||t>180)&&(t+=t>0?-360:360),t},t.updateDomAttributes=function(t,e){if(this.domElement){let i=this.domElement;t.substring&&dt(e)?e?i.setAttribute(t,e):i.removeAttribute(t):ot(t)&&Object.entries(t).forEach((([t,e])=>{e?i.setAttribute(t,e):i.removeAttribute(t)}))}return this},t.initializeDomLayout=function(t){let e=t.domElement,i=e.style;if(i.boxSizing="border-box",e&&t.setInitialDimensions){let s=e.getBoundingClientRect();e.style.transform,e.style.transformOrigin;let n,r=!1;if(t&&t.host&&(r=t.host,r.substring&&o[r]&&(r=o[r])),this.currentDimensions[0]=s.width,this.currentDimensions[1]=s.height,t.width=s.width,t.height=s.height,e.className&&(t.classes=e.className),r&&r.domElement&&(n=r.domElement.getBoundingClientRect(),n&&(t.startX=s.left-n.left,t.startY=s.top-n.top)),"Stack"===this.type){dt(t.perspective)||dt(t.perspectiveZ)||(t.perspectiveZ=dt(i.perspective)&&i.perspective?parseFloat(i.perspective):0);let e=i.perspectiveOrigin;e.length&&(e=e.split(" "),e.length>0&&!dt(t.perspective)&&!dt(t.perspectiveX)&&(t.perspectiveX=e[0]),dt(t.perspective)||dt(t.perspectiveY)||(e.length>1?t.perspectiveY=e[1]:t.perspectiveY=e[0]))}}},t.addClasses=function(t){if(t.substring){let e=this.classes;e+=` ${t}`,e=e.trim(),e=e.replace(/[\s\uFEFF\xA0]+/g," "),e!==this.classes&&(this.classes=e,this.dirtyClasses=!0)}return this},t.removeClasses=function(t){if(t.substring){let e,i=this.classes;t.split().forEach((t=>{e=new RegExp(" ?"+t+" ?"),i=i.replace(e," "),i=i.trim(),i=i.replace(/[\s\uFEFF\xA0]+/g," ")})),i!==this.classes&&(this.classes=i,this.dirtyClasses=!0)}return this},t.emptyElementTagNames=["AREA","BASE","BR","COL","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR","CANVAS"],t.addPathCorners=function(){if(this.domElement&&!this.noUserInteraction&&this.emptyElementTagNames.indexOf(this.domElement.tagName)<0){let t=function(){let t=document.createElement("div");return t.style.width=0,t.style.height=0,t.style.position="absolute",t.style.margin=0,t.style.border=0,t.style.padding=0,t},e=t(),i=t(),s=t(),n=t();e.style.top="0%",e.style.left="0%",e.setAttribute("data-scrawl-corner-div","sc"),i.style.top="0%",i.style.left="100%",i.setAttribute("data-scrawl-corner-div","sc"),s.style.top="100%",s.style.left="100%",s.setAttribute("data-scrawl-corner-div","sc"),n.style.top="100%",n.style.left="0%",n.setAttribute("data-scrawl-corner-div","sc");let r=this.domElement;r.appendChild(e),r.appendChild(i),r.appendChild(s),r.appendChild(n),this.pathCorners.push(e),this.pathCorners.push(i),this.pathCorners.push(s),this.pathCorners.push(n),this.currentCornersData||(this.currentCornersData=[])}return this},t.checkCornerPositions=function(t){let e=this.pathCorners;if(4===e.length){let i,s=this.getHere(),n=Zt.scrollX-(s.offsetX||0),r=Zt.scrollY-(s.offsetY||0),o=Math.round,a=[];const l=function(t){let e=t[0];e?(a.push(o(e.left+n)),a.push(o(e.top+r))):a.push(0,0)};switch(t){case"topLeft":return i=e[0].getClientRects(),l(i),a;case"topRight":return i=e[1].getClientRects(),l(i),a;case"bottomRight":return i=e[2].getClientRects(),l(i),a;case"bottomLeft":return i=e[3].getClientRects(),l(i),a;default:return e.forEach((t=>{st(t)&&(i=t.getClientRects(),l(i))})),a}}};const s=["topLeft","topRight","bottomRight","bottomLeft"];return t.getCornerCoordinate=function(t){return s.indexOf(t)>=0?this.checkCornerPositions(t):[].concat(this.currentStampPosition)},t.cleanPathObject=function(){if(this.dirtyPathObject=!1,this.domElement&&!this.noUserInteraction)if(this.pathCorners.length||this.addPathCorners(),this.pathCorners.length){this.currentCornersData||(this.currentCornersData=[]);let t=this.currentCornersData;t.length=0,t.push(...this.checkCornerPositions());let e=this.pathObject=new Path2D;e.moveTo(t[0],t[1]),e.lineTo(t[2],t[3]),e.lineTo(t[4],t[5]),e.lineTo(t[6],t[7]),e.closePath()}else{let t=this.pathObject=new Path2D;t.moveTo(0,0),t.lineTo(10,0),t.lineTo(0,10),t.lineTo(-10,0),t.closePath()}},t.checkHit=function(t=[],e){if(this.noUserInteraction)return!1;this.pathObject&&!this.dirtyPathObject||this.cleanPathObject();let i=Array.isArray(t)?t:[t],s=!1;e||(e=requestCell(),s=!0);let n,r,o=e.engine,a=this.currentStampPosition;return a[0],a[1],i.some((t=>{if(Array.isArray(t))n=t[0],r=t[1];else{if(!ft(t,t.x,t.y))return!1;n=t.x,r=t.y}return!(!n.toFixed||!r.toFixed||isNaN(n)||isNaN(r))&&o.isPointInPath(this.pathObject,n,r)}),this)?(s&&releaseCell(e),{x:n,y:r,artefact:this}):(s&&releaseCell(e),!1)},t.cleanRotation=function(){this.dirtyRotation=!1,this.rotation&&at(this.rotation)||(this.rotation=Ti()),this.currentRotation&&at(this.rotation)||(this.currentRotation=Ti());let t=this.rotation;t.setFromEuler({pitch:this.pitch||0,yaw:this.yaw||0,roll:this.roll||0}),1!==t.getMagnitude()&&t.normalize();let e=Hi(),i=this.path,s=this.mimic,n=this.pivot,r=this.lockTo;i&&r.indexOf("path")>=0?e.set(t):s&&this.useMimicRotation&&r.indexOf("mimic")>=0?dt(s.currentRotation)?(e.set(s.currentRotation),this.addOwnRotationToMimic&&e.quaternionRotate(t)):this.dirtyMimicRotation=!0:(e.set(t),n&&this.addPivotRotation&&r.indexOf("pivot")>=0&&(dt(n.currentRotation)?e.quaternionRotate(n.currentRotation):this.dirtyPivotRotation=!0)),this.currentRotation.set(e),Bi(e),this.dirtyPositionSubscribers=!0,this.mimicked&&this.mimicked.length&&(this.dirtyMimicRotation=!0)},t.cleanOffsetZ=function(){this.dirtyOffsetZ=!1},t.cleanContent=function(){this.dirtyContent=!1,this.domElement&&(this.dirtyDimensions=!0)},t.cleanDisplayShape=_,t.cleanDisplayArea=_,t.prepareStamp=function(){(this.dirtyScale||this.dirtyDimensions||this.dirtyStart||this.dirtyOffset||this.dirtyHandle||this.dirtyRotation)&&(this.dirtyPathObject=!0),this.dirtyContent&&this.cleanContent(),this.dirtyScale&&this.cleanScale(),this.dirtyDimensions&&this.cleanDimensions(),this.dirtyDisplayArea&&this.cleanDisplayArea(),this.dirtyDisplayShape&&this.cleanDisplayShape(),this.dirtyLock&&this.cleanLock(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyOffsetZ&&this.cleanOffsetZ(),this.dirtyHandle&&this.cleanHandle(),this.dirtyRotation&&this.cleanRotation(),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0),this.pivoted.length&&(this.dirtyStampPositions=!0),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtyStampHandlePositions&&this.cleanStampHandlePositions(),this.dirtyPathObject&&this.cleanPathObject()},t.stamp=function(){if(!this.domElement)return!1;let t,e,i,s,n,[r,o]=this.currentStampPosition,[a,l]=this.currentStampHandlePosition,h=this.currentScale,c=this.currentRotation,u=`${a}px ${l}px 0`,d=`translate(${r-a}px,${o-l}px)`;(this.yaw||this.pitch||this.roll||this.pivot&&this.addPivotRotation||this.mimic&&this.useMimicRotation||this.path&&this.addPathRotation)&&(t=c.v,e=t.x,i=t.y,s=t.z,n=c.getAngle(!1),d+=` rotate3d(${e},${i},${s},${n}rad)`),this.offsetZ&&(d+=` translateZ(${this.offsetZ}px)`),1!==h&&(d+=` scale(${h},${h})`),d!==this.currentTransformString&&(this.currentTransformString=d,this.dirtyTransform=!0),u!==this.currentTransformOriginString&&(this.currentTransformOriginString=u,this.dirtyTransformOrigin=!0),(this.dirtyTransform||this.dirtyPerspective||this.dirtyPosition||this.dirtyDomDimensions||this.dirtyTransformOrigin||this.dirtyVisibility||this.dirtySmoothFont||this.dirtyCss||this.dirtyClasses||this.domShowRequired)&&(this.domShowRequired=!1,Ss(this.name),As(!0)),this.dirtyPositionSubscribers&&this.updatePositionSubscribers(),(this.dirtyMimicRotation||this.dirtyPivotRotation)&&(this.dirtyMimicRotation=!1,this.dirtyPivotRotation=!1,this.dirtyRotation=!0),this.dirtyMimicScale&&(this.dirtyMimicScale=!1,this.dirtyScale=!0)},t.initializeAccessibility=function(){this.reduceMotionAction=_,this.noPreferenceMotionAction=_,this.colorSchemeLightAction=_,this.colorSchemeDarkAction=_,this.reduceTransparencyAction=_,this.noPreferenceTransparencyAction=_,this.reduceDataAction=_,this.noPreferenceDataAction=_,this.moreContrastAction=_,this.otherContrastAction=_},e.moreContrastAction=function(t){nt(t)&&(this.moreContrastAction=t)},t.setMoreContrastAction=function(t){nt(t)&&(this.moreContrastAction=t)},e.otherContrastAction=function(t){nt(t)&&(this.otherContrastAction=t)},t.setOtherContrastAction=function(t){nt(t)&&(this.otherContrastAction=t)},t.contrastActions=function(){const t=this.here;if(dt(t)){const e=t.prefersContrast;dt(e)&&(e?this.moreContrastAction():this.otherContrastAction())}},e.reduceMotionAction=function(t){nt(t)&&(this.reduceMotionAction=t)},t.setReduceMotionAction=function(t){nt(t)&&(this.reduceMotionAction=t)},e.noPreferenceMotionAction=function(t){nt(t)&&(this.noPreferenceMotionAction=t)},t.setNoPreferenceMotionAction=function(t){nt(t)&&(this.noPreferenceMotionAction=t)},t.reducedMotionActions=function(){const t=this.here;if(dt(t)){const e=t.prefersReducedMotion;dt(e)&&(e?this.reduceMotionAction():this.noPreferenceMotionAction())}},e.colorSchemeLightAction=function(t){nt(t)&&(this.colorSchemeLightAction=t)},t.setColorSchemeLightAction=function(t){nt(t)&&(this.colorSchemeLightAction=t)},e.colorSchemeDarkAction=function(t){nt(t)&&(this.colorSchemeDarkAction=t)},t.setColorSchemeDarkAction=function(t){nt(t)&&(this.colorSchemeDarkAction=t)},t.colorSchemeActions=function(){const t=this.here;if(dt(t)){const e=t.prefersDarkColorScheme;dt(e)&&(e?this.colorSchemeDarkAction():this.colorSchemeLightAction())}},e.reduceTransparencyAction=function(t){nt(t)&&(this.reduceTransparencyAction=t)},t.setReduceTransparencyAction=function(t){nt(t)&&(this.reduceTransparencyAction=t)},e.noPreferenceTransparencyAction=function(t){nt(t)&&(this.noPreferenceTransparencyAction=t)},t.setNoPreferenceTransparencyAction=function(t){nt(t)&&(this.noPreferenceTransparencyAction=t)},t.reducedTransparencyActions=function(){const t=this.here;if(dt(t)){const e=t.prefersReduceTransparency;dt(e)&&(e?this.reduceTransparencyAction():this.noPreferenceTransparencyAction())}},e.reduceDataAction=function(t){nt(t)&&(this.reduceDataAction=t)},t.setReduceDataAction=function(t){nt(t)&&(this.reduceDataAction=t)},e.noPreferenceDataAction=function(t){nt(t)&&(this.noPreferenceDataAction=t)},t.setNoPreferenceDataAction=function(t){nt(t)&&(this.noPreferenceDataAction=t)},t.reducedDataActions=function(){const t=this.here;if(dt(t)){const e=t.prefersReduceData;dt(e)&&(e?this.reduceDataAction():this.noPreferenceDataAction())}},t.checkAccessibilityValues=function(){this.contrastActions(),this.reducedMotionActions(),this.colorSchemeActions(),this.reducedTransparencyActions(),this.reducedDataActions()},t.apply=function(){fe(),this.prepareStamp(),this.stamp(),Os(this.name),this.dirtyPathObject=!0,this.cleanPathObject()},t}function $i(t=Q){let e={breakToBanner:3,breakToLandscape:1.5,breakToPortrait:.65,breakToSkyscraper:.35,actionBannerShape:null,actionLandscapeShape:null,actionRectangleShape:null,actionPortraitShape:null,actionSkyscraperShape:null,breakToSmallest:2e4,breakToSmaller:8e4,breakToLarger:18e4,breakToLargest:32e4,actionSmallestArea:null,actionSmallerArea:null,actionRegularArea:null,actionLargerArea:null,actionLargestArea:null};t.defs=lt(t.defs,e),lt(t,e),t.packetFunctions=ct(t.packetFunctions,["actionBannerShape","actionLandscapeShape","actionRectangleShape","actionPortraitShape","actionSkyscraperShape"]);let i=t.getters,s=t.setters;return i.displayShape=function(){return this.currentDisplayShape},i.displayShapeBreakpoints=function(){return{breakToBanner:this.breakToBanner,breakToLandscape:this.breakToLandscape,breakToPortrait:this.breakToPortrait,breakToSkyscraper:this.breakToSkyscraper,breakToSmallest:this.breakToSmallest,breakToSmaller:this.breakToSmaller,breakToLarger:this.breakToLarger,breakToLargest:this.breakToLargest}},s.displayShapeBreakpoints=function(t=Q){for(let[e,i]of Object.entries(t))if(rt(i))switch(e){case"breakToBanner":this.breakToBanner=i;break;case"breakToLandscape":this.breakToLandscape=i;break;case"breakToPortrait":this.breakToPortrait=i;break;case"breakToSkyscraper":this.breakToSkyscraper=i;break;case"breakToSmallest":this.breakToSmallest=i;break;case"breakToSmaller":this.breakToSmaller=i;break;case"breakToLarger":this.breakToLarger=i;break;case"breakToLargest":this.breakToLargest=i}this.dirtyDisplayShape=!0,this.dirtyDisplayArea=!0},t.setDisplayShapeBreakpoints=s.displayShapeBreakpoints,s.breakToBanner=function(t){rt(t)&&(this.breakToBanner=t),this.dirtyDisplayShape=!0},s.breakToLandscape=function(t){rt(t)&&(this.breakToLandscape=t),this.dirtyDisplayShape=!0},s.breakToPortrait=function(t){rt(t)&&(this.breakToPortrait=t),this.dirtyDisplayShape=!0},s.breakToSkyscraper=function(t){rt(t)&&(this.breakToSkyscraper=t),this.dirtyDisplayShape=!0},s.breakToSmallest=function(t){rt(t)&&(this.breakToSmallest=t),this.dirtyDisplayArea=!0},s.breakToSmaller=function(t){rt(t)&&(this.breakToSmaller=t),this.dirtyDisplayArea=!0},s.breakToLarger=function(t){rt(t)&&(this.breakToLarger=t),this.dirtyDisplayArea=!0},s.breakToLargest=function(t){rt(t)&&(this.breakToLargest=t),this.dirtyDisplayArea=!0},s.actionBannerShape=function(t){nt(t)&&(this.actionBannerShape=t),this.dirtyDisplayShape=!0},t.setActionBannerShape=s.actionBannerShape,s.actionLandscapeShape=function(t){nt(t)&&(this.actionLandscapeShape=t),this.dirtyDisplayShape=!0},t.setActionLandscapeShape=s.actionLandscapeShape,s.actionRectangleShape=function(t){nt(t)&&(this.actionRectangleShape=t),this.dirtyDisplayShape=!0},t.setActionRectangleShape=s.actionRectangleShape,s.actionPortraitShape=function(t){nt(t)&&(this.actionPortraitShape=t),this.dirtyDisplayShape=!0},t.setActionPortraitShape=s.actionPortraitShape,s.actionSkyscraperShape=function(t){nt(t)&&(this.actionSkyscraperShape=t),this.dirtyDisplayShape=!0},t.setActionSkyscraperShape=s.actionSkyscraperShape,s.actionSmallestArea=function(t){nt(t)&&(this.actionSmallestArea=t),this.dirtyDisplayArea=!0},t.setActionSmallestArea=s.actionSmallestArea,s.actionSmallerArea=function(t){nt(t)&&(this.actionSmallerArea=t),this.dirtyDisplayArea=!0},t.setActionSmallerArea=s.actionSmallerArea,s.actionRegularArea=function(t){nt(t)&&(this.actionRegularArea=t),this.dirtyDisplayArea=!0},t.setActionRegularArea=s.actionRegularArea,s.actionLargerArea=function(t){nt(t)&&(this.actionLargerArea=t),this.dirtyDisplayArea=!0},t.setActionLargerArea=s.actionLargerArea,s.actionLargestArea=function(t){nt(t)&&(this.actionLargestArea=t),this.dirtyDisplayArea=!0},t.setActionLargestArea=s.actionLargestArea,t.initializeDisplayShapeActions=function(){this.actionBannerShape=_,this.actionLandscapeShape=_,this.actionRectangleShape=_,this.actionPortraitShape=_,this.actionSkyscraperShape=_,this.currentDisplayShape="",this.dirtyDisplayShape=!0,this.actionSmallestArea=_,this.actionSmallerArea=_,this.actionRegularArea=_,this.actionLargerArea=_,this.actionLargestArea=_,this.currentDisplayArea="",this.dirtyDisplayArea=!0},t.cleanDisplayShape=function(){this.dirtyDisplayShape=!1;let[t,e]=this.currentDimensions;if(t>0&&e>0){let i=t/e,s=this.currentDisplayShape,n=this.breakToBanner,r=this.breakToLandscape,o=this.breakToPortrait,a=this.breakToSkyscraper;return i>n?"banner"!==s&&(this.currentDisplayShape="banner",this.actionBannerShape(),!0):i>r?"landscape"!==s&&(this.currentDisplayShape="landscape",this.actionLandscapeShape(),!0):i<a?"skyscraper"!==s&&(this.currentDisplayShape="skyscraper",this.actionSkyscraperShape(),!0):i<o?"portrait"!==s&&(this.currentDisplayShape="portrait",this.actionPortraitShape(),!0):"rectangle"!==s&&(this.currentDisplayShape="rectangle",this.actionRectangleShape(),!0)}return this.dirtyDisplayShape=!0,!1},t.cleanDisplayArea=function(){this.dirtyDisplayArea=!1;let[t,e]=this.currentDimensions;if(t>0&&e>0){let i=t*e,s=this.currentDisplayArea,n=this.breakToLargest,r=this.breakToLarger,o=this.breakToSmaller,a=this.breakToSmallest;return i>n?"largest"!==s&&(this.currentDisplayArea="largest",this.actionLargestArea(),!0):i>r?"larger"!==s&&(this.currentDisplayArea="larger",this.actionLargerArea(),!0):i<a?"smallest"!==s&&(this.currentDisplayArea="smallest",this.actionSmallestArea(),!0):i<o?"smaller"!==s&&(this.currentDisplayArea="smaller",this.actionSmallerArea(),!0):"regular"!==s&&(this.currentDisplayArea="regular",this.actionRegularArea(),!0)}return this.dirtyDisplayArea=!0,!1},t.updateDisplayShape=function(){this.currentDisplayShape="",this.dirtyDisplayShape=!0},t.updateDisplayArea=function(){this.currentDisplayArea="",this.dirtyDisplayArea=!0},t.updateDisplay=function(){this.updateDisplayShape(),this.updateDisplayArea()},t}E.Quaternion=Quaternion;const Canvas=function(t=Q){let e;if(this.makeName(t.name),this.register(),this.initializePositions(),this.dimensions[0]=300,this.dimensions[1]=150,this.pathCorners=[],this.css={},this.here={},this.perspective={x:"50%",y:"50%",z:0},this.dirtyPerspective=!0,this.initializeDomLayout(t),this.set(this.defs),t.label||(t.label=`${this.name} canvas element`),this.initializeDisplayShapeActions(),this.initializeAccessibility(),this.set(t),this.cleanDimensions(),e=this.domElement,e){this.engine=this.domElement.getContext("2d"),this.state=Ce({engine:this.engine}),this.cells=[],this.cellBatchesClear=[],this.cellBatchesCompile=[],this.cellBatchesShow=[];let t=this.currentDimensions[0],i=this.currentDimensions[1];const s=e.dataset;if(s.isResponsive){e.style.width="100%",e.style.height="100%";let n=!0;s.baseWidth&&s.baseHeight&&(n=!1,t=parseFloat(s.baseWidth),i=parseFloat(s.baseHeight)),this.set({checkForResize:!0,baseMatchesCanvasDimensions:n,ignoreCanvasCssDimensions:!0,fit:s.fit||this.fit}),this.cleanDimensions()}const n={name:`${this.name}_base`,element:!1,width:t,height:i,cleared:!0,compiled:!0,shown:!1,isBase:!0,host:this.name,controller:this,order:10};s.baseClearAlpha&&(n.clearAlpha=parseFloat(s.baseClearAlpha)),s.baseBackgroundColor&&(n.backgroundColor=s.baseBackgroundColor),this.base=this.buildCell(n),ct(Qi,this.name),Ji();const r=document.createElement("nav");r.id=`${this.name}-navigation`,r.style.width="0px",r.style.height="0px",r.style.maxWidth="0px",r.style.maxHeight="0px",r.style.border="0px",r.style.padding="0px",r.style.margin="0px",r.style.overflow="hidden",this.navigation=r,e.appendChild(r);const o=document.createElement("div");o.id=`${this.name}-text-hold`,o.style.width="0px",o.style.height="0px",o.style.maxWidth="0px",o.style.maxHeight="0px",o.style.border="0px",o.style.padding="0px",o.style.margin="0px",o.style.overflow="hidden",this.textHold=o,e.appendChild(o);const a=document.createElement("div");a.id=`${this.name}-ARIA-label`,a.textContent=this.label,this.ariaLabelElement=a,ws.appendChild(a),e.setAttribute("aria-labelledby",a.id),e.setAttribute("aria-live","polite");const l=document.createElement("div");l.id=`${this.name}-ARIA-description`,l.textContent=this.description,this.ariaDescriptionElement=l,ws.appendChild(l),e.setAttribute("aria-describedby",l.id),e.setAttribute("aria-live","polite"),this.cleanAria()}else this.cleanDimensions();return this.dirtyCells=!0,this.apply(),this.dirtyDomDimensions=!0,t.setAsCurrentCanvas&&this.setAsCurrentCanvas(),this};let ji=Canvas.prototype=Object.create(Object.prototype);ji.type="Canvas",ji.lib="canvas",ji.isArtefact=!0,ji.isAsset=!1,ji=Bt(ji),ji=Li(ji),ji=$i(ji);ji.defs=lt(ji.defs,{position:"relative",trackHere:"subscribe",fit:"none",isComponent:!1,baseMatchesCanvasDimensions:!1,renderOnResize:!0,ignoreCanvasCssDimensions:!1,title:"",label:"",description:"",role:"img"}),ji.stringifyFunction=_,ji.processPacketOut=_,ji.finalizePacketOut=_,ji.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},ji.clone=K,ji.factoryKill=function(){let t,e,i=this.name,s=this.host;ut(Qi,i),Ji(),ut($t,i),s&&"root"!==s&&(t=this.currentHost?this.currentHost:o[s],t&&(t.removeGroups(i),e=g[t.name],e&&e.removeArtefacts(i))),g[i]&&g[i].kill(),this.base.kill(),this.navigation.remove(),this.textHold.remove(),this.ariaLabelElement.remove(),this.ariaDescriptionElement.remove(),this.domElement.remove()};let Xi=ji.getters,Yi=ji.setters,Ni=ji.deltaSetters;ji.fitDefaults=["fill","contain","cover"],Yi.fit=function(t){this.fit=this.fitDefaults.indexOf(t)>=0?t:"none"},Yi.title=function(t){this.title=t,this.dirtyAria=!0},Yi.label=function(t){this.label=t,this.dirtyAria=!0},Yi.description=function(t){this.description=t,this.dirtyAria=!0},Yi.role=function(t){this.role=t,this.dirtyAria=!0},Xi.backgroundColor=function(){return this.base.backgroundColor},Yi.backgroundColor=function(t){this.base&&this.base.set({backgroundColor:t})},Xi.alpha=function(){return this.base.alpha},Yi.alpha=function(t){this.base&&this.base.set({alpha:t})},Ni.alpha=function(t){this.base&&this.base.deltaSet({alpha:t})},Xi.composite=function(){return this.base.composite},Yi.composite=function(t){this.base&&this.base.set({composite:t})},Yi.checkForEntityHover=function(t){this.base.set({checkForEntityHover:t})},Yi.onEntityHover=function(t){this.base.set({onEntityHover:t})},Yi.onEntityNoHover=function(t){this.base.set({onEntityNoHover:t})},Xi.baseGroup=function(){return g[this.base.name]},Xi.baseName=function(){return this.base.name},ji.setAsCurrentCanvas=function(){return this.base&&cs(this),this},ji.setBase=function(t){return this.base&&(this.base.set(t),this.setBaseHelper()),this},ji.deltaSetBase=function(t){return this.base&&(this.base.deltaSet(t),this.setBaseHelper()),this},ji.updateBaseHere=function(){this.base&&this.base.updateBaseHere(this.here,this.fit)},ji.setBaseHelper=function(){let t={};this.base.dirtyScale&&(t.dirtyScale=!0),this.base.dirtyDimensions&&(t.dirtyDimensions=!0),this.base.dirtyLock&&(t.dirtyLock=!0),this.base.dirtyStart&&(t.dirtyStart=!0),this.base.dirtyOffset&&(t.dirtyOffset=!0),this.base.dirtyHandle&&(t.dirtyHandle=!0),this.base.dirtyRotation&&(t.dirtyRotation=!0),this.cleanCells(),this.base.prepareStamp(),this.updateCells(t)},ji.updateCells=function(t=Q){const e=this.cells;for(let i,s=0,n=e.length;s<n;s++)i=u[e[s]],i&&(t.dirtyScale&&(i.dirtyScale=!0),t.dirtyDimensions&&(i.dirtyDimensions=!0),t.dirtyLock&&(i.dirtyLock=!0),t.dirtyStart&&(i.dirtyStart=!0),t.dirtyOffset&&(i.dirtyOffset=!0),t.dirtyHandle&&(i.dirtyHandle=!0),t.dirtyRotation&&(i.dirtyRotation=!0))},ji.buildCell=function(t=Q){t.host||!1||(t.host=this.base.name);let e=hi(t);return this.addCell(e),this.cleanCells(),e},ji.cleanDimensionsAdditionalActions=function(){this.cells&&this.updateCells({dirtyDimensions:!0}),this.dirtyDomDimensions=!0,this.dirtyDisplayShape=!0,this.dirtyDisplayArea=!0},ji.addCell=function(t){if(t=t.substring?t:t.name||!1){const e=u[t];e&&(this.base&&(e.host=this.base.name,e.currentHost=null),e.prepareStamp(),ct(this.cells,t),this.dirtyCells=!0)}return this},ji.removeCell=function(t){return(t=t.substring?t:t.name||!1)&&(ut(this.cells,t),this.dirtyCells=!0),this},ji.killCell=function(t){let e=t.substring?u[t]:t;return e&&e.kill(),this.dirtyCells=!0,this},ji.clear=function(){this.dirtyCells&&this.cleanCells(),this.base&&this.base.dirtyDimensions&&this.base.cleanDimensions();const t=this.cellBatchesClear;for(let e=0,i=t.length;e<i;e++)t[e].clear()},ji.compile=function(){this.dirtyCells&&this.cleanCells(),this.base&&this.base.dirtyDimensions&&this.base.cleanDimensions();const t=this.cellBatchesCompile;for(let e=0,i=t.length;e<i;e++)t[e].compile();this.prepareStamp(),this.stamp()},ji.show=function(){this.dirtyCells&&this.cleanCells(),this.base&&this.base.dirtyDimensions&&this.base.cleanDimensions();const t=this.cellBatchesShow;for(let e=0,i=t.length;e<i;e++)t[e].show();this.base.show(),Os(),this.dirtyAria&&this.cleanAria()},ji.render=function(){this.clear(),this.compile(),this.show()},ji.cleanCells=function(){this.dirtyCells=!1;let t,e=[],i=[],s=[],n=this.cells;for(let r,o=0,a=n.length;o<a;o++)r=u[n[o]],r&&(r.cleared&&e.push(r),r.compiled&&(t=r.compileOrder,i[t]||(i[t]=[]),i[t].push(r)),r.shown&&(t=r.showOrder,s[t]||(s[t]=[]),s[t].push(r)));this.cellBatchesClear=[].concat(e),this.cellBatchesCompile=i.reduce(((t,e)=>t.concat(e)),[]),this.cellBatchesShow=s.reduce(((t,e)=>t.concat(e)),[])},ji.cascadeEventAction=function(t,e={}){this.currentActiveEntityNames||(this.currentActiveEntityNames=[]);let i,s,n,r,a,l,h=this.currentActiveEntityNames,c=[],d=[],f=[],p=[],m=[],g=[];const y=this.cells;for(i=0,s=y.length;i<s;i++)n=u[y[i]],n&&(n.shown||n.isBase||n.includeInCascadeEventActions)&&c.push(n.getEntityHits());for(c=c.reduce(((t,e)=>t.concat(e)),[]),i=0,s=c.length;i<s;i++)r=c[i],a=r.name,d.indexOf(a)<0&&(d.push(a),h.indexOf(a)<0?(f.push(r),p.push(a)):(m.push(r),g.push(a)));let b=f.concat(m),S=function(t){if(h.length){for(i=0,s=p.length;i<s;i++)ut(h,p[i]);for(i=0,s=g.length;i<s;i++)ut(h,g[i]);for(i=0,s=h.length;i<s;i++)l=o[h[i]],l&&l.onLeave(t)}};const k=b.length,A=f.length;switch(t){case"down":for(i=0;i<k;i++)b[i].onDown(e);break;case"up":for(i=0;i<k;i++)b[i].onUp(e);break;case"enter":for(i=0;i<A;i++)f[i].onEnter(e);break;case"leave":S(e);break;case"move":for(S(e),i=0;i<A;i++)f[i].onEnter(e)}return this.currentActiveEntityNames=p.concat(g),this.currentActiveEntityNames},ji.getEntityHits=function(){return this.cascadeEventAction()},ji.checkHover=function(){this.cascadeEventAction()},ji.cleanAria=function(){this.dirtyAria=!1,this.domElement.setAttribute("title",this.title),this.domElement.setAttribute("role",this.role),this.ariaLabelElement.textContent=this.label,this.ariaDescriptionElement.textContent=this.description};const Gi=function(t){return!!t&&new Canvas(t)};E.Canvas=Canvas;const Element=function(t=Q){let e=t.domElement;return this.makeName(t.name),this.register(),e&&(t.text?e.textContent=t.text:t.content&&(e.innerHTML=t.content)),this.initializePositions(),this.dimensions[0]=this.dimensions[1]=100,this.pathCorners=[],this.css={},this.here={},this.initializeDomLayout(t),this.set(this.defs),this.initializeAccessibility(),this.set(t),e=this.domElement,e&&(e.id=this.name),this.apply(),this};let zi=Element.prototype=Object.create(Object.prototype);zi.type="Element",zi.lib="element",zi.isArtefact=!0,zi.isAsset=!1,zi=Bt(zi),zi=Li(zi),zi.factoryKill=function(){ut($t,this.name),this.domElement.remove()};let Wi=zi.setters;Wi.text=function(t){if(st(this.domElement)){let e=this.domElement,i=e.querySelectorAll('[data-scrawl-corner-div="sc"]');e.textContent=t,i.forEach((t=>e.appendChild(t))),this.dirtyContent=!0}},Wi.content=function(t){if(this.domElement){let e=this.domElement,i=e.querySelectorAll('[data-scrawl-corner-div="sc"]');e.innerHTML=t,i.forEach((t=>e.appendChild(t))),this.dirtyContent=!0}},zi.cleanDimensionsAdditionalActions=function(){this.dirtyDomDimensions=!0},zi.addCanvas=function(t=Q){if(this.canvas)return this.canvas;{let e=document.createElement("canvas"),i=this.domElement;e.id=`${this.name}-canvas`;let s=i.getBoundingClientRect();window.getComputedStyle(i),i.parentNode.insertBefore(e,this.domElement);let n=Gi({name:`${this.name}-canvas`,domElement:e,position:"absolute",width:s.width,height:s.height,mimic:this.name,lockTo:"mimic",useMimicDimensions:!0,useMimicScale:!0,useMimicStart:!0,useMimicHandle:!0,useMimicOffset:!0,useMimicRotation:!0,addOwnDimensionsToMimic:!1,addOwnScaleToMimic:!1,addOwnStartToMimic:!1,addOwnHandleToMimic:!1,addOwnOffsetToMimic:!1,addOwnRotationToMimic:!1});return n.set(t),this.canvas=n,n}};const Vi=function(t){return!!t&&new Element(t)};E.Element=Element;const Stack=function(t=Q){let e,i;if(this.makeName(t.name),this.register(),this.initializePositions(),this.initializeCascade(),this.dimensions[0]=300,this.dimensions[1]=150,this.pathCorners=[],this.css={},this.here={},this.perspective={x:"50%",y:"50%",z:0},this.dirtyPerspective=!0,this.initializeDomLayout(t),e=xi({name:this.name,host:this.name}),this.addGroups(e.name),this.set(this.defs),this.initializeDisplayShapeActions(),this.initializeAccessibility(),this.set(t),i=this.domElement,i){i.dataset.isResponsive&&(this.isResponsive=!0),"root"===i.getAttribute("data-scrawl-group")&&(ct(Qi,this.name),Ji())}return this};let Zi=Stack.prototype=Object.create(Object.prototype);Zi.type="Stack",Zi.lib="stack",Zi.isArtefact=!0,Zi.isAsset=!1,Zi=Bt(Zi),Zi=Qe(Zi),Zi=Li(Zi),Zi=$i(Zi);Zi.defs=lt(Zi.defs,{position:"relative",perspective:null,trackHere:"subscribe",isResponsive:!1,containElementsInHeight:!1}),Zi.stringifyFunction=_,Zi.processPacketOut=_,Zi.finalizePacketOut=_,Zi.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},Zi.clone=K,Zi.factoryKill=function(){let t=this.name;ut(Qi,t),Ji(),ut($t,t),g[t]&&g[t].kill(),Object.entries(o).forEach((([e,i])=>{i.host===t&&i.kill()})),this.domElement.remove()};let _i=Zi.getters,Ui=Zi.setters,Ki=Zi.deltaSetters;_i.perspectiveX=function(){return this.perspective.x},_i.perspectiveY=function(){return this.perspective.y},_i.perspectiveZ=function(){return this.perspective.z},Ui.perspectiveX=function(t){this.perspective.x=t,this.dirtyPerspective=!0},Ui.perspectiveY=function(t){this.perspective.y=t,this.dirtyPerspective=!0},Ui.perspectiveZ=function(t){this.perspective.z=t,this.dirtyPerspective=!0},Ui.perspective=function(t=Q){this.perspective.x=dt(t.x)?t.x:this.perspective.x,this.perspective.y=dt(t.y)?t.y:this.perspective.y,this.perspective.z=dt(t.z)?t.z:this.perspective.z,this.dirtyPerspective=!0},Ki.perspectiveX=function(t){this.perspective.x=z(this.perspective.x,t),this.dirtyPerspective=!0},Ki.perspectiveY=function(t){this.perspective.y=z(this.perspective.y,t),this.dirtyPerspective=!0},_i.group=function(){return g[this.name]},Zi.updateArtefacts=function(t=Q){this.groupBuckets.forEach((e=>{e.artefactCalculateBuckets.forEach((e=>{t.dirtyScale&&(e.dirtyScale=!0),t.dirtyDimensions&&(e.dirtyDimensions=!0),t.dirtyLock&&(e.dirtyLock=!0),t.dirtyStart&&(e.dirtyStart=!0),t.dirtyOffset&&(e.dirtyOffset=!0),t.dirtyHandle&&(e.dirtyHandle=!0),t.dirtyRotation&&(e.dirtyRotation=!0),t.dirtyPathObject&&(e.dirtyPathObject=!0)}))}))},Zi.cleanDimensionsAdditionalActions=function(){this.groupBuckets&&this.updateArtefacts({dirtyDimensions:!0,dirtyPath:!0,dirtyStart:!0,dirtyHandle:!0}),this.dirtyDomDimensions=!0,this.dirtyPath=!0,this.dirtyStart=!0,this.dirtyHandle=!0,this.dirtyDisplayShape=!0,this.dirtyDisplayArea=!0},Zi.cleanPerspective=function(){this.dirtyPerspective=!1;let t=this.perspective;this.domPerspectiveString=`perspective-origin: ${t.x} ${t.y}; perspective: ${t.z}px;`,this.domShowRequired=!0,this.groupBuckets&&this.updateArtefacts({dirtyHandle:!0,dirtyPathObject:!0})},Zi.checkResponsive=function(){this.isResponsive&&this.trackHere&&(this.currentVportWidth||(this.currentVportWidth=Zt.w),this.currentVportHeight||(this.currentVportHeight=Zt.h),this.dirtyHeight&&this.containElementsInHeight&&(this.dirtyHeight=!1),this.currentVportWidth!==Zt.w&&(this.currentVportWidth=Zt.w,this.containElementsInHeight&&(this.dirtyHeight=!0)),this.currentVportHeight!==Zt.h&&(this.currentVportHeight=Zt.h))},Zi.clear=function(){this.checkResponsive()},Zi.compile=function(){this.sortGroups(),this.prepareStamp(),this.stamp(),this.groupBuckets.forEach((t=>t.stamp()))},Zi.show=function(){Os()},Zi.render=function(){this.compile(),this.show()},Zi.addExistingDomElements=function(t){let e,i,s,n,r;if(dt(t))for(e=t.substring?document.querySelectorAll(t):[].concat(t),n=0,r=e.length;n<r;n++)i=e[n],st(i)&&(s=Vi({name:i.id||i.name,domElement:i,group:this.name,host:this.name,position:"absolute",setInitialDimensions:!0}),s&&s.domElement&&this.domElement.appendChild(s.domElement));return this},Zi.addNewElement=function(t){if(t&&t.tag){t.domElement=document.createElement(t.tag),t.domElement.setAttribute("data-scrawl-group",this.name),dt(t.group)||(t.group=this.name),t.host=this.name,t.position||(t.position="absolute"),t.dimensions&&Array.isArray(t.dimensions)&&(t.width=t.dimensions[0]||100,t.height=t.dimensions[1]||100),dt(t.width)||(t.width=100),dt(t.height)||(t.height=100);let e=Vi(t);return e&&e.domElement&&(dt(t.boxSizing)||(e.domElement.style.boxSizing="border-box"),this.domElement.appendChild(e.domElement)),e}return!1};const qi=function(t){return!!t&&new Stack(t)};E.Stack=Stack;let Qi=[],Ji=()=>{es=!0},ts=[],es=!0;const is=function(t){let e=t.getAttribute("data-scrawl-group"),i=t.id||t.getAttribute("name"),s="absolute";e||(t.setAttribute("data-scrawl-group","root"),e="root",s="relative"),i||(i=J(),t.id=i);let n=qi({name:i,domElement:t,group:e,host:e,position:s,setInitialDimensions:!0});return ss(t,i),n},ss=function(t,e){let i=t.getBoundingClientRect(),s=0;Array.from(t.children).forEach((t=>{if(null!=t.getAttribute("data-scrawl-stack")||it(t)||"SCRIPT"===t.tagName)t.setAttribute("data-scrawl-group",e);else{let n=t.getBoundingClientRect(),r=window.getComputedStyle(t),o=parseFloat(r.marginTop)+parseFloat(r.borderTopWidth)+parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)+parseFloat(r.borderBottomWidth)+parseFloat(r.marginBottom);s=s||n.top-i.top;let a={name:t.id||t.getAttribute("name"),domElement:t,group:e,host:e,position:"absolute",width:n.width,height:n.height,startX:n.left-i.left,startY:s,classes:t.className?t.className:""};s+=o+n.height,Vi(a)}}))},ns=function(t=Q){let e,i,s,n,r,a,l="absolute";return e=t.element&&t.element.substring?document.querySelector(t.element):st(t.element)?t.element:document.createElement("div"),t.host&&t.host.substring?(i=document.querySelector(t.host),i||(i=document.body)):i=st(t.host)?t.host:dt(e.parentElement)?e.parentElement:document.body,dt(t.width)&&(e.style.width=t.width.toFixed?`${t.width}px`:t.width),dt(t.height)&&(e.style.height=t.height.toFixed?`${t.height}px`:t.height),a=t.name||e.id||e.getAttribute("name")||"",a||(a=J()),e.id=a,e.setAttribute("data-scrawl-stack","data-scrawl-stack"),i&&null!=i.getAttribute("data-scrawl-stack")?(s=o[i.id],r=s?s.name:"root"):r="root",e.setAttribute("data-scrawl-group",r),"root"===r&&(l="relative"),e.parentElement&&i.id===e.parentElement.id||i.appendChild(e),n=qi({name:a,domElement:e,group:r,host:r,position:l,setInitialDimensions:!0}),ss(e,a),Array.from(e.childNodes).forEach((t=>{t.id&&Qi.indexOf(t.id)>=0&&ut(Qi,t.id)})),delete t.name,delete t.element,delete t.host,delete t.width,delete t.height,n.set(t),es=!0,n},rs=function(t){let e=t.getAttribute("data-scrawl-group"),i=t.id||t.getAttribute("name"),s="absolute";return e||(t.setAttribute("data-scrawl-group","root"),e="root",s=t.style.position),i||(i=J(),t.id=i),Gi({name:i,domElement:t,group:e,host:e,position:s,setInitialDimensions:!0})},os=function(t){let e=document.querySelector(t),i=!1;return e&&(i=rs(e)),cs(i),i},as=function(t){let e,i=document.querySelector(t);return i&&(e=is(i)),e};let ls=null,hs=null;const cs=function(t){let e=!1;if(t)if(t.substring){let i=c[t];i&&(ls=i,e=!0)}else"Canvas"===t.type&&(ls=t,e=!0);if(e&&ls.base){let t=g[ls.base.name];t&&(hs=t)}},us=function(t=Q){let e=document.createElement("canvas"),i=t.name?t.name:J(),s=t.host,n="root",r=t.width||300,a=t.height||150,l="relative";if(s.substring){let t=o[s];!t&&s?(s=document.querySelector(s),s&&(n=s.id)):s=t}s?"Stack"===s.type?(n=s.name,l="absolute",s=s.domElement):st(s)||(s=document.body):s=document.body,e.id=i,e.setAttribute("data-scrawl-group",n),e.width=r,e.height=a,e.style.position=l,s.appendChild(e);let h=Gi({name:i,domElement:e,group:n,host:n,position:l,setInitialDimensions:!1,setAsCurrentCanvas:!dt(t.setAsCurrentCanvas)||t.setAsCurrentCanvas,trackHere:dt(t.trackHere)?t.trackHere:"subscribe"});return delete t.group,delete t.host,delete t.name,delete t.element,delete t.position,delete t.setInitialDimensions,delete t.setAsCurrentCanvas,delete t.trackHere,h.set(t),h},ds=function(...t){gs(t),ys("clear")},fs=function(...t){gs(t),ys("compile")},ps=function(...t){gs(t),ys("show")},ms=function(...t){gs(t),ys("render")},gs=function(t){t.length?ts=t:es&&function(){let t=Math.floor;if(es){es=!1;let e,i,s,n,r,a=[];for(s=0,n=Qi.length;s<n;s++)r=Qi[s],e=o[r],e&&(i=t(e.order)||0,a[i]||(a[i]=[]),a[i].push(e.name));ts=a.reduce(((t,e)=>t.concat(e)),[])}}()},ys=function(t){let e,i,s,n;for(e=0,i=ts.length;e<i;e++)s=ts[e],n=o[s],n&&n[t]&&n[t]()},bs=[],Ss=function(t=""){if(!t)throw new Error(`core/document addDomShowElement() error - false argument supplied: ${t}`);if(!t.substring)throw new Error(`core/document addDomShowElement() error - argument not a string: ${t}`);ct(bs,t)};let ks=!1;const As=function(t=!0){ks=t},Os=function(t=""){if(ks||t){let e,i,s,n,r,a,l,h,c,u,d,f,p,m,g,y,b,S;t?e=[t]:(ks=!1,e=[].concat(bs),bs.length=0);let k=Mt(),A=Ft();for(i=0,s=e.length;i<s;i++){if(n=e[i],r=o[n],!r)throw new Error(`core/document domShow() error - artefact missing: ${n}`);if(a=r.domElement,!a)throw new Error(`core/document domShow() error - DOM element missing: ${n}`);if(l=a.style,r.dirtyPerspective&&(r.dirtyPerspective=!1,h=r.perspective,l.perspectiveOrigin=`${h.x} ${h.y}`,l.perspective=`${h.z}px`),r.dirtyPosition&&(r.dirtyPosition=!1,l.position=r.position),r.dirtyDomDimensions&&(r.dirtyDomDimensions=!1,c=r.currentDimensions,u=c[0],d=c[1],"Canvas"===r.type?(k?(a.width=u,a.height=d):(r.ignoreCanvasCssDimensions||(l.width=`${u}px`,l.height=`${d}px`),a.width=u*A,a.height=d*A),r.renderOnResize&&r.render()):(l.width=`${u}px`,l.height=d?`${d}px`:"auto")),r.dirtyTransformOrigin&&(r.dirtyTransformOrigin=!1,l.transformOrigin=r.currentTransformOriginString),r.dirtyTransform&&(r.dirtyTransform=!1,l.transform=r.currentTransformString),r.dirtyVisibility&&(r.dirtyVisibility=!1,l.display=r.visibility?"block":"none"),r.dirtySmoothFont&&(r.dirtySmoothFont=!1,r.smoothFont?(l.webkitFontSmoothing="auto",l.mozOsxFontSmoothing="auto",l.smoothFont="auto"):(l.webkitFontSmoothing="none",l.mozOsxFontSmoothing="grayscale",l.smoothFont="never")),r.dirtyCss)for(r.dirtyCss=!1,m=r.css||{},g=Object.keys(m),f=0,p=g.length;f<p;f++)y=g[f],S=m[y],H.has(y)?(b=`${y[0].toUpperCase}${y.substr(1)}`,l[`webkit${b}`]=S,l[`moz${b}`]=S,l[`ms${b}`]=S,l[`o${b}`]=S,l[y]=S):I.has(y)&&(l[y]=S);r.dirtyClasses&&(r.dirtyClasses=!1,a.className.substring&&(a.className=r.classes))}}};let ws=document.createElement("div");ws.style.padding=0,ws.style.border=0,ws.style.margin=0,ws.style.width="4500px",ws.style.boxSizing="border-box",ws.style.position="absolute",ws.style.top="-5000px",ws.style.left="-5000px",ws.id="Scrawl-ARIA-default-hold",document.body.appendChild(ws);let vs=document.createElement("nav");vs.style.position="absolute",vs.style.top="-5000px",vs.style.left="-5000px",vs.id="Scrawl-navigation-default-hold",document.body.prepend(vs);const Cs=function(){window.scrawlEnvironmentTouchSupported=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),function(t="[data-scrawl-stack]"){document.querySelectorAll(t).forEach((t=>is(t)))}(),function(t="[data-scrawl-canvas]"){let e;document.querySelectorAll(t).forEach(((t,i)=>{e=rs(t),i||cs(e)}))}(),N(),fe(),te(),Xt=!0,ce(),window.scrawlEnvironmentColorChecker=yi({name:"entity-colorEngine-do-not-overwrite"})},RenderAnimation=function(t=Q){let e;if(this.noTarget=null!=t.noTarget&&t.noTarget,t.target||t.noTarget){if(Array.isArray(t.target)){let e=[];return t.target.forEach((i=>{let s=Object.assign({},t);s.name=`${s.name}_${i.name}`,s.target=i,e.push(new RenderAnimation(s))})),e}e=t.target&&t.target.substring?o[t.target]:t.target}else e={clear:ds,compile:fs,show:ps,checkAccessibilityValues:_};this.makeName(t.name),this.order=dt(t.order)?t.order:this.defs.order,this.onRun=t.onRun||_,this.onHalt=t.onHalt||_,this.onKill=t.onKill||_,this.target=e,this.commence=t.commence||_,this.afterClear=t.afterClear||_,this.afterCompile=t.afterCompile||_,this.afterShow=t.afterShow||_,this.afterCreated=t.afterCreated||_,this.error=t.error||_,this.readyToInitialize=!0,this.fn=function(){this.noTarget?(this.commence(),this.afterClear(),this.afterCompile(),this.afterShow(),this.readyToInitialize&&(this.afterCreated(this),this.readyToInitialize=!1)):this.isRunning()&&(this.commence(),this.target.clear(),this.afterClear(),this.target.compile(),this.afterCompile(),this.target.show(),this.afterShow(),this.readyToInitialize&&(this.target.checkAccessibilityValues(),this.afterCreated(this),this.readyToInitialize=!1))},this.register();const i=t.observer||!1;return i&&(et(i)?this.observer=yt(this,this.target):this.observer=yt(this,this.target,i)),t.delay||this.run(),this};let xs=RenderAnimation.prototype=Object.create(Object.prototype);xs.type="RenderAnimation",xs.lib="animation",xs.isArtefact=!1,xs.isAsset=!1,xs=Bt(xs);xs.defs=lt(xs.defs,{order:1,onRun:null,onHalt:null,onKill:null,commence:null,afterClear:null,afterCompile:null,afterShow:null,afterCreated:null,error:null,target:null}),xs.stringifyFunction=_,xs.processPacketOut=_,xs.finalizePacketOut=_,xs.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},xs.clone=K,xs.kill=function(){return this.onKill(),ut(j,this.name),X(),this.deregister(),!0},xs.run=function(){return this.onRun(),ct(j,this.name),X(),this.target&&this.target.checkAccessibilityValues(),setTimeout((()=>pe()),20),this},xs.start=function(){this.readyToInitialize=!0,this.run()},xs.isRunning=function(){return j.indexOf(this.name)>=0},xs.halt=function(){return this.onHalt(),ut(j,this.name),X(),this};const Ps=function(t){return!!t&&new RenderAnimation(t)};E.RenderAnimation=RenderAnimation;const UnstackedElement=function(t){let e=t.id||t.name;return this.makeName(e),this.register(),t.setAttribute("data-scrawl-name",this.name),this.domElement=t,this.elementComputedStyles=window.getComputedStyle(t),this.hostStyles=Q,this.canvasStartX=0,this.canvasStartY=0,this.canvasWidth=0,this.canvasHeight=0,this.canvasZIndex=0,this};let Ds=UnstackedElement.prototype=Object.create(Object.prototype);Ds.type="UnstackedElement",Ds.lib="unstackedelement",Ds.isArtefact=!1,Ds.isAsset=!1,Ds=Bt(Ds);Ds.defs=lt(Ds.defs,{canvasOnTop:!1}),Ds.getters,Ds.setters,Ds.deltaSetters,Ds.demolish=function(t=!1){return!0},Ds.addCanvas=function(t=Q){if(!this.canvas){let e=document.createElement("canvas"),i=this.domElement,s=i.style;"static"===s.position&&(s.position="relative"),e.id=`${this.name}-canvas`,i.prepend(e);let n=Gi({name:`${this.name}-canvas`,domElement:e,position:"absolute"});return this.canvas=n,n.set(t),this.updateCanvas(),n}},Ds.includedStyles=["width","height","zIndex","borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],Ds.mimickedStyles=["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],Ds.checkElementStyleValues=function(){let t={},e=this.domElement,i=this.canvas;if(e&&i&&i.domElement){let s=this.hostStyles,n=this.elementComputedStyles,r=i.domElement,o=this.includedStyles,{x:a,y:l,width:h,height:c}=e.getBoundingClientRect(),{x:u,y:d}=r.getBoundingClientRect(),{zIndex:f,width:p,height:m}=n;a=Math.floor(a),l=Math.floor(l),u=Math.floor(u),d=Math.floor(d),h=Math.floor(h),c=Math.floor(c),p=Math.floor(parseFloat(p)),m=Math.floor(parseFloat(m)),o.forEach((e=>{switch(e){case"width":let i=Math.max(p,h);this.canvasWidth!==i&&(this.canvasWidth=i,this.dirtyDimensions=!0);break;case"height":let r=Math.max(m,c);this.canvasHeight!==r&&(this.canvasHeight=r,this.dirtyDimensions=!0);break;case"zIndex":let o="auto"===f?0:parseInt(f,10);o=this.canvasOnTop?o+1:o-1,this.canvasZIndex!==o&&(this.canvasZIndex=o,this.dirtyZIndex=!0);break;default:let a=s[e],l=n[e];dt(a)&&a===l||(s[e]=l,t[e]=l)}}));let g=a-u,y=l-d;(g||y)&&(this.canvasStartX+=g,this.canvasStartY+=y,this.dirtyStart=!0)}return t},Ds.updateCanvas=function(){if(this.canvas&&this.canvas.domElement){let t=this.canvas,e=t.domElement.style,i=this.mimickedStyles,s=this.checkElementStyleValues();for(let[t,n]of Object.entries(s))i.indexOf(t)>=0&&(e[t]=n);if(this.dirtyStart&&(this.dirtyStart=!1,t.set({startX:this.canvasStartX,startY:this.canvasStartY})),this.dirtyDimensions){this.dirtyDimensions=!1;let e=this.canvasWidth,i=this.canvasHeight;t.set({width:e,height:i}),t.dirtyDimensions=!0,t.base.set({width:e,height:i}),t.base.dirtyDimensions=!0,t.cleanDimensions(),t.base.cleanDimensions()}this.dirtyZIndex&&(this.dirtyZIndex=!1,e.zIndex=this.canvasZIndex)}};E.UnstackedElement=UnstackedElement;const Rs=function(t){let e=!!st(t.domElement)&&t.domElement,i=ot(t.animationHooks)?t.animationHooks:{},s=ot(t.canvasSpecs)?t.canvasSpecs:{},n=ot(t.observerSpecs)?t.observerSpecs:{},r=!et(t.includeCanvas)||t.includeCanvas;return e&&e.id&&o[e.id]?Fs(e,s,i,n):Es(e,s,i,n,r)},Fs=function(t,e,i,s){let n=o[t.id];if(!n)return!1;e.baseMatchesCanvasDimensions=!0,e.ignoreCanvasCssDimensions=!0,e.checkForResize=!0;let r=n.addCanvas(e);n.elementComputedStyles=window.getComputedStyle(t),i.name=`${n.name}-animation`,i.target=r;let a=Ps(i),l=yt(a,n,s);return{element:n,canvas:r,animation:a,demolish:()=>{l(),a.kill(),r.demolish(),n.demolish(!0)}}},Es=function(t,e,i,s,n){if(!t||["AREA","BASE","BR","COL","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"].indexOf(t.tagName)>=0)return{};let r,o=t.id;var a;o&&R[o]?r=R[o]:r=!!(a=t)&&new UnstackedElement(a),e.baseMatchesCanvasDimensions=!0,e.checkForResize=!0;let l=!!n&&r.addCanvas(e);i.name=`${r.name}-animation`,l?(i.afterClear||(i.afterClear=()=>r.updateCanvas()),i.target=l):i.noTarget=!0;let h=Ps(i),c=yt(h,r,s);return{element:r,canvas:l,animation:h,demolish:()=>{c(),h.kill(),l&&l.demolish(),r.demolish(!0)}}},Ms=["artefact","group","animation","tween","styles"],Is=t=>{if(t&&t.substring){let e;return!!Ms.some((i=>(e=B[i][t],e)))&&e}return!1};function Hs(t=Q){t.defs=lt(t.defs,{order:1,ticker:"",targets:null,time:0,action:null,reverseOnCycleEnd:!1,reversed:!1}),t.kill=function(){let t,e=this.ticker;return e===`${this.name}_ticker`?(t=n[e],t&&t.kill()):e&&this.removeFromTicker(e),this.deregister(),!0};let e=t.getters,i=t.setters;return e.targets=function(){return[].concat(this.targets)},i.targets=function(t=[]){this.setTargets(t)},i.action=function(t){this.action=t,"function"!=typeof this.action&&(this.action=_)},t.calculateEffectiveTime=function(t){let e,i=pt(t,this.time),s=W(i),r=s[1],o=s[0],a=0;return this.effectiveTime=0,"%"===o&&r<=100?this.ticker&&(e=n[this.ticker],e&&(a=e.effectiveDuration,this.effectiveTime=a*(r/100))):this.effectiveTime=r,this},t.addToTicker=function(t){let e;return dt(t)&&(this.ticker&&this.ticker!==t&&this.removeFromTicker(this.ticker),e=n[t],dt(e)&&(this.ticker=t,e.subscribe(this.name),this.calculateEffectiveTime())),this},t.removeFromTicker=function(t){let e;return(t=dt(t)?t:this.ticker)&&(e=n[t],dt(e)&&(this.ticker="",e.unsubscribe(this.name))),this},t.setTargets=function(t){t=[].concat(t);let e=[];return t.forEach((t=>{if(nt(t))nt(t.set)&&e.push(t);else if(ot(t)&&dt(t.name))e.push(t);else{let i=Is(t);i&&e.push(i)}})),this.targets=e,this},t.addToTargets=function(t){return(t=[].concat(t)).forEach((t=>{"function"==typeof t?"function"==typeof t.set&&this.targets.push(t):(result=Is(t),result&&this.targets.push(result))}),this),this},t.removeFromTargets=function(t){t=[].concat(t);let e=[],i=[].concat(this.targets);return i.forEach((t=>{let i=t.type||"unknown",s=t.name||"unnamed";"unknown"!==i&&"unnamed"!==s&&e.push(`${i}_${s}`)})),t.forEach((t=>{let s;if(s="function"==typeof t?t:Is(t),s){let t=s.type||"unknown",n=s.name||"unnamed";if("unknown"!==t&&"unnamed"!==n){let s=`${t}_${n}`,r=e.indexOf(s);r>=0&&(i[r]=!1)}}})),this.targets=[],i.forEach((t=>{t&&this.targets.push(t)}),this),this},t.checkForTarget=function(t){return!!t.substring&&this.targets.some((e=>e.name===t))},t.run=_,t.isRunning=_,t.halt=_,t.reverse=_,t.resume=_,t.seekTo=_,t.seekFor=_,t}const Action=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.action=_,this.revert=_,this.set(t),this.calculateEffectiveTime(),dt(t.ticker)&&this.addToTicker(t.ticker),this};let Bs=Action.prototype=Object.create(Object.prototype);Bs.type="Action",Bs.lib="tween",Bs.isArtefact=!1,Bs.isAsset=!1,Bs=Bt(Bs),Bs=Hs(Bs);Bs.defs=lt(Bs.defs,{revert:null}),Bs.packetExclusions=ct(Bs.packetExclusions,["targets"]),Bs.packetFunctions=ct(Bs.packetFunctions,["revert","action"]),Bs.finalizePacketOut=function(t,e){return Array.isArray(this.targets)&&(t.targets=this.targets.map((t=>t.name))),t};let Ts=Bs.setters;Ts.revert=function(t){this.revert=t,"function"!=typeof this.revert&&(this.revert=_)},Ts.triggered=function(t){this.triggered!==t&&(t?this.action():this.revert(),this.triggered=t)},Bs.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs;let r,o,a,l;for(o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!==a&&null!=l&&(r=s[a],r?r.call(this,l):void 0!==n[a]&&(this[a]=l));let h=!!dt(t.ticker)&&this.ticker;h?(this.ticker=h,this.addToTicker(t.ticker)):dt(t.time)&&this.calculateEffectiveTime()}return this},Bs.getEndTime=function(){return this.effectiveTime},Bs.update=function(t){let e=this.reversed,i=this.effectiveTime,s=this.triggered;this.reverseOnCycleEnd;let n=t.tick,r=t.reverseTick,o=t.willLoop;return t.next,e?r>=i?s||(this.action(),this.triggered=!0):s&&(this.revert(),this.triggered=!1):n>=i?s||(this.action(),this.triggered=!0):s&&(this.revert(),this.triggered=!1),o&&(this.triggered=!this.triggered),!0};const Ls=function(t){return!!t&&new Action(t)};function $s(t=Q){(t=ti(t=qe(t=_e(t=Ze(t=Ve(t=We(t=ze(t)))))))).defs=lt(t.defs,{method:"fill",pathObject:null,winding:"nonzero",flipReverse:!1,flipUpend:!1,scaleOutline:!0,lockFillStyleToEntity:!1,lockStrokeStyleToEntity:!1,onEnter:null,onLeave:null,onDown:null,onUp:null}),t.packetExclusions=ct(t.packetExclusions,["state"]),t.packetFunctions=ct(t.packetFunctions,["onEnter","onLeave","onDown","onUp"]),t.processEntityPacketOut=function(t,e,i){return this.processFactoryPacketOut(t,e,i)},t.processFactoryPacketOut=function(t,e,i){let s=!0;return i.indexOf(t)<0&&e===this.defs[t]&&(s=!1),s},t.finalizePacketOut=function(t,e){let i=JSON.parse(this.state.saveAsPacket(e))[3];return t=lt(t,i),t=this.handlePacketAnchor(t,e)},t.postCloneAction=function(t,e){return this.onEnter&&(t.onEnter=this.onEnter),this.onLeave&&(t.onLeave=this.onLeave),this.onDown&&(t.onDown=this.onDown),this.onUp&&(t.onUp=this.onUp),e.sharedState&&(t.state=this.state),e.anchor&&(e.anchor.host=t,dt(e.anchor.focusAction)||(e.anchor.focusAction=this.anchor.focusAction),dt(e.anchor.blurAction)||(e.anchor.blurAction=this.anchor.blurAction),t.buildAnchor(e.anchor),e.anchor.clickAction||(t.anchor.clickAction=this.anchor.clickAction)),t};let e=t.getters,i=t.setters;return t.deltaSetters,e.group=function(){return this.group?this.group.name:""},i.lockStylesToEntity=function(t){this.lockFillStyleToEntity=t,this.lockStrokeStyleToEntity=t},t.get=function(t){const e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t],s=this.state;return null!=i?(e=this[t],void 0!==e?e:i):(i=s.defs[t],null!=i?(e=s[t],void 0!==e?e:i):null)}},t.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs,r=this.state,o=r?r.setters:Q,a=r?r.defs:Q;let l,h,c,u;for(h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(xe.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=u)):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=u)))}return this},t.setDelta=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.deltaSetters,n=this.defs,r=this.state,o=r?r.deltaSetters:Q,a=r?r.defs:Q;let l,h,c,u;for(h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(xe.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=z(this[c],u))):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=z(r[c],u))))}return this},t.entityInit=function(t=Q){this.makeName(t.name),this.register(),this.initializePositions(),this.state=Ce(Q),this.set(this.defs),t.group||(t.group=hs),this.onEnter=_,this.onLeave=_,this.onDown=_,this.onUp=_,this.set(t),this.midInitActions(t),this.purge&&this.purgeArtefact(this.purge)},t.midInitActions=_,t.prepareStamp=function(){this.dirtyHost&&(this.dirtyHost=!1,this.dirtyDimensions=!0),(this.dirtyScale||this.dirtyDimensions||this.dirtyStart||this.dirtyOffset||this.dirtyHandle)&&(this.dirtyPathObject=!0),this.dirtyScale&&this.cleanScale(),this.dirtyDimensions&&this.cleanDimensions(),this.dirtyLock&&this.cleanLock(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyHandle&&this.cleanHandle(),this.dirtyRotation&&this.cleanRotation(),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtyStampHandlePositions&&this.cleanStampHandlePositions(),this.dirtyPathObject&&this.cleanPathObject(),this.dirtyPositionSubscribers&&this.updatePositionSubscribers(),this.anchor&&this.dirtyAnchorHold&&(this.dirtyAnchorHold=!1,this.buildAnchor(this.anchor))},t.cleanPathObject=_,t.stamp=function(t=!1,e,i){let s=!(this.noFilters||!this.filters||!this.filters.length);return t?(e&&"Cell"===e.type&&(this.currentHost=e),i&&this.set(i),this.prepareStamp(),s?this.filteredStamp():this.regularStamp()):this.visibility?this.stashOutput||s?this.filteredStamp():this.regularStamp():void 0},t.regularStamp=function(){let t=this.currentHost;if(t){let e=t.engine,i=this.currentStampPosition,s=i[0],n=i[1];t.rotateDestination(e,s,n,this),this.noCanvasEngineUpdates||t.setEngine(this),this[this.method](e)}},t.filteredStamp=function(){!this.dirtyFilters&&this.currentFilters||this.cleanFilters();let t=this.currentHost,e=t.element,i=t.engine,s=t.currentDimensions,n=ai(),r=n.element,o=n.engine;this.currentHost=n;let a=r.width=s[0]||e.width,l=r.height=s[1]||e.height;if(a&&l){let s=this.noCanvasEngineUpdates;if(this.noCanvasEngineUpdates=!1,this.regularStamp(),!this.noFilters&&this.filters&&this.filters.length){this.isStencil&&(o.save(),o.globalCompositeOperation="source-in",o.globalAlpha=1,o.setTransform(1,0,0,1,0,0),o.drawImage(e,0,0),o.restore(),this.dirtyFilterIdentifier=!0),o.setTransform(1,0,0,1,0,0);let t=o.getImageData(0,0,a,l);this.preprocessFilters(this.currentFilters);let i=Oi.action({identifier:this.filterIdentifier,image:t,filters:this.currentFilters});i&&(o.globalCompositeOperation="source-over",o.globalAlpha=1,o.setTransform(1,0,0,1,0,0),o.putImageData(i,0,0))}if(i.save(),i.globalAlpha=this.state&&this.state.globalAlpha?this.state.globalAlpha:1,i.globalCompositeOperation=this.state&&this.state.globalCompositeOperation?this.state.globalCompositeOperation:"source-over",i.setTransform(1,0,0,1,0,0),i.drawImage(r,0,0),this.stashOutput){this.stashOutput=!1;let[t,e,i,s]=this.getCellCoverage(o.getImageData(0,0,r.width,r.height));if(this.stashedImageData=o.getImageData(t,e,i,s),this.stashOutputAsAsset){const t=this.stashOutputAsAsset.substring?this.stashOutputAsAsset:`${this.name}-image`;if(this.stashOutputAsAsset=!1,r.width=i,r.height=s,o.putImageData(this.stashedImageData,0,0),this.stashedImage)this.stashedImage.src=r.toDataURL();else{let e=this.stashedImage=document.createElement("img");e.id=t,e.onload=function(){ws.appendChild(e),je(`#${t}`)},e.src=r.toDataURL()}}}i.restore(),this.currentHost=t,this.noCanvasEngineUpdates=s}li(n)},t.getCellCoverage=function(t){let e,i,s=t.width,n=t.height,r=t.data,o=0,a=0,l=s,h=n,c=3;for(i=0;i<n;i++)for(e=0;e<s;e++)r[c]&&(l>e&&(l=e),o<e&&(o=e),h>i&&(h=i),a<i&&(a=i)),c+=4;return l<o&&h<a?[l,h,o-l,a-h]:[0,0,s,n]},t.simpleStamp=function(t,e=Q){t&&"Cell"===t.type&&(this.currentHost=t,this.set(e),this.prepareStamp(),this.regularStamp())},t.draw=function(t){t.stroke(this.pathObject)},t.fill=function(t){t.fill(this.pathObject,this.winding)},t.drawAndFill=function(t){let e=this.pathObject;t.stroke(e),t.fill(e,this.winding),this.currentHost.clearShadow(),t.stroke(e),t.fill(e,this.winding)},t.fillAndDraw=function(t){let e=this.pathObject;t.fill(e,this.winding),t.stroke(e),this.currentHost.clearShadow(),t.fill(e,this.winding),t.stroke(e)},t.drawThenFill=function(t){let e=this.pathObject;t.stroke(e),t.fill(e,this.winding)},t.fillThenDraw=function(t){let e=this.pathObject;t.fill(e,this.winding),t.stroke(e)},t.clip=function(t){t.clip(this.pathObject,this.winding)},t.clear=function(t){let e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fill(this.pathObject,this.winding),t.globalCompositeOperation=e},t.none=function(t){},t}E.Action=Action;const Block=function(t=Q){return this.entityInit(t),t.dimensions||(t.width||(this.currentDimensions[0]=this.dimensions[0]=10),t.height||(this.currentDimensions[1]=this.dimensions[1]=10)),this};let js=Block.prototype=Object.create(Object.prototype);js.type="Block",js.lib="entity",js.isArtefact=!0,js.isAsset=!1,js=Bt(js),js=$s(js),js.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){let t=this.pathObject=new Path2D,e=this.currentStampHandlePosition,i=this.currentScale,s=this.currentDimensions,n=-e[0]*i,r=-e[1]*i,o=s[0]*i,a=s[1]*i;t.rect(n,r,o,a)}};const Xs=function(t){return!!t&&new Block(t)};E.Block=Block;const Ys={x:0,y:0},Ns=function(t,e,i){t.x=e,t.y=i},Gs=function(t,e){let i=Math.atan2(t.y,t.x);i+=.01745329251*e;let s=Math.sqrt(t.x*t.x+t.y*t.y);t.x=s*Math.cos(i),t.y=s*Math.sin(i)},zs=function(t,e,i){let s,n,r=[],o=[],a=[],l=[],h=0;if("linear"===t){let[t,e,a,l]=i;s=a-t,n=l-e,h=Math.sqrt(s*s+n*n),r=r.concat([t,a]),o=o.concat([e,l])}else if("bezier"===t||"quadratic"===t){let c,u,d,f,p,m,g="bezier"===t?"getBezierXY":"getQuadraticXY",y=!1,b=.25,S=0;for(;!y;){for(r.length=0,o.length=0,S=0,a.length=0,l.length=0,m=Ws[g](0,...i),c=m.x,u=m.y,r.push(c),o.push(u),p=b;p<=1;p+=b)m=Ws[g](p,...i),({x:d,y:f}=m),r.push(d),o.push(f),s=d-c,n=f-u,S+=Math.sqrt(s*s+n*n),c=d,u=f,a.push(S),l.push(p);S<h+e&&(y=!0),h=S,b/=2,b<.004&&(y=!0)}}return{length:h,xPoints:r,yPoints:o,positions:l,progression:a}},Ws={getBezierXY:function(t,e,i,s,n,r,o,a,l){let h=1-t;return{x:Math.pow(h,3)*e+3*t*Math.pow(h,2)*s+3*t*t*h*r+t*t*t*a,y:Math.pow(h,3)*i+3*t*Math.pow(h,2)*n+3*t*t*h*o+t*t*t*l}},getQuadraticXY:function(t,e,i,s,n,r,o){let a=1-t;return{x:a*a*e+2*a*t*s+t*t*r,y:a*a*i+2*a*t*n+t*t*o}}};function Vs(t=Q){(t=$s(t)).defs=lt(t.defs,{species:"",useAsPath:!1,precision:10,constantPathSpeed:!1,pathDefinition:"",showBoundingBox:!1,boundingBoxColor:"rgb(0 0 0 / 0.5)",minimumBoundingBoxDimensions:20}),t.packetExclusions=ct(t.packetExclusions,["dimensions","pathed"]),t.packetExclusionsByRegex=ct(t.packetExclusionsByRegex,[]),t.packetCoordinates=ct(t.packetCoordinates,[]),t.packetObjects=ct(t.packetObjects,[]),t.packetFunctions=ct(t.packetFunctions,[]),t.finalizePacketOut=function(t,e){let i=JSON.parse(this.state.saveAsPacket(e))[3];return t=lt(t,i),t=this.handlePacketAnchor(t,e)},t.getters;let e=t.setters,i=t.deltaSetters;return e.species=function(t){dt(t)&&(this.species=t,this.updateDirty())},e.precision=function(t){dt(t)&&t.toFixed&&(this.precision=t,this.updateDirty())},e.constantPathSpeed=function(t){this.constantPathSpeed=t,this.updateDirty()},e.width=_,e.height=_,e.dimensions=_,i.width=_,i.height=_,i.dimensions=_,e.pathDefinition=function(t){t.substring&&(this.pathDefinition=t),this.pathCalculatedOnce=!1,this.dirtyPathObject=!0},t.updateDirty=function(){this.dirtySpecies=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},t.midInitActions=function(t){this.set(t)},t.shapeInit=function(t){this.entityInit(t),this.units=[],this.unitLengths=[],this.unitPartials=[],this.pathed=[],this.localBox=[]},t.positionPointOnPath=function(t){let e=Ri(t);e.vectorSubtract(this.currentStampHandlePosition),this.flipReverse&&(e.x=-e.x),this.flipUpend&&(e.y=-e.y),e.rotate(this.roll),e.vectorAdd(this.currentStampPosition);let i={x:e.x,y:e.y};return Fi(e),i},t.getBezierXY=function(t,e,i,s,n,r,o,a,l){let h=1-t;return{x:Math.pow(h,3)*e+3*t*Math.pow(h,2)*s+3*t*t*h*r+t*t*t*a,y:Math.pow(h,3)*i+3*t*Math.pow(h,2)*n+3*t*t*h*o+t*t*t*l}},t.getQuadraticXY=function(t,e,i,s,n,r,o){let a=1-t;return{x:a*a*e+2*a*t*s+t*t*r,y:a*a*i+2*a*t*n+t*t*o}},t.getLinearXY=function(t,e,i,s,n){return{x:e+(s-e)*t,y:i+(n-i)*t}},t.getBezierAngle=function(t,e,i,s,n,r,o,a,l){let h=1-t,c=Math.pow(h,2)*(s-e)+2*t*h*(r-s)+t*t*(a-r),u=Math.pow(h,2)*(n-i)+2*t*h*(o-n)+t*t*(l-o);return(-Math.atan2(c,u)+.5*Math.PI)/M},t.getQuadraticAngle=function(t,e,i,s,n,r,o){let a=1-t,l=2*a*(s-e)+2*t*(r-s),h=2*a*(n-i)+2*t*(o-n);return(-Math.atan2(l,h)+.5*Math.PI)/M},t.getLinearAngle=function(t,e,i,s,n){let r=s-e,o=n-i;return(-Math.atan2(r,o)+.5*Math.PI)/M},t.getConstantPosition=function(t){if(!t||!t.toFixed||isNaN(t))return 0;if(t>=1)return.9999;let e=this.unitPositions;if(e&&e.length){let e,i,s,n,r,o,a,l=this.length,h=this.unitProgression,c=this.unitPositions,u=t*l,d=-1;for(let t=0,e=h.length;t<e;t++)if(u<=h[t]){d=t-1;break}return d<0?(e=h[0],n=u/e*c[0]):(e=h[d],i=d?h[d-1]:0,s=e-i,r=c[d],o=c[d+1],a=o-r,n=r+(u-e)/s*a),n}return t},t.buildPathPositionObject=function(t,e){if(t){let i,s,[n,...r]=t;switch(n){case"linear":i=this.positionPointOnPath(this.getLinearXY(e,...r)),s=this.getLinearAngle(e,...r);break;case"quadratic":i=this.positionPointOnPath(this.getQuadraticXY(e,...r)),s=this.getQuadraticAngle(e,...r);break;case"bezier":i=this.positionPointOnPath(this.getBezierXY(e,...r)),s=this.getBezierAngle(e,...r)}let o=0;return this.flipReverse&&o++,this.flipUpend&&o++,1===o&&(s=-s),s+=this.roll,i.angle=s,i}return!1},t.getPathPositionData=function(t,e=!1){if(this.useAsPath&&dt(t)&&t.toFixed){let i,s,n,r,o,a,l=t%1,h=this.unitPartials,c=0;for(0===t?l=0:1===t&&(l=.9999),e&&(l=this.getConstantPosition(l)),n=0,r=h.length;n<r;n++)if(a=this.units[n][0],"move"!==a&&"close"!==a&&"unknown"!==a){if(i=h[n],l<=i){o=this.units[n],s=(l-c)/(i-c);break}c=i}return this.buildPathPositionObject(o,s)}return!1},t.prepareStamp=function(){this.dirtyHost&&(this.dirtyHost=!1),(this.dirtyScale||this.dirtySpecies||this.dirtyDimensions||this.dirtyStart||this.dirtyHandle)&&(this.dirtyPathObject=!0,(this.dirtyScale||this.dirtySpecies)&&(this.pathCalculatedOnce=!1)),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0),this.dirtyScale&&this.cleanScale(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyRotation&&this.cleanRotation(),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtySpecies&&this.cleanSpecies(),this.dirtyPathObject&&this.cleanPathObject(),this.dirtyPositionSubscribers&&this.updatePositionSubscribers()},t.cleanDimensions=function(){this.dirtyDimensions=!1,this.dirtyStart=!0,this.dirtyHandle=!0,this.dirtyOffset=!0},t.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){this.dirtyDimensions&&(this.cleanSpecies(),this.pathCalculatedOnce=!1),this.calculateLocalPath(this.pathDefinition),this.dirtyDimensions&&this.cleanDimensions(),this.dirtyHandle&&this.cleanHandle(),this.dirtyStampHandlePositions&&this.cleanStampHandlePositions();let t=this.currentStampHandlePosition;this.pathObject=new Path2D(`m${-t[0]},${-t[1]}${this.localPath}`)}},t.calculateLocalPath=function(t,e){let i;if(this.pathCalculatedOnce||(i=function(t,e,i,s,n){let r,o,a,l,h=[],c=[],u="",d="",f=[],p=[],m=[],g=t.match(/([A-Za-z][0-9. ,\-]*)/g),y=0,b={},S=0,k=0,A=0,O=0,w=[],v=[],C=[],x=[],P=0,D=0,R=t=>{c.push({c:u.toLowerCase(),p:t||null,x:A,y:O,cx:S,cy:k,rx:P,ry:D}),s||(w.push(S),v.push(k)),A=S,O=k};for(r=0,o=g.length;r<o;r++)if(u=g[r][0],h=g[r].match(/(-?[0-9.]+\b)/g)||[],h.length){for(a=0,l=h.length;a<l;a++)h[a]=parseFloat(h[a]);switch(0===r?"M"===u&&(A=h[0]*e-i.x,O=h[1]*e-i.y,u="m"):(A=S,O=k),u){case"H":for(a=0,l=h.length;a<l;a++)h[a]=h[a]*e-A,S+=h[a],P=D=0,R(h.slice(a,a+1));break;case"V":for(a=0,l=h.length;a<l;a++)h[a]=h[a]*e-O,k+=h[a],P=D=0,R(h.slice(a,a+1));break;case"M":for(a=0,l=h.length;a<l;a+=2)h[a]=h[a]*e-A,h[a+1]=h[a+1]*e-O,S+=h[a],k+=h[a+1],P=D=0,R(h.slice(a,a+2));break;case"L":case"T":for(a=0,l=h.length;a<l;a+=2)h[a]=h[a]*e-A,h[a+1]=h[a+1]*e-O,S+=h[a],k+=h[a+1],"T"===u?(P=h[a]+A,D=h[a+1]+O):P=D=0,R(h.slice(a,a+2));break;case"Q":case"S":for(a=0,l=h.length;a<l;a+=4)h[a]=h[a]*e-A,h[a+1]=h[a+1]*e-O,h[a+2]=h[a+2]*e-A,h[a+3]=h[a+3]*e-O,S+=h[a+2],k+=h[a+3],P=h[a]+A,D=h[a+1]+O,R(h.slice(a,a+4));break;case"C":for(a=0,l=h.length;a<l;a+=6)h[a]=h[a]*e-A,h[a+1]=h[a+1]*e-O,h[a+2]=h[a+2]*e-A,h[a+3]=h[a+3]*e-O,h[a+4]=h[a+4]*e-A,h[a+5]=h[a+5]*e-O,S+=h[a+4],k+=h[a+5],P=h[a+2]+A,D=h[a+3]+O,R(h.slice(a,a+6));break;case"A":for(a=0,l=h.length;a<l;a+=7)h[a+5]=h[a+5]*e-A,h[a+6]=h[a+6]*e-O,S+=h[a+5],k+=h[a+6],P=D=0,R(h.slice(a,a+7));break;case"h":for(a=0,l=h.length;a<l;a++)h[a]*=e,S+=h[a],P=D=0,R(h.slice(a,a+1));break;case"v":for(a=0,l=h.length;a<l;a++)h[a]*=e,k+=h[a],P=D=0,R(h.slice(a,a+1));break;case"m":case"l":case"t":for(a=0,l=h.length;a<l;a+=2)h[a]*=e,h[a+1]*=e,S+=h[a],k+=h[a+1],"t"===u?(P=h[a]+A,D=h[a+1]+O):P=D=0,R(h.slice(a,a+2));break;case"q":case"s":for(a=0,l=h.length;a<l;a+=4)h[a]*=e,h[a+1]*=e,h[a+2]*=e,h[a+3]*=e,S+=h[a+2],k+=h[a+3],P=h[a]+A,D=h[a+1]+O,R(h.slice(a,a+4));break;case"c":for(a=0,l=h.length;a<l;a+=6)h[a]*=e,h[a+1]*=e,h[a+2]*=e,h[a+3]*=e,h[a+4]*=e,h[a+5]*=e,S+=h[a+4],k+=h[a+5],P=h[a+2]+A,D=h[a+3]+O,R(h.slice(a,a+6));break;case"a":for(a=0,l=h.length;a<l;a+=7)h[a]*=e,h[a+1]*=e,h[a+5]*=e,h[a+6]*=e,S+=h[a+5],k+=h[a+6],P=D=0,R(h.slice(a,a+7))}}else P=D=0,R();for(r=0,o=c.length;r<o;r++){let t=c[r],e=t.p;if(e){for(a=0,l=e.length;a<l;a++)e[a]=e[a].toFixed(1);for(d+=`${t.c}${t.p.join()}`,a=0,l=e.length;a<l;a++)e[a]=parseFloat(e[a])}else d+=`${t.c}`}if(b.localPath=d,s){let t=Ys;for(r=0,o=c.length;r<o;r++){let e=c[r],i=r>0&&c[r-1],{c:s,p:n,x:o,y:a,cx:l,cy:h,rx:u,ry:d}=e;if(n)switch(s){case"h":f[r]=["linear",o,a,n[0]+o,a];break;case"v":f[r]=["linear",o,a,o,n[0]+a];break;case"m":f[r]=["move",o,a];break;case"l":f[r]=["linear",o,a,n[0]+o,n[1]+a];break;case"t":i&&(i.rx||i.ry)?(Ns(t,i.rx-l,i.ry-h),Gs(t,180),f[r]=["quadratic",o,a,t.x+l,t.y+h,n[0]+o,n[1]+a]):f[r]=["quadratic",o,a,o,a,n[0]+o,n[1]+a];break;case"q":f[r]=["quadratic",o,a,n[0]+o,n[1]+a,n[2]+o,n[3]+a];break;case"s":i&&(i.rx||i.ry)?(Ns(t,i.rx-l,i.ry-h),Gs(t,180),f[r]=["bezier",o,a,t.x+l,t.y+h,n[0]+o,n[1]+a,n[2]+o,n[3]+a]):f[r]=["bezier",o,a,o,a,n[0]+o,n[1]+a,n[2]+o,n[3]+a];break;case"c":f[r]=["bezier",o,a,n[0]+o,n[1]+a,n[2]+o,n[3]+a,n[4]+o,n[5]+a];break;case"a":f[r]=["linear",o,a,n[5]+o,n[6]+a];break;case"z":isNaN(o)&&(o=0),isNaN(a)&&(a=0),f[r]=["close",o,a];break;default:isNaN(o)&&(o=0),isNaN(a)&&(a=0),f[r]=["unknown",o,a]}else f[r]=[`no-points-${s}`,o,a]}for(b.units=f,r=0,o=f.length;r<o;r++){let t,[e,...i]=f[r];switch(e){case"linear":case"quadratic":case"bezier":t=zs(e,n,i),p[r]=t.length,w=w.concat(t.xPoints),v=v.concat(t.yPoints),C.push(t.progression),x.push(t.positions);break;default:p[r]=0}}y=p.reduce(((t,e)=>t+e),0);let e=0;for(r=0,o=p.length;r<o;r++)e+=p[r]/y,m[r]=parseFloat(e.toFixed(6))}b.unitLengths=p,b.unitPartials=m,b.length=parseFloat(y.toFixed(1)),b.unitPositions=x,b.unitProgression=C;let F=Math.max(...w),E=Math.max(...v),M=Math.min(...w),I=Math.min(...v);return b.maxX=F,b.maxY=E,b.minX=M,b.minY=I,b.xRange=w,b.yRange=v,b}(t,this.currentScale,this.currentStart,this.useAsPath,this.precision),this.pathCalculatedOnce=!0),i){this.localPath=i.localPath,this.length=i.length;let t=i.maxX,s=i.maxY,n=i.minX,r=i.minY,o=this.dimensions,a=this.currentDimensions,l=this.localBox;if(o[0]=parseFloat((t-n).toFixed(1)),o[1]=parseFloat((s-r).toFixed(1)),o[0]===a[0]&&o[1]===a[1]||(a[0]=o[0],a[1]=o[1],this.dirtyHandle=!0),l.length=0,l.push(parseFloat(n.toFixed(1)),parseFloat(r.toFixed(1)),o[0],o[1]),this.useAsPath){const{units:t,unitLengths:e,unitPartials:s,unitProgression:n,unitPositions:r}=i;let o,a,l,h,c,u,d,f,p,m,g=0,y=[],b=[];for(c=0,u=e.length;c<u;c++)if(g+=e[c],l=n[c],l)for(a=s[c],o=s[c+1]-a,h=r[c],d=0,f=l.length;d<f;d++)p=g+l[d],y.push(parseFloat(p.toFixed(1))),m=a+h[d]*o,b.push(parseFloat(m.toFixed(6)));this.units=t,this.unitLengths=e,this.unitPartials=s,this.unitProgression=y,this.unitPositions=b}e||this.calculateLocalPathAdditionalActions()}},t.calculateLocalPathAdditionalActions=_,t.updatePathSubscribers=function(){this.pathed.forEach((t=>{let e=o[t];e&&(e.currentPathData=!1,e.dirtyStart=!0,e.addPathHandle&&(e.dirtyHandle=!0),e.addPathOffset&&(e.dirtyOffset=!0),e.addPathRotation&&(e.dirtyRotation=!0),"Polyline"===e.type?e.dirtyPins=!0:"Line"!==e.type&&"Quadratic"!==e.type&&"Bezier"!==e.type||e.dirtyPins.push(this.name))}),this)},t.draw=function(t){t.stroke(this.pathObject),this.showBoundingBox&&this.drawBoundingBox(t)},t.fill=function(t){t.fill(this.pathObject,this.winding),this.showBoundingBox&&this.drawBoundingBox(t)},t.drawAndFill=function(t){let e=this.pathObject;t.stroke(e),this.currentHost.clearShadow(),t.fill(e,this.winding),this.showBoundingBox&&this.drawBoundingBox(t)},t.fillAndDraw=function(t){let e=this.pathObject;t.stroke(e),this.currentHost.clearShadow(),t.fill(e,this.winding),t.stroke(e),this.showBoundingBox&&this.drawBoundingBox(t)},t.drawThenFill=function(t){let e=this.pathObject;t.stroke(e),t.fill(e,this.winding),this.showBoundingBox&&this.drawBoundingBox(t)},t.fillThenDraw=function(t){let e=this.pathObject;t.fill(e,this.winding),t.stroke(e),this.showBoundingBox&&this.drawBoundingBox(t)},t.clear=function(t){let e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fill(this.pathObject,this.winding),t.globalCompositeOperation=e,this.showBoundingBox&&this.drawBoundingBox(t)},t.drawBoundingBox=function(t){t.save(),t.strokeStyle=this.boundingBoxColor,t.lineWidth=1,t.globalCompositeOperation="source-over",t.globalAlpha=1,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.strokeRect(...this.getBoundingBox()),t.restore()},t.getBoundingBox=function(){let t=Math.floor,e=Math.ceil,i=this.minimumBoundingBoxDimensions,[s,n,r,o]=this.localBox,[a,l]=this.currentStampHandlePosition,[h,c]=this.currentStampPosition;return r<i&&(r=i),o<i&&(o=i),[t(s-a),t(n-l),e(r),e(o),h,c]},t}const Zs=t=>"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1);function _s(t=Q){t.defs=lt(t.defs,{end:null,endPivot:"",endPivotCorner:"",addEndPivotHandle:!1,addEndPivotOffset:!1,endPath:"",endPathPosition:0,addEndPathHandle:!1,addEndPathOffset:!0,endParticle:"",endLockTo:"",useStartAsControlPoint:!1}),t.packetExclusions=ct(t.packetExclusions,["controlledLineOffset"]),t.packetExclusionsByRegex=ct(t.packetExclusionsByRegex,[]),t.packetCoordinates=ct(t.packetCoordinates,["end"]),t.packetObjects=ct(t.packetObjects,["endPivot","endPath"]),t.packetFunctions=ct(t.packetFunctions,[]),t.factoryKill=function(){Object.entries(o).forEach((([t,e])=>{e.name!==this.name&&(e.startControlPivot&&e.startControlPivot.name===this.name&&e.set({startControlPivot:!1}),e.controlPivot&&e.controlPivot.name===this.name&&e.set({controlPivot:!1}),e.endControlPivot&&e.endControlPivot.name===this.name&&e.set({endControlPivot:!1}),e.endPivot&&e.endPivot.name===this.name&&e.set({endPivot:!1}),e.startControlPath&&e.startControlPath.name===this.name&&e.set({startControlPath:!1}),e.controlPath&&e.controlPath.name===this.name&&e.set({controlPath:!1}),e.endControlPath&&e.endControlPath.name===this.name&&e.set({endControlPath:!1}),e.endPath&&e.endPath.name===this.name&&e.set({endPath:!1}))}))};let e=t.getters,i=t.setters,s=t.deltaSetters;return i.useStartAsControlPoint=function(t){if(this.useStartAsControlPoint=t,!t){let t=this.controlledLineOffset;t[0]=0,t[1]=0}this.updateDirty()},i.endPivot=function(t){this.setControlHelper(t,"endPivot","end"),this.updateDirty(),this.dirtyEnd=!0},i.endParticle=function(t){this.setControlHelper(t,"endParticle","end"),this.updateDirty(),this.dirtyEnd=!0},i.endPath=function(t){this.setControlHelper(t,"endPath","end"),this.updateDirty(),this.dirtyEnd=!0},i.endPathPosition=function(t){this.endPathPosition=t,this.dirtyEnd=!0,this.currentEndPathData=!1,this.dirtyFilterIdentifier=!0},s.endPathPosition=function(t){this.endPathPosition+=t,this.dirtyEnd=!0,this.currentEndPathData=!1,this.dirtyFilterIdentifier=!0},e.endPositionX=function(){return this.currentEnd[0]},e.endPositionY=function(){return this.currentEnd[1]},e.endPosition=function(){return[].concat(this.currentEnd)},i.endX=function(t){null!=t&&(this.end[0]=t,this.updateDirty(),this.dirtyEnd=!0,this.currentEndPathData=!1)},i.endY=function(t){null!=t&&(this.end[1]=t,this.updateDirty(),this.dirtyEnd=!0,this.currentEndPathData=!1)},i.end=function(t,e){this.setCoordinateHelper("end",t,e),this.updateDirty(),this.dirtyEnd=!0,this.currentEndPathData=!1},s.endX=function(t){let e=this.end;e[0]=z(e[0],t),this.updateDirty(),this.dirtyEnd=!0,this.currentEndPathData=!1},s.endY=function(t){let e=this.end;e[1]=z(e[1],t),this.updateDirty(),this.dirtyEnd=!0,this.currentEndPathData=!1},s.end=function(t,e){this.setDeltaCoordinateHelper("end",t,e),this.updateDirty(),this.dirtyEnd=!0,this.currentEndPathData=!1},i.endLockTo=function(t){this.endLockTo=t,this.updateDirty(),this.dirtyEndLock=!0,this.currentEndPathData=!1},t.curveInit=function(t){this.end=Ee(),this.currentEnd=Ee(),this.endLockTo="coord",this.dirtyEnd=!0,this.dirtyPins=[],this.controlledLineOffset=Ee()},t.setControlHelper=function(t,e,i){if(et(t)&&!t)this[e]=null,"startControl"===i?this.dirtyStartControlLock=!0:"control"===i?this.dirtyControlLock=!0:"endControl"===i?this.dirtyEndControlLock=!0:this.dirtyEndLock=!0;else if(t){let s=this[e],n=t.substring?o[t]:t;e.indexOf("Pivot")>0?n&&n.isArtefact&&(s&&s.isArtefact&&ut(s.pivoted,this.name),ct(n.pivoted,this.name),this[e]=n):e.indexOf("Path")>0?n&&n.isArtefact&&(s&&s.isArtefact&&ut(s.pathed,this.name),ct(n.pathed,this.name),this[e]=n):e.indexOf("Particle")>0&&(n=t.substring?b[t]:t,n||(this.updateDirty(),"startControl"===i?this.dirtyStartControl=!0:"control"===i?this.dirtyControl=!0:"endControl"===i?this.dirtyEndControl=!0:this.dirtyEnd=!0,this[e]=t))}},t.buildPathPositionObject=function(t,e){if(t){let i,s,[n,...r]=t;switch(n){case"linear":i=this.positionPointOnPath(this.getLinearXY(e,...r)),s=this.getLinearAngle(e,...r);break;case"quadratic":i=this.positionPointOnPath(this.getQuadraticXY(e,...r)),s=this.getQuadraticAngle(e,...r);break;case"bezier":i=this.positionPointOnPath(this.getBezierXY(e,...r)),s=this.getBezierAngle(e,...r)}let o=0;this.flipReverse&&o++,this.flipUpend&&o++,1===o&&(s=-s),s+=this.roll,this.currentStampPosition;let a=this.controlledLineOffset;return this.localBox,i.x+=a[0],i.y+=a[1],i.angle=s,i}return!1},t.prepareStamp=function(){this.dirtyHost&&(this.dirtyHost=!1),this.dirtyPins.length&&this.preparePinsForStamp(),this.dirtyLock&&this.cleanLock(),this.dirtyStartControlLock&&this.cleanControlLock("startControl"),this.dirtyEndControlLock&&this.cleanControlLock("endControl"),this.dirtyControlLock&&this.cleanControlLock("control"),this.dirtyEndLock&&this.cleanControlLock("end"),(this.dirtyScale||this.dirtySpecies||this.dirtyDimensions||this.dirtyStart||this.dirtyStartControl||this.dirtyEndControl||this.dirtyControl||this.dirtyEnd||this.dirtyHandle)&&(this.dirtyPathObject=!0,this.useStartAsControlPoint&&this.dirtyStart&&(this.dirtySpecies=!0,this.pathCalculatedOnce=!1),(this.dirtyScale||this.dirtySpecies||this.dirtyStartControl||this.dirtyEndControl||this.dirtyControl||this.dirtyEnd)&&(this.pathCalculatedOnce=!1)),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0,this.useStartAsControlPoint&&(this.dirtySpecies=!0,this.dirtyPathObject=!0,this.pathCalculatedOnce=!1)),this.dirtyScale&&this.cleanScale(),this.dirtyStart&&this.cleanStart(),(this.dirtyStartControl||"particle"===this.startControlLockTo)&&this.cleanControl("startControl"),(this.dirtyEndControl||"particle"===this.endControlLockTo)&&this.cleanControl("endControl"),(this.dirtyControl||"particle"===this.controlLockTo)&&this.cleanControl("control"),(this.dirtyEnd||"particle"===this.endLockTo)&&this.cleanControl("end"),this.dirtyOffset&&this.cleanOffset(),this.dirtyRotation&&this.cleanRotation(),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtySpecies&&this.cleanSpecies(),this.dirtyPathObject&&this.cleanPathObject(),this.dirtyPositionSubscribers&&(this.updatePositionSubscribers(),this.updateControlPathSubscribers())},t.cleanControlLock=function(t){let e=Zs(t);this[`dirty${e}Lock`]=!1,this[`dirty${e}`]=!0},t.cleanControl=function(t){let e=Zs(t);this[`dirty${e}`]=!1;let i,s,n=`${t}Path`,r=`${t}Particle`,a=this[`${t}Pivot`],l=this[n],h=this[r];a&&a.substring&&(i=o[a],i&&(a=i)),l&&l.substring&&(i=o[l],i&&(l=i)),h&&h.substring&&(i=b[h],i&&(h=i));let c,u,d,f,p,m,g,y=this[`${t}LockTo`],S=this[t],k=this[`current${e}`];switch(("pivot"!==y||a&&!a.substring)&&("path"!==y||l&&!l.substring)&&("particle"!==y||h&&!h.substring)||(y="coord"),y){case"pivot":this.pivotCorner&&a.getCornerCoordinate?[c,u]=a.getCornerCoordinate(this[`${t}PivotCorner`]):[c,u]=a.currentStampPosition,this.addPivotOffset||([d,f]=a.currentOffset,c-=d,u-=f);break;case"path":s=this.getControlPathData(l,t,e),c=s.x,u=s.y,this.addPathOffset||(c-=l.currentOffset[0],u-=l.currentOffset[1]);break;case"particle":c=h.position.x,u=h.position.y,this.pathCalculatedOnce=!1;break;case"mouse":p=this.getHere(),c=p.x||0,u=p.y||0;break;default:c=u=0,m=this.getHost(),m&&(g=m.currentDimensions,g&&(this.cleanPosition(k,S,g),[c,u]=k))}k[0]=c,k[1]=u,this.dirtySpecies=!0,this.dirtyPathObject=!0,this.dirtyPositionSubscribers=!0},t.getControlPathData=function(t,e,i){let s=this[`current${i}PathData`];if(s)return s;let n=this[`${e}PathPosition`],r=n,o=t.getPathPositionData(n);if(n<0&&(n+=1),n>1&&(n%=1),n=parseFloat(n.toFixed(6)),n!==r&&(this[`${e}PathPosition`]=n),o)return this[`current${i}PathData`]=o,o;{let t=this.getHost();if(t){let s=t.currentDimensions;if(s){let t=this[`current${i}`];return this.cleanPosition(t,this[e],s),{x:t[0],y:t[1]}}}return{x:0,y:0}}},t.updateControlPathSubscribers=function(){[].concat(this.endSubscriber,this.endControlSubscriber,this.controlSubscriber,this.startControlSubscriber).forEach((t=>{let e=o[t];e&&("Line"!==e.type&&"Quadratic"!==e.type&&"Bezier"!==e.type||("Quadratic"===e.type?(e.dirtyControl=!0,e.currentControlPathData=!1):"Bezier"===e.type&&(e.dirtyStartControl=!0,e.dirtyEndControl=!0,e.currentStartControlPathData=!1,e.currentEndControlPathData=!1),e.currentEndPathData=!1,e.dirtyEnd=!0),e.currentPathData=!1,e.dirtyStart=!0)}))},t}const Bezier=function(t=Q){return this.startControl=Ee(),this.endControl=Ee(),this.currentStartControl=Ee(),this.currentEndControl=Ee(),this.startControlLockTo="coord",this.endControlLockTo="coord",this.curveInit(t),this.shapeInit(t),this.dirtyStartControl=!0,this.dirtyEndControl=!0,this};let Us=Bezier.prototype=Object.create(Object.prototype);Us.type="Bezier",Us.lib="entity",Us.isArtefact=!0,Us.isAsset=!1,Us=Bt(Us),Us=Vs(Us),Us=_s(Us);Us.defs=lt(Us.defs,{startControl:null,startControlPivot:"",startControlPivotCorner:"",addStartControlPivotHandle:!1,addStartControlPivotOffset:!1,startControlPath:"",startControlPathPosition:0,addStartControlPathHandle:!1,addStartControlPathOffset:!0,startControlParticle:"",endControl:null,endControlPivot:"",endControlPivotCorner:"",addEndControlPivotHandle:!1,addEndControlPivotOffset:!1,endControlPath:"",endControlPathPosition:0,addEndControlPathHandle:!1,addEndControlPathOffset:!0,endControlParticle:"",startControlLockTo:"",endControlLockTo:""}),Us.packetExclusions=ct(Us.packetExclusions,[]),Us.packetExclusionsByRegex=ct(Us.packetExclusionsByRegex,[]),Us.packetCoordinates=ct(Us.packetCoordinates,["startControl","endControl"]),Us.packetObjects=ct(Us.packetObjects,["startControlPivot","startControlPath","endControlPivot","endControlPath"]),Us.packetFunctions=ct(Us.packetFunctions,[]);let Ks=Us.getters,qs=Us.setters,Qs=Us.deltaSetters;qs.endControlPivot=function(t){this.setControlHelper(t,"endControlPivot","endControl"),this.updateDirty(),this.dirtyEndControl=!0},qs.endControlParticle=function(t){this.setControlHelper(t,"endControlParticle","endControl"),this.updateDirty(),this.dirtyEndControl=!0},qs.endControlPath=function(t){this.setControlHelper(t,"endControlPath","endControl"),this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1},qs.endControlPathPosition=function(t){this.endControlPathPosition=t,this.dirtyEndControl=!0,this.currentEndControlPathData=!1,this.dirtyFilterIdentifier=!0},Qs.endControlPathPosition=function(t){this.endControlPathPosition+=t,this.dirtyEndControl=!0,this.currentEndControlPathData=!1,this.dirtyFilterIdentifier=!0},qs.startControlPivot=function(t){this.setControlHelper(t,"startControlPivot","startControl"),this.updateDirty(),this.dirtyStartControl=!0},qs.startControlParticle=function(t){this.setControlHelper(t,"startControlParticle","startControl"),this.updateDirty(),this.dirtyStartControl=!0},qs.startControlPath=function(t){this.setControlHelper(t,"startControlPath","startControl"),this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1},qs.startControlPathPosition=function(t){this.startControlPathPosition=t,this.dirtyStartControl=!0,this.currentStartControlPathData=!1,this.dirtyFilterIdentifier=!0},Qs.startControlPathPosition=function(t){this.startControlPathPosition+=t,this.dirtyStartControl=!0,this.currentStartControlPathData=!1,this.dirtyFilterIdentifier=!0},Ks.startControlPositionX=function(){return this.currentStartControl[0]},Ks.startControlPositionY=function(){return this.currentStartControl[1]},Ks.startControlPosition=function(){return[].concat(this.currentStartControl)},qs.startControlX=function(t){null!=t&&(this.startControl[0]=t,this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1)},qs.startControlY=function(t){null!=t&&(this.startControl[1]=t,this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1)},qs.startControl=function(t,e){this.setCoordinateHelper("startControl",t,e),this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1},Qs.startControlX=function(t){let e=this.startControl;e[0]=z(e[0],t),this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1},Qs.startControlY=function(t){let e=this.startControl;e[1]=z(e[1],t),this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1},Qs.startControl=function(t,e){this.setDeltaCoordinateHelper("startControl",t,e),this.updateDirty(),this.dirtyStartControl=!0,this.currentStartControlPathData=!1},Ks.endControlPositionX=function(){return this.currentEndControl[0]},Ks.endControlPositionY=function(){return this.currentEndControl[1]},Ks.endControlPosition=function(){return[].concat(this.currentEndControl)},qs.endControlX=function(t){null!=t&&(this.endControl[0]=t,this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1)},qs.endControlY=function(t){null!=t&&(this.endControl[1]=t,this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1)},qs.endControl=function(t,e){this.setCoordinateHelper("endControl",t,e),this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1},Qs.endControlX=function(t){let e=this.endControl;e[0]=z(e[0],t),this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1},Qs.endControlY=function(t){let e=this.endControl;e[1]=z(e[1],t),this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1},Qs.endControl=function(t,e){this.setDeltaCoordinateHelper("endControl",t,e),this.updateDirty(),this.dirtyEndControl=!0,this.currentEndControlPathData=!1},qs.startControlLockTo=function(t){this.startControlLockTo=t,this.updateDirty(),this.dirtyStartControlLock=!0},qs.endControlLockTo=function(t){this.endControlLockTo=t,this.updateDirty(),this.dirtyEndControlLock=!0,this.currentEndControlPathData=!1},Us.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeBezierPath(),this.pathDefinition=t},Us.makeBezierPath=function(){let[t,e]=this.currentStampPosition,[i,s]=this.currentStartControl,[n,r]=this.currentEndControl,[o,a]=this.currentEnd;return`m0,0c${(i-t).toFixed(2)},${(s-e).toFixed(2)} ${(n-t).toFixed(2)},${(r-e).toFixed(2)} ${(o-t).toFixed(2)},${(a-e).toFixed(2)}`},Us.cleanDimensions=function(){this.dirtyDimensions=!1,this.dirtyHandle=!0,this.dirtyOffset=!0,this.dirtyStart=!0,this.dirtyStartControl=!0,this.dirtyEndControl=!0,this.dirtyEnd=!0,this.dirtyFilterIdentifier=!0},Us.preparePinsForStamp=function(){const t=this.dirtyPins,e=this.endPivot,i=this.endPath,s=this.startControlPivot,n=this.startControlPath,r=this.endControlPivot,o=this.endControlPath;for(let a,l=0,h=t.length;l<h;l++)a=t[l],(s&&s.name==a||n&&n.name==a)&&(this.dirtyStartControl=!0,this.startControlLockTo.includes("path")&&(this.currentStartControlPathData=!1)),(r&&r.name==a||o&&o.name==a)&&(this.dirtyEndControl=!0,this.endControlLockTo.includes("path")&&(this.currentEndControlPathData=!1)),(e&&e.name==a||i&&i.name==a)&&(this.dirtyEnd=!0,this.endLockTo.includes("path")&&(this.currentEndPathData=!1));t.length=0};const Js=function(t=Q){return!!t&&(t.species="bezier",new Bezier(t))};E.Bezier=Bezier;const Cog=function(t=Q){return this.shapeInit(t),this};let tn=Cog.prototype=Object.create(Object.prototype);tn.type="Cog",tn.lib="entity",tn.isArtefact=!0,tn.isAsset=!1,tn=Bt(tn),tn=Vs(tn);tn.defs=lt(tn.defs,{outerRadius:0,innerRadius:0,outerControlsDistance:0,innerControlsDistance:0,outerControlsOffset:0,innerControlsOffset:0,points:0,twist:0,curve:"bezier"});let en=tn.setters,sn=tn.deltaSetters;en.outerRadius=function(t){this.outerRadius=t,this.updateDirty()},sn.outerRadius=function(t){this.outerRadius+=t,this.updateDirty()},en.innerRadius=function(t){this.innerRadius=t,this.updateDirty()},sn.innerRadius=function(t){this.innerRadius+=t,this.updateDirty()},en.outerControlsDistance=function(t){this.outerControlsDistance=t,this.updateDirty()},sn.outerControlsDistance=function(t){this.outerControlsDistance+=t,this.updateDirty()},en.innerControlsDistance=function(t){this.innerControlsDistance=t,this.updateDirty()},sn.innerControlsDistance=function(t){this.innerControlsDistance+=t,this.updateDirty()},en.outerControlsOffset=function(t){this.outerControlsOffset=t,this.updateDirty()},sn.outerControlsOffset=function(t){this.outerControlsOffset+=t,this.updateDirty()},en.innerControlsOffset=function(t){this.innerControlsOffset=t,this.updateDirty()},sn.innerControlsOffset=function(t){this.innerControlsOffset+=t,this.updateDirty()},en.points=function(t){this.points=t,this.updateDirty()},sn.points=function(t){this.points+=t,this.updateDirty()},en.twist=function(t){this.twist=t,this.updateDirty()},sn.twist=function(t){this.twist+=t,this.updateDirty()},en.curve=function(t){t&&["line","quadratic","bezier"].indexOf(t)>=0?(this.curve=t,this.updateDirty()):(this.curve="bezier",this.updateDirty())},tn.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeCogPath(),this.pathDefinition=t},tn.makeCogPath=function(){let t,e,i,s,n,r,o,{points:a,twist:l,outerRadius:h,innerRadius:c,outerControlsDistance:u,innerControlsDistance:d,outerControlsOffset:f,innerControlsOffset:p,curve:m}=this,g=360/a,y=[],b="";if(h.substring||c.substring||u.substring||d.substring||f.substring||p.substring){let t=this.getHost();if(t){let[e,i]=t.currentDimensions;h=h.substring?parseFloat(h)/100*e:h,c=c.substring?parseFloat(c)/100*e:c,u=u.substring?parseFloat(u)/100*e:u,d=d.substring?parseFloat(d)/100*e:d,f=f.substring?parseFloat(f)/100*e:f,p=p.substring?parseFloat(p)/100*e:p}}let S=Ri({x:0,y:-h}),k=Ri({x:0,y:-c}),A=Ri({x:u+f,y:-h}),O=Ri({x:-d+p,y:-c}),w=Ri({x:d+p,y:-c}),v=Ri({x:-u+f,y:-h});if(O.rotate(-g/2),O.rotate(l),k.rotate(-g/2),k.rotate(l),w.rotate(-g/2),w.rotate(l),t=S.x,e=S.y,y.push(t),"bezier"==m)for(o=0;o<a;o++)i=parseFloat((A.x-t).toFixed(1)),s=parseFloat((A.y-e).toFixed(1)),b+=`${i},${s} `,O.rotate(g),k.rotate(g),w.rotate(g),i=parseFloat((O.x-t).toFixed(1)),s=parseFloat((O.y-e).toFixed(1)),b+=`${i},${s} `,i=parseFloat((k.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((k.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,i=parseFloat((w.x-t).toFixed(1)),s=parseFloat((w.y-e).toFixed(1)),b+=`${i},${s} `,v.rotate(g),S.rotate(g),A.rotate(g),i=parseFloat((v.x-t).toFixed(1)),s=parseFloat((v.y-e).toFixed(1)),b+=`${i},${s} `,i=parseFloat((S.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((S.y-e).toFixed(1)),e+=s,b+=`${i},${s} `;else if("quadratic"==m)for(o=0;o<a;o++)i=parseFloat((A.x-t).toFixed(1)),s=parseFloat((A.y-e).toFixed(1)),b+=`${i},${s} `,k.rotate(g),w.rotate(g),i=parseFloat((k.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((k.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,i=parseFloat((w.x-t).toFixed(1)),s=parseFloat((w.y-e).toFixed(1)),b+=`${i},${s} `,S.rotate(g),A.rotate(g),i=parseFloat((S.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((S.y-e).toFixed(1)),e+=s,b+=`${i},${s} `;else for(o=0;o<a;o++)i=parseFloat((A.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((A.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,O.rotate(g),k.rotate(g),w.rotate(g),i=parseFloat((O.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((O.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,i=parseFloat((k.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((k.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,i=parseFloat((w.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((w.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,v.rotate(g),S.rotate(g),A.rotate(g),i=parseFloat((v.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((v.y-e).toFixed(1)),e+=s,b+=`${i},${s} `,i=parseFloat((S.x-t).toFixed(1)),t+=i,y.push(t),s=parseFloat((S.y-e).toFixed(1)),e+=s,b+=`${i},${s} `;return Fi(S),n=Math.min(...y),r=Math.abs(n).toFixed(1),"bezier"==m?`m${r},0c${b}z`:"quadratic"==m?`m${r},0q${b}z`:`m${r},0l${b}z`};const nn=function(t){return!!t&&(t.species="cog",new Cog(t))};E.Cog=Cog;const Palette=function(t=Q){return this.makeName(t.name),this.register(),this.factory=yi({name:`${this.name}-color-factory`}),this.set(this.defs),this.colors=t.colors||{"0 ":[0,0,0,1],"999 ":[255,255,255,1]},this.stops=Array(1e3),this.easingFunction=U,this.set(t),this.dirtyPalette=!0,this};let rn=Palette.prototype=Object.create(Object.prototype);rn.type="Palette",rn.lib="palette",rn.isArtefact=!1,rn.isAsset=!1,rn=Bt(rn);rn.defs=lt(rn.defs,{colors:null,stops:null,cyclic:!1,easing:"linear",easingFunction:null,precision:25}),rn.packetFunctions=ct(rn.packetFunctions,["easingFunction"]),rn.packetExclusions=ct(rn.packetExclusions,["stops"]),rn.kill=function(){return this.factory&&this.factory.kill&&this.factory.kill(),this.deregister(),this};let on=rn.getters,an=rn.setters;on.colors=function(){const t=this.factory,e=[];if(t){const i=t.colorSpace;for(const[s,n]of Object.entries(this.colors))e.push([parseInt(s,10),t.buildColorString(...n,i)])}else e.push([0,"rgba(0 0 0 / 1)"],[999,"rgba(255 255 255 / 1)"]);return e},an.colors=function(t){if(Array.isArray(t)){let e=this.factory,i={},s=e.colorSpace.toLowerCase();t.forEach((t=>{let[n,r]=t;n.toFixed&&r.substring&&(e.convert(r),i[`${n} `]=[...e[s]])})),this.colors=i,this.dirtyPalette=!0}},an.easing=function(t){this.setEasingHelper(t)},an.easingFunction=an.easing,rn.setEasing=function(t){return this.setEasingHelper(t),this},rn.setEasingFunction=rn.setEasing,rn.setEasingHelper=function(t){nt(t)?(this.easing="function",this.easingFunction=t):t.substring&&gt[t]?(this.easing=t,this.easingFunction=U):(this.easing="linear",this.easingFunction=U),this.dirtyPalette=!0},on.colorSpace=function(){return this.getColorSpace()},an.colorSpace=function(t){if(t.substring){const e=t.toUpperCase(),i=t.toLowerCase();if(["RGB","HSL","HWB","XYZ","LAB","LCH","OKLAB","OKLCH"].includes(e)){const t=Object.assign({},this.colors),s=this.factory.colorSpace;this.factory.set({colorSpace:e});for(const[e,n]of Object.entries(t)){const t=this.factory.buildColorString(...n,s);this.factory.setColor(t),this.colors[e].length=0,this.colors[e].push(...this.factory[i])}this.dirtyPalette=!0}}},on.returnColorAs=function(){return this.getReturnColorAs()},an.returnColorAs=function(t){this.factory.set({returnColorAs:t}),this.dirtyPalette=!0},an.precision=function(t){t=parseInt(t,10),(isNaN(t)||t<0)&&(t=0),t>50&&(t=50),this.precision=t,this.dirtyPalette=!0},an.stops=_,rn.getColorSpace=function(){return this.factory?this.factory.colorSpace:"RGB"},rn.getReturnColorAs=function(){return this.factory?this.factory.returnColorAs:"RGB"},rn.recalculateHold=[],rn.recalculate=function(){this.dirtyPalette=!1;const{colors:t,stops:e,factory:i}=this;e.fill("rgba(0 0 0 / 0)");const{colorSpace:s}=i;let n=Object.keys(t);n=n.map((t=>parseInt(t,10))),n.sort(((t,e)=>t-e));let r,o,a,l,h=n[0],[c,u,d,f]=t[`${h} `];e[h]=i.returnColorFromValues(c,u,d,f);for(let c=0,u=n.length-1;c<u;c++){h=n[c],r=n[c+1],o=t[`${h} `],a=t[`${r} `],i.setMinimumColor(i.buildColorString(...o,s)),i.setMaximumColor(i.buildColorString(...a,s)),l=r-h;for(let t=h+1;t<=r;t++)e[t]=i.getRangeColor((t-h)/l,!0)}},rn.updateColor=function(t,e){const i=this.factory,s=i.colorSpace.toLowerCase();ft(t,e)&&(t=t.substring?parseInt(t,10):Math.floor(t))>=0&&t<=999&&(i.convert(e),t+=" ",this.colors[t]=[...i[s]],this.dirtyPalette=!0)},rn.removeColor=function(t){dt(t)&&(t=t.substring?parseInt(t,10):Math.floor(t))>=0&&t<=999&&(t+=" ",delete this.colors[t],this.dirtyPalette=!0)},rn.addStopsToGradient=function(t,e,i,s){let n,r,o,a,l,h,{stops:c,easing:u,easingFunction:d,precision:f}=this,p=Object.keys(this.colors);if(t){p=p.map((t=>parseInt(t,10))),p.sort(((t,e)=>t-e)),ft(e,i)||(e=0,i=999);let m=d;"function"!==u&&gt[u]&&(m=gt[u]);const g=this.getColorSpace(),y=!(!f||"linear"===u&&"RGB"===g);if(e===i)return c[e]||"rgba(0 0 0 / 0)";if(e<i)if(t.addColorStop(0,c[e]),t.addColorStop(1,c[i]),n=i-e,y)for(o=e+1;o<i;o+=f)r=(o-e)/n,s&&(r>1?r-=1:r<0&&(r+=1)),r=m(r),r>0&&r<1&&t.addColorStop(r,c[o]);else for(o=0,a=p.length;o<a;o++)l=p[o],l>e&&l<i&&(r=(l-e)/n,s&&(r>1?r-=1:r<0&&(r+=1)),r>0&&r<1&&t.addColorStop(r,c[l]));else if(s)if(t.addColorStop(0,c[e]),t.addColorStop(1,c[i]),h=999-e,n=h+i,y)for(o=0;o<n;o+=f)l=o+e,l>999&&(l-=999),r=m(o/n),r>0&&r<1&&t.addColorStop(r,c[l]);else for(o=0,a=p.length;o<a;o++){if(l=p[o],999===l)r=(l-e-.01)/n;else if(l>e)r=(l-e)/n;else if(0===l)r=(l+h+.01)/n;else{if(!(l<i))continue;r=(l+h)/n}r>1?r-=1:r<0&&(r+=1),r>0&&r<1&&t.addColorStop(r,c[l])}else if(t.addColorStop(0,c[e]),t.addColorStop(1,c[i]),n=e-i,y)for(o=i+1;o<e;o+=f)o<e&&o>i&&(r=m(1-(o-i)/n),r>0&&r<1&&t.addColorStop(r,c[o]));else for(o=0,a=p.length;o<a;o++)l=p[o],l<e&&l>i&&(r=1-(l-i)/n,r>0&&r<1&&t.addColorStop(r,c[l]));return t}return"rgba(0 0 0 / 0)"};E.Palette=Palette;const ln=["colors","cyclic","stops"];function hn(t=Q){t.defs=lt(t.defs,{start:null,end:null,palette:null,paletteStart:0,paletteEnd:999,cyclePalette:!1,animateByDelta:!1}),t.finalizePacketOut=function(t,e){return e.colors?t.colors=e.colors:this.palette?t.colors=this.palette.get("colors"):t.colors=[[0,"rgba(0 0 0 / 1)"],[999,"rgba(255 255 255 / 1)"]],e.easing?t.easing=e.easing:this.palette&&this.palette.easing?t.easing=this.palette.easing:t.easing="linear",dt(e.precision)?t.precision=e.precision:this.palette&&dt(this.palette.precision)?t.precision=this.palette.precision:t.precision=0,e.colorSpace?t.colorSpace=e.colorSpace:this.palette?t.colorSpace=this.palette.getColorSpace():t.colorSpace="RGB",e.returnColorAs?t.returnColorAs=e.returnColorAs:this.palette?t.returnColorAs=this.palette.getReturnColorAs():t.returnColorAs="RGB",t},t.kill=function(){let t=this.name;return this.palette&&this.palette.kill&&this.palette.kill(),Object.entries(f).forEach((([e,i])=>{let s=i.state;if(s){let e=s.fillStyle,i=s.strokeStyle;ot(e)&&e.name===t&&(s.fillStyle=s.defs.fillStyle),ot(i)&&i.name===t&&(s.strokeStyle=s.defs.strokeStyle)}})),this.deregister(),this};let e=t.getters,i=t.setters,s=t.deltaSetters;return e.startX=function(){return this.currentStart[0]},e.startY=function(){return this.currentStart[1]},i.startX=function(t){null!=t&&(this.start[0]=t,this.dirtyStart=!0)},i.startY=function(t){null!=t&&(this.start[1]=t,this.dirtyStart=!0)},i.start=function(t,e){this.setCoordinateHelper("start",t,e),this.dirtyStart=!0},s.startX=function(t){let e=this.start;e[0]=z(e[0],t),this.dirtyStart=!0},s.startY=function(t){let e=this.start;e[1]=z(e[1],t),this.dirtyStart=!0},s.start=function(t,e){this.setDeltaCoordinateHelper("start",t,e),this.dirtyStart=!0},e.endX=function(){return this.currentEnd[0]},e.endY=function(){return this.currentEnd[1]},i.endX=function(t){null!=t&&(this.end[0]=t,this.dirtyEnd=!0)},i.endY=function(t){null!=t&&(this.end[1]=t,this.dirtyEnd=!0)},i.end=function(t,e){this.setCoordinateHelper("end",t,e),this.dirtyEnd=!0},s.endX=function(t){let e=this.end;e[0]=z(e[0],t),this.dirtyEnd=!0},s.endY=function(t){let e=this.end;e[1]=z(e[1],t),this.dirtyEnd=!0},s.end=function(t,e){this.setDeltaCoordinateHelper("end",t,e),this.dirtyEnd=!0},i.palette=function(t=Q){"Palette"===t.type&&(this.palette=t)},i.paletteStart=function(t){t.toFixed&&(this.paletteStart=t,(t<0||t>999)&&(this.paletteStart=t>500?999:0))},s.paletteStart=function(t){let e;t.toFixed&&(e=this.paletteStart+t,(e<0||e>999)&&(e=this.cyclePalette?e>500?e-1e3:e+1e3:t>500?999:0),this.paletteStart=e)},i.paletteEnd=function(t){t.toFixed&&(this.paletteEnd=t,(t<0||t>999)&&(this.paletteEnd=t>500?999:0))},s.paletteEnd=function(t){let e;t.toFixed&&(e=this.paletteEnd+t,(e<0||e>999)&&(e=this.cyclePalette?e>500?e-1e3:e+1e3:t>500?999:0),this.paletteEnd=e)},i.colors=function(t){Array.isArray(t)&&this.palette&&this.palette.set({colors:t})},i.easing=function(t){this.palette&&this.palette.set({easing:t})},i.easingFunction=i.easing,i.colorSpace=function(t){this.palette&&this.palette.set({colorSpace:t})},i.returnColorAs=function(t){this.palette&&this.palette.set({returnColorAs:t})},i.precision=function(t){this.palette&&this.palette.set({precision:t})},i.delta=function(t=Q){t&&(this.delta=ht(this.delta,t))},t.get=function(t){let e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t],s=this.palette;return void 0!==i?(e=this[t],void 0!==e?e:i):(i=s.defs[t],void 0!==i?(e=s[t],void 0!==e?e:i):undef)}},t.set=function(t=Q){let e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs,r=this.palette;let o,a,l,h,c,u;for(r&&(o=r.setters||Q,a=r.defs||Q),h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(ln.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=u)):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=u)));this.dirtyFilterIdentifier=!0}return this},t.setDelta=function(t=Q){let e=Object.keys(t),i=e.length;if(i){let s,n,r,o,a,l,h=this.deltaSetters,c=this.defs,u=this.palette;for(u&&(s=u.deltaSetters||Q,n=u.defs||Q),o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!=a&&null!=l&&(ln.indexOf(a)<0?(r=h[a],r?r.call(this,l):void 0!==c[a]&&(this[a]=z(this[a],l))):(r=s[a],r?r.call(u,l):void 0!==n[a]&&(u[a]=z(this[a],l))));this.dirtyFilterIdentifier=!0}return this},t.setCoordinateHelper=function(t,e,i){let s=this[t];Array.isArray(e)?(s[0]=e[0],s[1]=e[1]):(s[0]=e,s[1]=i)},t.setDeltaCoordinateHelper=function(t,e,i){let s=this[t],n=s[0],r=s[1];Array.isArray(e)?(s[0]=z(n,e[0]),s[1]=z(r,e[1])):(s[0]=z(n,e),s[1]=z(r,i))},t.updateByDelta=function(){return this.setDelta(this.delta),this},t.stylesInit=function(t=Q){this.makeName(t.name),this.register(),this.gradientArgs=[],this.start=Ee(),this.end=Ee(),this.currentStart=Ee(),this.currentEnd=Ee(),this.palette=function(t){return!!t&&new Palette(t)}({name:`${this.name}_palette`}),this.delta={},this.set(this.defs),this.set(t)},t.getData=function(t,e){return this.palette&&this.palette.dirtyPalette&&this.palette.recalculate(),this.cleanStyle(t,e),this.finalizeCoordinates(t),this.buildStyle(e)},t.cleanStyle=function(t=Q,e=Q){let i,s,n,r;t.lockFillStyleToEntity||t.lockStrokeStyleToEntity?(i=t.currentDimensions,r=t.currentScale,s=i[0]*r,n=i[1]*r):(i=e.currentDimensions,s=i[0],n=i[1]),this.cleanPosition(this.currentStart,this.start,[s,n]),this.cleanPosition(this.currentEnd,this.end,[s,n]),this.cleanRadius(s)},t.cleanPosition=function(t,e,i){let s,n;for(let r=0;r<2;r++)s=e[r],n=i[r],s.toFixed?t[r]=s:t[r]="left"===s||"top"===s?0:"right"===s||"bottom"===s?n:"center"===s?n/2:parseFloat(s)/100*n},t.finalizeCoordinates=function(t=Q){this.currentStart,this.currentEnd;let e,i,s=t.currentStampPosition,n=t.currentStampHandlePosition,r=t.currentScale;t.lockFillStyleToEntity||t.lockStrokeStyleToEntity?(e=-n[0]*r||0,i=-n[1]*r||0):(e=-s[0]||0,i=-s[1]||0),this.updateGradientArgs(e,i)},t.cleanRadius=_,t.buildStyle=function(t){return"rgb(0 0 0 / 0)"},t.addStopsToGradient=function(t,e,i,s){return this.palette?(this.dirtyFilterIdentifier=!0,this.palette.addStopsToGradient(t,e,i,s)):t},t.updateColor=function(t,e){return this.palette&&(this.dirtyFilterIdentifier=!0,this.palette.updateColor(t,e)),this},t.removeColor=function(t){return this.palette&&(this.dirtyFilterIdentifier=!0,this.palette.removeColor(t)),this},t}Lt({name:"SC-system-gradient-delta-animation",fn:()=>{D.forEach((t=>{const e=P[t];e&&e.animateByDelta&&e.updateByDelta()}))}});const ConicGradient=function(t=Q){return this.stylesInit(t),this};let cn=ConicGradient.prototype=Object.create(Object.prototype);cn.type="ConicGradient",cn.lib="styles",cn.isArtefact=!1,cn.isAsset=!1,cn=Bt(cn),cn=hn(cn);cn.defs=lt(cn.defs,{angle:0}),cn.packetObjects=ct(cn.packetObjects,["palette"]),cn.buildStyle=function(t){if(t){let e=t.engine;if(e){if(!e.createConicGradient)return"rgb(0 0 0 / 0)";let t=e.createConicGradient(...this.gradientArgs);return this.addStopsToGradient(t,this.paletteStart,this.paletteEnd,this.cyclePalette)}}return"rgb(0 0 0 / 0)"},cn.updateGradientArgs=function(t,e){let i=this.gradientArgs,s=this.currentStart,n=this.angle*M,r=s[0]+t,o=s[1]+e;i.length=0,i.push(n,r,o)};const un=function(t){return!!t&&new ConicGradient(t)};E.ConicGradient=ConicGradient;const Crescent=function(t=Q){return mt(t.dimensions,t.width,t.height,t.radius)||(t.radius=5),this.entityInit(t),this};let dn=Crescent.prototype=Object.create(Object.prototype);dn.type="Crescent",dn.lib="entity",dn.isArtefact=!0,dn.isAsset=!1,dn=Bt(dn),dn=$s(dn);dn.defs=lt(dn.defs,{outerRadius:20,innerRadius:10,displacement:0,displayIntersect:!1}),dn.getters;let fn=dn.setters,pn=dn.deltaSetters;fn.outerRadius=function(t){null!=t&&(this.outerRadius=t,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0)},pn.outerRadius=function(t){null!=t&&(this.outerRadius=addStrings(this.outerRadius,t),this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0)},fn.innerRadius=function(t){null!=t&&(this.innerRadius=t,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0)},pn.innerRadius=function(t){null!=t&&(this.innerRadius=addStrings(this.innerRadius,t),this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0)},fn.width=fn.outerRadius,pn.width=pn.outerRadius,fn.height=fn.innerRadius,pn.height=pn.innerRadius,fn.displacement=function(t){if(null!=t&&t.toFixed&&t>=0){let e=t;e<0&&(e=0),this.displacement=e,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0}},pn.displacement=function(t){if(null!=t&&t.toFixed){let e=addStrings(this.displacement,t);e.toFixed&&e<0&&(e=0),this.displacement=e,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0}},fn.displayIntersect=function(t){this.displayIntersect=t,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},dn.cleanDimensionsAdditionalActions=function(){const{outerRadius:t,innerRadius:e,displacement:i}=this;let s,n=this.getHost();s=n?n.currentDimensions?n.currentDimensions:[n.w,n.h]:[300,150];let[r,o]=s;this.currentOuterRadius=t.substring?parseFloat(t)/100*r:t,this.currentInnerRadius=e.substring?parseFloat(e)/100*o:e,this.currentDisplacement=i.substring?parseFloat(i)/100*r:i,this.currentDimensions[0]=this.currentDimensions[1]=2*this.currentOuterRadius,this.dirtyPathObject=!0},dn.calculateInterception=function(){ft(this.currentOuterRadius,this.currentInnerRadius,this.currentDisplacement)||this.cleanDimensionsAdditionalActions();const{currentOuterRadius:t,currentInnerRadius:e,currentDisplacement:i}=this;this.outerCircleStart=0,this.outerCircleEnd=360*M,this.innerCircleStart=0,this.innerCircleEnd=360*M,this.drawOuterCircle=!1,this.drawDonut=!1;let s=t+e,n=t-e;if(!n&&!i)this.drawOuterCircle=!0;else if(i>=s)this.drawOuterCircle=!0;else if(i<s&&i>n){let s,n,r=ai(),{engine:o,element:a}=r,l=Re();for(a.width=a.width,o.fillStyle="black",o.save(),o.beginPath(),o.arc(0,0,t,0,2*Math.PI),l.setFromArray([e,0]),s=0;s<360&&(l.rotate(.5),!o.isPointInPath(l[0]+i,l[1]));s+=.5);for(o.restore(),o.save(),o.beginPath(),o.arc(i,0,e,0,2*Math.PI),l.setFromArray([t,0]),n=0;n<360&&(l.rotate(.5),o.isPointInPath(...l));n+=.5);o.restore(),this.outerCircleStart=-n*M,this.outerCircleEnd=n*M,this.innerCircleStart=s*M,this.innerCircleEnd=-s*M,Fe(l),li(r)}else this.drawDonut=!0},dn.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){this.calculateInterception();let{currentStampHandlePosition:t,currentScale:e,currentOuterRadius:i,currentInnerRadius:s,outerCircleStart:n,outerCircleEnd:r,innerCircleStart:o,innerCircleEnd:a,drawOuterCircle:l,currentDisplacement:h,displayIntersect:c}=this,u=this.pathObject=new Path2D;i*=e,s*=e,h*=e;let d=i-t[0]*e,f=i-t[1]*e;if(l)u.arc(d,f,i,n,r),u.closePath(),this.pathObjectOuter=!1,this.pathObjectInner=!1;else{let t=this.pathObjectOuter=new Path2D,e=this.pathObjectInner=new Path2D;c?u.arc(d,f,i,n,r):u.arc(d,f,i,n,r,!0),u.arc(d+h,f,s,o,a),u.closePath(),t.arc(d,f,i,n,r,!0),t.closePath(),e.arc(d+h,f,s,o,a),e.closePath()}}},dn.draw=function(t){this.drawDonut?(t.stroke(this.pathObjectOuter),t.stroke(this.pathObjectInner)):t.stroke(this.pathObject)},dn.fill=function(t){t.fill(this.pathObject,this.winding)},dn.drawAndFill=function(t){if(this.drawDonut){let e=this.pathObject,i=this.pathObjectOuter,s=this.pathObjectInner;t.stroke(i),t.stroke(s),t.fill(e,this.winding),this.currentHost.clearShadow(),t.stroke(i),t.stroke(s),t.fill(e,this.winding)}else{let e=this.pathObject;t.stroke(e),t.fill(e,this.winding),this.currentHost.clearShadow(),t.stroke(e),t.fill(e,this.winding)}},dn.fillAndDraw=function(t){if(this.drawDonut){let e=this.pathObject,i=this.pathObjectOuter,s=this.pathObjectInner;t.fill(e,this.winding),t.stroke(i),t.stroke(s),this.currentHost.clearShadow(),t.fill(e,this.winding),t.stroke(i),t.stroke(s)}else{let e=this.pathObject;t.fill(e,this.winding),t.stroke(e),this.currentHost.clearShadow(),t.fill(e,this.winding),t.stroke(e)}},dn.drawThenFill=function(t){if(this.drawDonut){let e=this.pathObject,i=this.pathObjectOuter,s=this.pathObjectInner;t.stroke(i),t.stroke(s),t.fill(e,this.winding)}else{let e=this.pathObject;t.stroke(e),t.fill(e,this.winding)}},dn.fillThenDraw=function(t){if(this.drawDonut){let e=this.pathObject,i=this.pathObjectOuter,s=this.pathObjectInner;t.fill(e,this.winding),t.stroke(i),t.stroke(s)}else{let e=this.pathObject;t.fill(e,this.winding),t.stroke(e)}},dn.clip=function(t){t.clip(this.pathObject,this.winding)},dn.clear=function(t){let e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fill(this.pathObject,this.winding),t.globalCompositeOperation=e};const mn=function(t){return!!t&&new Crescent(t)};E.Crescent=Crescent;const ParticleHistory=function(t){let e=[];return Object.setPrototypeOf(e,ParticleHistory.prototype),t&&e.set(t),e};let gn=ParticleHistory.prototype=Object.create(Array.prototype);gn.constructor=ParticleHistory,gn.type="ParticleHistory";const yn=[],bn=function(t){t&&"ParticleHistory"===t.type&&(t.length=0,yn.push(t),yn.length>100&&(yn.length=0))};E.ParticleHistory=ParticleHistory;const Particle=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.initializePositions(),this.set(t),this};let Sn=Particle.prototype=Object.create(Object.prototype);Sn.type="Particle",Sn.lib="particle",Sn.isArtefact=!1,Sn.isAsset=!1,Sn=Bt(Sn);Sn.defs=lt(Sn.defs,{position:null,velocity:null,load:null,history:null,historyLength:1,engine:"euler",forces:null,mass:1,fill:"#000000",stroke:"#000000"}),Sn.packetExclusions=ct(Sn.packetExclusions,[]),Sn.packetExclusionsByRegex=ct(Sn.packetExclusionsByRegex,["^(local|dirty|current)"]),Sn.packetCoordinates=ct(Sn.packetCoordinates,[]),Sn.packetObjects=ct(Sn.packetObjects,["position","velocity","acceleration"]),Sn.packetFunctions=ct(Sn.packetFunctions,[]),Sn.factoryKill=function(){this.history.forEach((t=>bn(t)));O.forEach((t=>{let e=A[t];e.particleFrom&&e.particleFrom.name===this.name||e.particleTo&&(e.particleTo.name,this.name)})),[].forEach((t=>t.kill()))};let kn=Sn.getters,An=Sn.setters,On=Sn.deltaSetters;kn.positionX=function(){return this.position.x},kn.positionY=function(){return this.position.y},kn.positionZ=function(){return this.position.z},kn.position=function(){let t=this.position;return[t.x,t.y,t.z]},An.positionX=function(t){this.position.x=t},An.positionY=function(t){this.position.y=t},An.positionZ=function(t){this.position.z=t},An.position=function(t){this.position.set(t)},On.positionX=function(t){this.position.x+=t},On.positionY=function(t){this.position.y+=t},On.positionZ=function(t){this.position.z+=t},On.position=_,kn.velocityX=function(){return this.velocity.x},kn.velocityY=function(){return this.velocity.y},kn.velocityZ=function(){return this.velocity.z},kn.velocity=function(){let t=this.velocity;return[t.x,t.y,t.z]},An.velocityX=function(t){this.velocity.x=t},An.velocityY=function(t){this.velocity.y=t},An.velocityZ=function(t){this.velocity.z=t},An.velocity=function(t,e,i){this.velocity.set(t,e,i)},On.velocityX=function(t){this.velocity.x+=t},On.velocityY=function(t){this.velocity.y+=t},On.velocityZ=function(t){this.velocity.z+=t},On.velocity=_,An.forces=function(t){t&&(Array.isArray(t)?(this.forces.length=0,this.forces=this.forces.concat(t)):this.forces.push(t))},An.load=_,An.history=_,On.load=_,Sn.initializePositions=function(){this.initialPosition=Ei(),this.position=Ei(),this.velocity=Ei(),this.load=Ei(),this.forces=[],this.history=[],this.isRunning=!1},Sn.applyForces=function(t,e){this.load.zero(),this.isBeingDragged||this.forces.forEach((i=>{let s=S[i];s&&s.action&&s.action(this,t,e)}))},Sn.update=function(t,e){this.isBeingDragged?this.position.setFromVector(this.isBeingDragged).vectorAdd(this.dragOffset):Pn[this.engine].call(this,t*e.tickMultiplier)},Sn.manageHistory=function(t,e){let{history:i,remainingTime:s,position:n,historyLength:r,hasLifetime:o,distanceLimit:a,initialPosition:l,killBeyondCanvas:h}=this,c=!0,u=0;if(o)if(u=s-t,u<=0){let t=i.pop();bn(t),c=!1,i.length||(this.isRunning=!1)}else this.remainingTime=u;let d=i[i.length-1];if(d){let[t,i,s,n]=d;if(h){let t=e.element.width,i=e.element.height;(s<0||n<0||s>t||n>i)&&(c=!1,this.isRunning=!1)}if(a){let t=Ri(l);t.vectorSubtractArray([s,n,i]),t.getMagnitude()>a&&(c=!1,this.isRunning=!1),Fi(t)}}if(c){let{x:t,y:e,z:s}=n,o=(yn.length||yn.push(new ParticleHistory),yn.shift());if(o.push(u,s,t,e),i.unshift(o),i.length>r){i.splice(r).forEach((t=>bn(t)))}}},Sn.run=function(t,e,i){this.hasLifetime=!1,t&&(this.remainingTime=t,this.hasLifetime=!0),this.distanceLimit=0,e&&(this.initialPosition.set(this.position),this.distanceLimit=e),this.killBeyondCanvas=i,this.isRunning=!0};const wn=function(t){return!!t&&new Particle(t)};E.Particle=Particle;const vn=[],Cn=function(t){vn.length||vn.push(new Particle);let e=vn.shift();return e.set(t),e},xn=function(t){if(t&&"Particle"===t.type&&(t.history.forEach((t=>bn(t))),t.history.length=0,t.set(t.defs),vn.push(t),vn.length>50)){let t=[].concat(vn);vn.length=0,t.forEach((t=>t.kill()))}},Pn={euler:function(t){let{position:e,velocity:i,load:s,mass:n}=this,r=Ri(),o=Ri(i);r.setFromVector(s).scalarDivide(n),o.vectorAdd(r.scalarMultiply(t)),i.setFromVector(o),e.vectorAdd(o.scalarMultiply(t)),Fi(r)},"improved-euler":function(t){let{position:e,velocity:i,load:s,mass:n}=this,r=Ri(),o=Ri(),a=Ri(),l=Ri(i);r.setFromVector(s).scalarDivide(n).scalarMultiply(t),o.setFromVector(s).vectorAdd(r).scalarDivide(n).scalarMultiply(t),a.setFromVector(r).vectorAdd(o).scalarDivide(2),l.vectorAdd(a),i.setFromVector(l),e.vectorAdd(l.scalarMultiply(t)),Fi(r)},"runge-kutta":function(t){let{position:e,velocity:i,load:s,mass:n}=this,r=Ri(),o=Ri(),a=Ri(),l=Ri(),h=Ri(),c=Ri(i);r.setFromVector(s).scalarDivide(n).scalarMultiply(t).scalarDivide(2),o.setFromVector(s).vectorAdd(r).scalarDivide(n).scalarMultiply(t).scalarDivide(2),a.setFromVector(s).vectorAdd(o).scalarDivide(n).scalarMultiply(t).scalarDivide(2),l.setFromVector(s).vectorAdd(a).scalarDivide(n).scalarMultiply(t).scalarDivide(2),o.scalarMultiply(2),a.scalarMultiply(2),h.setFromVector(r).vectorAdd(o).vectorAdd(a).vectorAdd(l).scalarDivide(6),c.vectorAdd(h),i.setFromVector(c),e.vectorAdd(c.scalarMultiply(t)),Fi(r)}},Emitter=function(t=Q){return this.makeName(t.name),this.register(),this.initializePositions(),this.set(this.defs),this.onEnter=_,this.onLeave=_,this.onDown=_,this.onUp=_,this.fillColorFactory=yi({name:`${this.name}-fillColorFactory`}),this.strokeColorFactory=yi({name:`${this.name}-strokeColorFactory`}),this.range=Ei(),this.rangeFrom=Ei(),this.preAction=_,this.stampAction=_,this.postAction=_,this.particleStore=[],this.deadParticles=[],this.liveParticles=[],t.group||(t.group=hs),this.set(t),this.purge&&this.purgeArtefact(this.purge),this};let Dn=Emitter.prototype=Object.create(Object.prototype);Dn.type="Emitter",Dn.lib="entity",Dn.isArtefact=!0,Dn.isAsset=!1,Dn=Bt(Dn),Dn=$s(Dn);Dn.defs=lt(Dn.defs,{world:null,artefact:null,range:null,rangeFrom:null,generationRate:0,particleCount:0,generateAlongPath:null,generateInArea:null,generateFromExistingParticles:!1,generateFromExistingParticleHistories:!1,limitDirectionToAngleMultiples:0,generationChoke:15,killAfterTime:0,killAfterTimeVariation:0,killRadius:0,killRadiusVariation:0,killBeyondCanvas:!1,historyLength:1,forces:null,mass:1,massVariation:0,engine:"euler",hitRadius:10,showHitRadius:!1,hitRadiusColor:"#000000",resetAfterBlur:3}),Dn.packetExclusions=ct(Dn.packetExclusions,["forces","particleStore","deadParticles","liveParticles","fillColorFactory","strokeColorFactory"]),Dn.packetExclusionsByRegex=ct(Dn.packetExclusionsByRegex,[]),Dn.packetCoordinates=ct(Dn.packetCoordinates,[]),Dn.packetObjects=ct(Dn.packetObjects,["world","artefact","generateInArea","generateAlongPath"]),Dn.packetFunctions=ct(Dn.packetFunctions,["preAction","stampAction","postAction"]),Dn.finalizePacketOut=function(t,e){let i=e.forces||this.forces||!1;if(i){let e=[];i.forEach((t=>{t.substring?e.push(t):ot(t)&&t.name&&e.push(t.name)})),t.forces=e}let s=[];return this.particleStore.forEach((t=>s.push(t.saveAsPacket()))),t.particleStore=s,t},Dn.postCloneAction=function(t,e){return t},Dn.factoryKill=function(t,e){this.isRunning=!1,t&&this.artefact.kill(),e&&this.world.kill(),this.fillColorFactory.kill(),this.strokeColorFactory.kill(),this.deadParticles.forEach((t=>t.kill())),this.liveParticles.forEach((t=>t.kill())),this.particleStore.forEach((t=>t.kill()))},Dn.getters;let Rn=Dn.setters,Fn=Dn.deltaSetters;Rn.rangeX=function(t){this.range.x=t},Rn.rangeY=function(t){this.range.y=t},Rn.rangeZ=function(t){this.range.z=t},Rn.range=function(t){this.range.set(t)},Rn.rangeFromX=function(t){this.rangeFrom.x=t},Rn.rangeFromY=function(t){this.rangeFrom.y=t},Rn.rangeFromZ=function(t){this.rangeFrom.z=t},Rn.rangeFrom=function(t){this.rangeFrom.set(t)},Rn.preAction=function(t){nt(t)&&(this.preAction=t,this.dirtyFilterIdentifier=!0)},Rn.stampAction=function(t){nt(t)&&(this.stampAction=t,this.dirtyFilterIdentifier=!0)},Rn.postAction=function(t){nt(t)&&(this.postAction=t,this.dirtyFilterIdentifier=!0)},Rn.world=function(t){let e;t.substring?e=w[t]:ot(t)&&"World"===t.type&&(e=t),e&&(this.world=e)},Rn.artefact=function(t){let e;t.substring?e=o[t]:ot(t)&&t.isArtefact&&(e=t),e&&(this.artefact=e,this.dirtyFilterIdentifier=!0)},Rn.generateAlongPath=function(t){let e;t.substring?e=o[t]:ot(t)&&t.isArtefact&&(e=t),e&&e.useAsPath?this.generateAlongPath=e:this.generateAlongPath=!1,this.dirtyFilterIdentifier=!0},Rn.generateInArea=function(t){let e;t.substring?e=o[t]:ot(t)&&t.isArtefact&&(e=t),this.generateInArea=e||!1,this.dirtyFilterIdentifier=!0},Rn.fillColor=function(t){this.fillColorFactory.set({color:t}),this.dirtyFilterIdentifier=!0},Rn.fillMinimumColor=function(t){this.fillColorFactory.set({minimumColor:t}),this.dirtyFilterIdentifier=!0},Rn.fillMaximumColor=function(t){this.fillColorFactory.set({maximumColor:t}),this.dirtyFilterIdentifier=!0},Rn.strokeColor=function(t){this.strokeColorFactory.set({color:t}),this.dirtyFilterIdentifier=!0},Rn.strokeMinimumColor=function(t){this.strokeColorFactory.set({minimumColor:t}),this.dirtyFilterIdentifier=!0},Rn.strokeMaximumColor=function(t){this.strokeColorFactory.set({maximumColor:t}),this.dirtyFilterIdentifier=!0},Rn.hitRadius=function(t){t.toFixed&&(this.hitRadius=t,this.width=this.height=2*t)},Fn.hitRadius=function(t){t.toFixed&&(this.hitRadius+=t,this.width=this.height=2*this.hitRadius)},Rn.width=function(t){t.toFixed&&(this.hitRadius=t/2,this.width=this.height=t)},Fn.width=function(t){t.toFixed&&(this.hitRadius=t/2,this.width=this.height=t)},Rn.height=Rn.width,Fn.height=Fn.width,Dn.prepareStamp=function(){this.dirtyHost&&(this.dirtyHost=!1,this.dirtyDimensions=!0),(this.dirtyScale||this.dirtyDimensions||this.dirtyStart||this.dirtyOffset||this.dirtyHandle)&&(this.dirtyPathObject=!0),this.dirtyScale&&this.cleanScale(),this.dirtyDimensions&&this.cleanDimensions(),this.dirtyLock&&this.cleanLock(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyHandle&&this.cleanHandle(),this.dirtyRotation&&this.cleanRotation(),(this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtyStampHandlePositions&&this.cleanStampHandlePositions();let t=Date.now(),{particleStore:e,deadParticles:i,liveParticles:s,particleCount:n,generationRate:r,generatorChoke:o,resetAfterBlur:a}=this;o||(this.generatorChoke=o=t),e.forEach((t=>{t.isRunning?s.push(t):i.push(t)})),e.length=0,i.forEach((t=>xn(t))),i.length=0,e.push(...s),s.length=0;let l=t-o;if(l/1e3>a&&(l=0,this.generatorChoke=t),l>0&&r){let i=Math.floor(r/1e3*l);if(n){let t=n-e.length;t<=0?i=0:t<i&&(i=t)}i&&(this.addParticles(i),this.generatorChoke=t)}},Dn.addParticles=function(t){const e=Math.random,i=function(t,i){return t+(e()*i*2-i)},s=function(t,i){return t+e()*i};let n,r,o,a,l=Date.now(),{historyLength:h,engine:c,forces:u,mass:d,massVariation:f,fillColorFactory:p,strokeColorFactory:m,range:g,rangeFrom:y,currentStampPosition:b,particleStore:S,killAfterTime:k,killAfterTimeVariation:A,killRadius:O,killRadiusVariation:w,killBeyondCanvas:v,currentRotation:C,generateAlongPath:x,generateInArea:P,generateFromExistingParticles:D,generateFromExistingParticleHistories:R,limitDirectionToAngleMultiples:F,generationChoke:E}=this,{x:M,y:I,z:H}=g,{x:B,y:T,z:L}=y;if(P){let g=this.currentHost;if(g){const y=g.element,{width:b,height:C}=y;P.pathObject&&!P.dirtyPathObject||P.cleanPathObject();const x=ai(),D=x.engine,R=Re();let{pathObject:F,winding:$,currentStart:j}=P;[o,a]=j;const X=t=>D.isPointInPath(F,...t,$);x.rotateDestination(D,o,a,P);t:for(n=0;n<t;n++){let t=!1;for(;!t;){if(l+E<Date.now())break t;R.set(e()*b,e()*C),X(R)&&(t=!0)}r=Cn(),r.set({positionX:R[0],positionY:R[1],positionZ:0,velocityX:s(B,M),velocityY:s(T,I),velocityZ:s(L,H),historyLength:h,engine:c,forces:u,mass:i(d,f),fill:p.getRangeColor(Math.random()),stroke:m.getRangeColor(Math.random())});let n=Math.abs(i(k,A)),o=Math.abs(i(O,w));r.run(n,o,v),S.push(r)}li(x),Fe(R)}}else if(x){if(x.useAsPath){x.pathObject&&!x.dirtyPathObject||x.cleanPathObject();t:for(n=0;n<t;n++){let t=!1,n=!1;for(;!n;){if(l+E<Date.now())break t;t=x.getPathPositionData(e(),!0),t&&(n=!0)}r=Cn(),r.set({positionX:t.x,positionY:t.y,positionZ:0,velocityX:s(B,M),velocityY:s(T,I),velocityZ:s(L,H),historyLength:h,engine:c,forces:u,mass:i(d,f),fill:p.getRangeColor(Math.random()),stroke:m.getRangeColor(Math.random())});let o=Math.abs(i(k,A)),a=Math.abs(i(O,w));r.run(o,a,v),S.push(r)}}}else if(R){let e,o,a,l,g,y,x=S.length,P=Ri();for(n=0;n<t;n++){x?(o=S[Math.floor(Math.random()*x)],a=o.history,a&&a.length>1?([l,g,...y]=a[Math.floor(Math.random()*a.length)],y?P.setFromArray(y):P.setFromVector(o.position)):P.setFromVector(o.position)):P.setFromArray(b),r=Cn(),r.set({positionX:P.x,positionY:P.y,positionZ:P.z,historyLength:h,engine:c,forces:u,mass:i(d,f),fill:p.getRangeColor(Math.random()),stroke:m.getRangeColor(Math.random())}),F?(P.zero(),e=Math.floor(360/F),P.x=s(B,M),P.rotate(Math.floor(Math.random()*e)*F),r.set({velocityX:P.x,velocityY:P.y,velocityZ:s(L,H)})):r.set({velocityX:s(B,M),velocityY:s(T,I),velocityZ:s(L,H)}),Fi(P),r.velocity.rotate(C);let t=Math.abs(i(k,A)),n=Math.abs(i(O,w));r.run(t,n,v),S.push(r)}}else if(D){let e,o,a=S.length,l=Ri();for(n=0;n<t;n++){a?(o=S[Math.floor(Math.random()*a)],l.setFromVector(o.position)):l.setFromArray(b),r=Cn(),r.set({positionX:l.x,positionY:l.y,positionZ:l.z,historyLength:h,engine:c,forces:u,mass:i(d,f),fill:p.getRangeColor(Math.random()),stroke:m.getRangeColor(Math.random())}),F?(l.zero(),e=Math.floor(360/F),l.x=s(B,M),l.rotate(Math.floor(Math.random()*e)*F),r.set({velocityX:l.x,velocityY:l.y,velocityZ:s(L,H)})):r.set({velocityX:s(B,M),velocityY:s(T,I),velocityZ:s(L,H)}),Fi(l),r.velocity.rotate(C);let t=Math.abs(i(k,A)),n=Math.abs(i(O,w));r.run(t,n,v),S.push(r)}}else for([o,a]=b,n=0;n<t;n++){r=Cn(),r.set({positionX:o,positionY:a,positionZ:0,velocityX:s(B,M),velocityY:s(T,I),velocityZ:s(L,H),historyLength:h,engine:c,forces:u,mass:i(d,f),fill:p.getRangeColor(Math.random()),stroke:m.getRangeColor(Math.random())}),r.velocity.rotate(C);let t=Math.abs(i(k,A)),e=Math.abs(i(O,w));r.run(t,e,v),S.push(r)}},Dn.regularStamp=function(){let{world:t,artefact:e,particleStore:i,preAction:s,stampAction:n,postAction:r,lastUpdated:o,resetAfterBlur:a,showHitRadius:l,hitRadius:h,hitRadiusColor:c,currentStampPosition:u}=this,d=this.currentHost,f=.016,p=Date.now();if(o&&(f=(p-o)/1e3),f>a&&(i.forEach((t=>xn(t))),i.length=0,f=.016),i.forEach((e=>e.applyForces(t,d))),i.forEach((e=>e.update(f,t))),s.call(this,d),i.forEach((t=>{t.manageHistory(f,d),n.call(this,e,t,d)})),r.call(this,d),l){let t=d.engine;t.save(),t.lineWidth=1,t.strokeStyle=c,t.setTransform(1,0,0,1,0,0),t.beginPath(),t.arc(u[0],u[1],h,0,2*Math.PI),t.stroke(),t.restore()}this.lastUpdated=p},Dn.checkHit=function(t=[],e){if(this.noUserInteraction)return!1;let i,s,n=Array.isArray(t)?t:[t],r=this.currentStampPosition,o=!1;if(n.some((t=>{if(Array.isArray(t))i=t[0],s=t[1];else{if(!ft(t,t.x,t.y))return!1;i=t.x,s=t.y}if(!i.toFixed||!s.toFixed||isNaN(i)||isNaN(s))return!1;let e=Ri(r).vectorSubtract(t);return e.getMagnitude()<this.hitRadius&&(o=!0),Fi(e),o}),this)){return this.checkHitReturn(i,s,e)}return!1};const En=function(t){return!!t&&new Emitter(t)};E.Emitter=Emitter;const Gradient=function(t=Q){return this.stylesInit(t),this};let Mn=Gradient.prototype=Object.create(Object.prototype);Mn.type="Gradient",Mn.lib="styles",Mn.isArtefact=!1,Mn.isAsset=!1,Mn=Bt(Mn),Mn=hn(Mn),Mn.packetObjects=ct(Mn.packetObjects,["palette"]),Mn.buildStyle=function(t){if(t){let e=t.engine;if(e){let t=e.createLinearGradient(...this.gradientArgs);return this.addStopsToGradient(t,this.paletteStart,this.paletteEnd,this.cyclePalette)}}return"rgb(0 0 0 / 0)"},Mn.updateGradientArgs=function(t,e){let i=this.gradientArgs,s=this.currentStart,n=this.currentEnd,r=s[0]+t,o=s[1]+e,a=n[0]+t,l=n[1]+e;r===a&&o===l&&a++,i.length=0,i.push(r,o,a,l)};const In=function(t){return!!t&&new Gradient(t)};E.Gradient=Gradient;const Filter=function(t=Q){return this.makeName(t.name),this.register(),this.actions=[],this.set(t),this};let Hn=Filter.prototype=Object.create(Object.prototype);Hn.type="Filter",Hn.lib="filter",Hn.isArtefact=!1,Hn.isAsset=!1,Hn=Bt(Hn);Hn.defs=lt(Hn.defs,{actions:null,method:"",lineIn:"",lineMix:"",lineOut:"",opacity:1,alpha:255,angle:0,areaAlphaLevels:null,asset:"",blend:"normal",blue:0,blueInBlue:0,blueColor:"rgba(0 0 0 / 1)",blueInGreen:0,blueInRed:0,channelX:"red",channelY:"green",clamp:0,compose:"source-over",copyHeight:1,copyWidth:1,copyX:0,copyY:0,concurrent:!1,easing:"linear",excludeAlpha:!0,excludeBlue:!1,excludeGreen:!1,excludeRed:!1,excludeTransparentPixels:!0,gradient:null,green:0,greenInBlue:0,greenColor:"rgba(0 0 0 / 1)",greenInGreen:0,greenInRed:0,gutterHeight:1,gutterWidth:1,height:1,highAlpha:255,highBlue:255,highColor:"rgba(255 255 255 / 1)",highGreen:255,highRed:255,includeAlpha:!1,includeBlue:!0,includeGreen:!0,includeRed:!0,innerRadius:0,keepOnlyChangedAreas:!1,level:0,lowAlpha:0,lowBlue:0,lowColor:"rgba(0 0 0 / 1)",lowGreen:0,lowRed:0,minimumColorDistance:1e3,noiseType:"random",noWrap:!1,offsetAlphaX:0,offsetAlphaY:0,offsetBlueX:0,offsetBlueY:0,offsetGreenX:0,offsetGreenY:0,offsetRedX:0,offsetRedY:0,offsetX:0,offsetY:0,offsetAlphaMin:0,offsetAlphaMax:0,offsetBlueMin:0,offsetBlueMax:0,offsetGreenMin:0,offsetGreenMax:0,offsetRedMin:0,offsetRedMax:0,offsetMin:0,offsetMax:0,opaqueAt:1,operation:"mean",outerRadius:"30%",palette:"black-white",passes:1,points:null,postProcessResults:!0,processHorizontal:!0,processVertical:!0,radius:1,ranges:null,red:0,redInBlue:0,redColor:"rgba(0 0 0 / 1)",redInGreen:0,redInRed:0,reference:"black",scaleX:1,scaleY:1,seed:"some-random-string-or-other",smoothing:0,startX:"50%",startY:"50%",step:1,strength:1,staticSwirls:null,tileHeight:1,tileWidth:1,tileRadius:1,tolerance:0,transparentAt:0,transparentEdges:!1,useBluenoise:!1,useLabForPaletteDistance:!1,useMixedChannel:!0,useNaturalGrayscale:!1,weights:null,width:1}),Hn.kill=function(){let t=this.name;return Object.entries(f).forEach((([e,i])=>{let s=i.filters;s&&s.indexOf(t)>=0&&ut(s,t)})),Object.entries(g).forEach((([e,i])=>{let s=i.filters;s&&s.indexOf(t)>=0&&ut(s,t)})),Object.entries(u).forEach((([e,i])=>{let s=i.filters;s&&s.indexOf(t)>=0&&ut(s,t)})),this.deregister(),this};let Bn=Hn.setters;Hn.deltaSetters,Hn.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs;let r,o,a,l;for(o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!==a&&null!=l&&(r=s[a],r?r.call(this,l):void 0!==n[a]&&(this[a]=l))}return this.method&&Tn[this.method]&&Tn[this.method](this),this.dirtyFilterIdentifier=!0,this},Hn.setDelta=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.deltaSetters,n=this.defs;let r,o,a,l;for(o=0;o<i;o++)a=e[o],l=t[a],a&&"name"!==a&&null!=l&&(r=s[a],r?r.call(this,l):void 0!==n[a]&&(this[a]=addStrings(this[a],l)))}return this.method&&Tn[this.method]&&Tn[this.method](this),this.dirtyFilterIdentifier=!0,this},Bn.actions=function(t){null!=t&&(this.actions=t)};const Tn={alphaToChannels:function(t){t.actions=[{action:"alpha-to-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,excludeRed:null==t.excludeRed||t.excludeRed,excludeGreen:null==t.excludeGreen||t.excludeGreen,excludeBlue:null==t.excludeBlue||t.excludeBlue}]},areaAlpha:function(t){t.actions=[{action:"area-alpha",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,tileWidth:null!=t.tileWidth?t.tileWidth:1,tileHeight:null!=t.tileHeight?t.tileHeight:1,offsetX:null!=t.offsetX?t.offsetX:0,offsetY:null!=t.offsetY?t.offsetY:0,gutterWidth:null!=t.gutterWidth?t.gutterWidth:1,gutterHeight:null!=t.gutterHeight?t.gutterHeight:1,areaAlphaLevels:null!=t.areaAlphaLevels?t.areaAlphaLevels:[255,0,0,0]}]},binary:function(t){let e=null!=t.lowRed?t.lowRed:0,i=null!=t.lowGreen?t.lowGreen:0,s=null!=t.lowBlue?t.lowBlue:0,n=null!=t.lowAlpha?t.lowAlpha:255,r=null!=t.highRed?t.highRed:255,o=null!=t.highGreen?t.highGreen:255,a=null!=t.highBlue?t.highBlue:255,l=null!=t.highAlpha?t.highAlpha:255,h=null!=t.low?t.low:[e,i,s,n],c=null!=t.high?t.high:[r,o,a,l];t.actions=[{action:"threshold",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,level:null!=t.level?t.level:128,red:null!=t.red?t.red:128,green:null!=t.green?t.green:128,blue:null!=t.blue?t.blue:128,alpha:null!=t.alpha?t.alpha:128,low:h,high:c,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha,useMixedChannel:null!=t.useMixedChannel&&t.useMixedChannel}]},blend:function(t){t.actions=[{action:"blend",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",lineMix:null!=t.lineMix?t.lineMix:"",blend:null!=t.blend?t.blend:"normal",offsetX:null!=t.offsetX?t.offsetX:0,offsetY:null!=t.offsetY?t.offsetY:0,opacity:null!=t.opacity?t.opacity:1}]},blue:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,excludeRed:!0,excludeGreen:!0}]},blur:function(t){t.actions=[{action:"blur",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha,excludeTransparentPixels:null!=t.excludeTransparentPixels&&t.excludeTransparentPixels,processHorizontal:null==t.processHorizontal||t.processHorizontal,processVertical:null==t.processVertical||t.processVertical,radius:null!=t.radius?t.radius:1,passes:null!=t.passes?t.passes:1,step:null!=t.step?t.step:1}]},brightness:function(t){let e=null!=t.level?t.level:1;t.actions=[{action:"modulate-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,red:e,green:e,blue:e}]},channelLevels:function(t){t.actions=[{action:"lock-channels-to-levels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,red:null!=t.red?t.red:[0],green:null!=t.green?t.green:[0],blue:null!=t.blue?t.blue:[0],alpha:null!=t.alpha?t.alpha:[255]}]},channels:function(t){t.actions=[{action:"modulate-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,red:null!=t.red?t.red:1,green:null!=t.green?t.green:1,blue:null!=t.blue?t.blue:1,alpha:null!=t.alpha?t.alpha:1}]},channelstep:function(t){let e=null!=t.clamp?t.clamp:"down";["down","round","up"].includes(e)||(e="down"),t.actions=[{action:"step-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,clamp:e,red:null!=t.red?t.red:1,green:null!=t.green?t.green:1,blue:null!=t.blue?t.blue:1}]},channelsToAlpha:function(t){t.actions=[{action:"channels-to-alpha",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue}]},chroma:function(t){const e=[],i=[];null!=t.ranges&&t.ranges.forEach((t=>{6===t.length?e.push(t):2===t.length&&(t[0].substring&&t[1].substring&&(i.length=0,t.forEach((t=>{let[e,s,n]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t);i.push(e,s,n)}))),e.push(i))})),t.actions=[{action:"chroma",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,ranges:e}]},chromakey:function(t){let e=null!=t.red?t.red:0,i=null!=t.green?t.green:255,s=null!=t.blue?t.blue:0;null!=t.reference&&([e,i,s]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.reference),t.red=e,t.green=i,t.blue=s,delete t.reference),t.actions=[{action:"colors-to-alpha",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,red:e,green:i,blue:s,transparentAt:null!=t.transparentAt?t.transparentAt:0,opaqueAt:null!=t.opaqueAt?t.opaqueAt:1}]},clampChannels:function(t){let e=null!=t.lowRed?t.lowRed:0,i=null!=t.lowGreen?t.lowGreen:0,s=null!=t.lowBlue?t.lowBlue:0,n=null!=t.highRed?t.highRed:255,r=null!=t.highGreen?t.highGreen:255,o=null!=t.highBlue?t.highBlue:255;null!=t.lowColor&&([e,i,s]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.lowColor),t.lowRed=e,t.lowGreen=i,t.lowBlue=s,delete t.lowColor),null!=t.highColor&&([n,r,o]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.highColor),t.highRed=n,t.highGreen=r,t.highBlue=o,delete t.highColor),t.actions=[{action:"clamp-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,lowRed:e,lowGreen:i,lowBlue:s,highRed:n,highGreen:r,highBlue:o}]},compose:function(t){t.actions=[{action:"compose",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",lineMix:null!=t.lineMix?t.lineMix:"",compose:null!=t.compose?t.compose:"source-over",offsetX:null!=t.offsetX?t.offsetX:0,offsetY:null!=t.offsetY?t.offsetY:0,opacity:null!=t.opacity?t.opacity:1}]},corrode:function(t){t.actions=[{action:"corrode",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",width:null!=t.width?t.width:3,height:null!=t.height?t.height:3,offsetX:null!=t.offsetX?t.offsetX:1,offsetY:null!=t.offsetY?t.offsetY:1,includeRed:null!=t.includeRed&&t.includeRed,includeGreen:null!=t.includeGreen&&t.includeGreen,includeBlue:null!=t.includeBlue&&t.includeBlue,includeAlpha:null==t.includeAlpha||t.includeAlpha,operation:null!=t.operation?t.operation:"mean",opacity:null!=t.opacity?t.opacity:1}]},curveWeights:function(t){t.actions=[{action:"vary-channels-by-weights",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,weights:null!=t.weights&&t.weights,useMixedChannel:null==t.useMixedChannel||t.useMixedChannel}]},cyan:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeGreen:!0,includeBlue:!0,excludeRed:!0}]},displace:function(t){t.actions=[{action:"displace",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",lineMix:null!=t.lineMix?t.lineMix:"",opacity:null!=t.opacity?t.opacity:1,channelX:null!=t.channelX?t.channelX:"red",channelY:null!=t.channelY?t.channelY:"green",offsetX:null!=t.offsetX?t.offsetX:0,offsetY:null!=t.offsetY?t.offsetY:0,scaleX:null!=t.scaleX?t.scaleX:1,scaleY:null!=t.scaleY?t.scaleY:1,transparentEdges:null!=t.transparentEdges&&t.transparentEdges}]},edgeDetect:function(t){t.actions=[{action:"matrix",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,width:3,height:3,offsetX:1,offsetY:1,includeRed:!0,includeGreen:!0,includeBlue:!0,includeAlpha:!1,weights:[0,1,0,1,-4,1,0,1,0]}]},emboss:function(t){const e=[];t.useNaturalGrayscale?e.push({action:"grayscale",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:"emboss-work"}):e.push({action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:"emboss-work",includeRed:!0,includeGreen:!0,includeBlue:!0}),t.clamp&&e.push({action:"clamp-channels",lineIn:"emboss-work",lineOut:"emboss-work",lowRed:0+t.clamp,lowGreen:0+t.clamp,lowBlue:0+t.clamp,highRed:255-t.clamp,highGreen:255-t.clamp,highBlue:255-t.clamp}),t.smoothing&&e.push({action:"gaussian-blur",lineIn:"emboss-work",lineOut:"emboss-work",radius:t.smoothing}),e.push({action:"emboss",lineIn:"emboss-work",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,angle:null!=t.angle?t.angle:0,strength:null!=t.strength?t.strength:1,tolerance:null!=t.tolerance?t.tolerance:0,keepOnlyChangedAreas:null!=t.keepOnlyChangedAreas&&t.keepOnlyChangedAreas,postProcessResults:null==t.postProcessResults||t.postProcessResults}),t.actions=e},flood:function(t){let e=null!=t.red?t.red:0,i=null!=t.green?t.green:0,s=null!=t.blue?t.blue:0,n=null!=t.alpha?t.alpha:255,r=null!=t.excludeAlpha&&t.excludeAlpha;null!=t.reference&&([e,i,s,n]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.reference),n=Math.round(255*n),t.red=e,t.green=i,t.blue=s,t.alpha=n,delete t.reference),t.actions=[{action:"flood",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,red:e,green:i,blue:s,alpha:n,excludeAlpha:r}]},gaussianBlur:function(t){t.actions=[{action:"gaussian-blur",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,radius:null!=t.radius?t.radius:1}]},glitch:function(t){t.actions=[{action:"glitch",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,useMixedChannel:null==t.useMixedChannel||t.useMixedChannel,seed:null!=t.seed?t.seed:"some-random-string-or-other",step:null!=t.step?t.step:1,offsetMin:null!=t.offsetMin?t.offsetMin:0,offsetMax:null!=t.offsetMax?t.offsetMax:0,offsetRedMin:null!=t.offsetRedMin?t.offsetRedMin:0,offsetRedMax:null!=t.offsetRedMax?t.offsetRedMax:0,offsetGreenMin:null!=t.offsetGreenMin?t.offsetGreenMin:0,offsetGreenMax:null!=t.offsetGreenMax?t.offsetGreenMax:0,offsetBlueMin:null!=t.offsetBlueMin?t.offsetBlueMin:0,offsetBlueMax:null!=t.offsetBlueMax?t.offsetBlueMax:0,offsetAlphaMin:null!=t.offsetAlphaMin?t.offsetAlphaMin:0,offsetAlphaMax:null!=t.offsetAlphaMax?t.offsetAlphaMax:0,transparentEdges:null!=t.transparentEdges&&t.transparentEdges,level:null!=t.level?t.level:0}]},gray:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:!0,includeGreen:!0,includeBlue:!0}]},grayscale:function(t){t.actions=[{action:"grayscale",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1}]},green:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,excludeRed:!0,excludeBlue:!0}]},image:function(t){t.actions=[{action:"process-image",lineOut:null!=t.lineOut?t.lineOut:"",asset:null!=t.asset?t.asset:"",width:null!=t.width?t.width:1,height:null!=t.height?t.height:1,copyWidth:null!=t.copyWidth?t.copyWidth:1,copyHeight:null!=t.copyHeight?t.copyHeight:1,copyX:null!=t.copyX?t.copyX:0,copyY:null!=t.copyY?t.copyY:0}]},invert:function(t){t.actions=[{action:"invert-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:!0,includeGreen:!0,includeBlue:!0}]},magenta:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:!0,includeBlue:!0,excludeGreen:!0}]},mapToGradient:function(t){t.gradient&&t.gradient.substring&&(t.gradient=P[t.gradient]),t.actions=[{action:"map-to-gradient",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,useNaturalGrayscale:null!=t.useNaturalGrayscale&&t.useNaturalGrayscale,gradient:t.gradient||In()}]},matrix:function(t){t.actions=[{action:"matrix",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,width:3,height:3,offsetX:1,offsetY:1,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha,weights:null!=t.weights?t.weights:[0,0,0,0,1,0,0,0,0]}]},matrix5:function(t){t.actions=[{action:"matrix",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,width:5,height:5,offsetX:2,offsetY:2,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha,weights:null!=t.weights?t.weights:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]}]},newsprint:function(t){t.actions=[{action:"newsprint",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,width:null!=t.width?t.width:1}]},notblue:function(t){t.actions=[{action:"set-channel-to-level",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeBlue:!0,level:0}]},notgreen:function(t){t.actions=[{action:"set-channel-to-level",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeGreen:!0,level:0}]},notred:function(t){t.actions=[{action:"set-channel-to-level",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:!0,level:0}]},offset:function(t){t.actions=[{action:"offset",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,offsetRedX:null!=t.offsetX?t.offsetX:0,offsetRedY:null!=t.offsetY?t.offsetY:0,offsetGreenX:null!=t.offsetX?t.offsetX:0,offsetGreenY:null!=t.offsetY?t.offsetY:0,offsetBlueX:null!=t.offsetX?t.offsetX:0,offsetBlueY:null!=t.offsetY?t.offsetY:0,offsetAlphaX:null!=t.offsetX?t.offsetX:0,offsetAlphaY:null!=t.offsetY?t.offsetY:0}]},offsetChannels:function(t){t.actions=[{action:"offset",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,offsetRedX:null!=t.offsetRedX?t.offsetRedX:0,offsetRedY:null!=t.offsetRedY?t.offsetRedY:0,offsetGreenX:null!=t.offsetGreenX?t.offsetGreenX:0,offsetGreenY:null!=t.offsetGreenY?t.offsetGreenY:0,offsetBlueX:null!=t.offsetBlueX?t.offsetBlueX:0,offsetBlueY:null!=t.offsetBlueY?t.offsetBlueY:0,offsetAlphaX:null!=t.offsetAlphaX?t.offsetAlphaX:0,offsetAlphaY:null!=t.offsetAlphaY?t.offsetAlphaY:0}]},pixelate:function(t){t.actions=[{action:"pixelate",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,tileWidth:null!=t.tileWidth?t.tileWidth:1,tileHeight:null!=t.tileHeight?t.tileHeight:1,offsetX:null!=t.offsetX?t.offsetX:0,offsetY:null!=t.offsetY?t.offsetY:0,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha}]},randomNoise:function(t){const e=["random","ordered","bluenoise"].includes(t.noiseType)?t.noiseType:"random";t.actions=[{action:"random-noise",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,width:null!=t.width?t.width:1,height:null!=t.height?t.height:1,seed:null!=t.seed?t.seed:"some-random-string-or-other",noiseType:e,level:null!=t.level?t.level:0,noWrap:null!=t.noWrap&&t.noWrap,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null==t.includeAlpha||t.includeAlpha,excludeTransparentPixels:null==t.excludeTransparentPixels||t.excludeTransparentPixels}]},red:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,excludeGreen:!0,excludeBlue:!0}]},reducePalette:function(t){let e=null!=t.palette?t.palette:"black-white";t.actions=[],e.substring&&e.includes(",")&&(e=e.split(","),e.forEach((t=>t.trim())));let i=t.useBluenoise?"bluenoise":t.noiseType||"random";["random","ordered","bluenoise"].includes(i)||(i="random"),t.actions.push({action:"reduce-palette",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",seed:null!=t.seed?t.seed:"some-random-string-or-other",minimumColorDistance:null!=t.minimumColorDistance?t.minimumColorDistance:1e3,useLabForPaletteDistance:null!=t.useLabForPaletteDistance&&t.useLabForPaletteDistance,palette:e,noiseType:i,opacity:null!=t.opacity?t.opacity:1})},saturation:function(t){let e=null!=t.level?t.level:1;t.actions=[{action:"modulate-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,red:e,green:e,blue:e,saturation:!0}]},sepia:function(t){t.actions=[{action:"tint-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,redInRed:.393,redInGreen:.349,redInBlue:.272,greenInRed:.769,greenInGreen:.686,greenInBlue:.534,blueInRed:.189,blueInGreen:.168,blueInBlue:.131}]},sharpen:function(t){t.actions=[{action:"matrix",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,width:3,height:3,offsetX:1,offsetY:1,includeRed:!0,includeGreen:!0,includeBlue:!0,includeAlpha:!1,weights:[0,-1,0,-1,5,-1,0,-1,0]}]},swirl:function(t){let e=null!=t.startX?t.startX:"50%",i=null!=t.startY?t.startY:"50%",s=null!=t.innerRadius?t.innerRadius:0,n=null!=t.outerRadius?t.outerRadius:"30%",r=null!=t.angle?t.angle:0,o=null!=t.easing?t.easing:"linear";const a=[...null!=t.staticSwirls?t.staticSwirls:[]];a.push([e,i,s,n,r,o]),t.actions=[{action:"swirl",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,swirls:a}]},threshold:function(t){let e=null!=t.lowRed?t.lowRed:0,i=null!=t.lowGreen?t.lowGreen:0,s=null!=t.lowBlue?t.lowBlue:0,n=null!=t.lowAlpha?t.lowAlpha:255,r=null!=t.highRed?t.highRed:255,o=null!=t.highGreen?t.highGreen:255,a=null!=t.highBlue?t.highBlue:255,l=null!=t.highAlpha?t.highAlpha:255;null!=t.lowColor&&([e,i,s,n]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.lowColor),n=Math.round(255*n),t.lowRed=e,t.lowGreen=i,t.lowBlue=s,t.lowAlpha=n,t.low=[e,i,s,n],delete t.lowColor),null!=t.highColor&&([r,o,a,l]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.highColor),l=Math.round(255*l),t.highRed=r,t.highGreen=o,t.highBlue=a,t.highAlpha=l,t.high=[r,o,a,l],delete t.highColor);let h=null!=t.low?t.low:[e,i,s,n],c=null!=t.high?t.high:[r,o,a,l];t.actions=[{action:"threshold",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,level:null!=t.level?t.level:128,red:null!=t.red?t.red:128,green:null!=t.green?t.green:128,blue:null!=t.blue?t.blue:128,alpha:null!=t.alpha?t.alpha:128,low:h,high:c,includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha,useMixedChannel:null==t.useMixedChannel||t.useMixedChannel}]},tiles:function(t){t.actions=[{action:"tiles",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,tileWidth:null!=t.tileWidth?t.tileWidth:1,tileHeight:null!=t.tileHeight?t.tileHeight:1,tileRadius:null!=t.tileRadius?t.tileRadius:1,offsetX:null!=t.offsetX?t.offsetX:0,offsetY:null!=t.offsetY?t.offsetY:0,angle:null!=t.angle?t.angle:0,points:null!=t.points?t.points:"rect-grid",seed:null!=t.seed?t.seed:"some-random-string-or-other",includeRed:null==t.includeRed||t.includeRed,includeGreen:null==t.includeGreen||t.includeGreen,includeBlue:null==t.includeBlue||t.includeBlue,includeAlpha:null!=t.includeAlpha&&t.includeAlpha}]},tint:function(t){let e=null!=t.redInRed?t.redInRed:1,i=null!=t.redInGreen?t.redInGreen:0,s=null!=t.redInBlue?t.redInBlue:0,n=null!=t.greenInRed?t.greenInRed:0,r=null!=t.greenInGreen?t.greenInGreen:1,o=null!=t.greenInBlue?t.greenInBlue:0,a=null!=t.blueInRed?t.blueInRed:0,l=null!=t.blueInGreen?t.blueInGreen:0,h=null!=t.blueInBlue?t.blueInBlue:1;null!=t.redColor&&([e,n,a]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.redColor),e/=255,n/=255,a/=255,t.redInRed=e,t.greenInRed=n,t.blueInRed=a,delete t.redColor),null!=t.greenColor&&([i,r,l]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.greenColor),i/=255,r/=255,l/=255,t.redInGreen=i,t.greenInGreen=r,t.blueInGreen=l,delete t.greenColor),null!=t.blueColor&&([s,o,h]=window.scrawlEnvironmentColorChecker.extractRGBfromColor(t.blueColor),s/=255,o/=255,h/=255,t.redInBlue=s,t.greenInBlue=o,t.blueInBlue=h,delete t.blueColor),t.actions=[{action:"tint-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,redInRed:e,redInGreen:i,redInBlue:s,greenInRed:n,greenInGreen:r,greenInBlue:o,blueInRed:a,blueInGreen:l,blueInBlue:h}]},userDefined:function(t){t.actions=[{action:"user-defined-legacy",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1}]},yellow:function(t){t.actions=[{action:"average-channels",lineIn:null!=t.lineIn?t.lineIn:"",lineOut:null!=t.lineOut?t.lineOut:"",opacity:null!=t.opacity?t.opacity:1,includeRed:!0,includeGreen:!0,excludeBlue:!0}]}},Ln=function(t){return!!t&&new Filter(t)};E.Filter=Filter;const Force=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.set(t),this.action||(this.action=_),this};let $n=Force.prototype=Object.create(Object.prototype);$n.type="Force",$n.lib="force",$n.isArtefact=!1,$n.isAsset=!1,$n=Bt($n);$n.defs=lt($n.defs,{action:null}),$n.packetFunctions=ct($n.packetFunctions,["action"]),$n.kill=function(){return this.deregister(),!0},$n.setters.action=function(t){nt(t)?this.action=t:this.action=_};const jn=function(t){return!!t&&new Force(t)};E.Force=Force,jn({name:"gravity",action:(t,e,i)=>{let{mass:s,load:n}=t,r=Ri();r.setFromVector(e.gravity).scalarMultiply(s),n.vectorAdd(r),Fi(r)}});const Grid=function(t=Q){return this.tileFill=[],this.tileSources=[],this.entityInit(t),t.tileSources||(this.tileSources=[].concat([{type:"color",source:"#000000"},{type:"color",source:"#ffffff"}])),t.tileFill?Array.isArray(t.tileFill)&&this.tileFill.length===t.tileFill.length&&(this.tileFill=t.tileFill):(this.tileFill.length=this.columns*this.rows,this.tileFill.fill(0)),this.tilePaths=[],this.tileRealCoordinates=[],this.tileVirtualCoordinates=[],t.dimensions||(t.width||(this.currentDimensions[0]=this.dimensions[0]=20),t.height||(this.currentDimensions[1]=this.dimensions[1]=20)),this};let Xn=Grid.prototype=Object.create(Object.prototype);Xn.type="Grid",Xn.lib="entity",Xn.isArtefact=!0,Xn.isAsset=!1,Xn=Bt(Xn),Xn=$s(Xn);Xn.defs=lt(Xn.defs,{columns:2,rows:2,columnGutterWidth:1,rowGutterWidth:1,tileSources:null,tileFill:null,gutterColor:"#808080"}),Xn.packetExclusions=ct(Xn.packetExclusions,["tileSources"]),Xn.finalizePacketOut=function(t,e){let i=t.tileSources=[];this.tileSources.forEach((t=>{i.push({type:t.type,source:ot(t.source)?t.source.name:t.source})})),ot(t.gutterColor)&&(t.gutterColor=t.gutterColor.name);let s=JSON.parse(this.state.saveAsPacket(e))[3];return t=lt(t,s),t=this.handlePacketAnchor(t,e)},Xn.getters;let Yn=Xn.setters,Nn=Xn.deltaSetters;Yn.columns=function(t){if(rt(t)&&(Number.isInteger(t)||(t=parseInt(t,10)),t!==this.columns)){let e,i,s,n=this.tileFill,r=this.columns,o=[];for(this.columns=t,e=0,i=this.rows;e<i;e++)for(s=0;s<t;s++)s<r?o.push(n[e*r+s]):o.push(0);this.tileFill=o}this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},Nn.columns=_,Yn.rows=function(t){if(rt(t)&&(Number.isInteger(t)||(t=parseInt(t,10)),t!==this.rows)){let e=this.rows;this.rows=t,this.tileFill.length=this.columns*t,e<t&&this.tileFill.fill(0,e*this.columns)}this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},Nn.rows=_,Xn.setAllTilesTo=function(t){return rt(t)&&(Number.isInteger(t)||(t=parseInt(t,10)),this.tileFill.fill(t),this.dirtyFilterIdentifier=!0),this},Xn.setTileFill=function(t){const{columns:e,rows:i}=this;return Array.isArray(t)&&t.length===e*i&&(this.tileFill=t,this.dirtyFilterIdentifier=!0),this},Xn.setTilesTo=function(t,e){let i=this.tileFill;return dt(t)&&rt(e)&&(Number.isInteger(e)||(e=parseInt(e,10)),rt(t)?i[t]=e:Array.isArray(t)&&t.forEach((t=>{rt(t)&&(i[t]=e)})),this.dirtyFilterIdentifier=!0),this},Xn.setTileSourceTo=function(t,e){return rt(t)&&ot(e)&&e.type&&e.source&&(this.tileSources[t]=e),this},Xn.removeTileSource=function(t){return rt(t)&&t&&(this.tileSources[t]=null,this.tileFill=this.tileFill.map((e=>e===t?0:e))),this},Xn.getTileSource=function(t,e){if(rt(t))return rt(e)?this.tileFill[t*this.rows+e]:this.tileFill[t]},Xn.getTilesUsingSource=function(t){let e=[];return rt(t)&&this.tileFill.forEach(((i,s)=>i==t&&e.push(s))),e},Xn.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){let t=this.pathObject=new Path2D,e=new Path2D,i=new Path2D,s=this.currentStampHandlePosition,n=this.currentScale,r=this.currentDimensions,o=-s[0]*n,a=-s[1]*n,l=r[0]*n,h=r[1]*n;t.rect(o,a,l,h);let c,u,d,f,p=this.columns,m=this.rows,g=l/p,y=h/m,b=this.tilePaths,S=this.tileRealCoordinates,k=this.tileVirtualCoordinates;for(e.moveTo(o,a),e.lineTo(o+l,a),c=1;c<=m;c++){let t=a+c*y;e.moveTo(o,t),e.lineTo(o+l,t)}for(this.rowLines=e,i.moveTo(o,a),i.lineTo(o,a+h),u=1;u<=p;u++){let t=o+u*g;i.moveTo(t,a),i.lineTo(t,a+h)}for(this.columnLines=i,b.length=0,S.length=0,k.length=0,c=0;c<m;c++)for(u=0;u<p;u++){let t=new Path2D;d=u*g,f=c*y,t.rect(o+d,a+f,g,y),b.push(t),k.push([d,f]),S.push([o+d,a+f])}this.currentTileWidth=g,this.currentTileHeight=y}},Xn.performFill=function(t){t.save();let e,i=ai(),s=i.engine,n=i.element,r=this.tileSources,o=this.tileFill,a=this.tilePaths,l=this.tileRealCoordinates,h=this.tileVirtualCoordinates,c=this.winding,u=this.currentTileWidth,d=this.currentTileHeight,p=this.scale,m=this.currentDimensions;r.forEach(((r,g)=>{if(r&&r.type)switch(r.type){case"color":t.fillStyle=r.source;break;case"cellGradient":this.lockFillStyleToEntity=!1,t.fillStyle=r.source.getData(this,this.currentHost);break;case"gridGradient":this.lockFillStyleToEntity=!0,t.fillStyle=r.source.getData(this,this.currentHost)}let y=o.map((t=>t===g));if(y.length)switch(r.type){case"gridPicture":e=r.source.substring?f[r.source]:r.source,e.simpleStamp&&(n.width=m[0]*p,n.height=m[1]*p,s.globalCompositeOperation="source-over",s.fillStyle="#000000",y.forEach(((t,e)=>{t&&s.fillRect(h[e][0],h[e][1],u,d)})),s.globalCompositeOperation="source-in",e.simpleStamp(i,{startX:0,startY:0,width:m[0]*p,height:m[1]*p,method:"fill"}),t.drawImage(n,l[0][0],l[0][1]));break;case"tilePicture":e=r.source.substring?f[r.source]:r.source,e.simpleStamp&&(n.width=u,n.height=d,s.globalCompositeOperation="source-over",e.simpleStamp(i,{startX:0,startY:0,width:u,height:d,method:"fill"}),y.forEach(((e,i)=>e&&t.drawImage(n,l[i][0],l[i][1]))));break;default:y.forEach(((e,i)=>e&&t.fill(a[i],c)))}}));let g,y=this.gutterColor,b=this.rowGutterWidth,S=this.columnGutterWidth;if(dt(y)){switch(y.substring?g={type:"color",source:this.gutterColor}:ot(y)?g=y:rt(y)&&ot(r[y])&&(g=r[y]),g.type){case"cellGradient":this.lockFillStyleToEntity=!1,t.strokeStyle=g.source.getData(this,this.currentHost);break;case"gridGradient":this.lockFillStyleToEntity=!0,t.strokeStyle=g.source.getData(this,this.currentHost);break;case"color":t.strokeStyle=g.source}switch(g.type){case"gridPicture":case"tilePicture":if((b||S)&&(e=g.source.substring?f[g.source]:g.source,e.simpleStamp)){let r=this.currentStampHandlePosition,o=this.currentScale,a=r[0]*o,h=r[1]*o;n.width=m[0]*o,n.height=m[1]*o,s.globalCompositeOperation="source-over",s.strokeStyle="#000000",s.translate(a,h),b&&(s.lineWidth=b,s.stroke(this.rowLines)),S&&(s.lineWidth=S,s.stroke(this.columnLines)),s.globalCompositeOperation="source-in",e.simpleStamp(i,{startX:0,startY:0,width:m[0]*o,height:m[1]*o,method:"fill"}),t.drawImage(n,l[0][0],l[0][1]),s.translate(0,0)}break;default:b&&(t.lineWidth=b,t.stroke(this.rowLines)),S&&(t.lineWidth=S,t.stroke(this.columnLines))}}li(i),t.restore()},Xn.fill=function(t){this.performFill(t)},Xn.drawAndFill=function(t){let e=this.pathObject;t.stroke(e),this.currentHost.clearShadow(),this.performFill(t)},Xn.fillAndDraw=function(t){let e=this.pathObject;t.stroke(e),this.currentHost.clearShadow(),this.performFill(t),t.stroke(e)},Xn.drawThenFill=function(t){let e=this.pathObject;t.stroke(e),this.performFill(t)},Xn.fillThenDraw=function(t){let e=this.pathObject;this.performFill(t),t.stroke(e)},Xn.checkHit=function(t=[],e){if(this.noUserInteraction)return!1;this.pathObject&&!this.dirtyPathObject||this.cleanPathObject();let i=Array.isArray(t)?t:[t],s=!1;e||(e=ai(),s=!0);let n,r,o,a=e.engine,l=this.currentStampPosition,h=l[0],c=l[1],u=new Set,d=this.tilePaths;const f=t=>{let e,i;if(Array.isArray(t))e=t[0],i=t[1];else{if(!ft(t,t.x,t.y))return[!1];e=t.x,i=t.y}return!e.toFixed||!i.toFixed||isNaN(e)||isNaN(i)?[!1]:[!0,e,i]};return e.rotateDestination(a,h,c,this),i.some((t=>([n,r,o]=f(t),!!n&&a.isPointInPath(this.pathObject,r,o,this.winding))),this)?(i.forEach((t=>{[n,r,o]=f(t),n&&d.some(((t,e)=>!!a.isPointInPath(t,r,o,this.winding)&&(u.add(e),!0)))})),s&&li(e),{x:r,y:o,tiles:[...u],artefact:this}):(s&&li(e),!1)};const Gn=function(t){return!!t&&new Grid(t)};E.Grid=Grid;const Line=function(t=Q){return this.curveInit(t),this.shapeInit(t),this};let zn=Line.prototype=Object.create(Object.prototype);zn.type="Line",zn.lib="entity",zn.isArtefact=!0,zn.isAsset=!1,zn=Bt(zn),zn=Vs(zn),zn=_s(zn),zn.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeLinePath(),this.pathDefinition=t},zn.makeLinePath=function(){let[t,e]=this.currentStampPosition,[i,s]=this.currentEnd;return`m0,0l${(i-t).toFixed(2)},${(s-e).toFixed(2)}`},zn.cleanDimensions=function(){this.dirtyDimensions=!1,this.dirtyHandle=!0,this.dirtyOffset=!0,this.dirtyStart=!0,this.dirtyEnd=!0},zn.preparePinsForStamp=function(){const t=this.dirtyPins,e=this.endPivot,i=this.endPath;for(let s,n=0,r=t.length;n<r;n++)s=t[n],(e&&e.name==s||i&&i.name==s)&&(this.dirtyEnd=!0,this.endLockTo.includes("path")&&(this.currentEndPathData=!1));t.length=0};const Wn=function(t){return!!t&&(t.species="line",new Line(t))};E.Line=Line;const LineSpiral=function(t=Q){return this.shapeInit(t),this};let Vn=LineSpiral.prototype=Object.create(Object.prototype);Vn.type="LineSpiral",Vn.lib="entity",Vn.isArtefact=!0,Vn.isAsset=!1,Vn=Bt(Vn),Vn=Vs(Vn);Vn.defs=lt(Vn.defs,{startRadius:0,radiusIncrement:.1,radiusIncrementAdjust:1,startAngle:0,angleIncrement:5,angleIncrementAdjust:1,stepLimit:100});let Zn=Vn.setters,_n=Vn.deltaSetters;Zn.startRadius=function(t){this.startRadius=t,this.updateDirty()},_n.startRadius=function(t){this.startRadius+=t,this.updateDirty()},Zn.radiusIncrement=function(t){this.radiusIncrement=t,this.updateDirty()},_n.radiusIncrement=function(t){this.radiusIncrement+=t,this.updateDirty()},Zn.radiusIncrementAdjust=function(t){this.radiusIncrementAdjust=t,this.updateDirty()},_n.radiusIncrementAdjust=function(t){this.radiusIncrementAdjust+=t,this.updateDirty()},Zn.startAngle=function(t){this.startAngle=t,this.updateDirty()},_n.startAngle=function(t){this.startAngle+=t,this.updateDirty()},Zn.angleIncrement=function(t){this.angleIncrement=t,this.updateDirty()},_n.angleIncrement=function(t){this.angleIncrement+=t,this.updateDirty()},Zn.angleIncrementAdjust=function(t){this.angleIncrementAdjust=t,this.updateDirty()},_n.angleIncrementAdjust=function(t){this.angleIncrementAdjust+=t,this.updateDirty()},Zn.stepLimit=function(t){this.stepLimit=t,this.updateDirty()},_n.stepLimit=function(t){this.stepLimit+=t,this.updateDirty()},Vn.cleanSpecies=function(){this.dirtySpecies=!1;let t="m0,0";t=this.makeLineSpiralPath(),this.pathDefinition=t},Vn.makeLineSpiralPath=function(){let t="m0,0 m",{startRadius:e,radiusIncrement:i,radiusIncrementAdjust:s,startAngle:n,angleIncrement:r,angleIncrementAdjust:o,stepLimit:a}=this,l=Re(),h=n,c=r,u=e,d=i,f=0;for(l.setFromArray([0,u]).rotate(h),t+=`${l[0].toFixed(1)},${l[1].toFixed(1)}l`;f<a;)f++,c*=o,h+=c,d*=s,u+=d,l.setFromArray([0,u]).rotate(h),t+=`${l[0].toFixed(1)},${l[1].toFixed(1)} `;return Fe(l),t},Vn.calculateLocalPathAdditionalActions=function(){let[t,e,i,s]=this.localBox,n=this.scale;this.pathDefinition=this.pathDefinition.replace("m0,0 ",`m${-t/n},${-e/n}`),this.pathCalculatedOnce=!1,this.calculateLocalPath(this.pathDefinition,!0)};const Un=function(t){return!!t&&(t.species="linespiral",new LineSpiral(t))};E.LineSpiral=LineSpiral;const Loom=function(t=Q){return this.makeName(t.name),this.register(),this.state=Ce(Q),this.set(this.defs),t.group||(t.group=hs),this.onEnter=_,this.onLeave=_,this.onDown=_,this.onUp=_,this.delta={},this.set(t),this.fromPathData=[],this.toPathData=[],this.watchFromPath=null,this.watchIndex=-1,this.engineInstructions=[],this.engineDeltaLengths=[],this};let Kn=Loom.prototype=Object.create(Object.prototype);Kn.type="Loom",Kn.lib="entity",Kn.isArtefact=!0,Kn.isAsset=!1,Kn=Bt(Kn),Kn=We(Kn),Kn=qe(Kn);Kn.defs=lt(Kn.defs,{fromPath:null,toPath:null,fromPathStart:0,fromPathEnd:1,toPathStart:0,toPathEnd:1,synchronizePathCursors:!0,loopPathCursors:!0,constantPathSpeed:!0,isHorizontalCopy:!0,showBoundingBox:!1,boundingBoxColor:"#000000",source:null,sourceIsVideoOrSprite:!1,interferenceLoops:2,interferenceFactor:1.03,visibility:!0,calculateOrder:0,stampOrder:0,host:null,group:null,anchor:null,noCanvasEngineUpdates:!1,noDeltaUpdates:!1,onEnter:null,onLeave:null,onDown:null,onUp:null,noUserInteraction:!1,method:"fill"}),Kn.packetExclusions=ct(Kn.packetExclusions,["pathObject","state"]),Kn.packetExclusionsByRegex=ct(Kn.packetExclusionsByRegex,["^(local|dirty|current)","Subscriber$"]),Kn.packetCoordinates=ct(Kn.packetCoordinates,[]),Kn.packetObjects=ct(Kn.packetObjects,["group","fromPath","toPath","source"]),Kn.packetFunctions=ct(Kn.packetFunctions,["onEnter","onLeave","onDown","onUp"]),Kn.processPacketOut=function(t,e,i){let s=!0;return i.indexOf(t)<0&&e===this.defs[t]&&(s=!1),s},Kn.finalizePacketOut=function(t,e){let i=JSON.parse(this.state.saveAsPacket(e))[3];return t=lt(t,i),t=this.handlePacketAnchor(t,e)},Kn.handlePacketAnchor=function(t,e){if(this.anchor){let i=JSON.parse(this.anchor.saveAsPacket(e))[3];t.anchor=i}return t},Kn.clone=K;let qn=Kn.getters,Qn=Kn.setters,Jn=Kn.deltaSetters;Kn.get=function(t){const e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t],s=this.state;return null!=i?(e=this[t],void 0!==e?e:i):(i=s.defs[t],null!=i?(e=s[t],void 0!==e?e:i):null)}},Kn.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs,r=this.state,o=r?r.setters:Q,a=r?r.defs:Q;let l,h,c,u;for(h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(xe.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=u)):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=u)))}return this},Kn.setDelta=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.deltaSetters,n=this.defs,r=this.state,o=r?r.deltaSetters:Q,a=r?r.defs:Q;let l,h,c,u;for(h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(xe.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=addStrings(this[c],u))):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=addStrings(r[c],u))))}return this},Qn.host=function(t){if(t){let e=o[t];e&&e.here?this.host=e.name:this.host=t}else this.host=""},qn.group=function(){return this.group?this.group.name:""},Qn.group=function(t){let e;t&&(this.group&&"Group"===this.group.type&&this.group.removeArtefacts(this.name),t.substring?(e=g[t],this.group=e||t):this.group=t),this.group&&"Group"===this.group.type&&this.group.addArtefacts(this.name)},Kn.getHere=function(){return currentCorePosition},Qn.delta=function(t){t&&(this.delta=ht(this.delta,t))},Qn.fromPath=function(t){if(t){let e=this.fromPath,i=t.substring?o[t]:t,s=this.name;i&&i.name&&i.useAsPath&&(e&&e.name!==i.name&&removeItem(e.pathed,s),ct(i.pathed,s),this.fromPath=i,this.dirtyStart=!0)}},Qn.toPath=function(t){if(t){let e=this.toPath,i=t.substring?o[t]:t,s=this.name;i&&i.name&&i.useAsPath&&(e&&e.name!==i.name&&removeItem(e.pathed,s),ct(i.pathed,s),this.toPath=i,this.dirtyStart=!0)}},Qn.source=function(t){if((t=t.substring?o[t]:t)&&"Picture"===t.type){let e=this.source;e&&"Picture"===e.type&&e.imageUnsubscribe(this.name),this.source=t,t.imageSubscribe(this.name),this.dirtyInput=!0}},Qn.isHorizontalCopy=function(t){this.isHorizontalCopy=!!t,this.dirtyPathData=!0},Qn.synchronizePathCursors=function(t){this.synchronizePathCursors=!!t,t&&(this.toPathStart=this.fromPathStart,this.toPathEnd=this.fromPathEnd),this.dirtyPathData=!0},Qn.loopPathCursors=function(t){if(this.loopPathCursors=!!t,t){let t,e=Math.floor;t=this.fromPathStart,(t<0||t>1)&&(this.fromPathStart=t-e(t)),t=this.fromPathEnd,(t<0||t>1)&&(this.fromPathEnd=t-e(t)),t=this.toPathStart,(t<0||t>1)&&(this.toPathStart=t-e(t)),t=this.toPathEnd,(t<0||t>1)&&(this.toPathEnd=t-e(t))}this.dirtyOutput=!0},Qn.fromPathStart=function(t){this.loopPathCursors&&(t<0||t>1)&&(t-=Math.floor(t)),this.fromPathStart=t,this.synchronizePathCursors&&(this.toPathStart=t),this.dirtyPathData=!0},Jn.fromPathStart=function(t){let e=this.fromPathStart+=t;this.loopPathCursors&&(e<0||e>1)&&(e-=Math.floor(e)),this.fromPathStart=e,this.synchronizePathCursors&&(this.toPathStart=e),this.dirtyPathData=!0},Qn.fromPathEnd=function(t){this.loopPathCursors&&(t<0||t>1)&&(t-=Math.floor(t)),this.fromPathEnd=t,this.synchronizePathCursors&&(this.toPathEnd=t),this.dirtyPathData=!0},Jn.fromPathEnd=function(t){let e=this.fromPathEnd+=t;this.loopPathCursors&&(e<0||e>1)&&(e-=Math.floor(e)),this.fromPathEnd=e,this.synchronizePathCursors&&(this.toPathEnd=e),this.dirtyPathData=!0},Qn.toPathStart=function(t){this.loopPathCursors&&(t<0||t>1)&&(t-=Math.floor(t)),this.toPathStart=t,this.synchronizePathCursors&&(this.fromPathStart=t),this.dirtyPathData=!0},Jn.toPathStart=function(t){let e=this.toPathStart+=t;this.loopPathCursors&&(e<0||e>1)&&(e-=Math.floor(e)),this.toPathStart=e,this.synchronizePathCursors&&(this.fromPathStart=e),this.dirtyPathData=!0},Qn.toPathEnd=function(t){this.loopPathCursors&&(t<0||t>1)&&(t-=Math.floor(t)),this.toPathEnd=t,this.synchronizePathCursors&&(this.fromPathEnd=t),this.dirtyPathData=!0},Jn.toPathEnd=function(t){let e=this.toPathEnd+=t;this.loopPathCursors&&(e<0||e>1)&&(e-=Math.floor(e)),this.toPathEnd=e,this.synchronizePathCursors&&(this.fromPathEnd=e),this.dirtyPathData=!0},Kn.getHost=function(){if(this.currentHost)return this.currentHost;if(this.host){let t=o[this.host];if(t)return this.currentHost=t,this.dirtyHost=!0,this.currentHost}return currentCorePosition},Kn.midInitActions=_,Kn.update=function(){this.dirtyInput=!0,this.dirtyOutput=!0},Kn.prepareStamp=function(){let t=this.fromPath,e=this.toPath,[i,s,n,r]=this.getBoundingBox();if(!this.dirtyPathData){let{x:i,y:s}=t.getPathPositionData(0),{x:n,y:r}=t.getPathPositionData(1),{x:o,y:a}=e.getPathPositionData(0),{x:l,y:h}=e.getPathPositionData(1),c=[i,s,n,r,o,a,l,h];this.pathTests&&!this.pathTests.some(((t,e)=>t!==c[e]))||(this.pathTests=c,this.dirtyPathData=!0)}if(this.dirtyPathData||!this.fromPathData.length){this.dirtyPathData=!1,this.watchIndex=-1,this.engineInstructions.length=0,this.engineDeltaLengths.length=0;let n=Math.ceil,r=Math.max,o=Math.min,a=this.fromPathData;a.length=0;let l=this.toPathData;if(l.length=0,t&&e){let h,c,u,d,f=n(t.length),p=n(e.length);h=this.setSourceDimension(r(f,p));let m,g,y,b=this.fromPathStart,S=this.fromPathEnd,k=this.toPathStart,A=this.toPathEnd,O=this.constantPathSpeed;m=b<S?S-b:S+(1-b),m<.005&&(m=.005),g=k<A?A-k:A+(1-k),g<.005&&(g=.005),y=n(o(m,g)),c=1/(h*(1/y));for(let n=0;n<=1;n+=c)({x:u,y:d}=t.getPathPositionData(n,O)),a.push([u-i,d-s]),({x:u,y:d}=e.getPathPositionData(n,O)),l.push([u-i,d-s]);this.fromPathSteps=m/y,this.toPathSteps=g/y,this.watchFromPath=1===this.fromPathSteps,this.dirtyOutput=!0}else this.dirtyPathData=!0}},Kn.setSourceDimension=function(t){if(t)this.sourceDimension!==t&&(this.sourceDimension=t,this.dirtyInput=!0);else{let t=this.fromPath,e=this.toPath;if(t&&e){let i=Math.ceil,s=i(t.length),n=i(e.length),r=Math.max(s,n);this.sourceDimension!==r&&(this.sourceDimension=r)}else this.sourceDimension=0}return this.sourceDimension},Kn.simpleStamp=function(t,e){t&&"Cell"===t.type&&(this.currentHost=t,e&&(this.set(e),this.prepareStamp()),this.regularStamp())},Kn.stamp=function(t=!1,e,i){if(t)return e&&"Cell"===e.type&&(this.currentHost=e),i&&(this.set(i),this.prepareStamp()),this.regularStamp();this.visibility&&((this.sourceIsVideoOrSprite||this.dirtyInput)&&(this.sourceImageData=this.cleanInput()),this.dirtyOutput&&(this.output=this.cleanOutput()),this.regularStamp())},Kn.cleanInput=function(){this.dirtyInput=!1;let t=this.sourceDimension;if(!t)return this.dirtyInput=!0,!1;let e=ai(),i=e.engine,s=e.element;return s.width=t,s.height=t,i.setTransform(1,0,0,1,0,0),this.source.stamp(!0,e,{startX:0,startY:0,handleX:0,handleY:0,offsetX:0,offsetY:0,roll:0,scale:1,width:t,height:t,method:"fill"}),i.getImageData(0,0,t,t)},Kn.cleanOutput=function(){this.dirtyOutput=!1;let t=this.sourceDimension,e=this.sourceImageData;if(t&&e){let i,s,n,r,o,a,l,h,c,u,d,f=Math.hypot,p=Math.floor,m=Math.ceil,g=Math.atan2,y=Math.cos,b=Math.sin,S=this.fromPathData,k=this.toPathData,A=S.length,O=this.fromPathStart*A,w=this.fromPathSteps||1,v=this.toPathStart*A,C=this.toPathSteps||1,x=.5*Math.PI,P=x-1.5708,D=this.isHorizontalCopy,R=this.loopPathCursors,F=this.watchFromPath,E=this.watchIndex,M=this.engineInstructions,I=this.engineDeltaLengths,[H,B,T,L]=this.getBoundingBox(),$=ai(),j=$.engine,X=$.element;X.width=t,X.height=t,j.setTransform(1,0,0,1,0,0),j.putImageData(e,0,0);let Y=ai(),N=Y.engine,G=Y.element;if(G.width=T,G.height=L,N.globalAlpha=this.state.globalAlpha,N.setTransform(1,0,0,1,0,0),!M.length){for(let e=0;e<t;e++)E<0&&(F&&O<1||!F&&v<1)&&(E=e),O<A&&v<A&&O>=0&&v>=0?([i,s]=S[p(O)],[n,r]=k[p(v)],o=n-i,a=r-s,l=f(o,a),D?(h=-g(o,a)+x,c=y(h),u=b(h),M.push([c,u,-u,c,i,s]),I.push(l)):(h=-g(o,a)+P,c=y(h),u=b(h),M.push([c,u,-u,c,i,s,l]),I.push(l))):(M.push(!1),I.push(!1)),O+=w,v+=C,R&&(O>=A&&(O-=A),v>=A&&(v-=A));E<0&&(E=0),this.watchIndex=E}if(D)for(let e=0;e<t;e++)d=M[E],d&&(N.setTransform(...d),N.drawImage(X,0,E,t,1,0,0,I[E],1)),E++,E>=t&&(E=0);else for(let e=0;e<t;e++)d=M[E],d&&(N.setTransform(...d),N.drawImage(X,E,0,1,t,0,0,1,I[E])),E++,E>=t&&(E=0);let z=this.interferenceFactor,W=this.interferenceLoops,V=m(T*z),Z=m(L*z);X.width=V,X.height=Z,N.setTransform(1,0,0,1,0,0),j.setTransform(1,0,0,1,0,0);for(let t=0;t<W;t++)j.drawImage(G,0,0,T,L,0,0,V,Z),N.drawImage(X,0,0,V,Z,0,0,T,L);let _=N.getImageData(0,0,T,L);return li($),li(Y),this.dirtyTargetImage=!0,_}return!1},Kn.regularStamp=function(){let t=this.currentHost;if(t){let e=t.engine;this.noCanvasEngineUpdates||t.setEngine(this),this[this.method](e)}},Kn.getBoundingBox=function(){let t=this.fromPath,e=this.toPath;if(t&&e){if(this.dirtyStart)if(t.getBoundingBox&&e.getBoundingBox){this.dirtyStart=!1;let[i,s,n,r,o,a]=t.getBoundingBox(),[l,h,c,u,d,f]=e.getBoundingBox();(isNaN(i)||isNaN(s)||isNaN(n)||isNaN(r)||isNaN(o)||isNaN(a)||isNaN(l)||isNaN(h)||isNaN(c)||isNaN(u)||isNaN(d)||isNaN(f))&&(this.dirtyStart=!0),i==l&&s==h&&n==c&&r==u&&o==d&&a==f&&(this.dirtyStart=!0),i+=o,s+=a,l+=d,h+=f;let p=Math.min(i,l),m=Math.max(i+n,l+c),g=Math.min(s,h),y=Math.max(s+r,h+u);this.boundingBox=[p,g,m-p,y-g],this.dirtyPathData=!0}else this.boundingBox=[0,0,0,0]}else this.boundingBox=[0,0,0,0];return this.boundingBox},Kn.fill=function(t){this.doFill(t),this.showBoundingBox&&this.drawBoundingBox(t)},Kn.draw=function(t){this.doStroke(t),this.showBoundingBox&&this.drawBoundingBox(t)},Kn.drawAndFill=function(t){this.doStroke(t),this.currentHost.clearShadow(),this.doFill(t),this.showBoundingBox&&this.drawBoundingBox(t)},Kn.fillAndDraw=function(t){this.doFill(t),this.currentHost.clearShadow(),this.doStroke(t),this.showBoundingBox&&this.drawBoundingBox(t)},Kn.drawThenFill=function(t){this.doStroke(t),this.doFill(t),this.showBoundingBox&&this.drawBoundingBox(t)},Kn.fillThenDraw=function(t){this.doFill(t),this.doStroke(t),this.showBoundingBox&&this.drawBoundingBox(t)},Kn.clear=function(t){let e=this.output,i=!!this.currentHost&&this.currentHost.element,s=t.globalCompositeOperation;if(e&&i){let i=ai(),n=i.engine,r=i.element,[o,a,l,h]=this.getBoundingBox();r.width=l,r.height=h,n.putImageData(e,0,0),t.setTransform(1,0,0,1,0,0),t.globalCompositeOperation="destination-out",t.drawImage(r,0,0,l,h,o,a,l,h),t.globalCompositeOperation=s,li(i),this.showBoundingBox&&this.drawBoundingBox(t)}},Kn.none=_,Kn.clip=_,Kn.doStroke=function(t){let e=this.fromPath,i=this.toPath;if(e&&e.getBoundingBox&&i&&i.getBoundingBox){let s=this.currentHost;if(s){let n=e.currentStampPosition,r=e.getPathPositionData(1),o=i.currentStampPosition,a=i.getPathPositionData(1);s.rotateDestination(t,n[0],n[1],e),t.stroke(e.pathObject),s.rotateDestination(t,o[0],o[1],e),t.stroke(i.pathObject),t.setTransform(1,0,0,1,0,0),t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(a.x,a.y),t.moveTo(...o),t.lineTo(...n),t.closePath(),t.stroke()}}},Kn.doFill=function(t){let e=this.output,i=!!this.currentHost&&this.currentHost.element;if(e&&i){let i=ai(),s=i.engine,n=i.element,[r,o,a,l]=this.getBoundingBox();n.width=a,n.height=l,s.putImageData(e,0,0),t.setTransform(1,0,0,1,0,0),t.drawImage(n,0,0,a,l,r,o,a,l),li(i)}},Kn.drawBoundingBox=function(t){this.dirtyStart&&this.getBoundingBox(),t.save();let e=t.getTransform();t.setTransform(1,0,0,1,0,0),t.strokeStyle=this.boundingBoxColor,t.lineWidth=1,t.globalCompositeOperation="source-over",t.globalAlpha=1,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.strokeRect(...this.boundingBox),t.restore(),t.setTransform(e)},Kn.checkHit=function(t=[]){if(this.noUserInteraction)return!1;let e,i,s,n,r,o=Array.isArray(t)?t:[t],a=!(!this.output||!this.output.data)&&this.output.data;if(a){let[t,l,h,c]=this.getBoundingBox();if(o.some((o=>{if(Array.isArray(o))e=o[0],i=o[1];else{if(!ft(o,o.x,o.y))return!1;e=o.x,i=o.y}return!(!e.toFixed||!i.toFixed||isNaN(e)||isNaN(i))&&(s=e-t,n=i-l,!(s<0||s>h||n<0||n>c)&&(r=4*(n*h+s)+3,!!a&&a[r]>0))}),this))return{x:e,y:i,artefact:this}}return!1};const tr=function(t){return!!t&&new Loom(t)};E.Loom=Loom;const Mesh=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.state=Ce(),t.group||(t.group=hs),this.onEnter=_,this.onLeave=_,this.onDown=_,this.onUp=_,this.delta={},this.set(t),this.fromPathData=[],this.toPathData=[],this.watchFromPath=null,this.watchIndex=-1,this.engineInstructions=[],this.engineDeltaLengths=[],this};let er=Mesh.prototype=Object.create(Object.prototype);er.type="Mesh",er.lib="entity",er.isArtefact=!0,er.isAsset=!1,er=Bt(er),er=We(er),er=qe(er);er.defs=lt(er.defs,{net:null,isHorizontalCopy:!0,source:null,sourceIsVideoOrSprite:!1,interferenceLoops:2,interferenceFactor:1.03,visibility:!0,calculateOrder:0,stampOrder:0,delta:null,host:null,group:null,anchor:null,noCanvasEngineUpdates:!1,noDeltaUpdates:!1,onEnter:null,onLeave:null,onDown:null,onUp:null,noUserInteraction:!1,method:"fill"}),er.packetExclusions=ct(er.packetExclusions,["pathObject","state"]),er.packetExclusionsByRegex=ct(er.packetExclusionsByRegex,["^(local|dirty|current)","Subscriber$"]),er.packetCoordinates=ct(er.packetCoordinates,[]),er.packetObjects=ct(er.packetObjects,["group","net","source"]),er.packetFunctions=ct(er.packetFunctions,["onEnter","onLeave","onDown","onUp"]),er.processPacketOut=function(t,e,i){let s=!0;return i.indexOf(t)<0&&e===this.defs[t]&&(s=!1),s},er.finalizePacketOut=function(t,e){let i=JSON.parse(this.state.saveAsPacket(e))[3];return t=lt(t,i),t=this.handlePacketAnchor(t,e)},er.handlePacketAnchor=function(t,e){if(this.anchor){let i=JSON.parse(this.anchor.saveAsPacket(e))[3];t.anchor=i}return t},er.clone=K;let ir=er.getters,sr=er.setters;er.deltaSetters,er.get=function(t){const e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t],s=this.state;return void 0!==i?(e=this[t],void 0!==e?e:i):(i=s.defs[t],void 0!==i?(e=s[t],void 0!==e?e:i):null)}},er.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs,r=this.state,o=r?r.setters:Q,a=r?r.defs:Q;let l,h,c,u;for(h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(xe.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=u,this.dirtyFilterIdentifier=!0)):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=u)))}return this},er.setDelta=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.deltaSetters,n=this.defs,r=this.state,o=r?r.deltaSetters:Q,a=r?r.defs:Q;let l,h,c,u;for(h=0;h<i;h++)c=e[h],u=t[c],c&&"name"!=c&&null!=u&&(xe.indexOf(c)<0?(l=s[c],l?l.call(this,u):void 0!==n[c]&&(this[c]=addStrings(this[c],u),this.dirtyFilterIdentifier=!0)):(l=o[c],l?l.call(r,u):void 0!==a[c]&&(r[c]=addStrings(r[c],u))))}return this},sr.host=function(t){if(t){let e=o[t];e&&e.here?this.host=e.name:this.host=t}else this.host="";this.dirtyFilterIdentifier=!0},ir.group=function(){return this.group?this.group.name:""},sr.group=function(t){let e;t&&(this.group&&"Group"===this.group.type&&this.group.removeArtefacts(this.name),t.substring?(e=group[t],this.group=e||t):this.group=t),this.group&&"Group"===this.group.type&&this.group.addArtefacts(this.name)},er.getHere=function(){return currentCorePosition},sr.net=function(t){t&&((t=t.substring?o[t]:t)&&"Net"===t.type&&(this.net=t,this.dirtyStart=!0),this.dirtyFilterIdentifier=!0)},sr.source=function(t){if((t=t.substring?o[t]:t)&&"Picture"===t.type){let e=this.source;e&&"Picture"===e.type&&e.imageUnsubscribe(this.name),this.source=t,t.imageSubscribe(this.name),this.dirtyInput=!0,this.dirtyFilterIdentifier=!0}},sr.isHorizontalCopy=function(t){this.isHorizontalCopy=!!t,this.dirtyPathData=!0,this.dirtyFilterIdentifier=!0},er.getHost=function(){if(this.currentHost)return this.currentHost;if(this.host){let t=o[this.host];if(t)return this.currentHost=t,this.dirtyHost=!0,this.currentHost}return currentCorePosition},er.midInitActions=_,er.prepareStamp=function(){this.badNet=!0,this.dirtyParticles=!1;let{net:t,particlePositions:e}=this;if(t&&t.particleStore&&t.particleStore.length>3){let{rows:i,columns:s,particleStore:n}=t;if(i&&s){this.badNet=!1,this.rows=i,this.columns=s,e||(e=[]);let t=[];n.forEach((e=>{let i=e.position,{x:s,y:n}=i;t.push([s,n])}));let r=t.join(",");e.join(",")!==r&&(this.particlePositions=t,this.dirtyInput=!0),this.sourceIsVideoOrSprite&&(this.dirtyInput=!0)}}},er.setSourceDimension=function(){if(!this.badNet){const{columns:t,rows:e,particlePositions:i}=this,s=[],n=[],r=[],o=[],a=[],l=[],h=[],c=[],u=[];let d,f,p,m,g,y,b,S,k,A,O,w,v,C,x,P,D,R;for(p=0;p<e;p++){for(m=0,v=n[p]=[],y=c[p]=[],d=0,f=t-1;d<f;d++)g=p*t+d,[b,k]=i[g],[S,A]=i[g+1],y.push([b,k,S,A]),0===d?l.push([b,k]):d===f-1?h.push([S,A]):0===p?(a.push([b,k]),d===f-2&&a.push([S,A])):p===e-1&&(u.push([b,k]),d===f-2&&u.push([S,A])),r.push(b,S),o.push(k,A),O=S-b,w=A-k,C=Math.sqrt(O*O+w*w),m+=C,v.push(C);s.push(m)}this.sourceDimension=Math.max(...s);let F=this.currentHost||this.getHost();if(F){let t=Math.max(...F.currentDimensions);this.sourceDimension>t&&(this.sourceDimension=t)}for(x=0,P=n.length;x<P;x++)for(C=s[x],v=n[x],y=c[x],D=0,R=v.length;D<R;D++)C&&(v[D]=v[D]/C),y[D].push(v[D]);this.struts=c;let E=Math.min(...r),M=Math.min(...o),I=Math.max(...r),H=Math.max(...o);this.boundingBox=[E,M,I-E,H-M],l.reverse(),u.reverse();let B=`M${a[0][0]},${a[0][1]}L`;for(x=1,P=a.length;x<P;x++)[d,p]=a[x],B+=`${d},${p} `;for(x=0,P=h.length;x<P;x++)[d,p]=h[x],B+=`${d},${p} `;for(x=0,P=u.length;x<P;x++)[d,p]=u[x],B+=`${d},${p} `;for(x=0,P=l.length;x<P;x++)[d,p]=l[x],B+=`${d},${p} `;B+="z",this.pathObject=new Path2D(B)}},er.simpleStamp=function(t,e){t&&"Cell"===t.type&&(this.currentHost=t,e&&(this.set(e),this.prepareStamp()),this.regularStamp())},er.stamp=function(t=!1,e,i){t&&(e&&"Cell"===e.type&&(this.currentHost=e),i&&(this.set(i),this.prepareStamp()),this.regularStamp()),this.visibility&&(this.dirtyInput&&(this.sourceImageData=this.cleanInput(),this.sourceImageData?this.output=this.cleanOutput():this.dirtyInput=!0),this.output&&this.regularStamp())},er.cleanInput=function(){this.dirtyInput=!1,this.setSourceDimension();let t=this.sourceDimension;if(!t)return this.dirtyInput=!0,!1;let e=ai(),i=e.engine,s=e.element;s.width=t,s.height=t,i.setTransform(1,0,0,1,0,0),this.source.stamp(!0,e,{startX:0,startY:0,handleX:0,handleY:0,offsetX:0,offsetY:0,roll:0,scale:1,width:t,height:t,method:"fill"});let n=i.getImageData(0,0,t,t);return li(e),n},er.cleanOutput=function(){const t=Math.PI/2;this.dirtyOutput=!1;let{sourceDimension:e,sourceImageData:i,columns:s,rows:n,struts:r,boundingBox:o}=this;if(e=Math.ceil(e),i&&n-1>0){let[a,l,h,c]=o;h+=a,c+=l;const u=ai(),d=u.engine,f=u.element;f.width=e,f.height=e,d.setTransform(1,0,0,1,0,0),d.putImageData(i,0,0);const p=ai(),m=p.engine,g=p.element;g.width=h,g.height=c,m.globalAlpha=this.state.globalAlpha,m.setTransform(1,0,0,1,0,0);const y=parseFloat((e/(n-1)).toFixed(4)),b=parseFloat((e/(s-1)).toFixed(4));let S,k,A,O,w,v,C,x,P,D,R,F,E,M,I,H,B,T,L,$,j,X,Y;for(j=0,X=n-1;j<X;j++)for(S=r[j],k=r[j+1],L=0,$=s-1;L<$;L++){let[i,s,n,r,o]=S[L],[a,l,h,c,u]=k[L];for(o*=e,u*=e,A=Math.max(o,u,b),O=b/A,w=(n-i)/A,v=(r-s)/A,C=(h-a)/A,x=(c-l)/A,Y=0;Y<A;Y++){P=i+w*Y,D=s+v*Y,R=a+C*Y,F=l+x*Y,M=j*y,E=L*b+O*Y,I=P-R,H=D-F,B=Math.sqrt(I*I+H*H),T=Math.atan2(H,I)+t,m.setTransform(1,0,0,1,P,D),m.rotate(T);let n=M+y>e?e-M:y;m.drawImage(f,E,M,1,n,0,0,1,B)}}let N=this.interferenceFactor,G=this.interferenceLoops,z=Math.ceil(h*N),W=Math.ceil(c*N);f.width=z,f.height=W,m.setTransform(1,0,0,1,0,0),d.setTransform(1,0,0,1,0,0);for(let t=0;t<G;t++)d.drawImage(g,0,0,h,c,0,0,z,W),m.drawImage(f,0,0,z,W,0,0,h,c);let V=m.getImageData(0,0,h,c);return li(u),li(p),this.dirtyTargetImage=!0,V}return!1},er.regularStamp=function(){let t=this.currentHost;if(t){let e=t.engine;this.noCanvasEngineUpdates||t.setEngine(this),this[this.method](e)}},er.fill=function(t){this.doFill(t)},er.draw=function(t){this.doStroke(t)},er.drawAndFill=function(t){this.doStroke(t),this.currentHost.clearShadow(),this.doFill(t)},er.fillAndDraw=function(t){this.doFill(t),this.currentHost.clearShadow(),this.doStroke(t)},er.drawThenFill=function(t){this.doStroke(t),this.doFill(t)},er.fillThenDraw=function(t){this.doFill(t),this.doStroke(t)},er.clear=function(t){let e=this.output,i=!!this.currentHost&&this.currentHost.element,s=t.globalCompositeOperation;if(e&&i){let n=ai(),r=n.engine,o=n.element,a=i.width,l=i.height;o.width=a,o.height=l,r.putImageData(e,0,0),t.setTransform(1,0,0,1,0,0),t.globalCompositeOperation="destination-out",t.drawImage(o,0,0),t.globalCompositeOperation=s,li(n)}},er.none=_,er.clip=_,er.doStroke=function(t){t.setTransform(1,0,0,1,0,0),t.stroke(this.pathObject)},er.doFill=function(t){let e=this.output,i=!!this.currentHost&&this.currentHost.element;if(e&&i){let s=ai(),n=s.engine,r=s.element,o=i.width,a=i.height;r.width=o,r.height=a,n.putImageData(e,0,0),t.setTransform(1,0,0,1,0,0),t.drawImage(r,0,0),li(s)}},er.checkHit=function(t=[],e){if(this.noUserInteraction)return!1;if(!this.pathObject)return!1;let i=Array.isArray(t)?t:[t],s=!1;e||(e=ai(),s=!0);let n,r,o=e.engine;if(i.some((t=>{if(Array.isArray(t))n=t[0],r=t[1];else{if(!ft(t,t.x,t.y))return!1;n=t.x,r=t.y}return!(!n.toFixed||!r.toFixed||isNaN(n)||isNaN(r))&&o.isPointInPath(this.pathObject,n,r,this.winding)}),this)){let t={x:n,y:r,artefact:this};return s&&li(e),t}return s&&li(e),!1};const nr=function(t){return!!t&&new Mesh(t)};E.Mesh=Mesh;const Spring=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.set(t),this.action||(this.action=_),this};let rr=Spring.prototype=Object.create(Object.prototype);rr.type="Spring",rr.lib="spring",rr.isArtefact=!1,rr.isAsset=!1,rr=Bt(rr);rr.defs=lt(rr.defs,{particleFrom:null,particleFromIsStatic:!1,particleTo:null,particleToIsStatic:!1,springConstant:50,damperConstant:10,restLength:1}),rr.packetObjects=ct(rr.packetObjects,["particleFrom","particleTo"]),rr.kill=function(){return this.deregister(),!0};let or=rr.setters;or.particleFrom=function(t){t.substring&&(t=b[t]),t&&"Particle"===t.type&&(this.particleFrom=t)},or.particleTo=function(t){t.substring&&(t=b[t]),t&&"Particle"===t.type&&(this.particleTo=t)},rr.applySpring=function(){let{particleFrom:t,particleTo:e,particleFromIsStatic:i,particleToIsStatic:s,springConstant:n,damperConstant:r,restLength:o}=this;if(t&&e){let{position:a,velocity:l,load:h}=t,{position:c,velocity:u,load:d}=e,f=Ri(u).vectorSubtract(l),p=Ri(c).vectorSubtract(a),m=Ri(p).normalize(),g=Ri(m);m.scalarMultiply(n*(p.getMagnitude()-o)),f.vectorMultiply(g).scalarMultiply(r).vectorMultiply(g);let y=Ri(m).vectorAdd(f);i||h.vectorAdd(y),s||d.vectorSubtract(y),Fi(f)}};const ar=function(t){return!!t&&new Spring(t)};E.Spring=Spring;const Net=function(t=Q){return this.makeName(t.name),this.register(),this.initializePositions(),this.set(this.defs),this.onEnter=_,this.onLeave=_,this.onDown=_,this.onUp=_,this.generate=_,this.postGenerate=_,this.stampAction=_,this.particleStore=[],this.springs=[],t.group||(t.group=hs),this.set(t),this.purge&&this.purgeArtefact(this.purge),this};let lr=Net.prototype=Object.create(Object.prototype);lr.type="Net",lr.lib="entity",lr.isArtefact=!0,lr.isAsset=!1,lr=Bt(lr),lr=$s(lr);lr.defs=lt(lr.defs,{world:null,artefact:null,historyLength:1,forces:null,mass:1,engine:"euler",springConstant:50,damperConstant:10,restLength:1,showSprings:!1,showSpringsColor:"#000000",rows:0,columns:0,rowDistance:0,columnDistance:0,shapeTemplate:null,precision:20,joinTemplateEnds:!1,particlesAreDraggable:!1,hitRadius:10,showHitRadius:!1,hitRadiusColor:"#000000",resetAfterBlur:3}),lr.packetExclusions=ct(lr.packetExclusions,["forces","springs","particleStore"]),lr.packetExclusionsByRegex=ct(lr.packetExclusionsByRegex,[]),lr.packetCoordinates=ct(lr.packetCoordinates,[]),lr.packetObjects=ct(lr.packetObjects,["world","artefact","shapeTemplate"]),lr.packetFunctions=ct(lr.packetFunctions,["generate","postGenerate","stampAction"]),lr.finalizePacketOut=function(t,e){let i=e.forces||this.forces||!1;if(i){let e=[];i.forEach((t=>{t.substring?e.push(t):ot(t)&&t.name&&e.push(t.name)})),t.forces=e}let s=[];return this.particleStore.forEach((t=>s.push(t.saveAsPacket()))),t.particleStore=s,t},lr.postCloneAction=function(t,e){return t},lr.factoryKill=function(t,e){this.isRunning=!1,t&&(this.artefact.kill(),this.shapeTemplate&&this.shapeTemplate.kill()),e&&this.world.kill(),this.purgeParticlesFromLibrary()},lr.purgeParticlesFromLibrary=function(){let{particleStore:t,springs:e}=this;a.forEach((t=>{let e=o[t];e&&(e.particle&&!e.particle.substring&&e.particle.name&&(e.particle=e.particle.name),"Polyline"===e.type&&e.useParticlesAsPins&&e.pins.forEach(((t,i)=>{ot(t)&&"Particle"===t.type&&(e.pins[i]=t.name,e.dirtyPins=!0)})))})),t.forEach((t=>t.kill())),t.length=0,e.forEach((t=>t.kill())),e.length=0},lr.getters;let hr=lr.setters;lr.deltaSetters,hr.generate=function(t){nt(t)?this.generate=t:t.substring&&cr[t]&&(this.generate=cr[t])},hr.postGenerate=function(t){nt(t)&&(this.postGenerate=t)},hr.stampAction=function(t){nt(t)&&(this.stampAction=t)},hr.world=function(t){let e;t.substring?e=w[t]:ot(t)&&"World"===t.type&&(e=t),e&&(this.world=e)},hr.artefact=function(t){let e;t.substring?e=o[t]:ot(t)&&t.isArtefact&&(e=t),e&&(this.artefact=e),this.dirtyFilterIdentifier=!0},hr.shapeTemplate=function(t){let e;t.substring?e=f[t]:ot(t)&&t.isArtefact&&dt(t.species)&&(e=t),e&&(this.shapeTemplate=e),this.dirtyFilterIdentifier=!0},lr.regularStamp=function(){let{world:t,artefact:e,particleStore:i,springs:s,generate:n,postGenerate:r,stampAction:o,lastUpdated:a,resetAfterBlur:l,showSprings:h,showSpringsColor:c,showHitRadius:u,hitRadius:d,hitRadiusColor:f}=this,p=1,m="source-over";this.state&&(p=this.state.globalAlpha,m=this.state.globalCompositeOperation);let g=this.currentHost,y=.016,b=Date.now();if(a&&(y=(b-a)/1e3),y>l&&(this.purgeParticlesFromLibrary(),y=.016),i.length||(n.call(this,g),r.call(this)),i.forEach((e=>e.applyForces(t,g))),s.forEach((t=>t.applySpring())),i.forEach((e=>e.update(y,t))),h){let t=g.engine;t.save(),t.globalAlpha=p,t.globalCompositeOperation=m,t.strokeStyle=c,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor="rgb(0 0 0 / 0)",t.lineWidth=1,t.setTransform(1,0,0,1,0,0),t.beginPath(),s.forEach((e=>{let{particleFrom:i,particleTo:s}=e;t.moveTo(i.position.x,i.position.y),t.lineTo(s.position.x,s.position.y)})),t.stroke(),t.restore()}if(i.forEach((t=>{t.manageHistory(y,g),o.call(this,e,t,g)})),u){let t=g.engine;t.save(),t.globalAlpha=p,t.globalCompositeOperation=m,t.lineWidth=1,t.strokeStyle=f,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor="rgb(0 0 0 / 0)",t.setTransform(1,0,0,1,0,0),t.beginPath(),i.forEach((e=>{t.moveTo(e.position.x,e.position.y),t.arc(e.position.x,e.position.y,d,0,2*Math.PI)})),t.stroke(),t.restore()}this.lastUpdated=b},lr.restart=function(){return this.purgeParticlesFromLibrary(),this.lastUpdated=Date.now(),this},lr.checkHit=function(t=[],e){if(this.lastHitParticle=null,!this.particlesAreDraggable)return!1;if(this.noUserInteraction)return!1;let i,s,n,r,o,a=Array.isArray(t)?t:[t],l=this.particleStore,h=!1;if(a.some((t=>{if(Array.isArray(t))i=t[0],s=t[1];else{if(!ft(t,t.x,t.y))return!1;i=t.x,s=t.y}if(!i.toFixed||!s.toFixed||isNaN(i)||isNaN(s))return!1;let e=Ri();for(n=0,r=l.length;n<r;n++)if(o=l[n],e.set(o.position).vectorSubtract(t),e.getMagnitude()<this.hitRadius){h=o;break}return Fi(e),h}),this)){let t=this.checkHitReturn(i,s,e,h);return this.lastHitParticle=h,t}return!1},lr.checkHitReturn=function(t,e,i,s){return{x:t,y:e,artefact:this,particle:s}},lr.pickupArtefact=function(t){let e=this.lastHitParticle;return ft(t,e)&&(e.isBeingDragged=t,e.dragOffset=Ri(e.position).vectorSubtract(t),this.lastHitParticle),this},lr.dropArtefact=function(){return this.lastHitParticle.isBeingDragged=null,Fi(this.lastHitParticle.dragOffset),this.lastHitParticle.dragOffset=null,this.lastHitParticle=null,this};const cr={"weak-net":function(t){let{particleStore:e,artefact:i,historyLength:s,engine:n,forces:r,springs:o,mass:a,rows:l,columns:h,rowDistance:c,columnDistance:u,showSprings:d,showSpringsColor:f,name:p,springConstant:m,damperConstant:g,restLength:y}=this;if(t&&l>0&&h>0){let d,f,S,k,A,[O,w]=this.currentStampPosition,[v,C]=t.currentDimensions,x=c.substring?parseFloat(c)/100*C:c,P=u.substring?parseFloat(u)/100*C:u;for(k=0;k<l;k++)for(f=x*k+w,A=0;A<h;A++)d=P*A+O,S=wn({name:`${p}-${k}-${A}`,positionX:d,positionY:f,positionZ:0,velocityX:0,velocityY:0,velocityZ:0,historyLength:s,engine:n,forces:r,mass:a,fill:i.get("fillStyle"),stroke:i.get("strokeStyle")}),S.run(0,0,!1),e.push(S);const D=function(t,e,i){let s,n,r;s=Ri(t.position).vectorSubtract(e.position),n=s.getMagnitude(),r=ar({name:i,particleFrom:t,particleTo:e,springConstant:m,damperConstant:g,restLength:n*y}),o.push(r),Fi(s)};let R,F;for(k=0;k<l;k++)for(A=0;A<h-1;A++)R=b[`${p}-${k}-${A}`],F=b[`${p}-${k}-${A+1}`],D(R,F,`${p}-${k}-${A}~${p}-${k}-${A+1}`);for(k=0;k<h;k++)for(A=0;A<l-1;A++)R=b[`${p}-${A}-${k}`],F=b[`${p}-${A+1}-${k}`],D(R,F,`${p}-${A}-${k}~${p}-${A+1}-${k}`)}},"strong-net":function(t){let{particleStore:e,artefact:i,historyLength:s,engine:n,forces:r,springs:o,mass:a,rows:l,columns:h,rowDistance:c,columnDistance:u,showSprings:d,showSpringsColor:f,name:p,springConstant:m,damperConstant:g,restLength:y}=this;if(t&&l>0&&h>0){let d,f,S,k,A,[O,w]=this.currentStampPosition,[v,C]=t.currentDimensions,x=c.substring?parseFloat(c)/100*C:c,P=u.substring?parseFloat(u)/100*C:u;for(k=0;k<l;k++)for(f=x*k+w,A=0;A<h;A++)d=P*A+O,S=wn({name:`${p}-${k}-${A}`,positionX:d,positionY:f,positionZ:0,velocityX:0,velocityY:0,velocityZ:0,historyLength:s,engine:n,forces:r,mass:a,fill:i.get("fillStyle"),stroke:i.get("strokeStyle")}),S.run(0,0,!1),e.push(S);const D=function(t,e,i){let s,n,r;s=Ri(t.position).vectorSubtract(e.position),n=s.getMagnitude(),r=ar({name:i,particleFrom:t,particleTo:e,springConstant:m,damperConstant:g,restLength:n*y}),o.push(r),Fi(s)};let R,F;for(k=0;k<l;k++)for(A=0;A<h-1;A++)R=b[`${p}-${k}-${A}`],F=b[`${p}-${k}-${A+1}`],D(R,F,`${p}-${k}-${A}~${p}-${k}-${A+1}`);for(k=0;k<h;k++)for(A=0;A<l-1;A++)R=b[`${p}-${A}-${k}`],F=b[`${p}-${A+1}-${k}`],D(R,F,`${p}-${A}-${k}~${p}-${A+1}-${k}`);for(k=0;k<h-1;k++)for(A=0;A<l-1;A++)R=b[`${p}-${A}-${k}`],F=b[`${p}-${A+1}-${k+1}`],D(R,F,`${p}-${A}-${k}~${p}-${A+1}-${k+1}`);for(k=0;k<h-1;k++)for(A=l-1;A>0;A--)R=b[`${p}-${A}-${k}`],F=b[`${p}-${A-1}-${k+1}`],D(R,F,`${p}-${A}-${k}~${p}-${A-1}-${k+1}`)}},"weak-shape":function(t){let{particleStore:e,artefact:i,historyLength:s,engine:n,forces:r,springs:o,mass:a,showSprings:l,showSpringsColor:h,name:c,springConstant:u,damperConstant:d,restLength:f,shapeTemplate:p,precision:m,joinTemplateEnds:g}=this;const y=function(t,e,i){let s,n,r;s=Ri(t.position).vectorSubtract(e.position),n=s.getMagnitude(),r=ar({name:i,particleFrom:t,particleTo:e,springConstant:u,damperConstant:d,restLength:n*f}),o.push(r),Fi(s)};let S,k,A,O;if(p&&m){for(S=0;S<m;S++){let t=p.getPathPositionData(S/m);k=wn({name:`${c}-${S}`,positionX:t.x,positionY:t.y,positionZ:0,velocityX:0,velocityY:0,velocityZ:0,historyLength:s,engine:n,forces:r,mass:a,fill:i.get("fillStyle"),stroke:i.get("strokeStyle")}),k.run(0,0,!1),e.push(k)}for(S=0;S<m-1;S++)A=b[`${c}-${S}`],O=b[`${c}-${S+1}`],y(A,O,`${c}-${S}~${c}-${S+1}`);for(g&&(A=b[`${c}-${m-1}`],O=b[`${c}-0`],y(A,O,`${c}-${m-1}~${c}-0`)),S=0;S<m-2;S++)A=b[`${c}-${S}`],O=b[`${c}-${S+2}`],y(A,O,`${c}-${S}~${c}-${S+2}`);for(g&&(A=b[`${c}-${m-2}`],O=b[`${c}-0`],y(A,O,`${c}-${m-2}~${c}-0`),A=b[`${c}-${m-1}`],O=b[`${c}-1`],y(A,O,`${c}-${m-1}~${c}-1`)),S=0;S<m-3;S++)A=b[`${c}-${S}`],O=b[`${c}-${S+3}`],y(A,O,`${c}-${S}~${c}-${S+3}`);g&&(A=b[`${c}-${m-3}`],O=b[`${c}-0`],y(A,O,`${c}-${m-3}~${c}-0`),A=b[`${c}-${m-2}`],O=b[`${c}-1`],y(A,O,`${c}-${m-2}~${c}-1`),A=b[`${c}-${m-1}`],O=b[`${c}-2`],y(A,O,`${c}-${m-1}~${c}-2`))}},"strong-shape":function(t){let{particleStore:e,artefact:i,historyLength:s,engine:n,forces:r,springs:o,mass:a,showSprings:l,showSpringsColor:h,name:c,springConstant:u,damperConstant:d,restLength:f,shapeTemplate:p,precision:m,joinTemplateEnds:g}=this;const y=function(t,e,i){let s,n,r;s=Ri(t.position).vectorSubtract(e.position),n=s.getMagnitude(),r=ar({name:i,particleFrom:t,particleTo:e,springConstant:u,damperConstant:d,restLength:n*f}),o.push(r),Fi(s)};let S,k,A,O;if(p&&m){for(S=0;S<m;S++){let t=p.getPathPositionData(S/m);k=wn({name:`${c}-${S}`,positionX:t.x,positionY:t.y,positionZ:0,velocityX:0,velocityY:0,velocityZ:0,historyLength:s,engine:n,forces:r,mass:a,fill:i.get("fillStyle"),stroke:i.get("strokeStyle")}),k.run(0,0,!1),e.push(k)}for(S=0;S<m-1;S++)A=b[`${c}-${S}`],O=b[`${c}-${S+1}`],y(A,O,`${c}-${S}~${c}-${S+1}`);for(g&&(A=b[`${c}-${m-1}`],O=b[`${c}-0`],y(A,O,`${c}-${m-1}~${c}-0`)),S=0;S<m-2;S++)A=b[`${c}-${S}`],O=b[`${c}-${S+2}`],y(A,O,`${c}-${S}~${c}-${S+2}`);for(g&&(A=b[`${c}-${m-2}`],O=b[`${c}-0`],y(A,O,`${c}-${m-2}~${c}-0`),A=b[`${c}-${m-1}`],O=b[`${c}-1`],y(A,O,`${c}-${m-1}~${c}-1`)),S=0;S<m-3;S++)A=b[`${c}-${S}`],O=b[`${c}-${S+3}`],y(A,O,`${c}-${S}~${c}-${S+3}`);g&&(A=b[`${c}-${m-3}`],O=b[`${c}-0`],y(A,O,`${c}-${m-3}~${c}-0`),A=b[`${c}-${m-2}`],O=b[`${c}-1`],y(A,O,`${c}-${m-2}~${c}-1`),A=b[`${c}-${m-1}`],O=b[`${c}-2`],y(A,O,`${c}-${m-1}~${c}-2`));let t=Math.floor(m/2);for(S=0;S<m-t;S++)A=b[`${c}-${S}`],S+t<m-1&&(O=b[`${c}-${S+t}`],y(A,O,`${c}-${S}~${c}-${S+t}`))}},"hub-spoke":function(t){let{shapeTemplate:e,precision:i}=this;if(e&&e.type&&i){let{particleStore:s,artefact:n,historyLength:r,engine:o,forces:a,springs:l,mass:h,showSprings:c,showSpringsColor:u,name:d,springConstant:f,damperConstant:p,restLength:m,joinTemplateEnds:g}=this;const y=function(t,e,i){let s,n,r;s=Ri(t.position).vectorSubtract(e.position),n=s.getMagnitude(),r=ar({name:i,particleFrom:t,particleTo:e,springConstant:f,damperConstant:p,restLength:n*m}),l.push(r),Fi(s)};let S,k,A,O,w;if(["Bezier","Line","Oval","Polygon","Polyline","Quadratic","Rectangle","Shape","Spiral","Star","Tetragon"].indexOf(e.type)>=0){for(S=0;S<i;S++){let t=e.getPathPositionData(S/i);k=wn({name:`${d}-${S}`,positionX:t.x,positionY:t.y,positionZ:0,velocityX:0,velocityY:0,velocityZ:0,historyLength:r,engine:o,forces:a,mass:h,fill:n.get("fillStyle"),stroke:n.get("strokeStyle")}),k.run(0,0,!1),s.push(k)}for(S=0;S<i-1;S++)A=b[`${d}-${S}`],O=b[`${d}-${S+1}`],y(A,O,`${d}-${S}-${S+1}`);for(g&&(A=b[`${d}-${i-1}`],O=b[`${d}-0`],y(A,O,`${d}-${i-1}-0`)),S=0;S<i-2;S++)A=b[`${d}-${S}`],O=b[`${d}-${S+2}`],y(A,O,`${d}-${S}~${d}-${S+2}`);g&&(A=b[`${d}-${i-2}`],O=b[`${d}-0`],y(A,O,`${d}-${i-2}~${d}-0`),A=b[`${d}-${i-1}`],O=b[`${d}-1`],y(A,O,`${d}-${i-1}~${d}-1`))}else["Block","Cell","Element","Grid","Phrase","Picture","Stack"].indexOf(t.type)>=0||t.type;let[v,C]=e.get("position");w=wn({name:`${d}-hub`,positionX:v,positionY:C,positionZ:0,velocityX:0,velocityY:0,velocityZ:0,historyLength:r,engine:o,forces:a,mass:h,fill:n.get("fillStyle"),stroke:n.get("strokeStyle")}),w.run(0,0,!1),s.forEach(((t,e)=>y(t,w,`${d}-${e}-hub`))),s.push(w)}}},ur=function(t){return!!t&&new Net(t)};function dr(t=Q){t.defs=lt(t.defs,{choke:15});let e=t.setters,i=t.deltaSetters;return e.paletteStart=function(t){this.gradient&&this.gradient.set({paletteStart:t})},i.paletteStart=function(t){this.gradient&&this.gradient.setDelta({paletteStart:t})},e.paletteEnd=function(t){this.gradient&&this.gradient.set({paletteEnd:t})},i.paletteEnd=function(t){this.gradient&&this.gradient.setDelta({paletteEnd:t})},e.colors=function(t){this.gradient&&this.gradient.set({colors:t})},e.precision=function(t){this.gradient&&this.gradient.set({precision:t})},e.easing=function(t){this.gradient&&this.gradient.set({easing:t})},e.easingFunction=e.easing,e.colorSpace=function(t){this.gradient&&this.gradient.set({colorSpace:t})},e.returnColorAs=function(t){this.gradient&&this.gradient.set({returnColorAs:t})},e.cyclePalette=function(t){this.gradient&&this.gradient.set({cyclePalette:t})},e.delta=function(t=Q){this.gradient&&this.gradient.set({delta:t})},t.installElement=function(t){let e=document.createElement("canvas");e.id=t,this.element=e,this.engine=this.element.getContext("2d");let i=document.createElement("canvas");return i.id=`${t}-color`,i.width=256,i.height=1,this.colorElement=i,this.colorEngine=this.colorElement.getContext("2d"),this.gradient=In({name:`${t}-gradient`,endX:"100%",delta:{paletteStart:0,paletteEnd:0},cyclePalette:!1}),this.gradientLastUpdated=0,this},t.checkSource=function(t,e){this.notifySubscribers()},t.getData=function(t,e){return this.notifySubscribers(),this.buildStyle(e)},t.update=function(){this.dirtyOutput=!0},t.notifySubscribers=function(){this.dirtyOutput&&this.cleanOutput(),this.subscribers.forEach((t=>this.notifySubscriber(t)),this)},t.notifySubscriber=function(t){t.sourceNaturalWidth=this.width,t.sourceNaturalHeight=this.height,t.sourceLoaded=!0,t.source=this.element,t.dirtyImage=!0,t.dirtyCopyStart=!0,t.dirtyCopyDimensions=!0,t.dirtyImageSubscribers=!0},t.paintCanvas=function(){if(this.checkOutputValuesExist()&&this.dirtyOutput){this.dirtyOutput=!1;const{element:t,engine:e,width:i,height:s,colorElement:n,colorEngine:r,gradient:o,choke:a,gradientLastUpdated:l}=this,h=o.palette;t.width=i,t.height=s;let c,u,d,f=e.getImageData(0,0,i,s),p=f.data,m=i*s;const g=Date.now();l+a<g&&(o.updateByDelta(),this.gradientLastUpdated=g),h.dirtyPalette&&h.recalculate();let y=r.createLinearGradient(0,0,255,0);o.addStopsToGradient(y,o.paletteStart,o.paletteEnd,o.cyclePalette),r.fillStyle=y,r.fillRect(0,0,256,1);let b=r.getImageData(0,0,256,1).data;for(c=0;c<m;c++)u=4*Math.floor(255*this.getOutputValue(c,i)),d=4*c,p[d]=b[u],p[++d]=b[++u],p[++d]=b[++u],p[++d]=b[++u];e.putImageData(f,0,0)}},t}E.Net=Net;const NoiseAsset=function(t=Q){return this.makeName(t.name),this.register(),this.installElement(this.name),this.perm=[],this.permMod8=[],this.values=[],this.grad=[],this.subscribers=[],this.set(this.defs),this.set(t),t.subscribe&&this.subscribers.push(t.subscribe),this.dirtyOutput=!0,this};let fr=NoiseAsset.prototype=Object.create(Object.prototype);fr.type="NoiseAsset",fr.lib="asset",fr.isArtefact=!1,fr.isAsset=!0,fr=Bt(fr),fr=Me(fr),fr=dr(fr),fr=Je(fr);fr.defs=lt(fr.defs,{width:300,height:150,noiseEngine:"simplex",seed:"any_random_string_will_do",size:256,scale:50,octaves:1,octaveFunction:"none",persistence:.5,lacunarity:2,smoothing:"quintic",sumFunction:"none",sineFrequencyCoeff:1,sumAmplitude:5,worleyOutput:"X",worleyDepth:0}),delete fr.defs.source,delete fr.defs.sourceLoaded,fr.stringifyFunction=_,fr.processPacketOut=_,fr.finalizePacketOut=_,fr.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},fr.clone=K,fr.getters;let pr=fr.setters;fr.deltaSetters,pr.source=_,pr.subscribers=_,pr.octaveFunction=function(t){this.octaveFunction=null!=this.octaveFunctions[t]?this.octaveFunctions[t]:U,this.dirtyNoise=!0,this.dirtyOutput=!0},pr.sumFunction=function(t){this.sumFunction=null!=this.sumFunctions[t]?this.sumFunctions[t]:U,this.dirtyNoise=!0,this.dirtyOutput=!0},pr.smoothing=function(t){this.smoothing=null!=gt[t]?gt[t]:U,this.dirtyNoise=!0,this.dirtyOutput=!0},pr.noiseEngine=function(t){this.noiseEngine=null!=this.noiseEngines[t]?this.noiseEngines[t]:this.noiseEngines.simplex,this.dirtyNoise=!0,this.dirtyOutput=!0},pr.octaves=function(t){t.toFixed&&(this.octaves=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.seed=function(t){t.substring&&(this.seed=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.scale=function(t){t.toFixed&&(this.scale=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.size=function(t){t.toFixed&&(this.size=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.persistence=function(t){t.toFixed&&(this.persistence=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.lacunarity=function(t){t.toFixed&&(this.lacunarity=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.sineFrequencyCoeff=function(t){t.toFixed&&(this.sineFrequencyCoeff=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.modularAmplitude=function(t){t.toFixed&&(this.sumAmplitude=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.sumAmplitude=function(t){t.toFixed&&(this.sumAmplitude=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.width=function(t){t.toFixed&&(this.width=t,this.sourceNaturalWidth=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.height=function(t){t.toFixed&&(this.height=t,this.sourceNaturalHeight=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},pr.worleyDepth=function(t){t.toFixed&&(this.worleyDepth=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},fr.worleyOutputStrings=["X","Y","Z","XminusY","XminusZ","YminusX","YminusZ","ZminusX","ZminusY","XaddY","XaddZ","YaddZ","XaddYminusZ","XaddZminusY","YaddZminusX","XmultiplyY","XmultiplyZ","YmultiplyZ","XmultiplyYaddZ","XmultiplyZaddY","YmultiplyZaddX","XmultiplyYminusZ","XmultiplyZminusY","YmultiplyZminusX","sum"],pr.worleyOutput=function(t){t.substring&&this.worleyOutputStrings.indexOf(t)>=0&&(this.worleyOutput=t,this.dirtyNoise=!0,this.dirtyOutput=!0)},fr.cleanOutput=function(){this.dirtyNoise&&this.cleanNoise(),this.dirtyOutput&&this.paintCanvas()},fr.cleanNoise=function(){if(this.dirtyNoise){this.dirtyNoise=!1;let{noiseEngine:t,seed:e,width:i,height:s,element:n,engine:r,octaves:o,lacunarity:a,persistence:l,scale:h,octaveFunction:c,sumFunction:u}=this;if(t&&t.init){this.rndEngine=Oe(e),this.generatePermutationTable(),t.init.call(this);let n,r,d,f,p,m,g,y,b=[];for(r=0;r<s;r++)for(b[r]=[],n=0;n<i;n++)b[r][n]=[];let S=Math.pow(i,-h/100),k=-1e3,A=1e3,O=t.name;if(["stripes","smoothed-stripes","worley-euclidean","worley-manhattan"].indexOf(O)>=0)for(r=0;r<s;r++)for(n=0;n<i;n++)f=n*S,p=r*S,m=t.getNoiseValue.call(this,f,p),b[r][n]=m,A=Math.min(A,m),k=Math.max(k,m);else for(r=0;r<s;r++)for(n=0;n<i;n++){for(f=n*S,p=r*S,m=0,g=1,y=1,d=0;d<o;d++){let e=t.getNoiseValue.call(this,f*y,p*y);e=c(e,f,p,d+1),e*=g,m+=e,y*=a,g*=l}b[r][n]=m,A=Math.min(A,m),k=Math.max(k,m)}let w=k-A;for(r=0;r<s;r++)for(n=0;n<i;n++){f=n*S,p=r*S;let t=(b[r][n]-A)/w;b[r][n]=u.call(this,t,n*S,r*S)}this.noiseValues=b}else this.dirtyNoise=!0}},fr.checkOutputValuesExist=function(){return null!=this.noiseValues},fr.getOutputValue=function(t,e){let i=Math.floor(t/e),s=t-i*e;return this.noiseValues[i][s]},fr.simplexConstantF=.5*(Math.sqrt(3)-1),fr.simplexConstantG=(3-Math.sqrt(3))/6,fr.simplexConstantDoubleG=(3-Math.sqrt(3))/6*2,fr.perlinGrad=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]],fr.noiseEngines={perlin:{name:"perlin",init:function(){const{grad:t,size:e,rndEngine:i}=this;let s;t.length=0;for(let n=0;n<e;n++)t[n]=[2*i.random()-1,2*i.random()-1],s=Math.sqrt(t[n][0]*t[n][0]+t[n][1]*t[n][1]),t[n][0]/=s,t[n][1]/=s},getNoiseValue:function(t,e){const{size:i,perm:s,grad:n,smoothing:r}=this;let o,a,l,h,c=Math.floor(t)%i,u=(c+1)%i,d=t-Math.floor(t),f=d-1,p=Math.floor(e)%i,m=(p+1)%i,g=e-Math.floor(e),y=g-1,b=s[c],S=s[u],k=s[b+p],A=s[S+p],O=s[b+m],w=s[S+m],v=r(d),C=r(g);return l=d*n[k][0]+g*n[k][1],h=f*n[A][0]+g*n[A][1],o=tt(v,l,h),l=d*n[O][0]+y*n[O][1],h=f*n[w][0]+y*n[w][1],a=tt(v,l,h),.5*(1+tt(C,o,a))}},"improved-perlin":{name:"improved-perlin",init:_,getNoiseValue:function(t,e){const{size:i,perm:s,permMod8:n,perlinGrad:r,smoothing:o}=this;let a,l,h,c,u=Math.floor(t)%i,d=(u+1)%i,f=t-Math.floor(t),p=f-1,m=Math.floor(e)%i,g=(m+1)%i,y=e-Math.floor(e),b=y-1,S=s[u],k=s[d],A=n[S+m],O=n[k+m],w=n[S+g],v=n[k+g],C=o(f),x=o(y);return h=f*r[A][0]+y*r[A][1],c=p*r[O][0]+y*r[O][1],a=tt(C,h,c),h=f*r[w][0]+b*r[w][1],c=p*r[v][0]+b*r[v][1],l=tt(C,h,c),.5*(1+tt(x,a,l))}},simplex:{name:"simplex",init:_,getNoiseValue:function(t,e){const i=function(t,e,i){let s=.5-t*t-e*e;if(s<0)return 0;let[n,r]=a[i];return s*s*(n*t+r*e)},{simplexConstantF:s,simplexConstantG:n,simplexConstantDoubleG:r,size:o,perlinGrad:a,perm:l,permMod8:h}=this;let c=(t+e)*s,u=Math.floor(t+c),d=Math.floor(e+c),f=(u+d)*n,p=t-(u-f),m=e-(d-f),g=u%o,y=d%o,b=h[g+l[y]],S=i(p,m,b);b=h[g+1+l[y+1]],S+=i(p-1+r,m-1+r,b);let k=0,A=1;return p>m&&(k=1,A=0),b=h[g+k+l[y+A]],S+=i(p-k+n,m-A+n,b),.5+35*S}},value:{name:"value",init:function(){const{values:t,size:e,rndEngine:i}=this;t.length=0;for(let s=0;s<e;s++)t[s]=t[s+e]=i.random()},getNoiseValue:function(t,e){const{values:i,size:s,perm:n,smoothing:r}=this;let o=Math.floor(t)%s,a=Math.floor(e)%s,l=(o+1)%s,h=(a+1)%s,c=t-Math.floor(t),u=e-Math.floor(e),d=r(c),f=r(u),p=n[o],m=n[l],g=n[p+a],y=n[m+a],b=n[p+h],S=n[m+h],k=tt(d,i[g],i[y]),A=tt(d,i[b],i[S]);return tt(f,k,A)}},stripes:{name:"stripes",init:_,getNoiseValue:function(t,e){return t/5+e/5}},"smoothed-stripes":{name:"smoothed-stripes",init:_,getNoiseValue:function(t,e){const{smoothing:i}=this;return i(t)/5+i(e)/5}},"worley-euclidean":{name:"worley-euclidean",init:function(){this.worleySeed=Math.floor(1e6*this.rndEngine.random())},getNoiseValue:function(t,e){const{width:i,height:s,worleyDepth:n,worleyDistanceFunctions:r,worleyOutputFunctions:o,worleyOutput:a}=this,l=r["euclidian-distance"],h=o[a];return this.worleyNoise.call(this,{x:t,y:e,z:n},l,h)}},"worley-manhattan":{name:"worley-manhattan",init:function(){this.worleySeed=Math.floor(1e6*this.rndEngine.random())},getNoiseValue:function(t,e){const{width:i,height:s,worleyDepth:n,worleyDistanceFunctions:r,worleyOutputFunctions:o,worleyOutput:a}=this,l=r["manhattan-distance"],h=o[a];return this.worleyNoise.call(this,{x:t,y:e,z:n},l,h)}}},fr.generatePermutationTable=function(){const{perm:t,permMod8:e,rndEngine:i,size:s}=this;let n,r,o;for(t.length=0,e.length=0,n=0;n<s;n++)t[n]=n;for(;--n;)r=Math.floor(i.random()*s),o=t[n],t[n]=t[r],t[r]=o;for(n=0;n<s;n++)t[n+s]=t[n],e[n]=e[n+s]=t[n]%8},fr.octaveFunctions={none:U,absolute:function(t){return Math.abs(2*t-1)}},fr.sumFunctions={none:U,"sine-x":function(t,e,i){return.5+Math.sin(e*this.sineFrequencyCoeff+t)/2},"sine-y":function(t,e,i){return.5+Math.sin(i*this.sineFrequencyCoeff+t)/2},sine:function(t,e,i){return.5+Math.sin(e*this.sineFrequencyCoeff+t)/4+Math.sin(i*this.sineFrequencyCoeff+t)/4},modular:function(t){let e=t*this.sumAmplitude;return e-Math.floor(e)},random:function(t){let e=this.sumAmplitude,i=t+(Math.random()/e-.5/e);return i>1?i=1:i<0&&(i=0),i}},fr.wXorshift=function(t){let e=t^t>>12;return e^=e<<25,e^=e>>27,2*e},fr.wHash=function(t,e,i){return 16777619*(16777619*(16777619*(2166136261^t)^e)^i)&4294967295},fr.worleyDistanceFunctions={"euclidian-distance":function(t,e){return function(t,e){return[t.x-e.x,t.y-e.y,t.z-e.z]}(t,e).reduce(((t,e)=>t+e*e),0)},"manhattan-distance":function(t,e){return function(t,e){return[t.x-e.x,t.y-e.y,t.z-e.z]}(t,e).reduce(((t,e)=>t+Math.abs(e)),0)}},fr.wProbLookup=function(t){return(t&=4294967295)<393325350?1:t<1022645910?2:t<1861739990?3:t<2700834071?4:t<3372109335?5:t<3819626178?6:t<4075350088?7:t<4203212043?8:9},fr.wInsert=function(t,e){let i;for(let s=t.length-1;s>=0&&!(e>t[s]);s--)i=t[s],t[s]=e,s+1<t.length&&(t[s+1]=i)},fr.worleyOutputFunctions={X:function(t){return t[0]},Y:function(t){return t[1]},Z:function(t){return t[2]},XminusY:function(t){return t[0]-t[1]},XminusZ:function(t){return t[0]-t[2]},YminusX:function(t){return t[1]-t[0]},YminusZ:function(t){return t[1]-t[2]},ZminusX:function(t){return t[2]-t[0]},ZminusY:function(t){return t[2]-t[1]},XaddY:function(t){return t[0]+t[1]},XaddZ:function(t){return t[0]+t[2]},YaddZ:function(t){return t[1]+t[2]},XaddYminusZ:function(t){return t[0]+t[1]-t[2]},XaddZminusY:function(t){return t[0]+t[2]-t[1]},YaddZminusX:function(t){return t[1]+t[2]-t[0]},XmultiplyY:function(t){return t[0]*t[1]},XmultiplyZ:function(t){return t[0]*t[2]},YmultiplyZ:function(t){return t[1]*t[2]},XmultiplyYaddZ:function(t){return t[0]*t[1]+t[2]},XmultiplyZaddY:function(t){return t[0]*t[2]+t[1]},YmultiplyZaddX:function(t){return t[1]*t[2]+t[0]},XmultiplyYminusZ:function(t){return t[0]*t[1]-t[2]},XmultiplyZminusY:function(t){return t[0]*t[2]-t[1]},YmultiplyZminusX:function(t){return t[1]*t[2]-t[0]},sum:function(t){return t[0]+t[1]+t[2]}},fr.worleyNoise=function(t,e,i){let s,n,r,o,a,l={x:0,y:0,z:0},h={x:0,y:0,z:0},c=[9999999,9999999,9999999],{x:u,y:d,z:f}=t;u=Math.floor(u),d=Math.floor(d),f=Math.floor(f);for(let i=-1;i<2;++i)for(let p=-1;p<2;++p)for(let m=-1;m<2;++m){r=u+i,o=d+p,a=f+m,s=this.wXorshift(this.wHash(r+this.worleySeed&4294967295,4294967295&o,4294967295&a)),n=this.wProbLookup(s);for(let i=0;i<n;++i)s=this.wXorshift(s),l.X=s/4294967296,s=this.wXorshift(s),l.Y=s/4294967296,s=this.wXorshift(s),l.Z=s/4294967296,h={x:l.X+r,y:l.Y+o,z:l.Z+a},this.wInsert(c,e(t,h))}return i(c.map((t=>t<0?0:t>1?1:t)))};const mr=function(t){return!!t&&new NoiseAsset(t)},gr=mr;E.NoiseAsset=NoiseAsset;const Oval=function(t=Q){return this.shapeInit(t),this};let yr=Oval.prototype=Object.create(Object.prototype);yr.type="Oval",yr.lib="entity",yr.isArtefact=!0,yr.isAsset=!1,yr=Bt(yr),yr=Vs(yr);yr.defs=lt(yr.defs,{radiusX:5,radiusY:5,intersectX:.5,intersectY:.5,offshootA:.55,offshootB:0});let br=yr.setters,Sr=yr.deltaSetters;br.radius=function(t){this.setRectHelper(t,["radiusX","radiusY"])},br.radiusX=function(t){this.setRectHelper(t,["radiusX"])},br.radiusY=function(t){this.setRectHelper(t,["radiusY"])},Sr.radius=function(t){this.deltaRectHelper(t,["radiusX","radiusY"])},Sr.radiusX=function(t){this.deltaRectHelper(t,["radiusX"])},Sr.radiusY=function(t){this.deltaRectHelper(t,["radiusY"])},br.offshootA=function(t){this.offshootA=t,this.updateDirty()},br.offshootB=function(t){this.offshootB=t,this.updateDirty()},Sr.offshootA=function(t){t.toFixed&&(this.offshootA+=t,this.updateDirty())},Sr.offshootB=function(t){t.toFixed&&(this.offshootB+=t,this.updateDirty())},br.intersectA=function(t){this.intersectA=t,this.updateDirty()},br.intersectB=function(t){this.intersectB=t,this.updateDirty()},Sr.intersectA=function(t){t.toFixed&&(this.intersectA+=t,this.updateDirty())},Sr.intersectB=function(t){t.toFixed&&(this.intersectB+=t,this.updateDirty())},yr.setRectHelper=function(t,e){this.updateDirty(),e.forEach((e=>{this[e]=t}),this)},yr.deltaRectHelper=function(t,e){this.updateDirty(),e.forEach((e=>{this[e]=addStrings(this[e],t)}),this)},yr.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeOvalPath(),this.pathDefinition=t},yr.makeOvalPath=function(){let t,e,i=parseFloat(this.offshootA.toFixed(6)),s=parseFloat(this.offshootB.toFixed(6)),n=this.radiusX,r=this.radiusY;if(n.substring||r.substring){let i=this.getHost();if(i){let[s,o]=i.currentDimensions;t=2*(n.substring?parseFloat(n)/100*s:n),e=2*(r.substring?parseFloat(r)/100*o:r)}}else t=2*n,e=2*r;let o=parseFloat((t*this.intersectX).toFixed(2)),a=parseFloat((t-o).toFixed(2)),l=parseFloat((e*this.intersectY).toFixed(2)),h=parseFloat((e-l).toFixed(2)),c="m0,0";return c+=`c${a*i},${l*s} ${a-a*s},${l-l*i}, ${a},${l} `,c+=`${-a*s},${h*i} ${a*i-a},${h-h*s} ${-a},${h} `,c+=`${-o*i},${-h*s} ${o*s-o},${h*i-h} ${-o},${-h} `,c+=`${o*s},${-l*i} ${o-o*i},${l*s-l} ${o},${-l}z`,c},yr.calculateLocalPathAdditionalActions=function(){let[t,e,i,s]=this.localBox;this.pathDefinition=this.pathDefinition.replace("m0,0",`m${-t},${-e}`),this.pathCalculatedOnce=!1,this.calculateLocalPath(this.pathDefinition,!0)};const kr=function(t){return!!t&&(t.species="oval",new Oval(t))};E.Oval=Oval;const VideoAsset=function(t=Q){return this.assetConstructor(t)};let Ar=VideoAsset.prototype=Object.create(Object.prototype);Ar.type="Video",Ar.lib="asset",Ar.isArtefact=!1,Ar.isAsset=!0,Ar=Bt(Ar),Ar=Me(Ar),Ar.saveAsPacket=function(){return[this.name,this.type,this.lib,{}]},Ar.stringifyFunction=_,Ar.processPacketOut=_,Ar.finalizePacketOut=_,Ar.clone=K,Ar.getters;let Or=Ar.setters;Ar.deltaSetters,Or.source=function(t){t&&("VIDEO"===t.tagName.toUpperCase()&&(this.source=t,this.sourceNaturalWidth=t.videoWidth||0,this.sourceNaturalHeight=t.videoHeight||0,this.sourceLoaded=t.readyState>2),this.sourceLoaded&&this.notifySubscribers())},Ar.checkSource=function(t,e){let i=this.source;i&&i.readyState>2?(this.sourceLoaded=!0,this.sourceNaturalWidth===i.videoWidth&&this.sourceNaturalHeight===i.videoHeight&&this.sourceNaturalWidth===t&&this.sourceNaturalHeight===e||(this.sourceNaturalWidth=i.videoWidth,this.sourceNaturalHeight=i.videoHeight,this.notifySubscribers())):this.sourceLoaded=!1},Ar.addTextTrack=function(t,e,i){let s=this.source;s&&s.addTextTrack&&s.addTextTrack(t,e,i)},Ar.captureStream=function(){let t=this.source;return!(!t||!t.captureStream)&&t.captureStream()},Ar.canPlayType=function(t){let e=this.source;return e?e.canPlayType(t):"maybe"},Ar.fastSeek=function(t){let e=this.source;e&&e.fastSeek&&e.fastSeek(t)},Ar.load=function(){let t=this.source;t&&t.load()},Ar.pause=function(){let t=this.source;t&&t.pause()},Ar.play=function(){let t=this.source;return t?t.play().catch((t=>console.log(t.code,t.name,t.message))):Promise.reject("Source not defined")},Ar.setMediaKeys=function(t){let e=this.source;return e?e.setMediaKeys?e.setMediaKeys(t):Promise.reject("setMediaKeys not supported"):Promise.reject("Source not defined")},Ar.setSinkId=function(){let t=this.source;return t?t.setSinkId?t.setSinkId():Promise.reject("setSinkId not supported"):Promise.reject("Source not defined")};const wr=["video_audioTracks","video_autoPlay","video_buffered","video_controller","video_controls","video_controlsList","video_crossOrigin","video_currentSrc","video_currentTime","video_defaultMuted","video_defaultPlaybackRate","video_disableRemotePlayback","video_duration","video_ended","video_error","video_loop","video_mediaGroup","video_mediaKeys","video_muted","video_networkState","video_paused","video_playbackRate","video_readyState","video_seekable","video_seeking","video_sinkId","video_src","video_srcObject","video_textTracks","video_videoTracks","video_volume"],vr=["video_autoPlay","video_controller","video_controls","video_crossOrigin","video_currentTime","video_defaultMuted","video_defaultPlaybackRate","video_disableRemotePlayback","video_loop","video_mediaGroup","video_muted","video_playbackRate","video_src","video_srcObject","video_volume"],Cr=function(t){let e=/.*\/(.*?)\./;document.querySelectorAll(t).forEach((t=>{let i;if("VIDEO"===t.tagName.toUpperCase()){if(t.id||t.name)i=t.id||t.name;else{let s=e.exec(t.src);i=s&&s[1]?s[1]:""}let s=Dr({name:i,source:t});t.readyState<=2&&(t.oncanplay=()=>{s.set({source:t})})}}))},xr=function(t=Q){let e={};e.audio=!dt(t.audio)||t.audio,e.video={};let i=e.video.width={};t.minWidth&&(i.min=t.minWidth),t.maxWidth&&(i.max=t.maxWidth),i.ideal=t.width?t.width:1280;let s=e.video.height={};t.minHeight&&(s.min=t.minHeight),t.maxHeight&&(s.max=t.maxHeight),s.ideal=t.height?t.height:720,t.facing&&(e.video.facingMode=t.facing);let n=t.name||J(),r=document.createElement("video"),o=Dr({name:n,source:r});return new Promise(((t,i)=>{navigator&&navigator.mediaDevices?navigator.mediaDevices.getUserMedia(e).then((e=>{let i,s=e.getVideoTracks();Array.isArray(s)&&s[0]&&(i=s[0].getConstraints()),r.id=o.name,i&&(r.width=i.width,r.height=i.height),r.srcObject=e,r.onloadedmetadata=function(t){r.play()},t(o)})).catch((e=>{console.log(e.message),t(o)})):i("Navigator.mediaDevices object not found")}))},Pr=function(...t){let e=/.*\/(.*?)\./,i="";if(t.length){let s,n,r,o,a,l,h=!1,c=t[0];if(c.substring){let i=e.exec(c);s=i&&i[1]?i[1]:"",a=[...t],n="",r=!1,o=null,l="auto",h=!0}else c&&c.src&&(s=c.name||"",a=[...c.src],n=c.className||"",r=c.visibility||!1,o=document.querySelector(o),l=c.preload||"auto",h=!0);let u=Dr({name:s});if(h){let t=document.createElement("video");t.name=s,t.className=n,t.style.display=r?"block":"none",t.crossOrigin="anonymous",t.preload=l,a.forEach((e=>{let i=document.createElement("source");i.src=e,t.appendChild(i)})),t.onload=()=>{u.set({source:t}),o&&o.appendChild(t)},u.set({source:t}),i=s}}return i},Dr=function(t){return!!t&&new VideoAsset(t)};E.VideoAsset=VideoAsset;const SpriteAsset=function(t=Q){return this.assetConstructor(t),this};let Rr=SpriteAsset.prototype=Object.create(Object.prototype);Rr.type="Sprite",Rr.lib="asset",Rr.isArtefact=!1,Rr.isAsset=!0,Rr=Bt(Rr),Rr=Me(Rr);Rr.defs=lt(Rr.defs,{manifest:null}),Rr.saveAsPacket=function(){return[this.name,this.type,this.lib,{}]},Rr.stringifyFunction=_,Rr.processPacketOut=_,Rr.finalizePacketOut=_,Rr.clone=K,Rr.getters;let Fr=Rr.setters;Rr.deltaSetters,Fr.source=function(t=[]){if(t&&t[0]){this.sourceHold||(this.sourceHold={});let e=this.sourceHold;t.forEach((t=>{let i=t.id||t.name;i&&(e[i]=t)})),this.source=t[0],this.sourceNaturalWidth=t[0].naturalWidth,this.sourceNaturalHeight=t[0].naturalHeight,this.sourceLoaded=t[0].complete}},Rr.checkSource=_;const Er=function(...t){let e=/.*\/(.*?)\./,i=/\.(jpeg|jpg|png|gif|webp|svg|JPEG|JPG|PNG|GIF|WEBP|SVG)/,s=[];return t.forEach((t=>{let n,r,o,a,l,h=!1,c=!1;if(t.substring){let s=e.exec(t);n=s&&s[1]?s[1]:"",r=[t],o="",a=!1,l=t.replace(i,".json"),c=!0}else ot(t)&&t.imageSrc&&t.manifestSrc?(n=t.name||"",r=Array.isArray(t.imageSrc)?t.imageSrc:[t.imageSrc],l=t.manifestSrc,o=t.className||"",a=t.visibility||!1,h=document.querySelector(t.parent),c=!0):s.push(!1);if(c){let t=Mr({name:n});ot(l)?t.manifest=l:fetch(l).then((t=>{if(200!==t.status)throw new Error("Failed to load manifest");return t.json()})).then((e=>t.manifest=e)).catch((t=>console.log(t.message)));let c=[];r.forEach((t=>{let s,r,l=document.createElement("img");i.test(t)&&(r=e.exec(t),s=r&&r[1]?r[1]:""),l.name=s||n,l.className=o,l.crossorigin="anonymous",l.style.display=a?"block":"none",h&&h.appendChild(l),l.src=t,c.push(l)})),t.set({source:c}),s.push(n)}else s.push(!1)})),s},Mr=function(t){return!!t&&new SpriteAsset(t)};function Ir(t=Q){t.defs=lt(t.defs,{asset:null,removeAssetOnKill:!1,spriteIsRunning:!1,spriteLastFrameChange:0,spriteCurrentFrame:0,spriteTrack:"default",spriteForward:!0,spriteFrameDuration:100,spriteWillLoop:!0});let e=t.getters,i=t.setters;return e.sourceDimensions=function(){return[this.sourceNaturalWidth,this.sourceNaturalHeight]},i.asset=function(t){let e=this.asset,i=t&&t.name?t.name:t;e&&!e.substring&&e.unsubscribe(this),this.asset=i,this.dirtyAsset=!0},i.imageSource=function(t){let e=$e(t);if(e){let t=l[e[0]];if(t){let e=this.asset;e&&e.unsubscribe&&e.unsubscribe(this),t.subscribe(this)}}},i.videoSource=function(t){let e=Pr(t);if(e){let t=l[e];if(t){let e=this.asset;e&&e.unsubscribe&&e.unsubscribe(this),t.subscribe(this)}}},i.spriteSource=function(t){let e=Er(t);if(e){let t=l[e];if(t){let e=this.asset;e&&e.unsubscribe&&e.unsubscribe(this),t.subscribe(this)}}},t.cleanAsset=function(){let t=this.asset;if(t&&t.substring){let e=l[t];e&&(this.dirtyAsset=!1,e.subscribe(this))}},t.videoAction=function(t,...e){let i=this.asset;if(i&&"Video"===i.type)return i[t](...e)},t.videoPromiseAction=function(t,...e){let i=this.asset;return i&&"Video"===i.type?i[t](...e):Promise.reject("Asset not a video")},t.videoAddTextTrack=function(t,e,i){return this.videoAction("addTextTrack",t,e,i)},t.videoCaptureStream=function(){return this.videoAction("captureStream")},t.videoCanPlayType=function(t){return this.videoAction("canPlayType",t)},t.videoFastSeek=function(t){return this.videoAction("fastSeek",t)},t.videoLoad=function(){return this.videoAction("load")},t.videoPause=function(){return this.videoAction("pause")},t.videoPlay=function(){return this.videoPromiseAction("play")},t.videoSetMediaKeys=function(t){return this.videoPromiseAction("setMediaKeys",t)},t.videoSetSinkId=function(){return this.videoPromiseAction("setSinkId")},t.checkSpriteFrame=function(){let t=this.asset;if(t&&"Sprite"===t.type&&t.manifest){let e=this.copyArray;if(this.spriteIsRunning){let i=this.spriteLastFrameChange,s=this.spriteFrameDuration,n=Date.now();if(n>i+s){let i=t.manifest;if(i){let s=i[this.spriteTrack],r=s.length,o=this.spriteCurrentFrame,a=this.spriteWillLoop;o=this.spriteForward?o+1:o-1,o<0&&(o=a?r-1:0),o>=r&&(o=a?0:r-1);let[l,h,c,u,d]=s[o];if(e.length=0,e.push(h,c,u,d),this.dirtyCopyStart=!1,this.dirtyCopyDimensions=!1,l!==(this.source.id||this.source.name)){let e=t.sourceHold[l];e&&(this.source=e)}this.spriteCurrentFrame=o,this.spriteLastFrameChange=n}}}else{let[i,s,n,r,o]=t.manifest[this.spriteTrack][this.spriteCurrentFrame],[a,l,h,c]=e;a===s&&l===n&&h===r&&c===o||(e.length=0,e.push(s,n,r,o),this.dirtyCopyStart=!1,this.dirtyCopyDimensions=!1)}}},t.playSprite=function(t,e,i,s,n){dt(t)&&(this.spriteFrameDuration=t),dt(e)&&(this.spriteWillLoop=e),dt(i)&&(this.spriteTrack=i),dt(s)&&(this.spriteForward=s),dt(n)&&(this.spriteCurrentFrame=n),this.spriteLastFrameChange=Date.now(),this.spriteIsRunning=!0},t.haltSprite=function(t,e,i,s,n){dt(t)&&(this.spriteFrameDuration=t),dt(e)&&(this.spriteWillLoop=e),dt(i)&&(this.spriteTrack=i),dt(s)&&(this.spriteForward=s),dt(n)&&(this.spriteCurrentFrame=n),this.spriteIsRunning=!1},t}E.SpriteAsset=SpriteAsset;const Pattern=function(t=Q){return this.makeName(t.name),this.register(),this.set(this.defs),this.set(t),this};let Hr=Pattern.prototype=Object.create(Object.prototype);Hr.type="Pattern",Hr.lib="styles",Hr.isArtefact=!1,Hr.isAsset=!1,Hr=Bt(Hr),Hr=Je(Hr),Hr=Ir(Hr);Hr.defs=lt(Hr.defs,{}),Hr.packetObjects=ct(Hr.packetObjects,["asset"]),Hr.finalizePacketOut=function(t,e){if(Array.isArray(e.patternMatrix))t.patternMatrix=e.patternMatrix;else{let e=this.patternMatrix;e&&(t.patternMatrix=[e.a,e.b,e.c,e.d,e.e,e.f])}return t},Hr.kill=function(){let{name:t,asset:e,removeAssetOnKill:i}=this;return ot(e)&&e.unsubscribe(this),Object.entries(f).forEach((([e,i])=>{let s=i.state;if(s){let e=s.fillStyle,i=s.strokeStyle;ot(e)&&e.name===t&&(s.fillStyle=s.defs.fillStyle),ot(i)&&i.name===t&&(s.strokeStyle=s.defs.strokeStyle)}})),i&&(i.substring?e.kill(!0):e.kill()),this.deregister(),this},Hr.get=function(t){let e=this.source;if(0!==t.indexOf("video_")&&0!==t.indexOf("image_")||!e){let e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t];return void 0!==i?(e=this[t],void 0!==e?e:i):undef}}return wr.indexOf(t)>=0||Te.indexOf(t)>=0?e[t.substring(6)]:void 0},Hr.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.source,r=this.defs;let o,a,l,h;for(a=0;a<i;a++)l=e[a],h=t[l],0!==l.indexOf("video_")&&0!==l.indexOf("image_")||!n?l&&"name"!==l&&null!=h&&(o=s[l],o?o.call(this,h):void 0!==r[l]&&(this[l]=h)):(vr.indexOf(l)>=0||Le.indexOf(l)>=0)&&(n[l.substring(6)]=h);this.dirtyFilterIdentifier=!0}return this},Hr.getData=function(t,e){return this.dirtyAsset&&this.cleanAsset(),this.asset.checkSource(this.sourceNaturalWidth,this.sourceNaturalHeight),this.buildStyle(e)};const Br=function(t){return!!t&&new Pattern(t)};E.Pattern=Pattern;const FontAttributes=function(t=Q){return this.makeName(t.name),this.set(this.defs),this.set(t),this};let Tr=FontAttributes.prototype=Object.create(Object.prototype);Tr.type="FontAttributes",Tr.lib="fontattribute",Tr=Bt(Tr);Tr.defs=lt(Tr.defs,{style:"normal",variant:"normal",weight:"normal",stretch:"normal",sizeValue:12,sizeMetric:"px",family:"sans-serif"});let Lr=Tr.getters,$r=Tr.setters;Tr.deltaSetters,Lr.size=function(){return this.sizeValue?`${this.sizeValue}${this.sizeMetric}`:this.sizeMetric},$r.size=function(t){if(dt(t)){let e,i,s,n=0,r="medium";t.indexOf("xx-small")>=0?r="xx-small":t.indexOf("x-small")>=0?r="x-small":t.indexOf("smaller")>=0?r="smaller":t.indexOf("small")>=0?r="small":t.indexOf("medium")>=0?r="medium":t.indexOf("xxx-large")>=0?r="xxx-large":t.indexOf("xx-large")>=0?r="xx-large":t.indexOf("x-large")>=0?r="x-large":t.indexOf("larger")>=0?r="larger":t.indexOf("large")>=0?r="large":(n=12,r="px");let o=t.match(/(\d+\.\d+|\d+|\.\d+)(rem|em|rlh|lh|ex|cap|ch|ic|%|vw|vh|vmax|vmin|vi|vb|in|cm|mm|Q|pc|pt|px)?/i);Array.isArray(o)?([e,i,s]=o,i&&s&&"."!=i&&(n=i,r=s)):(o=t.match(/\/(\d+\.\d+|\d+|\.\d+)(rem|em|rlh|lh|ex|cap|ch|ic|%|vw|vh|vmax|vmin|vi|vb|in|cm|mm|Q|pc|pt|px)?/i),Array.isArray(o)&&([e,i,s]=o,i&&s&&"."!=i&&(n=i,r=s))),n!==this.sizeValue&&(this.sizeValue=n,this.dirtyFont=!0),r!==this.sizeMetric&&(this.sizeMetric=r,this.dirtyFont=!0)}},$r.sizeValue=function(t){dt(t)&&t!==this.sizeValue&&(this.sizeValue=t,this.dirtyFont=!0)},$r.sizeMetric=function(t){dt(t)&&t!==this.sizeMetric&&(this.sizeMetric=t,this.dirtyFont=!0)},$r.font=function(t){dt(t)&&($r.style.call(this,t),$r.variant.call(this,t),$r.weight.call(this,t),$r.stretch.call(this,t),$r.size.call(this,t),$r.family.call(this,t))},$r.style=function(t){if(dt(t)){let e="normal";e=t.indexOf("italic")>=0?"italic":e,e=t.indexOf("oblique")>=0?"oblique":e,e!==this.style&&(this.style=e,this.dirtyFont=!0)}},$r.variant=function(t){if(dt(t)){let e="normal";e=t.indexOf("small-caps")>=0?"small-caps":e,e!==this.variant&&(this.variant=e,this.dirtyFont=!0)}},$r.weight=function(t){if(dt(t)){let e="normal";t.toFixed?e=t:(e=t.indexOf("bold")>=0?"bold":e,e=t.indexOf("lighter")>=0?"lighter":e,e=t.indexOf("bolder")>=0?"bolder":e,e=t.indexOf(" 100 ")>=0?"100":e,e=t.indexOf(" 200 ")>=0?"200":e,e=t.indexOf(" 300 ")>=0?"300":e,e=t.indexOf(" 400 ")>=0?"400":e,e=t.indexOf(" 500 ")>=0?"500":e,e=t.indexOf(" 600 ")>=0?"600":e,e=t.indexOf(" 700 ")>=0?"700":e,e=t.indexOf(" 800 ")>=0?"800":e,e=t.indexOf(" 900 ")>=0?"900":e,e=/^\d00$/.test(t)?t:e),e!==this.weight&&(this.weight=e,this.dirtyFont=!0)}},$r.stretch=function(t){if(dt(t)){let e="normal";e=t.indexOf("semi-condensed")>=0?"semi-condensed":e,e=t.indexOf("condensed")>=0?"condensed":e,e=t.indexOf("extra-condensed")>=0?"extra-condensed":e,e=t.indexOf("ultra-condensed")>=0?"ultra-condensed":e,e=t.indexOf("semi-expanded")>=0?"semi-expanded":e,e=t.indexOf("expanded")>=0?"expanded":e,e=t.indexOf("extra-expanded")>=0?"extra-expanded":e,e=t.indexOf("ultra-expanded")>=0?"ultra-expanded":e,e!==this.stretch&&(this.stretch=e,this.dirtyFont=!0)}},Tr.rfsTestArray1=["italic","oblique","small-caps","normal","bold","lighter","bolder","ultra-condensed","extra-condensed","semi-condensed","condensed","ultra-expanded","extra-expanded","semi-expanded","expanded","xx-small","x-small","small","medium","xxx-large","xx-large","x-large","large"],Tr.rfsTestArray2=["0","1","2","3","4","5","6","7","8","9"],$r.family=function(t){if(dt(t)){let e="sans-serif",i=t.split(" "),s=i.length;1===s&&(e=t);let n=0,r=!0;for(;r;)if(n===s)r=!1;else{let t=i[n];t.length?this.rfsTestArray1.indexOf(t)>=0||this.rfsTestArray2.indexOf(t[0])>=0?n++:r=!1:n++}n<s&&(e=i.slice(n).join(" ")),e!==this.family&&(this.family=e,this.dirtyFont=!0)}},Tr.getFontString=function(){return!this.dirtyFont&&this.temperedFontString?this.temperedFontString:this.buildFont()},Tr.updateMetadata=function(t,e,i){t&&t.toFixed&&t>0&&t!==this.scale&&(this.scale=t,this.dirtyFont=!0),e&&e.toFixed&&e>0&&e!==this.lineHeight&&(this.lineHeight=e,this.dirtyFont=!0);let s=this.host&&this.host.type&&"Cell"===this.host.type?this.host.name:"";i&&i.type&&"Cell"===i.type&&i.name!==s&&(this.host=i,this.dirtyFont=!0)},Tr.calculateSize=function(){if(this.host){let t,e,i,s,{scale:n,lineHeight:r,host:o,sizeValue:a,sizeMetric:l}=this;if(o.getComputedFontSizes())[t,e,i,s]=o.getComputedFontSizes();else if(["in","cm","mm","Q","pc","pt","px"].indexOf(l)<0)return this.dirtyFont=!0,"12px";isNaN(a)&&(a=12);let h=t;switch(l){case"rem":h=e*a;break;case"em":case"cap":case"ch":case"ic":h=t*a;break;case"rlh":h=e*r*a;break;case"lh":h=t*r*a;break;case"ex":h=t/2*a;break;case"%":h=t/100*a;break;case"vw":case"vi":h=i/100*a;break;case"vh":case"vb":h=s/100*a;break;case"vmax":h=Math.max(i,s)/100*a;break;case"vmin":h=Math.min(i,s)/100*a;break;case"in":h=96*a;break;case"cm":h=37.8*a;break;case"mm":h=3.78*a;break;case"Q":h=.95*a;break;case"pc":h=16*a;break;case"pt":h=1.33*a;break;case"px":h=a;break;case"xx-small":h=.6*t;break;case"x-small":h=.75*t;break;case"smaller":h=.8*t;break;case"small":h=.89*t;break;case"xxx-large":h=3*t;break;case"xx-large":h=2*t;break;case"x-large":h=1.5*t;break;case"larger":h=1.3*t;break;case"large":h=1.2*t}return h*n+"px"}return"12px"},Tr.buildFont=function(){this.dirtyFont=!1;let t="";"normal"!==this.style&&(t+=`${this.style} `),"normal"!==this.variant&&(t+=`${this.variant} `),"normal"!==this.weight&&(t+=`${this.weight} `),"normal"!==this.stretch&&(t+=`${this.stretch} `),t+=`${this.calculateSize()} `,t+=`${this.family}`;let e=ai();return e.engine.font=t,t=e.engine.font,li(e),this.temperedFontString=t,t},Tr.update=function(t){return t&&this.set(t),this.getFontString()};E.FontAttributes=FontAttributes;const jr=document.createElement("div");jr.style.padding=0,jr.style.border=0,jr.style.margin=0,jr.style.height="auto",jr.style.lineHeight=1,jr.style.boxSizing="border-box",jr.innerHTML="|/}ÁÅþ§¶¿∑ƒ⌈⌊qwertyd0123456789QWERTY",jr.setAttribute("aria-hidden","true"),ws.appendChild(jr);const Xr=document.createElement("textarea"),Yr=(t,e)=>(t=parseFloat(t),rt(t)||(t=0),rt(e)||(e=0),parseFloat(t.toFixed(e))),Nr=(t,e)=>(t=parseFloat(t),rt(t)||(t=0),rt(e)||(e=0),Math.abs(parseFloat(t.toFixed(e)))),Phrase=function(t=Q){return this.fontAttributes=function(t){return!!t&&new FontAttributes(t)}(Q),this.entityInit(t),this.dirtyDimensions=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyPathObject=!0,this};let Gr=Phrase.prototype=Object.create(Object.prototype);Gr.type="Phrase",Gr.lib="entity",Gr.isArtefact=!0,Gr.isAsset=!1,Gr=Bt(Gr),Gr=$s(Gr),Gr.midInitActions=function(t){this.sectionStyles=[],this.sectionClasses=F};Gr.defs=lt(Gr.defs,{text:"",width:"auto",exposeText:!0,lineHeight:1.15,letterSpacing:0,justify:"left",sectionClassMarker:"[§<>]",sectionClasses:null,overlinePosition:-.1,overlineStyle:"rgb(250 0 0)",overlineWidth:1,noOverlineGlyphs:"",underlinePosition:.6,underlineStyle:"rgb(250 0 0)",underlineWidth:1,noUnderlineGlyphs:"",highlightStyle:"rgb(250 218 94 / 0.4)",boundingBoxColor:"rgb(0 0 0 / 0.5)",showBoundingBox:!1,textPath:"",textPathPosition:0,textPathLoop:!0,addTextPathRoll:!0,textPathDirection:"ltr",treatWordAsGlyph:!1}),Gr.packetExclusions=ct(Gr.packetExclusions,["textPositions","textLines","textLineWidths","textLineWords","textGlyphs","textGlyphWidths","fontAttributes"]),Gr.finalizePacketOut=function(t,e){let i=JSON.parse(this.state.saveAsPacket(e))[3];t=lt(t,i);let s=JSON.parse(this.fontAttributes.saveAsPacket(e))[3];return delete s.name,t=lt(t,s),t=this.handlePacketAnchor(t,e)},Gr.factoryKill=function(){this.exposedTextHold&&this.exposedTextHold.remove()};let zr=Gr.getters,Wr=Gr.setters,Vr=Gr.deltaSetters;Wr.handleX=function(t){null!=t&&(this.handle[0]=t,this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0)},Wr.handleY=function(t){null!=t&&(this.handle[1]=t,this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0)},Wr.handle=function(t,e){this.setCoordinateHelper("handle",t,e),this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0},Vr.handleX=function(t){let e=this.handle;e[0]=addStrings(e[0],t),this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0},Vr.handleY=function(t){let e=this.handle;e[1]=addStrings(e[1],t),this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0},Vr.handle=function(t,e){this.setDeltaCoordinateHelper("handle",t,e),this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0},zr.text=function(){return this.currentText||this.text||""},Wr.text=function(t){var e;this.text=(e=t).substring?e:e.toString,this.dirtyText=!0,this.dirtyPathObject=!0,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0},Gr.permittedJustifications=["left","right","center","full"],Wr.justify=function(t){this.permittedJustifications.indexOf(t)>=0&&(this.justify=t),this.dirtyText=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},Wr.width=function(t){this.dimensions[0]=t,this.dirtyDimensions=!0,this.dirtyHandle=!0,this.dirtyPathObject=!0,this.dirtyText=!0},Vr.width=function(t){let e=this.dimensions;e[0]=addStrings(e[0],t),this.dirtyDimensions=!0,this.dirtyHandle=!0,this.dirtyPathObject=!0,this.dirtyText=!0},Wr.scale=function(t){this.scale=t,this.dirtyDimensions=!0,this.dirtyHandle=!0,this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyScale=!0},Vr.scale=function(t){this.scale+=t,this.dirtyDimensions=!0,this.dirtyHandle=!0,this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyScale=!0},Wr.lineHeight=function(t){this.lineHeight=Nr(t,3),this.lineHeight<.5&&(this.lineHeight=.5),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Vr.lineHeight=function(t){this.lineHeight+=Yr(t,3),this.lineHeight<.5&&(this.lineHeight=.5),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Wr.letterSpacing=function(t){this.letterSpacing=Nr(t,3),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Vr.letterSpacing=function(t){this.letterSpacing+=Yr(t,3),this.letterSpacing<0&&(this.letterSpacing=0),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Wr.overlinePosition=function(t){this.overlinePosition=Yr(t,3),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Vr.overlinePosition=function(t){this.overlinePosition+=Yr(t,3),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Wr.noOverlineGlyphs=function(t){t.substring&&(this.noOverlineGlyphs=t)},Wr.underlinePosition=function(t){this.underlinePosition=Yr(t,3),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Vr.underlinePosition=function(t){this.underlinePosition+=Yr(t,3),this.dirtyPathObject=!0,this.dirtyText=!0,this.dirtyFilterIdentifier=!0},Wr.noUnderlineGlyphs=function(t){t.substring&&(this.noUnderlineGlyphs=t)},Wr.textPath=function(t){this.textPath=t,this.dirtyHandle=!0,this.dirtyText=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},Wr.textPathPosition=function(t){this.textPathLoop?(t<0&&(t=Math.abs(t)),t>1&&(t%=1),this.textPathPosition=parseFloat(t.toFixed(6))):this.textPathPosition=t,this.dirtyFilterIdentifier=!0},Vr.textPathPosition=function(t){let e=this.textPathPosition+t;this.textPathLoop?(e<0&&(e+=1),e>1&&(e%=1),this.textPathPosition=parseFloat(e.toFixed(6))):this.textPathPosition=e,this.dirtyFilterIdentifier=!0},zr.font=function(){return this.fontAttributes.getFontString()},Wr.font=function(t){this.fontAttributes.set({font:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.style=function(){return this.fontAttributes.get("style")},Wr.style=function(t){this.fontAttributes.set({style:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.variant=function(){return this.fontAttributes.get("variant")},Wr.variant=function(t){this.fontAttributes.set({variant:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.weight=function(){return this.fontAttributes.get("weight")},Wr.weight=function(t){this.fontAttributes.set({weight:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.stretch=function(){return this.fontAttributes.get("stretch")},Wr.stretch=function(t){this.fontAttributes.set({stretch:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.size=function(){return this.fontAttributes.get("size")},Wr.size=function(t){this.fontAttributes.set({size:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.sizeValue=function(){return this.fontAttributes.get("sizeValue")},Wr.sizeValue=function(t){this.fontAttributes.set({sizeValue:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},Vr.sizeValue=function(t){this.fontAttributes.deltaSet({sizeValue:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.sizeMetric=function(){return this.fontAttributes.get("sizeMetric")},Wr.sizeMetric=function(t){this.fontAttributes.set({sizeMetric:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},zr.family=function(){return this.fontAttributes.get("family")},Wr.family=function(t){this.fontAttributes.set({family:t}),this.dirtyFont=!0,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},Gr.cleanDimensionsAdditionalActions=function(){if(this.fontAttributes.dirtyFont=!0,this.fontAttributes.updateMetadata(this.scale,this.lineHeight,this.getHost()),"auto"===this.dimensions[0]){this.buildText();let t=ai(),e=t.engine;e.font=this.fontAttributes.getFontString(),this.currentDimensions[0]=Math.ceil(e.measureText(this.currentText).width/this.scale),li(t)}this.textLines?this.currentDimensions[1]=Math.ceil(this.textHeight*this.textLines.length*this.lineHeight/this.scale):this.dirtyDimensions=!0},Gr.setSectionStyles=function(t){let e,i,s,n=new RegExp(this.sectionClassMarker),r=t.split(n),o=this.sectionStyles,a=this.sectionClasses,l="";return o.length=0,r.forEach((t=>{e=a[t],e?(i=l.length,s=o[i],s?Object.assign(s,e):o[i]=Object.assign({},e)):dt(t)&&(l+=t)})),l},Gr.addSectionClass=function(t,e){return ft(t,e)&&t.substring&&ot(e)&&(this.sectionClasses[t]=e),this.dirtyText=!0,this.dirtyPathObject=!0,this},Gr.removeSectionClass=function(t){return delete this.sectionClasses[t],this.dirtyText=!0,this.dirtyPathObject=!0,this},Gr.getTextPath=function(){let t=this.textPath;return t&&t.substring&&(t=this.textPath=o[this.textPath],"Shape"===t.type&&t.useAsPath?t.pathed.push(this.name):t=this.path=!1),t},Gr.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){this.dirtyFont&&this.fontAttributes&&(this.dirtyFont=!1,this.dirtyText=!0,this.dirtyMimicDimensions=!0,this.dirtyPositionSubscribers=!0),this.dirtyText&&this.buildText(),this.dirtyHandle&&this.cleanHandle();let t=this.pathObject=new Path2D,e=this.currentHandle,i=this.currentDimensions,s=this.currentScale,n=-e[0]*s,r=-e[1]*s,o=i[0]*s,a=i[1]*s;this.boxStartValues=[n,r],t.rect(n,r,o,a)}},Gr.buildText=function(){this.dirtyText=!1;let t=this.convertTextEntityCharacters(this.text);if(t=this.setSectionStyles(t),this.currentText=t,isNaN(this.currentDimensions[0]))this.dirtyText=!0;else if(this.calculateTextPositions(t),this.exposeText){if(!this.exposedTextHold){let t=document.createElement("div");t.id=`${this.name}-text-hold`,t.setAttribute("aria-live","polite"),this.exposedTextHold=t,this.exposedTextHoldAttached=!1}if(this.exposedTextHold.textContent=t,!this.exposedTextHoldAttached&&this.currentHost){let t=this.getCanvasTextHold(this.currentHost);t&&t.textHold&&(t.textHold.appendChild(this.exposedTextHold),this.exposedTextHoldAttached=!0)}}},Gr.getCanvasTextHold=function(t){return t&&"Cell"===t.type&&t.controller&&"Canvas"===t.controller.type&&t.controller.textHold?t.controller:!(!t||"Cell"!==t.type||!t.currentHost)&&this.getCanvasTextHold(t.currentHost)},Gr.convertTextEntityCharacters=function(t){let e=t.trim();return e=e.replace(/[\s\uFEFF\xA0]+/g," "),Xr.innerHTML=e,Xr.value},Gr.calculateTextPositions=function(t){const e=function(t){if(!I)return M.dirtyPathObject=!0,M.dirtyText=!0,"black";if(t.substring){let e=!1;if(D.indexOf(t)>=0?e=P[t]:d.indexOf(t)>=0&&(e=u[t]),e)return e}return t};let i,s,n,r,o,a,l,h,c,f,p,m,g,y,b,S,k,A,O,w,v,C,x,R,F=ai(),E=F.engine,M=this,I=!(!this.group||!this.group.getHost)&&this.group.getHost(),H=[],B=[],T=[],L=[],$=[],j=[],X=[],Y=this.getTextPath(),N=this.fontAttributes,G=N.clone({}),z=this.sectionStyles,W=this.state,V={},Z=[],_=this.currentScale,U=this.currentDimensions,K=U[0]*_,q=this.treatWordAsGlyph,Q=this.lineHeight,J=this.justify;N.updateMetadata(_,Q,I),G.updateMetadata(_,Q,I);let tt=N.getFontString(),et=e(W.fillStyle),it=e(W.strokeStyle),st=this.letterSpacing*_,nt=tt,rt=et,ot=it,at=st;this.highlightStyle&&e(this.highlightStyle);let lt=!1;this.underlineStyle&&e(this.underlineStyle),this.underlinePosition;let ht=!1;this.overlineStyle&&e(this.overlineStyle),this.overlinePosition;let ct=!1,ut=0;for(i=q?t.split(" "):t.split(""),Z.push(nt),f=0,p=i.length;f<p;f++)r=i[f],$[f]=[,,,,,,r,0,0,0];for(z[0]||(z[0]={family:G.family,size:G.sizeValue?`${G.sizeValue}${G.sizeMetric}`:G.sizeMetric,stretch:G.stretch,style:G.style,variant:G.variant,weight:G.weight}),f=0,p=z.length;f<p;f++)s=z[f],s&&(n=$[f],n&&(0===f&&(n[0]=nt,n[3]=lt,n[4]=ht,n[5]=ct),s.defaults&&(nt=G.update(N),ot=it,rt=et,at=st,n[0]=nt,n[1]=ot,n[2]=rt,n[3]=lt,n[4]=ht,n[5]=ct),r=s.stroke,r&&r!==ot&&(ot="default"===r?it:e(s.stroke),n[1]=ot),r=s.fill,r&&r!==rt&&(rt="default"===r?et:e(s.fill),n[2]=rt),r=s.space,dt(r)&&r!==at&&(at=r*_),r=s.highlight,dt(r)&&r!==lt&&(lt=r,n[3]=lt),r=s.underline,dt(r)&&r!==ht&&(ht=r,n[4]=ht),r=s.overline,dt(r)&&r!==ct&&(ct=r,n[5]=ct),0!==f&&(s.variant||s.weight||s.style||s.stretch||s.size||s.sizeValue||s.sizeMetric||s.family||s.font)&&(r=G.update(s),r!==nt&&(nt=r,n[0]=nt,Z.indexOf(nt)<0&&Z.push(nt))))),H[f]=at;for(f=0,p=i.length;f<p;f++)dt(H[f])&&(at=H[f]),H[f]=at;for(E.save(),Z.forEach((t=>{E.font=t;let e=E.measureText("|/}ÁÅþ§¶¿∑ƒ⌈⌊qwertyd0123456789QWERTY");null!=e.actualBoundingBoxAscent&&null!=e.actualBoundingBoxDescent?V[t]=Math.ceil(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent):(jr.style.font=t,r=jr.clientHeight,V[t]=r)})),E.restore(),ut=Math.max(...Object.values(V)),v=w=o=a=0,f=0,p=$.length;f<p;f++)S=$[f],k=S[6],S[0]&&(E.font=S[0]),j.push(E.measureText(k).width),A=$[f+1],A=!(q||!A)&&A[6],b=!!A&&E.measureText(`${k}${A}`).width,X.push(b);for(f=0,p=X.length;f<p;f++)k=X[f],k&&(b=j[f]+j[f+1],n=$[f+1],b>k&&!n[0]&&(j[f]-=b-k));for(f=0,p=$.length;f<p;f++)S=$[f],k=S[6],O=j[f]+H[f],H[f]=O,(q||" "===k)&&(a=f),w+=O,v+=O,w>=K&&o<a&&(y=i.slice(o,a).join(""),B.push(y),b=q?y.split(" ").length-1:y.split(" ").length,L.push(b),b=H.slice(o,a).reduce(((t,e)=>t+e),0),T.push(b),w-=b,o=a+1),f+1===p&&(w===v?(y=t,B.push(y),L.push(q?y.split(" ").length-1:y.split(" ").length),T.push(v)):(y=i.slice(o).join(""),B.push(y),b=q?y.split(" ").length-1:y.split(" ").length,L.push(b),b=H.slice(o).reduce(((t,e)=>t+e),0),T.push(b))),dt(S[3])&&(lt=S[3]),dt(S[4])&&(ht=S[4]),dt(S[5])&&(ct=S[5]),S[3]=lt,S[4]=ht,S[5]=ct;if(_<=0&&(_=1),U[1]=Math.ceil(ut*B.length*Q/_),this.cleanHandle(),this.dirtyHandle=!1,C=this.currentHandle,x=-C[0]*_,R=-C[1]*_,!Y)if("full"===J)for(l=0,h=R,f=0,p=T.length;f<p;f++){for(b=x,c=f<p-1&&L[f]>1?(K-T[f])/(L[f]-1):0,m=0,g=B[f].length;m<g;m++)r=$[l]," "===r[6]&&(H[l]+=c),r[7]=Math.floor(b),r[8]=Math.floor(h),r[9]=H[l],b+=H[l],l++;l++,h+=ut*Q}else for(l=0,h=R,f=0,p=T.length;f<p;f++){for(b="right"===J?K-T[f]+x:"center"===J?(K-T[f])/2+x:x,m=0,g=B[f].length;m<g;m++)r=$[l],r&&(r[7]=Math.floor(b),r[8]=Math.floor(h),r[9]=H[l]),b+=H[l],l++;l++,h+=ut*Q}this.textGlyphs=i,this.textGlyphWidths=H,this.textLines=B,this.textLineWidths=T,this.textLineWords=L,this.textPositions=$,this.textHeight=ut,this.textLength=v,this.fontLibrary=V,li(F)},Gr.regularStamp=function(){let t,e,i,s,n,r=this.currentHost,o=this.method,a=this.preStamper,l=this.stamper;if(r)if(t=r.engine,"none"===this.method)this.performRotation(t);else if("clip"===this.method)this.performRotation(t),t.clip(this.pathObject,this.winding);else if(this.textPath){this.noCanvasEngineUpdates||r.setEngine(this),t.textBaseline="top",t.textAlign="left",this.getTextPath(),this.calculateGlyphPathPositions(),s=this.textPositions;let h,c,u=this.addTextPathRoll,d=this.addPathRotation,f=this.currentRotation,p=this.currentHandle;for(this.addPathRotation=u,e=0,i=s.length;e<i;e++)h=s[e],c=h[10],c&&(this.currentPathData=c,u&&(this.currentRotation=c.angle),r.rotateDestination(t,c.x,c.y,this),t.translate(-p[0],-p[1]),n=a(r,t,this,h),l[o](t,this,n));this.addPathRotation=d,this.currentRotation=f}else{for(this.performRotation(t),this.noCanvasEngineUpdates||r.setEngine(this),t.textBaseline="top",t.textAlign="left",s=this.textPositions||[],e=0,i=s.length;e<i;e++)n=a(r,t,this,s[e]),l[o](t,this,n);this.showBoundingBox&&this.drawBoundingBox(t)}},Gr.calculateGlyphPathPositions=function(){let t,e,i,s,n,r=this.getTextPath(),o=r.length,a=this.textPositions,l=this.textGlyphWidths,h="ltr"===this.textPathDirection,c=this.textPathPosition,u=this.justify,d=this.textPathLoop,f=this.constantPathSpeed;for(e=0,i=a.length;e<i;e++){switch(t=a[e],s=l[e],u){case"center":n=c+s/2/o,t[7]=-s/2;break;case"right":n=c+s/o,t[7]=-s;break;default:n=c}d&&(n>1||n<0)&&(n=n>.5?n-1:n+1),t[10]=n<=1&&n>=0&&r.getPathPositionData(n,f),t[9]=s,h?c+=s/o:c-=s/o,d&&(c>1||c<0)&&(c=c>.5?c-1:c+1)}},Gr.preStamper=function(t,e,i,s){const n=function(e){return e.getData?e.getData(i,t):e};let[r,o,a,l,h,c,...u]=s;if(r&&(e.font=r),l||h||c){let{highlightStyle:t,textHeight:s,underlineStyle:r,underlineWidth:o,underlinePosition:a,noUnderlineGlyphs:d,overlineStyle:f,overlineWidth:p,overlinePosition:m,noOverlineGlyphs:g}=i;e.save(),l&&(e.fillStyle=n(t),e.fillRect(u[1],u[2],u[3],s)),h&&d.indexOf(u[0])<0&&(e.fillStyle=n(r),e.fillRect(u[1],u[2]+s*a,u[3],o)),c&&(e.fillStyle=n(f),e.fillRect(u[1],u[2]+s*m,u[3],p)),e.restore()}return o&&(e.strokeStyle=n(o)),a&&(e.fillStyle=n(a)),u},Gr.stamper={draw:function(t,e,i){t.strokeText(...i)},fill:function(t,e,i){t.fillText(...i)},drawAndFill:function(t,e,i){t.strokeText(...i),t.fillText(...i),e.currentHost.clearShadow(),t.strokeText(...i),t.fillText(...i),e.currentHost.restoreShadow(e)},fillAndDraw:function(t,e,i){t.fillText(...i),t.strokeText(...i),e.currentHost.clearShadow(),t.fillText(...i),t.strokeText(...i),e.currentHost.restoreShadow(e)},drawThenFill:function(t,e,i){t.strokeText(...i),t.fillText(...i)},fillThenDraw:function(t,e,i){t.fillText(...i),t.strokeText(...i)},clear:function(t,e,i){let s=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fillText(...i),t.globalCompositeOperation=s}},Gr.drawBoundingBox=function(t){t.save(),t.strokeStyle=this.boundingBoxColor,t.lineWidth=1,t.globalCompositeOperation="source-over",t.globalAlpha=1,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.stroke(this.pathObject),t.restore()},Gr.performRotation=function(t){let e=this.currentHost;if(e){let[i,s]=this.currentStampPosition;e.rotateDestination(t,i,s,this)}};const Zr=function(t){return!!t&&new Phrase(t)};E.Phrase=Phrase;const Picture=function(t=Q){return this.copyStart=Ee(),this.currentCopyStart=Ee(),this.copyDimensions=Ee(),this.currentCopyDimensions=Ee(),this.copyArray=[],this.pasteArray=[],this.entityInit(t),t.copyStart||(t.copyStartX||(this.copyStart[0]=0),t.copyStartY||(this.copyStart[1]=0)),t.copyDimensions||(t.copyWidth||(this.copyDimensions[0]=1),t.copyHeight||(this.copyDimensions[1]=1)),this.imageSubscribers=[],this.dirtyCopyStart=!0,this.dirtyCopyDimensions=!0,this.dirtyImage=!0,this};let _r=Picture.prototype=Object.create(Object.prototype);_r.type="Picture",_r.lib="entity",_r.isArtefact=!0,_r.isAsset=!1,_r=Bt(_r),_r=$s(_r),_r=Ir(_r);_r.defs=lt(_r.defs,{copyStart:null,copyDimensions:null,checkHitIgnoreTransparency:!1}),_r.packetCoordinates=ct(_r.packetCoordinates,["copyStart","copyDimensions"]),_r.packetObjects=ct(_r.packetObjects,["asset"]),_r.factoryKill=function(t=!1){let{asset:e,removeAssetOnKill:i}=this;ot(e)&&(e.unsubscribe(this),i&&e.kill(!0))};let Ur=_r.getters,Kr=_r.setters,qr=_r.deltaSetters;Ur.copyStart=function(){return[].concat(this.currentCopyStart)},Ur.copyStartX=function(){return this.currentCopyStart[0]},Ur.copyStartY=function(){return this.currentCopyStart[1]},Kr.copyStartX=function(t){null!=t&&(this.copyStart[0]=t,this.dirtyCopyStart=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0)},Kr.copyStartY=function(t){null!=t&&(this.copyStart[1]=t,this.dirtyCopyStart=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0)},Kr.copyStart=function(t,e){this.setCoordinateHelper("copyStart",t,e),this.dirtyCopyStart=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},qr.copyStartX=function(t){let e=this.copyStart;e[0]=z(e[0],t),this.dirtyCopyStart=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},qr.copyStartY=function(t){let e=this.copyStart;e[1]=z(e[1],t),this.dirtyCopyStart=!0,this.dirtyFilterIdentifier=!0},qr.copyStart=function(t,e){this.setDeltaCoordinateHelper("copyStart",t,e),this.dirtyCopyStart=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},Ur.copyWidth=function(){return this.currentCopyDimensions[0]},Ur.copyHeight=function(){return this.currentCopyDimensions[1]},Ur.copyDimensions=function(t,e){return[].concat(this.currentCopyDimensions)},Kr.copyWidth=function(t){null!=t&&(this.copyDimensions[0]=t,this.dirtyCopyDimensions=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0)},Kr.copyHeight=function(t){null!=t&&(this.copyDimensions[1]=t,this.dirtyCopyDimensions=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0)},Kr.copyDimensions=function(t,e){this.setCoordinateHelper("copyDimensions",t,e),this.dirtyCopyDimensions=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},qr.copyWidth=function(t){let e=this.copyDimensions;e[0]=z(e[0],t),this.dirtyCopyDimensions=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},qr.copyHeight=function(t){let e=this.copyDimensions;e[1]=z(e[1],t),this.dirtyCopyDimensions=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},qr.copyDimensions=function(t,e){this.setDeltaCoordinateHelper("copyDimensions",t,e),this.dirtyCopyDimensions=!0,this.dirtyImageSubscribers=!0,this.dirtyFilterIdentifier=!0},Kr.checkHitIgnoreTransparency=function(t){this.checkHitIgnoreTransparency=t,t&&(this.stashOutput=!0)},_r.get=function(t){let e=this.source;if(0!==t.indexOf("video_")&&0!==t.indexOf("image_")||!e){let e=this.getters[t];if(e)return e.call(this);{let e,i=this.defs[t],s=this.state;return void 0!==i?(e=this[t],void 0!==e?e:i):(i=s.defs[t],void 0!==i?(e=s[t],void 0!==e?e:i):undef)}}return wr.indexOf(t)>=0||Te.indexOf(t)>=0?e[t.substring(6)]:void 0},_r.set=function(t=Q){const e=Object.keys(t),i=e.length;if(i){const s=this.setters,n=this.defs,r=this.source,o=this.state,a=o?o.setters:Q,l=o?o.defs:Q;let h,c,u,d;for(c=0;c<i;c++)u=e[c],d=t[u],0!==u.indexOf("video_")&&0!==u.indexOf("image_")||!r?u&&"name"!==u&&null!=d&&(xe.indexOf(u)<0?(h=s[u],h?h.call(this,d):void 0!==n[u]&&(this[u]=d)):(h=a[u],h?h.call(o,d):void 0!==l[u]&&(o[u]=d))):(vr.indexOf(u)>=0||Le.indexOf(u)>=0)&&(r[u.substring(6)]=d)}return this},_r.updateImageSubscribers=function(){this.dirtyImageSubscribers=!1,this.imageSubscribers.length&&this.imageSubscribers.forEach((t=>{let e=o[t];e&&(e.dirtyInput=!0)}))},_r.imageSubscribe=function(t){t&&t.substring&&ct(this.imageSubscribers,t)},_r.imageUnsubscribe=function(t){t&&t.substring&&ut(this.imageSubscribers,t)},_r.cleanImage=function(){let t=this.sourceNaturalWidth,e=this.sourceNaturalHeight;if(ft(t,e)&&t>0&&e>0){this.dirtyImage=!1;let i=this.currentCopyStart,s=i[0],n=i[1],r=this.currentCopyDimensions,o=r[0],a=r[1];s+o>t&&(i[0]=t-o),n+a>e&&(i[1]=e-a);let l=this.copyArray;l.length=0,l.push(i[0],i[1],o,a)}},_r.cleanCopyStart=function(){let t=this.sourceNaturalWidth,e=this.sourceNaturalHeight;if(ft(t,e)&&t>0&&e>0){this.dirtyCopyStart=!1,this.cleanPosition(this.currentCopyStart,this.copyStart,[t,e]);let i=this.currentCopyStart,s=i[0],n=i[1];(s<0||s>t)&&(i[0]=s<0?0:t-1),(n<0||n>e)&&(i[1]=n<0?0:e-1),this.dirtyImage=!0}},_r.cleanCopyDimensions=function(){let t=this.sourceNaturalWidth,e=this.sourceNaturalHeight;if(ft(t,e)&&t>0&&e>0){this.dirtyCopyDimensions=!1;let i=this.copyDimensions,s=this.currentCopyDimensions,n=i[0],r=i[1];n.substring?s[0]=parseFloat(n)/100*t:s[0]=n,r.substring?s[1]=parseFloat(r)/100*e:s[1]=r;let o=s[0],a=s[1];(o<=0||o>t)&&(s[0]=o<=0?1:t),(a<=0||a>e)&&(s[1]=a<=0?1:e),this.dirtyImage=!0}},_r.prepareStamp=function(){this.dirtyAsset&&this.cleanAsset(),this.asset&&("Sprite"===this.asset.type?this.checkSpriteFrame(this):this.asset.checkSource?this.asset.checkSource(this.sourceNaturalWidth,this.sourceNaturalHeight):this.dirtyAsset=!0),(this.dirtyDimensions||this.dirtyHandle||this.dirtyScale)&&(this.dirtyPaste=!0),(this.dirtyScale||this.dirtyDimensions||this.dirtyStart||this.dirtyOffset||this.dirtyHandle)&&(this.dirtyPathObject=!0),this.dirtyScale&&this.cleanScale(),this.dirtyDimensions&&this.cleanDimensions(),this.dirtyLock&&this.cleanLock(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyHandle&&this.cleanHandle(),this.dirtyRotation&&this.cleanRotation(),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtyStampHandlePositions&&this.cleanStampHandlePositions(),this.dirtyCopyStart&&this.cleanCopyStart(),this.dirtyCopyDimensions&&this.cleanCopyDimensions(),this.dirtyImage&&this.cleanImage(),this.dirtyPaste&&this.preparePasteObject(),this.dirtyPathObject&&this.cleanPathObject(),this.dirtyPositionSubscribers&&this.updatePositionSubscribers(),this.dirtyImageSubscribers&&this.updateImageSubscribers()},_r.preparePasteObject=function(){this.dirtyPaste=!1;let t=this.currentStampHandlePosition,e=this.currentDimensions,i=this.currentScale,s=-t[0]*i,n=-t[1]*i,r=e[0]*i,o=e[1]*i,a=this.pasteArray;a.length=0,a.push(s,n,r,o),this.dirtyPathObject=!0},_r.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject)if(this.pasteArray&&4===this.pasteArray.length||this.preparePasteObject(),4!==this.pasteArray.length)this.dirtyPathObject=!0;else{(this.pathObject=new Path2D).rect(...this.pasteArray)}},_r.draw=function(t){t.stroke(this.pathObject)},_r.fill=function(t){let[e,i,s,n]=this.copyArray;this.source&&s&&n&&t.drawImage(this.source,...this.copyArray,...this.pasteArray)},_r.drawAndFill=function(t){let[e,i,s,n]=this.copyArray;this.source&&s&&n&&(t.stroke(this.pathObject),t.drawImage(this.source,...this.copyArray,...this.pasteArray),this.currentHost.clearShadow(),t.stroke(this.pathObject),t.drawImage(this.source,...this.copyArray,...this.pasteArray))},_r.fillAndDraw=function(t){let[e,i,s,n]=this.copyArray;this.source&&s&&n&&(t.drawImage(this.source,...this.copyArray,...this.pasteArray),t.stroke(this.pathObject),this.currentHost.clearShadow(),t.drawImage(this.source,...this.copyArray,...this.pasteArray),t.stroke(this.pathObject)),t.stroke(this.pathObject)},_r.drawThenFill=function(t){let[e,i,s,n]=this.copyArray;this.source&&s&&n&&(t.stroke(this.pathObject),t.drawImage(this.source,...this.copyArray,...this.pasteArray))},_r.fillThenDraw=function(t){let[e,i,s,n]=this.copyArray;this.source&&s&&n&&(t.drawImage(this.source,...this.copyArray,...this.pasteArray),t.stroke(this.pathObject))},_r.checkHitReturn=function(t,e,i){if(this.checkHitIgnoreTransparency&&i&&i.engine){let[s,n,r,o]=this.copyArray,[a,l,h,c]=this.pasteArray,[u,d]=this.currentStampPosition,f=4*((e-d)*h+(t-u))+3;return!!i.engine.getImageData(s,n,r,o).data[f]&&{x:t,y:e,artefact:this}}return{x:t,y:e,artefact:this}};const Qr=function(t){return!!t&&new Picture(t)};E.Picture=Picture;const Polygon=function(t=Q){return this.shapeInit(t),this};let Jr=Polygon.prototype=Object.create(Object.prototype);Jr.type="Polygon",Jr.lib="entity",Jr.isArtefact=!0,Jr.isAsset=!1,Jr=Bt(Jr),Jr=Vs(Jr);Jr.defs=lt(Jr.defs,{sides:0,sideLength:0,radius:0});let to=Jr.setters,eo=Jr.deltaSetters;to.sides=function(t){this.sides=t,this.updateDirty()},eo.sides=function(t){this.sides+=t,this.updateDirty()},to.sideLength=function(t){this.sideLength=t,this.updateDirty()},eo.sideLength=function(t){this.sideLength+=t,this.updateDirty()},to.radius=function(t){this.radius=t,this.updateDirty()},eo.radius=function(t){this.radius+=t,this.updateDirty()},Jr.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makePolygonPath(),this.pathDefinition=t},Jr.makePolygonPath=function(){let t,e,i,s=this.sideLength||this.radius,n=this.sides,r=360/n,o="",a=[],l=0,h=Ri({x:0,y:-s});for(let t=0;t<n;t++)h.rotate(r),l+=h.y,a.push(l),o+=`${h.x.toFixed(1)},${h.y.toFixed(1)} `;return Fi(h),e=Math.min(...a),t=Math.max(...a),i=((Math.abs(e)+Math.abs(t)-s)/2).toFixed(1),o=`m0,${i}l${o}z`,o};const io=function(t){return!!t&&(t.species="polygon",new Polygon(t))};E.Polygon=Polygon;const Polyline=function(t=Q){return this.pins=[],this.currentPins=[],this.controlledLineOffset=Ee(),this.shapeInit(t),this};let so=Polyline.prototype=Object.create(Object.prototype);so.type="Polyline",so.lib="entity",so.isArtefact=!0,so.isAsset=!1,so=Bt(so),so=Vs(so);so.defs=lt(so.defs,{pins:null,tension:0,closed:!1,mapToPins:!1,useParticlesAsPins:!1}),so.packetExclusions=ct(so.packetExclusions,["controlledLineOffset"]),so.packetExclusionsByRegex=ct(so.packetExclusionsByRegex,[]),so.packetCoordinates=ct(so.packetCoordinates,[]),so.packetObjects=ct(so.packetObjects,[]),so.packetFunctions=ct(so.packetFunctions,[]),so.finalizePacketOut=function(t,e){let i=JSON.parse(this.state.saveAsPacket(e))[3];return t=lt(t,i),t=this.handlePacketAnchor(t,e),Object.keys(t).forEach((e=>{if("pins"===e){let e=[];t.pins.forEach((t=>{ot(t)?e.push(t.name):Array.isArray(t)?e.push([].concat(t)):e.push(t)})),t.pins=e}})),t};let no=so.getters,ro=so.setters,oo=so.deltaSetters;no.pins=function(t){return dt(t)?this.getPinAt(t):this.currentPins.concat()},ro.pins=function(t){if(dt(t)){let e=this.pins;if(Array.isArray(t))e.forEach(((t,e)=>this.removePinAt(e))),e.length=0,e.push(...t),this.updateDirty();else if(ot(t)&&dt(t.index)){let i=e[t.index];Array.isArray(i)&&(dt(t.x)&&(i[0]=t.x),dt(t.y)&&(i[1]=t.y),this.updateDirty())}}},oo.pins=function(t){if(dt(t)){let e=this.pins;if(ot(t)&&dt(t.index)){let i=e[t.index];Array.isArray(i)&&(dt(t.x)&&(i[0]=addStrings(i[0],t.x)),dt(t.y)&&(i[1]=addStrings(i[1],t.y)),this.updateDirty())}}},ro.tension=function(t){t.toFixed&&(this.tension=t,this.updateDirty())},oo.tension=function(t){t.toFixed&&(this.tension+=t,this.updateDirty())},ro.closed=function(t){this.closed=t,this.updateDirty()},ro.mapToPins=function(t){this.mapToPins=t,this.updateDirty()},ro.flipUpend=function(t){this.flipUpend=t,this.updateDirty()},ro.flipReverse=function(t){this.flipReverse=t,this.updateDirty()},ro.useAsPath=function(t){this.useAsPath=t,this.updateDirty()},ro.pivot=function(t){if(et(t)&&!t)this.pivot=null,"pivot"===this.lockTo[0]&&(this.lockTo[0]="start"),"pivot"===this.lockTo[1]&&(this.lockTo[1]="start"),this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0;else{let e=this.pivot,i=t.substring?o[t]:t,s=this.name;i&&i.name&&(e&&e.name!==i.name&&ut(e.pivoted,s),ct(i.pivoted,s),this.pivot=i,this.dirtyStampPositions=!0,this.dirtyStampHandlePositions=!0)}this.updateDirty()},so.updateDirty=function(){this.dirtySpecies=!0,this.dirtyPathObject=!0,this.dirtyPins=!0},so.getPinAt=function(t){let e=Math.floor(t);if(this.useAsPath){let t=this.getPathPositionData(this.unitPartials[e]);return[t.x,t.y]}{let t,i,s=this.currentPins,n=s[e],[r,o,a,l]=this.localBox,[h,c]=n,[u,d]=s[0],[f,p]=this.localOffset,[m,g]=this.currentStampPosition;return this.mapToPins?(t=h-u+r,i=c-u+o):(t=h-f,i=c-p),[m+t,g+i]}},so.updatePinAt=function(t,e){if(ft(t,e)){e=Math.floor(e);let i=this.pins;if(e<i.length&&e>=0){let s=i[e];ot(s)&&s.pivoted&&ut(s.pivoted,this.name),i[e]=t,this.updateDirty()}}},so.removePinAt=function(t){t=Math.floor(t);let e=this.pins;if(t<e.length&&t>=0){let i=e[t];ot(i)&&i.pivoted&&ut(i.pivoted,this.name),e[t]=null,this.updateDirty()}},so.prepareStamp=function(){this.dirtyHost&&(this.dirtyHost=!1),this.useParticlesAsPins&&(this.dirtyPins=!0),(this.dirtyPins||this.dirtyLock)&&(this.dirtySpecies=!0),(this.dirtyScale||this.dirtySpecies||this.dirtyDimensions||this.dirtyStart||this.dirtyHandle)&&(this.dirtyPathObject=!0,(this.dirtyScale||this.dirtySpecies)&&(this.pathCalculatedOnce=!1)),(this.isBeingDragged||this.lockTo.indexOf("mouse")>=0||this.lockTo.indexOf("particle")>=0)&&(this.dirtyStampPositions=!0),this.dirtyScale&&this.cleanScale(),this.dirtyStart&&this.cleanStart(),this.dirtyOffset&&this.cleanOffset(),this.dirtyRotation&&this.cleanRotation(),this.dirtyStampPositions&&this.cleanStampPositions(),this.dirtySpecies&&this.cleanSpecies(),this.dirtyPathObject&&(this.cleanPathObject(),this.updatePathSubscribers()),this.dirtyPositionSubscribers&&this.updatePositionSubscribers()},so.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makePolylinePath(),this.pathDefinition=t},so.getPathParts=function(t,e,i,s,n,r,o){let a=Math.sqrt,l=Math.pow,h=a(l(i-t,2)+l(s-e,2)),c=a(l(n-i,2)+l(r-s,2)),u=o*h/(h+c),d=o*c/(h+c);return[i-u*(n-t),s-u*(r-e),i,s,i+d*(n-t),s+d*(r-e)]},so.buildLine=function(t,e,i){let s="m0,0l";for(let n=2;n<i.length;n+=6)s+=`${Z(i[n]-t)},${Z(i[n+1]-e)} `,t=i[n],e=i[n+1];return s},so.buildCurve=function(t,e,i){let s="m0,0c",n=0;for(let r=0;r<i.length;r+=2)s+=`${Z(i[r]-t)},${Z(i[r+1]-e)} `,n++,n>2&&(t=i[r],e=i[r+1],n=0);return s},so.cleanCoordinate=function(t,e){return t.toFixed?t:"left"===t||"top"===t?0:"right"===t||"bottom"===t?e:"center"===t?e/2:parseFloat(t)/100*e},so.cleanPinsArray=function(){this.dirtyPins=!1;let t=this.pins,e=this.currentPins;if(e.length=0,this.useParticlesAsPins)t.forEach(((i,s)=>{let n;i&&i.substring?(n=b[i],n&&(t[s]=n)):n=i;let r=!(!n||!n.position)&&n.position;r&&e.push([r.x,r.y])})),e.length||(this.dirtyPins=!0);else{let i,s,n,r=1,a=1,l=this.getHost(),h=this.cleanCoordinate;l&&(n=l.currentDimensions,n&&([r,a]=n)),t.forEach(((n,l)=>{let c;if(n&&n.substring?(c=o[n],t[l]=c):c=n,c)if(Array.isArray(c))[i,s]=c,e.push([h(i,r),h(s,a)]);else if(ot(c)&&c.currentStart){let t=this.name;c.pivoted.indexOf(t)<0&&ct(c.pivoted,t),e.push([...c.currentStampPosition])}}))}if(e.length){let t=e[0][0],i=e[0][1];e.forEach((e=>{e[0]<t&&(t=e[0]),e[1]<i&&(i=e[1])})),this.localOffset=[t,i],this.updatePivotSubscribers()}},so.makePolylinePath=function(){let t=this.getPathParts,e=this.buildLine,i=this.buildCurve;this.pins;let s=this.currentPins,n=this.tension,r=this.closed;if(this.dirtyPins&&this.cleanPinsArray(),s.length){let o=s.length,a=s[0],l=s[o-1],h=[],c="m0,0";if(r){let r=[].concat(...t(...l,...a,...s[1],n));for(let e=0;e<o-2;e++)h=h.concat(...t(...s[e],...s[e+1],...s[e+2],n));h=h.concat(...t(...s[o-2],...l,...a,n)),h.unshift(r[4],r[5]),h.push(r[0],r[1],r[2],r[3]),c=n?i(a[0],a[1],h)+"z":e(a[0],a[1],h)+"z"}else{h.push(a[0],a[1]);for(let e=0;e<o-2;e++)h=h.concat(...t(...s[e],...s[e+1],...s[e+2],n));h.push(l[0],l[1],l[0],l[1]),c=n?i(a[0],a[1],h):e(a[0],a[1],h)}return c}return"m0,0"},so.calculateLocalPathAdditionalActions=function(){let[t,e,i,s]=this.localBox,n=this.pathDefinition;this.mapToPins?this.set({start:this.currentPins[0]}):this.pathDefinition=n.replace("m0,0",`m${-t},${-e}`),this.pathCalculatedOnce=!1,this.calculateLocalPath(this.pathDefinition,!0)},so.updatePathSubscribers=function(){this.pathed.forEach((t=>{let e=o[t];e&&(e.dirtyStart=!0)}))};const ao=function(t){return!!t&&(t.species="polyline",new Polyline(t))};E.Polyline=Polyline;const Quadratic=function(t=Q){return this.control=Ee(),this.currentControl=Ee(),this.controlLockTo="coord",this.curveInit(t),this.shapeInit(t),this.dirtyControl=!0,this};let lo=Quadratic.prototype=Object.create(Object.prototype);lo.type="Quadratic",lo.lib="entity",lo.isArtefact=!0,lo.isAsset=!1,lo=Bt(lo),lo=Vs(lo),lo=_s(lo);lo.defs=lt(lo.defs,{control:null,controlPivot:"",controlPivotCorner:"",addControlPivotHandle:!1,addControlPivotOffset:!1,controlPath:"",controlPathPosition:0,addControlPathHandle:!1,addControlPathOffset:!0,controlParticle:"",controlLockTo:""}),lo.packetExclusions=ct(lo.packetExclusions,[]),lo.packetExclusionsByRegex=ct(lo.packetExclusionsByRegex,[]),lo.packetCoordinates=ct(lo.packetCoordinates,["control"]),lo.packetObjects=ct(lo.packetObjects,["controlPivot","controlPath"]),lo.packetFunctions=ct(lo.packetFunctions,[]);let ho=lo.getters,co=lo.setters,uo=lo.deltaSetters;co.controlPivot=function(t){this.setControlHelper(t,"controlPivot","control"),this.updateDirty(),this.dirtyControl=!0},co.controlParticle=function(t){this.setControlHelper(t,"controlParticle","control"),this.updateDirty(),this.dirtyControl=!0},co.controlPath=function(t){this.setControlHelper(t,"controlPath","control"),this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1},co.controlPathPosition=function(t){this.controlPathPosition=t,this.dirtyControl=!0,this.currentControlPathData=!1,this.dirtyFilterIdentifier=!0},uo.controlPathPosition=function(t){this.controlPathPosition+=t,this.dirtyControl=!0,this.currentControlPathData=!1,this.dirtyFilterIdentifier=!0},ho.controlPositionX=function(){return this.currentControl[0]},ho.controlPositionY=function(){return this.currentControl[1]},ho.controlPosition=function(){return[].concat(this.currentControl)},co.controlX=function(t){null!=t&&(this.control[0]=t,this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1)},co.controlY=function(t){null!=t&&(this.control[1]=t,this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1)},co.control=function(t,e){this.setCoordinateHelper("control",t,e),this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1},uo.controlX=function(t){let e=this.control;e[0]=z(e[0],t),this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1},uo.controlY=function(t){let e=this.control;e[1]=z(e[1],t),this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1},uo.control=function(t,e){this.setDeltaCoordinateHelper("control",t,e),this.updateDirty(),this.dirtyControl=!0,this.currentControlPathData=!1},co.controlLockTo=function(t){this.controlLockTo=t,this.updateDirty(),this.dirtyControlLock=!0,this.currentControlPathData=!1},lo.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeQuadraticPath(),this.pathDefinition=t},lo.makeQuadraticPath=function(){let[t,e]=this.currentStampPosition,[i,s]=this.currentControl,[n,r]=this.currentEnd;return`m0,0q${(i-t).toFixed(2)},${(s-e).toFixed(2)} ${(n-t).toFixed(2)},${(r-e).toFixed(2)}`},lo.cleanDimensions=function(){this.dirtyDimensions=!1,this.dirtyHandle=!0,this.dirtyOffset=!0,this.dirtyStart=!0,this.dirtyControl=!0,this.dirtyEnd=!0,this.dirtyFilterIdentifier=!0},lo.preparePinsForStamp=function(){const t=this.dirtyPins,e=this.endPivot,i=this.endPath,s=this.controlPivot,n=this.controlPath;for(let r,o=0,a=t.length;o<a;o++)r=t[o],(s&&s.name===r||n&&n.name==r)&&(this.dirtyControl=!0,this.controlLockTo.includes("path")&&(this.currentControlPathData=!1)),(e&&e.name===r||i&&i.name==r)&&(this.dirtyEnd=!0,this.endLockTo.includes("path")&&(this.currentEndPathData=!1));t.length=0};const fo=function(t=Q){return!!t&&(t.species="quadratic",new Quadratic(t))};E.Quadratic=Quadratic;const RadialGradient=function(t=Q){return this.stylesInit(t),this};let po=RadialGradient.prototype=Object.create(Object.prototype);po.type="RadialGradient",po.lib="styles",po.isArtefact=!1,po.isAsset=!1,po=Bt(po),po=hn(po);po.defs=lt(po.defs,{startRadius:0,endRadius:0}),po.packetObjects=ct(po.packetObjects,["palette"]);let mo=po.getters,go=po.setters,yo=po.deltaSetters;mo.startRadius=function(t){return this.currentStartRadius},mo.endRadius=function(t){return this.currentEndRadius},go.startRadius=function(t){this.startRadius=t,this.dirtyStyle=!0},go.endRadius=function(t){this.endRadius=t,this.dirtyStyle=!0},yo.startRadius=function(t){this.startRadius=z(this.startRadius,t),this.dirtyStyle=!0},yo.endRadius=function(t){this.endRadius=z(this.endRadius,t),this.dirtyStyle=!0},po.cleanRadius=function(t){const e=(t,e)=>{if(rt(t))return t;switch(t){case"top":case"left":return 0;case"bottom":case"right":return e;case"center":return e/2;default:return t=parseFloat(t),rt(t)?t/100*e:0}};this.currentStartRadius=t?e(this.startRadius,t):this.defs.startRadius,this.currentEndRadius=t?e(this.endRadius,t):this.defs.endRadius},po.buildStyle=function(t){if(t){let e=t.engine;if(e){let t=e.createRadialGradient(...this.gradientArgs);return this.addStopsToGradient(t,this.paletteStart,this.paletteEnd,this.cyclePalette)}}return"rgb(0 0 0 / 0)"},po.updateGradientArgs=function(t,e){let i=this.gradientArgs,s=this.currentStart,n=this.currentEnd,r=this.currentStartRadius,o=this.currentEndRadius,a=s[0]+t,l=s[1]+e,h=n[0]+t,c=n[1]+e;a===h&&l===c&&r===o&&o++,i.length=0,i.push(a,l,r,h,c,o)};const bo=function(t){return!!t&&new RadialGradient(t)};E.RadialGradient=RadialGradient;const RawAsset=function(t=Q){this.makeName(t.name),this.register(),this.subscribers=[],this.set(this.defs),this.updateSource=_;let e=t.keytypes||{};t.userAttributes&&t.userAttributes.forEach((t=>{this.addAttribute(t),t.type&&(e[t.key]=t.type)})),this.initializeAttributes(e),this.set(t);let i=document.createElement("canvas");return i.width=0,i.height=0,this.element=i,this.engine=i.getContext("2d",{willReadFrequently:!0}),t.subscribe&&this.subscribers.push(t.subscribe),this};let So=RawAsset.prototype=Object.create(Object.prototype);So.type="RawAsset",So.lib="asset",So.isArtefact=!1,So.isAsset=!0,So=Bt(So),So=Me(So);So.defs=lt(So.defs,{keytypes:null,data:null,updateSource:null}),So.saveAsPacket=function(){return[this.name,this.type,this.lib,{}]},So.stringifyFunction=_,So.processPacketOut=_,So.finalizePacketOut=_,So.clone=K;let ko=So.getters,Ao=So.setters,Oo=So.deltaSetters;Ao.source=_,Ao.element=_,Ao.engine=_,Ao.data=function(t){t&&(this.data=t,this.dirtyData=!0)},Ao.updateSource=function(t){t&&nt(t)&&(this.updateSource=t,this.dirtyData=!0)},So.checkSource=function(t,e){this.source||(this.source=this.element);let i=this.source;if(i){let s=!1;this.dirtyData&&(this.dirtyData=!1,this.updateSource(this),s=!0),this.sourceLoaded=!0,this.sourceNaturalWidth&&this.sourceNaturalHeight&&this.sourceNaturalWidth===t&&this.sourceNaturalHeight===e||(this.sourceNaturalWidth=i.width,this.sourceNaturalHeight=i.height,s=!0),s&&this.sourceNaturalWidth&&this.sourceNaturalHeight&&this.notifySubscribers()}else this.sourceLoaded=!1},So.subscribeAction=function(t={}){this.subscribers.push(t),t.asset=this,t.source=this.element,this.notifySubscriber(t)},So.addAttribute=function(t=Q){let{key:e,defaultValue:i,setter:s,deltaSetter:n,getter:r}=t;return e&&e.substring&&(this.defs[e]=dt(i)?i:null,this[e]=dt(i)?i:null,nt(s)&&(Ao[e]=s),nt(n)&&(Oo[e]=n),nt(r)&&(ko[e]=r)),this},So.removeAttribute=function(t){return t&&t.substring&&(delete this.defs[t],delete this[t],delete ko[t],delete Ao[t],delete Oo[t]),this},So.initializeAttributes=function(t){for(let[e,i]of Object.entries(t))switch(i){case"Quaternion":this[e]=makeQuaternion();break;case"Vector":this[e]=makeVector();break;case"Coordinate":this[e]=makeCoordinate()}};const wo=function(t){return!!t&&new RawAsset(t)};E.RawAsset=RawAsset;const RdAsset=function(t=Q){return this.makeName(t.name),this.register(),this.installElement(this.name),this.subscribers=[],this.set(this.defs),this.set(t),t.subscribe&&this.subscribers.push(t.subscribe),this.currentGeneration=0,this.dataArrays=[],this.dirtyScene=!0,this.dirtyOutput=!0,this};let vo=RdAsset.prototype=Object.create(Object.prototype);vo.type="RdAsset",vo.lib="asset",vo.isArtefact=!1,vo.isAsset=!0,vo=Bt(vo),vo=Me(vo),vo=dr(vo),vo=Je(vo);vo.defs=lt(vo.defs,{width:300,height:150,diffusionRateA:.2097,diffusionRateB:.105,feedRate:.054,killRate:.062,initialSettingPreference:"random",randomEngineSeed:"some-random-string-or-other",initialRandomSeedLevel:.0045,initialSettingEntity:null,drawEvery:10,maxGenerations:4e3}),delete vo.defs.source,delete vo.defs.sourceLoaded,vo.stringifyFunction=_,vo.processPacketOut=_,vo.finalizePacketOut=_,vo.saveAsPacket=function(){return`[${this.name}, ${this.type}, ${this.lib}, {}]`},vo.clone=K,vo.getters;let Co=vo.setters;vo.deltaSetters,Co.subscribers=_,Co.width=function(t){t.toFixed&&(this.width=t,this.sourceNaturalWidth=t,this.dirtyScene=!0)},Co.height=function(t){t.toFixed&&(this.height=t,this.sourceNaturalHeight=t,this.dirtyScene=!0)},Co.initialRandomSeedLevel=function(t){t.toFixed&&(this.initialRandomSeedLevel=t,this.dirtyScene=!0)},Co.diffusionRateA=function(t){t.toFixed&&(this.diffusionRateA=t,this.dirtyScene=!0)},Co.diffusionRateB=function(t){t.toFixed&&(this.diffusionRateB=t,this.dirtyScene=!0)},Co.feedRate=function(t){t.toFixed&&(this.feedRate=t,this.dirtyScene=!0)},Co.killRate=function(t){t.toFixed&&(this.killRate=t,this.dirtyScene=!0)},Co.drawEvery=function(t){t.toFixed&&(this.drawEvery=t,this.dirtyScene=!0)},Co.maxGenerations=function(t){t.toFixed&&(this.maxGenerations=t,this.dirtyScene=!0)},vo.initialSettingPreferenceValues=["random","entity"],Co.initialSettingPreference=function(t){t.substring&&this.initialSettingPreferenceValues.indexOf(t)>=0&&(this.initialSettingPreference=t,this.dirtyScene=!0)},Co.randomEngineSeed=function(t){t.substring&&(this.randomEngineSeed=t,this.dirtyScene=!0)},Co.initialSettingEntity=function(t){t&&(t.substring||(t=t.name||""),t&&(this.initialSettingEntity=t,this.dirtyScene=!0))},Co.preset=function(t){if(t.substring){switch(t){case"negativeBubbles":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.098,this.killRate=.0555,this.maxGenerations=4e3,this.initialRandomSeedLevel=.05;break;case"positiveBubbles":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.098,this.killRate=.057,this.maxGenerations=4e3,this.initialRandomSeedLevel=.1;break;case"precriticalBubbles":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.082,this.killRate=.059,this.maxGenerations=4e3,this.initialRandomSeedLevel=.08;break;case"wormsAndLoops":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.082,this.killRate=.06,this.maxGenerations=4e3,this.initialRandomSeedLevel=.08;break;case"stableSolitons":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.074,this.killRate=.064,this.maxGenerations=4e3,this.initialRandomSeedLevel=.15;break;case"uSkateWorld":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.062,this.killRate=.0609,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"worms":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.058,this.killRate=.065,this.maxGenerations=4e3,this.initialRandomSeedLevel=.1;break;case"wormsJoinIntoMazes":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.046,this.killRate=.063,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"negatons":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.046,this.killRate=.0594,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"turingPatterns":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.042,this.killRate=.059,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"chaosToTuringNegatons":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.039,this.killRate=.058,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"fingerprints":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.037,this.killRate=.06,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"chaosWithNegatons":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.0353,this.killRate=.0566,this.maxGenerations=0,this.initialRandomSeedLevel=.0045;break;case"spotsAndWorms":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.034,this.killRate=.0618,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"selfReplicatingSpots":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.03,this.killRate=.063,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"superResonantMazes":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.03,this.killRate=.0565,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"mazes":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.029,this.killRate=.057,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045;break;case"mazesWithSomeChaos":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.026,this.killRate=.055,this.maxGenerations=0,this.initialRandomSeedLevel=.0045;break;case"chaos":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.026,this.killRate=.051,this.maxGenerations=0,this.initialRandomSeedLevel=.009;break;case"warringMicrobes":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.022,this.killRate=.059,this.maxGenerations=0,this.initialRandomSeedLevel=.0045;break;case"spotsAndLoops":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.018,this.killRate=.051,this.maxGenerations=0,this.initialRandomSeedLevel=.0045;break;case"movingSpots":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.014,this.killRate=.054,this.maxGenerations=0,this.initialRandomSeedLevel=.0045;break;case"waves":this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.014,this.killRate=.045,this.maxGenerations=0,this.initialRandomSeedLevel=.0045;break;default:this.diffusionRateA=.2097,this.diffusionRateB=.105,this.feedRate=.054,this.killRate=.062,this.maxGenerations=4e3,this.initialRandomSeedLevel=.0045}this.dirtyScene=!0}},vo.update=function(){this.dirtyOutput=!0},vo.cleanOutput=function(t=0){if(this.dirtyScene&&this.cleanScene(),!this.dirtyScene){const{element:e,engine:i,dataArrays:s,diffusionRateA:n,diffusionRateB:r,feedRate:o,killRate:a,currentSource:l,drawEvery:h,maxGenerations:c,currentGeneration:u}=this;let d,f,p,m,g,y,b,S,k,A;if(!c||u<c)if(l?[f,d,m,p]=s:[d,f,p,m]=s,t<h){for(b=0,S=d.length;b<S;b++)g=d[b],y=p[b],k=g+n*this.calculateLaplacian(b,d)-g*y*y+o*(1-g),A=y+r*this.calculateLaplacian(b,p)+g*y*y-(a+o)*y,f[b]=this.constrain(k,0,1),m[b]=this.constrain(A,0,1);this.currentSource=l?0:1,this.currentGeneration=u+1,this.cleanOutput(t+1)}else this.paintCanvas();else this.dirtyOutput&&this.paintCanvas()}},vo.cleanScene=function(){const{element:t,width:e,height:i,dataArrays:s,initialRandomSeedLevel:n,initialSettingPreference:r,randomEngineSeed:o,initialSettingEntity:a}=this;if(e&&i&&this.dirtyScene){this.dirtyScene=!1,t.width=e,t.height=i;const l=e*i;s.length=0;for(let t=0;t<4;t++)s.push(new Float64Array(l));this.currentSource=0;let[h,c,u,d]=s;if(h.fill(1),c.fill(1),u.fill(0),d.fill(0),"entity"===r&&f[a]){const t=f[a],s=ai(),{engine:n,element:r}=s;r.width=e,r.height=i,t.simpleStamp(s,{fillStyle:"white",strokeStyle:"white"});const o=n.getImageData(0,0,e,i).data;let l=0;for(let t=3,e=o.length;t<e;t+=4)u[l]=o[t]/255,l++;li(s)}else{const t=Oe(o);for(let e=0;e<l;e++)u[e]=t.random()<n?1:0}this.currentGeneration=0}},vo.constrain=function(t,e,i){return t<e?e:t>i?i:t},vo.calculateLaplacian=function(t,e){const i=this.width;let s,n=0,r=Math.floor(t/i),o=this.checkRow(r-1)*i,a=this.checkRow(r+1)*i,l=r*i,h=t-l,c=this.checkCol(h-1),u=this.checkCol(h+1);return n+=-1*e[t],s=o+c,n+=.05*e[s],s=o+u,n+=.05*e[s],s=a+c,n+=.05*e[s],s=a+u,n+=.05*e[s],s=o+h,n+=.2*e[s],s=l+u,n+=.2*e[s],s=l+c,n+=.2*e[s],s=a+h,n+=.2*e[s],n},vo.checkRow=function(t){const e=this.height;return t<0?e-1:t>=e?0:t},vo.checkCol=function(t){const e=this.width;return t<0?e-1:t>=e?0:t},vo.checkOutputValuesExist=function(){return!!this.dataArrays.length},vo.getOutputValue=function(t,e){let i,s,n,r;const{dataArrays:o,currentSource:a}=this;return a?[i,s,n,r]=o:[s,i,r,n]=o,(i[t]-n[t]+1)/2};const xo=function(t){return!!t&&new RdAsset(t)};E.RdAsset=RdAsset;const Rectangle=function(t=Q){return this.shapeInit(t),this.currentRectangleWidth=1,this.currentRectangleHeight=1,this};let Po=Rectangle.prototype=Object.create(Object.prototype);Po.type="Rectangle",Po.lib="entity",Po.isArtefact=!0,Po.isAsset=!1,Po=Bt(Po),Po=Vs(Po);Po.defs=lt(Po.defs,{rectangleWidth:10,rectangleHeight:10,radiusTLX:0,radiusTLY:0,radiusTRX:0,radiusTRY:0,radiusBRX:0,radiusBRY:0,radiusBLX:0,radiusBLY:0,offshootA:.55,offshootB:0});let Do=Po.setters,Ro=Po.deltaSetters;Do.radius=function(t){this.setRectHelper(t,["radiusTLX","radiusTRX","radiusBRX","radiusBLX","radiusX","radiusTLY","radiusTRY","radiusBRY","radiusBLY","radiusY"])},Do.radiusX=function(t){this.setRectHelper(t,["radiusTLX","radiusTRX","radiusBRX","radiusBLX","radiusX"])},Do.radiusY=function(t){this.setRectHelper(t,["radiusTLY","radiusTRY","radiusBRY","radiusBLY","radiusY"])},Do.radiusT=function(t){this.setRectHelper(t,["radiusTLX","radiusTLY","radiusTRX","radiusTRY"])},Do.radiusB=function(t){this.setRectHelper(t,["radiusBRX","radiusBRY","radiusBLX","radiusBLY"])},Do.radiusL=function(t){this.setRectHelper(t,["radiusTLX","radiusTLY","radiusBLX","radiusBLY"])},Do.radiusR=function(t){this.setRectHelper(t,["radiusTRX","radiusTRY","radiusBRX","radiusBRY"])},Do.radiusTX=function(t){this.setRectHelper(t,["radiusTLX","radiusTRX"])},Do.radiusBX=function(t){this.setRectHelper(t,["radiusBRX","radiusBLX"])},Do.radiusLX=function(t){this.setRectHelper(t,["radiusTLX","radiusBLX"])},Do.radiusRX=function(t){this.setRectHelper(t,["radiusTRX","radiusBRX"])},Do.radiusTY=function(t){this.setRectHelper(t,["radiusTLY","radiusTRY"])},Do.radiusBY=function(t){this.setRectHelper(t,["radiusBRY","radiusBLY"])},Do.radiusLY=function(t){this.setRectHelper(t,["radiusTLY","radiusBLY"])},Do.radiusRY=function(t){this.setRectHelper(t,["radiusTRY","radiusBRY"])},Do.radiusTL=function(t){this.setRectHelper(t,["radiusTLX","radiusTLY"])},Do.radiusTR=function(t){this.setRectHelper(t,["radiusTRX","radiusTRY"])},Do.radiusBL=function(t){this.setRectHelper(t,["radiusBLX","radiusBLY"])},Do.radiusBR=function(t){this.setRectHelper(t,["radiusBRX","radiusBRY"])},Do.radiusTLX=function(t){this.setRectHelper(t,["radiusTLX"])},Do.radiusTLY=function(t){this.setRectHelper(t,["radiusTLY"])},Do.radiusTRX=function(t){this.setRectHelper(t,["radiusTRX"])},Do.radiusTRY=function(t){this.setRectHelper(t,["radiusTRY"])},Do.radiusBRX=function(t){this.setRectHelper(t,["radiusBRX"])},Do.radiusBRY=function(t){this.setRectHelper(t,["radiusBRY"])},Do.radiusBLX=function(t){this.setRectHelper(t,["radiusBLX"])},Do.radiusBLY=function(t){this.setRectHelper(t,["radiusBLY"])},Ro.radius=function(t){this.deltaRectHelper(t,["radiusTLX","radiusTRX","radiusBRX","radiusBLX","radiusX","radiusTLY","radiusTRY","radiusBRY","radiusBLY","radiusY"])},Ro.radiusX=function(t){this.deltaRectHelper(t,["radiusTLX","radiusTRX","radiusBRX","radiusBLX","radiusX"])},Ro.radiusY=function(t){this.deltaRectHelper(t,["radiusTLY","radiusTRY","radiusBRY","radiusBLY","radiusY"])},Ro.radiusT=function(t){this.deltaRectHelper(t,["radiusTLX","radiusTLY","radiusTRX","radiusTRY"])},Ro.radiusB=function(t){this.deltaRectHelper(t,["radiusBRX","radiusBRY","radiusBLX","radiusBLY"])},Ro.radiusL=function(t){this.deltaRectHelper(t,["radiusTLX","radiusTLY","radiusBLX","radiusBLY"])},Ro.radiusR=function(t){this.deltaRectHelper(t,["radiusTRX","radiusTRY","radiusBRX","radiusBRY"])},Ro.radiusTX=function(t){this.deltaRectHelper(t,["radiusTLX","radiusTRX"])},Ro.radiusBX=function(t){this.deltaRectHelper(t,["radiusBRX","radiusBLX"])},Ro.radiusLX=function(t){this.deltaRectHelper(t,["radiusTLX","radiusBLX"])},Ro.radiusRX=function(t){this.deltaRectHelper(t,["radiusTRX","radiusBRX"])},Ro.radiusTY=function(t){this.deltaRectHelper(t,["radiusTLY","radiusTRY"])},Ro.radiusBY=function(t){this.deltaRectHelper(t,["radiusBRY","radiusBLY"])},Ro.radiusLY=function(t){this.deltaRectHelper(t,["radiusTLY","radiusBLY"])},Ro.radiusRY=function(t){this.deltaRectHelper(t,["radiusTRY","radiusBRY"])},Ro.radiusTL=function(t){this.deltaRectHelper(t,["radiusTLX","radiusTLY"])},Ro.radiusTR=function(t){this.deltaRectHelper(t,["radiusTRX","radiusTRY"])},Ro.radiusBL=function(t){this.deltaRectHelper(t,["radiusBLX","radiusBLY"])},Ro.radiusBR=function(t){this.deltaRectHelper(t,["radiusBRX","radiusBRY"])},Ro.radiusTLX=function(t){this.deltaRectHelper(t,["radiusTLX"])},Ro.radiusTLY=function(t){this.deltaRectHelper(t,["radiusTLY"])},Ro.radiusTRX=function(t){this.deltaRectHelper(t,["radiusTRX"])},Ro.radiusTRY=function(t){this.deltaRectHelper(t,["radiusTRY"])},Ro.radiusBRX=function(t){this.deltaRectHelper(t,["radiusBRX"])},Ro.radiusBRY=function(t){this.deltaRectHelper(t,["radiusBRY"])},Ro.radiusBLX=function(t){this.deltaRectHelper(t,["radiusBLX"])},Ro.radiusBLY=function(t){this.deltaRectHelper(t,["radiusBLY"])},Do.offshootA=function(t){this.offshootA=t,this.updateDirty()},Do.offshootB=function(t){this.offshootB=t,this.updateDirty()},Ro.offshootA=function(t){t.toFixed&&(this.offshootA+=t,this.updateDirty())},Ro.offshootB=function(t){t.toFixed&&(this.offshootB+=t,this.updateDirty())},Do.rectangleWidth=function(t){null!=t&&(this.rectangleWidth=t,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0)},Do.rectangleHeight=function(t){null!=t&&(this.rectangleHeight=t,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0)},Ro.rectangleWidth=function(t){this.rectangleWidth=z(this.rectangleWidth,t),this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0},Ro.rectangleHeight=function(t){this.rectangleHeight=z(this.rectangleHeight,t),this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0},Po.setRectHelper=function(t,e){this.updateDirty(),e.forEach((e=>{this[e]=t}),this)},Po.deltaRectHelper=function(t,e){this.updateDirty(),e.forEach((e=>{this[e]=z(this[e],t)}),this)},Po.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeRectanglePath(),this.pathDefinition=t},Po.cleanDimensions=function(){this.dirtyDimensions=!1;let t=this.getHost();if(t){let e=t.currentDimensions?t.currentDimensions:[t.w,t.h],i=this.rectangleWidth,s=this.rectangleHeight,n=this.currentRectangleWidth||1,r=this.currentRectangleHeight||1;i.substring&&(i=parseFloat(i)/100*e[0]),s.substring&&(s=parseFloat(s)/100*e[1]);let o,a=this.mimic;a&&a.name&&this.useMimicDimensions&&(o=a.currentDimensions),o?(this.currentRectangleWidth=this.addOwnDimensionsToMimic?o[0]+i:o[0],this.currentRectangleHeight=this.addOwnDimensionsToMimic?o[1]+s:o[1]):(this.currentRectangleWidth=i,this.currentRectangleHeight=s),this.currentDimensions[0]=this.currentRectangleWidth,this.currentDimensions[1]=this.currentRectangleHeight,this.dirtyStart=!0,this.dirtyHandle=!0,this.dirtyOffset=!0,n===this.currentRectangleWidth&&r===this.currentRectangleHeight||(this.dirtyPositionSubscribers=!0),this.mimicked&&this.mimicked.length&&(this.dirtyMimicDimensions=!0)}else this.dirtyDimensions=!0},Po.makeRectanglePath=function(){this.dirtyDimensions&&this.cleanDimensions();let t=this.currentRectangleWidth,e=this.currentRectangleHeight,i=this.offshootA,s=this.offshootB,n=this.radiusTLX,r=this.radiusTLY,o=this.radiusTRX,a=this.radiusTRY,l=this.radiusBRX,h=this.radiusBRY,c=this.radiusBLX,u=this.radiusBLY;(n.substring||r.substring||o.substring||a.substring||l.substring||h.substring||c.substring||u.substring)&&(n=n.substring?parseFloat(n)/100*t:n,r=r.substring?parseFloat(r)/100*e:r,o=o.substring?parseFloat(o)/100*t:o,a=a.substring?parseFloat(a)/100*e:a,l=l.substring?parseFloat(l)/100*t:l,h=h.substring?parseFloat(h)/100*e:h,c=c.substring?parseFloat(c)/100*t:c,u=u.substring?parseFloat(u)/100*e:u);let d="m0,0";return t-n-o!=0&&(d+="h"+(t-n-o)),o+a!==0&&(d+=`c${o*i},${a*s} ${o-o*s},${a-a*i}, ${o},${a}`),e-a-h!=0&&(d+="v"+(e-a-h)),l+h!==0&&(d+=`c${-l*s},${h*i} ${l*i-l},${h-h*s} ${-l},${h}`),-t+c+l!==0&&(d+=`h${-t+c+l}`),c+u!==0&&(d+=`c${-c*i},${-u*s} ${c*s-c},${u*i-u} ${-c},${-u}`),-e+r+u!==0&&(d+=`v${-e+r+u}`),n+r!==0&&(d+=`c${n*s},${-r*i} ${n-n*i},${r*s-r} ${n},${-r}`),d+="z",d},Po.calculateLocalPathAdditionalActions=function(){let[t,e,i,s]=this.localBox;this.pathDefinition=this.pathDefinition.replace("m0,0",`m${-t},${-e}`),this.pathCalculatedOnce=!1,this.calculateLocalPath(this.pathDefinition,!0)};const Fo=function(t){return!!t&&(t.species="rectangle",new Rectangle(t))};E.Rectangle=Rectangle;const Shape=function(t=Q){return this.shapeInit(t),this};let Eo=Shape.prototype=Object.create(Object.prototype);Eo.type="Shape",Eo.lib="entity",Eo.isArtefact=!0,Eo.isAsset=!1,Eo=Bt(Eo),Eo=Vs(Eo);Eo.defs=lt(Eo.defs,{}),Eo.cleanSpecies=function(){this.dirtySpecies=!1},Eo.cleanStampHandlePositionsAdditionalActions=function(){let t=this.localBox,e=this.currentStampHandlePosition;e[0]+=t[0],e[1]+=t[1]};const Mo=function(t){return!!t&&new Shape(t)};E.Shape=Shape;const Spiral=function(t=Q){return this.shapeInit(t),this};let Io=Spiral.prototype=Object.create(Object.prototype);Io.type="Spiral",Io.lib="entity",Io.isArtefact=!0,Io.isAsset=!1,Io=Bt(Io),Io=Vs(Io);Io.defs=lt(Io.defs,{loops:1,loopIncrement:1,drawFromLoop:0});let Ho=Io.setters,Bo=Io.deltaSetters;Ho.loops=function(t){this.loops=t,this.updateDirty()},Bo.loops=function(t){this.loops+=t,this.updateDirty()},Ho.loopIncrement=function(t){this.loopIncrement=t,this.updateDirty()},Bo.loopIncrement=function(t){this.loopIncrement+=t,this.updateDirty()},Ho.drawFromLoop=function(t){this.drawFromLoop=Math.floor(t),this.updateDirty()},Bo.drawFromLoop=function(t){this.drawFromLoop=Math.floor(this.drawFromLoop+t),this.updateDirty()},Io.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeSpiralPath(),this.pathDefinition=t},Io.firstTurn=[[.043,0,.082,-.035,.088,-.088],[.007,-.057,-.024,-.121,-.088,-.162],[-.07,-.045,-.169,-.054,-.265,-.015],[-.106,.043,-.194,.138,-.235,.265],[-.044,.139,-.026,.3,.058,.442],[.091,.153,.25,.267,.442,.308],[.206,.044,.431,-.001,.619,-.131],[.2,-.139,.34,-.361,.381,-.619]],Io.subsequentTurns=[[0,-.27,-.11,-.52,-.29,-.71],[-.19,-.19,-.44,-.29,-.71,-.29],[-.27,0,-.52,.11,-.71,.29],[-.19,.19,-.29,.44,-.29,.71],[0,.27,.11,.52,.29,.71],[.19,.19,.44,.29,.71,.29],[.27,0,.52,-.11,.71,-.29],[.19,-.19,.29,-.44,.29,-.71]],Io.makeSpiralPath=function(){let t,e,i,s,n,r,o,a,l,h,c,u,d=Math.floor(this.loops),f=this.loopIncrement,p=Math.floor(this.drawFromLoop),m=this.firstTurn,g=this.subsequentTurns,y=[];for(let o=0;o<m.length;o++)[t,e,i,s,n,r]=m[o],y.push([t*f,e*f,i*f,s*f,n*f,r*f]);let b="m0,0";for(let m=0;m<d;m++)for(let d=0;d<y.length;d++)[t,e,i,s,n,r]=y[d],m>=p&&(b+=`c${t},${e} ${i},${s} ${n},${r}`),[o,a,l,h,c,u]=g[d],y[d]=[t+o*f,e+a*f,i+l*f,s+h*f,n+c*f,r+u*f];return b},Io.calculateLocalPathAdditionalActions=function(){let[t,e,i,s]=this.localBox,n=this.scale;this.pathDefinition=this.pathDefinition.replace("m0,0",`m${-t/n},${-e/n}`),this.pathCalculatedOnce=!1,this.calculateLocalPath(this.pathDefinition,!0)};const To=function(t){return!!t&&(t.species="spiral",new Spiral(t))};E.Spiral=Spiral;const Star=function(t=Q){return this.shapeInit(t),this};let Lo=Star.prototype=Object.create(Object.prototype);Lo.type="Star",Lo.lib="entity",Lo.isArtefact=!0,Lo.isAsset=!1,Lo=Bt(Lo),Lo=Vs(Lo);Lo.defs=lt(Lo.defs,{radius1:0,radius2:0,points:0,twist:0});let $o=Lo.setters,jo=Lo.deltaSetters;$o.radius1=function(t){this.radius1=t,this.updateDirty()},jo.radius1=function(t){this.radius1+=t,this.updateDirty()},$o.radius2=function(t){this.radius2=t,this.updateDirty()},jo.radius2=function(t){this.radius2+=t,this.updateDirty()},$o.points=function(t){this.points=t,this.updateDirty()},jo.points=function(t){this.points+=t,this.updateDirty()},$o.twist=function(t){this.twist=t,this.updateDirty()},jo.twist=function(t){this.twist+=t,this.updateDirty()},Lo.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeStarPath(),this.pathDefinition=t},Lo.makeStarPath=function(){let t,e,i,s,n,r,o,a=this.points,l=this.twist,h=this.radius1,c=this.radius2,u=360/a,d=[],f="";if(h.substring||c.substring){let t=this.getHost();if(t){let[e,i]=t.currentDimensions;h=h.substring?parseFloat(h)/100*e:h,c=c.substring?parseFloat(c)/100*e:c}}let p=Ri({x:0,y:-h}),m=Ri({x:0,y:-c});for(t=p.x,e=p.y,d.push(t),m.rotate(-u/2),m.rotate(l),o=0;o<a;o++)m.rotate(u),i=parseFloat((m.x-t).toFixed(1)),t+=i,d.push(t),s=parseFloat((m.y-e).toFixed(1)),e+=s,f+=`${i},${s} `,p.rotate(u),i=parseFloat((p.x-t).toFixed(1)),t+=i,d.push(t),s=parseFloat((p.y-e).toFixed(1)),e+=s,f+=`${i},${s} `;return Fi(p),Fi(m),n=Math.min(...d),r=Math.abs(n).toFixed(1),f=`m${r},0l${f}z`,f};const Xo=function(t){return!!t&&(t.species="star",new Star(t))};E.Star=Star;const Tetragon=function(t=Q){return this.shapeInit(t),this};let Yo=Tetragon.prototype=Object.create(Object.prototype);Yo.type="Tetragon",Yo.lib="entity",Yo.isArtefact=!0,Yo.isAsset=!1,Yo=Bt(Yo),Yo=Vs(Yo);Yo.defs=lt(Yo.defs,{radiusX:5,radiusY:5,intersectX:.5,intersectY:.5});let No=Yo.setters,Go=Yo.deltaSetters;No.radius=function(t){this.setRectHelper(t,["radiusX","radiusY"])},No.radiusX=function(t){this.setRectHelper(t,["radiusX"])},No.radiusY=function(t){this.setRectHelper(t,["radiusY"])},Go.radius=function(t){this.deltaRectHelper(t,["radiusX","radiusY"])},Go.radiusX=function(t){this.deltaRectHelper(t,["radiusX"])},Go.radiusY=function(t){this.deltaRectHelper(t,["radiusY"])},No.intersectA=function(t){this.intersectA=t,this.updateDirty()},No.intersectB=function(t){this.intersectB=t,this.updateDirty()},Go.intersectA=function(t){t.toFixed&&(this.intersectA+=t,this.updateDirty())},Go.intersectB=function(t){t.toFixed&&(this.intersectB+=t,this.updateDirty())},Yo.setRectHelper=function(t,e){this.updateDirty(),e.forEach((e=>{this[e]=t}),this)},Yo.deltaRectHelper=function(t,e){this.updateDirty(),e.forEach((e=>{this[e]=addStrings(this[e],t)}),this)},Yo.cleanSpecies=function(){this.dirtySpecies=!1;let t="M0,0";t=this.makeTetragonPath(),this.pathDefinition=t},Yo.makeTetragonPath=function(){let t,e,i=this.radiusX,s=this.radiusY;if(i.substring||s.substring){let n=this.getHost();if(n){let[r,o]=n.currentDimensions;t=2*(i.substring?parseFloat(i)/100*r:i),e=2*(s.substring?parseFloat(s)/100*o:s)}}else t=2*i,e=2*s;let n=parseFloat((t*this.intersectX).toFixed(2)),r=parseFloat((t-n).toFixed(2)),o=parseFloat((e*this.intersectY).toFixed(2)),a=parseFloat((e-o).toFixed(2)),l="m0,0";return l+=`l${r},${o} ${-r},${a} ${-n},${-a} ${n},${-o}z`,l},Yo.calculateLocalPathAdditionalActions=function(){let[t,e,i,s]=this.localBox;this.pathDefinition=this.pathDefinition.replace("m0,0",`m${-t},${-e}`),this.pathCalculatedOnce=!1,this.calculateLocalPath(this.pathDefinition,!0)};const zo=function(t){return!!t&&(t.species="tetragon",new Tetragon(t))};E.Tetragon=Tetragon;const Ticker=function(t=Q){return this.makeName(t.name),this.register(),this.subscribers=[],this.subscriberObjects=[],this.set(this.defs),this.set(t),this.cycleCount=0,this.active=!1,this.effectiveDuration=0,this.startTime=0,this.currentTime=0,this.tick=0,this.lastEvent=0,t.subscribers&&this.subscribe(t.subscribers),this.setEffectiveDuration(),this};let Wo=Ticker.prototype=Object.create(Object.prototype);Wo.type="Ticker",Wo.lib="animationtickers",Wo.isArtefact=!1,Wo.isAsset=!1,Wo=Bt(Wo);Wo.defs=lt(Wo.defs,{order:1,duration:0,subscribers:null,killOnComplete:!1,cycles:1,eventChoke:0,onRun:null,onHalt:null,onReverse:null,onResume:null,onSeekTo:null,onSeekFor:null,onComplete:null,onReset:null}),Wo.packetExclusions=ct(Wo.packetExclusions,["subscribers"]),Wo.packetFunctions=ct(Wo.packetFunctions,["onRun","onHalt","onReverse","onResume","onSeekTo","onSeekFor","onComplete","onReset"]),Wo.kill=function(){return this.active&&this.halt(),ut(_o,this.name),Uo=!0,this.deregister(),!0},Wo.killTweens=function(t=!1){let e,i,s;for(e=0,i=this.subscribers.length;e<i;e++)s=C[this.subscribers[e]],s.completeAction(),s.kill();return t?(this.kill(),!0):this};let Vo=Wo.getters,Zo=Wo.setters;Vo.subscribers=function(){return[].concat(this.subscribers)},Zo.subscribers=function(t){this.subscribers=[],this.subscribe(t)},Zo.order=function(t){this.order=t,this.active&&(Uo=!0)},Zo.cycles=function(t){this.cycles=t,this.cycles||(this.cycleCount=0)},Zo.duration=function(t){let e,i,s,n=this.subscribers;if(this.duration=t,this.setEffectiveDuration(),dt(n))for(e=0,i=n.length;e<i;e++)s=C[n[e]],s&&(s.calculateEffectiveTime(),"Tween"===s.type&&s.calculateEffectiveDuration())},Wo.subscribe=function(t){let e,i,s,n,r=[].concat(t);for(e=0,i=r.length;e<i;e++)s=r[e],null!=s&&(n=s.substring?s:!(!ot(s)||!s.name)&&s.name,n&&ct(this.subscribers,n));return r.length&&(this.sortSubscribers(),this.recalculateEffectiveDuration()),this},Wo.unsubscribe=function(t){var e,i,s,n,r=[].concat(t);for(e=0,i=r.length;e<i;e++)(n=(s=t[e]).substring?s:!(!ot(s)||!s.name)&&s.name)&&ut(this.subscribers,n);return r.length&&(this.sortSubscribers(),this.recalculateEffectiveDuration()),this},Wo.repopulateSubscriberObjects=function(){let t,e=this.subscriberObjects,i=this.subscribers;e.length=0,i.forEach((i=>{t=C[i],t&&e.push(t)}))},Wo.getSubscriberObjects=function(){return this.subscribers.length&&!this.subscriberObjects.length&&this.repopulateSubscriberObjects(),this.subscriberObjects},Wo.sortSubscribers=function(){let t=this.subscribers;if(t.length>1){let e=[].concat(t),i=Math.floor,s=[];e.forEach((t=>{let e=i(t.effectiveTime)||0;s[e]||(s[e]=[]),s[e].push(t)})),this.subscribers=s.reduce(((t,e)=>t.concat(e)),[])}this.repopulateSubscriberObjects()},Wo.updateSubscribers=function(t,e){e=!!dt(e)&&e;let i,s,n=this.getSubscriberObjects();if(e)for(i=n.length-1;i>=0;i--)n[i].set(t);else for(i=0,s=n.length;i<s;i++)n[i].set(t);return this},Wo.changeSubscriberDirection=function(){return this.getSubscriberObjects().forEach((t=>t.reversed=!t.reversed)),this},Wo.makeTickerUpdateEvent=function(){return new CustomEvent("tickerupdate",{detail:{name:this.name,type:"Ticker",tick:this.tick,reverseTick:this.effectiveDuration-this.tick},bubbles:!0,cancelable:!0})},Wo.recalculateEffectiveDuration=function(){let t,e=this.getSubscriberObjects(),i=0;return this.duration?this.setEffectiveDuration():(e.forEach((e=>{t=e.getEndTime(),t>i&&(i=t)})),this.effectiveDuration=i),this},Wo.setEffectiveDuration=function(){let t;return this.duration&&(t=W(this.duration),"%"===t[0]?(this.duration=0,this.recalculateEffectiveDuration()):this.effectiveDuration=t[1]),this},Wo.fn=function(t){let e=qo();t=!!dt(t)&&t;let i,s,n,r,o,a,l,h,c=this.active,u=this.startTime,d=this.cycles,f=this.cycleCount,p=this.effectiveDuration,m=this.eventChoke;if(c&&u&&(!d||f<d)){if(l=this.currentTime=Date.now(),h=this.tick=l-u,!d||f+1<d?(h>=p?(h=this.tick=0,this.startTime=this.currentTime,e.tick=p,e.reverseTick=0,e.willLoop=!0,d&&(f++,this.cycleCount=f)):(e.tick=h,e.reverseTick=p-h),e.next=!0):h>=p?(e.tick=p,e.reverseTick=0,c=this.active=!1,d&&(f++,this.cycleCount=f)):(e.tick=h,e.reverseTick=p-h,e.next=!0),n=this.getSubscriberObjects(),t)for(i=n.length-1;i>=0;i--)n[i].update(e);else for(i=0,s=n.length;i<s;i++)n[i].update(e);m&&(r=this.lastEvent+m,o=Date.now(),r<o&&(a=this.makeTickerUpdateEvent(),window.dispatchEvent(a),this.lastEvent=o)),c||this.halt(),this.killOnComplete&&f>=d&&this.killTweens(!0)}Qo(e)},Wo.run=function(){return this.active||(this.startTime=this.currentTime=Date.now(),this.cycleCount=0,this.updateSubscribers({reversed:!1}),this.active=!0,ct(_o,this.name),Uo=!0,"function"==typeof this.onRun&&this.onRun()),this},Wo.isRunning=function(){return this.active},Wo.reset=function(){return this.active&&this.halt(),this.startTime=this.currentTime=Date.now(),this.cycleCount=0,this.updateSubscribers({reversed:!1}),this.active=!0,this.fn(!0),this.active=!1,"function"==typeof this.onReset&&this.onReset(),this},Wo.complete=function(){return this.active&&this.halt(),this.startTime=this.currentTime=Date.now(),this.cycleCount=0,this.updateSubscribers({reversed:!0}),this.active=!0,this.fn(),this.active=!1,"function"==typeof this.onComplete&&this.onComplete(),this},Wo.reverse=function(t=!1){let e;return t=pt(t,!1),this.active&&this.halt(),e=this.currentTime-this.startTime,this.startTime=this.currentTime-(this.effectiveDuration-e),this.changeSubscriberDirection(),this.active=!0,this.fn(),this.active=!1,"function"==typeof this.onReverse&&this.onReverse(),t&&this.resume(),this},Wo.halt=function(){return this.active=!1,ct(_o,this.name),Uo=!0,"function"==typeof this.onHalt&&this.onHalt(),this},Wo.resume=function(){let t,e,i;return this.active||(t=Date.now(),e=this.currentTime,i=this.startTime,this.startTime=t-(e-i),this.currentTime=t,this.active=!0,ct(_o,this.name),Uo=!0,"function"==typeof this.onResume&&this.onResume()),this},Wo.seekTo=function(t,e=!1){let i=!1;return t=pt(t,0),this.active&&this.halt(),this.cycles&&this.cycleCount>=this.cycles&&(this.cycleCount=this.cycles-1),t<this.tick&&(i=!0),this.currentTime=Date.now(),this.startTime=this.currentTime-t,this.active=!0,this.fn(i),this.active=!1,"function"==typeof this.onSeekTo&&this.onSeekTo(),e&&this.resume(),this},Wo.seekFor=function(t,e=!1){let i=!1;return t=__xtGet(t,0),this.active&&this.halt(),this.cycles&&this.cycleCount>=this.cycles&&(this.cycleCount=this.cycles-1),this.startTime-=t,t<0&&(i=!0),this.active=!0,this.fn(i),this.active=!1,"function"==typeof this.onSeekFor&&this.onSeekFor(),e&&this.resume(),this};let _o=[],Uo=!0;Lt({name:"coreTickersAnimation",order:0,fn:function(){if(Uo){Uo=!1;let t=[].concat(_o),e=Math.floor,i=[];t.forEach((t=>{let s=n[t];if(dt(s)){let t=e(s.order)||0;i[t]||(i[t]=[]),i[t].push(s.name)}})),_o=i.reduce(((t,e)=>t.concat(e)),[])}for(let t,e,i=0,s=_o.length;i<s;i++)t=_o[i],e=n[t],e&&e.fn&&e.fn()}});const Ko=[],qo=function(){return Ko.length||Ko.push({tick:0,reverseTick:0,willLoop:!1,next:!1}),Ko.shift()},Qo=function(t){t&&(t.tick=0,t.reverseTick=0,t.willLoop=!1,t.next=!1,Ko.push(t))},Jo=function(t){return!!t&&new Ticker(t)};E.Ticker=Ticker;const Tracer=function(t=Q){return this.makeName(t.name),this.register(),this.initializePositions(),this.set(this.defs),this.onEnter=_,this.onLeave=_,this.onDown=_,this.onUp=_,this.stampAction=_,this.trace=wn(t),t.group||(t.group=hs),this.set(t),this.purge&&this.purgeArtefact(this.purge),this};let ta=Tracer.prototype=Object.create(Object.prototype);ta.type="Tracer",ta.lib="entity",ta.isArtefact=!0,ta.isAsset=!1,ta=Bt(ta),ta=$s(ta);ta.defs=lt(ta.defs,{artefact:null,historyLength:1,hitRadius:10,showHitRadius:!1,hitRadiusColor:"#000000"}),ta.packetExclusions=ct(ta.packetExclusions,[]),ta.packetExclusionsByRegex=ct(ta.packetExclusionsByRegex,[]),ta.packetCoordinates=ct(ta.packetCoordinates,[]),ta.packetObjects=ct(ta.packetObjects,["artefact","particle"]),ta.packetFunctions=ct(ta.packetFunctions,["stampAction"]),ta.finalizePacketOut=function(t,e){return t},ta.postCloneAction=function(t,e){return t.trace=wn({name:t.name,historyLength:e.historyLength||this.historyLength||1}),t},ta.factoryKill=function(t){t&&this.artefact.kill(),this.trace.kill()},ta.getters;let ea=ta.setters;ta.deltaSetters,ea.stampAction=function(t){nt(t)&&(this.stampAction=t)},ea.artefact=function(t){let e;t.substring?e=o[t]:ot(t)&&t.isArtefact&&(e=t),e&&(this.artefact=e,this.dirtyFilterIdentifier=!0)},ta.regularStamp=function(){let{artefact:t,trace:e,stampAction:i,showHitRadius:s,hitRadius:n,hitRadiusColor:r,currentStampPosition:o}=this,a=this.currentHost;if(e.set({position:o}),e.manageHistory(0,a),i.call(this,t,e,a),s){let t=a.engine;t.save(),t.lineWidth=1,t.strokeStyle=r,t.setTransform(1,0,0,1,0,0),t.beginPath(),t.arc(o[0],o[1],n,0,2*Math.PI),t.stroke(),t.restore()}},ta.checkHit=function(t=[],e){if(this.noUserInteraction)return!1;let i,s,n=Array.isArray(t)?t:[t],r=this.currentStampPosition,o=!1;if(n.some((t=>{if(Array.isArray(t))i=t[0],s=t[1];else{if(!ft(t,t.x,t.y))return!1;i=t.x,s=t.y}if(!i.toFixed||!s.toFixed||isNaN(i)||isNaN(s))return!1;let e=Ri(r).vectorSubtract(t);return e.getMagnitude()<this.hitRadius&&(o=!0),Fi(e),o}),this)){return this.checkHitReturn(i,s,e)}return!1};const ia=function(t){return!!t&&new Tracer(t)};E.Tracer=Tracer;const Tween=function(t=Q){let e;return this.makeName(t.name),this.register(),this.set(this.defs),this.set(t),this.setDefinitionsValues(),this.status=-1,this.calculateEffectiveTime(),this.calculateEffectiveDuration(),n[t.ticker]?this.addToTicker(t.ticker):(e=`${this.name}_ticker`,Jo({name:e,order:this.order,subscribers:this.name,duration:this.effectiveDuration,eventChoke:pt(t.eventChoke,0),cycles:pt(t.cycles,1),killOnComplete:pt(t.killOnComplete,!1)}),this.ticker=e,n[e].recalculateEffectiveDuration()),this};let sa=Tween.prototype=Object.create(Object.prototype);sa.type="Tween",sa.lib="tween",sa.isArtefact=!1,sa.isAsset=!1,sa=Bt(sa),sa=Hs(sa);sa.defs=lt(sa.defs,{definitions:null,duration:0,killOnComplete:!1,commenceAction:null,onRun:null,onHalt:null,onResume:null,onReverse:null,onSeekTo:null,onSeekFor:null,completeAction:null}),sa.packetExclusions=ct(sa.packetExclusions,["definitions","targets"]),sa.packetFunctions=ct(sa.packetFunctions,["commenceAction","completeAction","onRun","onHalt","onResume","onReverse","onSeekTo","onSeekFor","action"]),sa.finalizePacketOut=function(t,e){return Array.isArray(this.targets)&&(t.targets=this.targets.map((t=>t.name))),Array.isArray(this.definitions)&&(t.definitions=this.definitions.map((t=>{let e={};if(e.attribute=t.attribute,e.start=t.start,e.end=t.end,t.engine&&t.engine.substring)e.engine=t.engine.substring;else if(dt(t.engine)&&null!==t.engine){let i=this.stringifyFunction(t.engine);i&&(e.engine=i,e.engineIsFunction=!0)}return e}))),t},sa.postCloneAction=function(t,e){if(e.useNewTicker){let i=n[this.ticker];dt(e.cycles)?t.cycles=e.cycles:t.cycles=i?i.cycles:1;let s=n[t.ticker];s.cycles=t.cycles,dt(e.duration)&&(t.duration=e.duration,t.calculateEffectiveDuration(),s&&s.recalculateEffectiveDuration())}return Array.isArray(t.definitions)&&t.definitions.forEach(((t,e)=>{t.engineIsFunction&&(t.engine=this.definitions[e].engine)})),t};let na=sa.getters,ra=sa.setters;na.definitions=function(){return[].concat(this.definitions)},ra.definitions=function(t){this.definitions=[].concat(t),this.setDefinitionsValues()},ra.commenceAction=function(t){this.commenceAction=t,"function"!=typeof this.commenceAction&&(this.commenceAction=_)},ra.completeAction=function(t){this.completeAction=t,"function"!=typeof this.completeAction&&(this.completeAction=_)},sa.set=function(t=Q){let e,i,s,n,r=this.setters,o=Object.keys(t),a=this.defs,l=!!dt(t.ticker)&&this.ticker;for(i=0,s=o.length;i<s;i++)e=o[i],"name"!==e&&(n=r[e],n?n.call(this,t[e]):void 0!==a[e]&&(this[e]=t[e]));return l?(this.ticker=l,this.addToTicker(t.ticker)):mt(t.time,t.duration)&&(this.calculateEffectiveTime(),this.calculateEffectiveDuration()),this},sa.getEndTime=function(){return this.effectiveTime+this.effectiveDuration},sa.calculateEffectiveDuration=function(t){let e,i=pt(t,this.duration),s=W(i),r=s[1],o=s[0],a=this.ticker,l=0;return this.effectiveDuration=0,"%"===o?a&&(e=n[a],e&&(l=e.effectiveDuration,this.effectiveDuration=l*(r/100))):this.effectiveDuration=r,this},sa.update=function(t=Q){let e,i,s=t.tick||0,n=t.reverseTick||0,r=0,o=this.effectiveTime,a=this.effectiveDuration,l=this.reversed;l?(e=o+a,i=o,n>e?r=1:n<i&&(r=-1)):(e=o,i=o+a,s<e?r=-1:s>i&&(r=1)),a?r&&r==this.status||(this.status=r,this.doSimpleUpdate(t),t.next||(this.status=l?-1:1)):r!=this.status&&(this.status=r,this.doSimpleUpdate(t),t.next||(this.status=l?-1:1)),t.willLoop&&(this.reverseOnCycleEnd?this.reversed=!l:this.status=-1)},sa.doSimpleUpdate=function(t=Q){let e,i,s,n,r,o,a,l,h,c,u,d,f,p,m=this.effectiveTime,g=this.engineActions,y=this.effectiveDuration,b=this.status,S=this.definitions,k=this.targets,A=this.action,O=this.setObj||{},w=Math.round;for(e=this.reversed?t.reverseTick-m:t.tick-m,o=y&&!b?e/y:b>0?1:0,i=0,s=S.length;i<s;i++)a=S[i],l=a.engine,c=a.effectiveStart,u=a.effectiveChange,d=a.integer,f=a.suffix,p=a.attribute,h=l.substring?g(l,c,u,o):l(c,u,o),d&&(h=w(h)),f&&(h+=f),O[p]=h;for(n=0,r=k.length;n<r;n++)k[n].set(O);this.setObj=O,A&&A()},sa.engineActions=function(t,e,i,s){const n=null!=gt[t]?t:"linear";return e+i*gt[n](s)},sa.setDefinitionsValues=function(){let t,e,i,s,n=this.parseDefinitionsValue,r=this.definitions;for(t=0,e=r.length;t<e;t++)s=r[t],s&&(i=n(s.start),s.effectiveStart=i[1],s.suffix=i[0],i=n(s.end),s.effectiveEnd=i[1],dt(s.engine)||(s.engine="linear"),s.effectiveChange=s.effectiveEnd-s.effectiveStart);return this},sa.parseDefinitionsValue=function(t){let e,i=["",0];return dt(t)&&(t.toFixed?i[1]=t:t.substring&&(e=t.match(/^-?\d+\.?\d*(\D*)/),dt(e[0])&&(i[1]=parseFloat(e)),dt(e[1])&&(i[0]=e[1]))),i},sa.run=function(){let t=n[this.ticker];return t&&(this.commenceAction(),t.run(),"function"==typeof this.onRun&&this.onRun()),this},sa.isRunning=function(){let t=n[this.ticker];return!!t&&t.isRunning()},sa.halt=function(){let t=n[this.ticker];return t&&(t.halt(),"function"==typeof this.onHalt&&this.onHalt()),this},sa.reverse=function(){let t=n[this.ticker];return t&&(t.reverse(),"function"==typeof this.onReverse&&this.onReverse()),this},sa.resume=function(){let t=n[this.ticker];return t&&(t.resume(),"function"==typeof this.onResume&&this.onResume()),this},sa.seekTo=function(t){let e=n[this.ticker];return e&&(e.seekTo(t),"function"==typeof this.onSeekTo&&this.onSeekTo()),this},sa.seekFor=function(t){let e=n[this.ticker];return e&&(e.seekFor(t),"function"==typeof this.onSeekFor&&this.onSeekFor()),this};const oa=function(t){return!!t&&new Tween(t)};E.Tween=Tween;const aa=(t,e)=>(t=parseFloat(t),rt(t)||(t=0),rt(e)||(e=0),parseFloat(t.toFixed(e))),Wheel=function(t=Q){return mt(t.dimensions,t.width,t.height,t.radius)||(t.radius=5),this.entityInit(t),this};let la=Wheel.prototype=Object.create(Object.prototype);la.type="Wheel",la.lib="entity",la.isArtefact=!0,la.isAsset=!1,la=Bt(la),la=$s(la);la.defs=lt(la.defs,{radius:5,startAngle:0,endAngle:360,clockwise:!0,includeCenter:!1,closed:!0}),la.getters;let ha=la.setters,ca=la.deltaSetters;ha.width=function(t){if(null!=t){let e=this.dimensions;e[0]=e[1]=t,this.dimensionsHelper()}},ca.width=function(t){let e=this.dimensions;e[0]=e[1]=addStrings(e[0],t),this.dimensionsHelper()},ha.height=function(t){if(null!=t){let e=this.dimensions;e[0]=e[1]=t,this.dimensionsHelper()}},ca.height=function(t){let e=this.dimensions;e[0]=e[1]=addStrings(e[0],t),this.dimensionsHelper()},ha.dimensions=function(t,e){this.setCoordinateHelper("dimensions",t,e),this.dimensionsHelper()},ca.dimensions=function(t,e){this.setDeltaCoordinateHelper("dimensions",t,e),this.dimensionsHelper()},ha.radius=function(t){this.radius=t,this.radiusHelper()},ca.radius=function(t){this.radius=addStrings(this.radius,t),this.radiusHelper()},ha.startAngle=function(t){this.startAngle=aa(t,4),this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},ca.startAngle=function(t){this.startAngle+=aa(t,4),this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},ha.endAngle=function(t){this.endAngle=aa(t,4),this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},ca.endAngle=function(t){this.endAngle+=aa(t,4),this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0},ha.closed=function(t){dt(t)&&(this.closed=!!t,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0)},ha.includeCenter=function(t){dt(t)&&(this.includeCenter=!!t,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0)},ha.clockwise=function(t){dt(t)&&(this.clockwise=!!t,this.dirtyPathObject=!0,this.dirtyFilterIdentifier=!0)},la.dimensionsHelper=function(){let t=this.dimensions[0];t.substring?this.radius=parseFloat(t)/2+"%":this.radius=t/2,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0},la.radiusHelper=function(){let t=this.radius,e=this.dimensions;t.substring?e[0]=e[1]=2*parseFloat(t)+"%":e[0]=e[1]=2*t,this.dirtyDimensions=!0,this.dirtyFilterIdentifier=!0},la.cleanDimensionsAdditionalActions=function(){let t=this.radius,e=this.currentDimensions,i=t.substring?parseFloat(t)/100*e[0]:t;e[0]!==2*i?(e[1]=e[0],this.currentRadius=e[0]/2):this.currentRadius=i},la.cleanPathObject=function(){if(this.dirtyPathObject=!1,!this.noPathUpdates||!this.pathObject){let t=this.pathObject=new Path2D,e=this.currentStampHandlePosition,i=this.currentScale,s=this.currentRadius*i,n=s-e[0]*i,r=s-e[1]*i,o=this.startAngle*M,a=this.endAngle*M;t.arc(n,r,s,o,a,!this.clockwise),this.includeCenter?(t.lineTo(n,r),t.closePath()):this.closed&&t.closePath()}};const ua=function(t){return!!t&&new Wheel(t)};E.Wheel=Wheel;const World=function(t=Q){this.makeName(t.name),this.register(),this.set(this.defs);let e=t.keytypes||{};return e.gravity||(e.gravity="Vector"),t.gravity||(t.gravity=[0,9.81,0]),t.userAttributes&&t.userAttributes.forEach((t=>{this.addAttribute(t),t.type&&(e[t.key]=t.type)})),this.initializeAttributes(e),this.set(t),this};let da=World.prototype=Object.create(Object.prototype);da.type="World",da.lib="world",da.isArtefact=!1,da.isAsset=!1,da=Bt(da);da.defs=lt(da.defs,{gravity:null,tickMultiplier:1,keytypes:null}),da.kill=function(){return this.deregister(),!0};let fa=da.getters,pa=da.setters,ma=da.deltaSetters;pa.gravityX=function(t){this.gravity&&dt(t)&&this.gravity.setX(t)},pa.gravityY=function(t){this.gravity&&dt(t)&&this.gravity.setY(t)},pa.gravityZ=function(t){this.gravity&&dt(t)&&this.gravity.setZ(t)},pa.gravity=function(t){this.gravity&&dt(t)&&this.gravity.set(t)},da.addAttribute=function(t=Q){let{key:e,defaultValue:i,setter:s,deltaSetter:n,getter:r}=t;return e&&e.substring&&(this.defs[e]=dt(i)?i:null,this[e]=dt(i)?i:null,nt(s)&&(pa[e]=s),nt(n)&&(ma[e]=n),nt(r)&&(fa[e]=r)),this},da.removeAttribute=function(t){return t&&t.substring&&(delete this.defs[t],delete this[t],delete fa[t],delete pa[t],delete ma[t]),this},da.initializeAttributes=function(t){for(let[e,i]of Object.entries(t))switch(i){case"Quaternion":this[e]=Ti();break;case"Vector":this[e]=Ei();break;case"Coordinate":this[e]=Ee()}};const ga=function(t){return!!t&&new World(t)};E.World=World;const ya=Cs;"undefined"!=typeof window&&Cs();export{us as addCanvas,bt as addListener,wt as addNativeListener,ns as addStack,ds as clear,fs as compile,Xe as createImageFromCell,Ne as createImageFromEntity,Ye as createImageFromGroup,Zt as currentCorePosition,pe as forceUpdate,os as getCanvas,Mt as getIgnorePixelRatio,Ft as getPixelRatio,as as getStack,ne as getTouchActionChoke,je as importDomImage,Cr as importDomVideo,$e as importImage,xr as importMediaStream,Er as importSprite,Pr as importVideo,ya as init,B as library,Ls as makeAction,Lt as makeAnimation,yt as makeAnimationObserver,Js as makeBezier,Xs as makeBlock,nn as makeCog,yi as makeColor,un as makeConicGradient,mn as makeCrescent,ye as makeDragZone,Vi as makeElement,En as makeEmitter,Ln as makeFilter,jn as makeForce,In as makeGradient,Gn as makeGrid,xi as makeGroup,Se as makeKeyboardZone,Wn as makeLine,Un as makeLineSpiral,tr as makeLoom,nr as makeMesh,ur as makeNet,gr as makeNoise,mr as makeNoiseAsset,kr as makeOval,Br as makePattern,Zr as makePhrase,Qr as makePicture,io as makePolygon,ao as makePolyline,fo as makeQuadratic,bo as makeRadialGradient,wo as makeRawAsset,xo as makeReactionDiffusionAsset,Fo as makeRectangle,Ps as makeRender,Mo as makeShape,Rs as makeSnippet,To as makeSpiral,ar as makeSpring,Xo as makeStar,zo as makeTetragon,Jo as makeTicker,ia as makeTracer,oa as makeTween,ua as makeWheel,ga as makeWorld,me as observeAndUpdate,Fe as releaseCoordinate,Bi as releaseQuaternion,Fi as releaseVector,St as removeListener,vt as removeNativeListener,ms as render,Re as requestCoordinate,Hi as requestQuaternion,Ri as requestVector,Oe as seededRandomNumberGenerator,cs as setCurrentCanvas,Ai as setFilterMemoizationChoke,It as setIgnorePixelRatio,Pt as setPixelRatioChangeAction,re as setTouchActionChoke,ps as show,N as startCoreAnimationLoop,ce as startCoreListeners,G as stopCoreAnimationLoop,ue as stopCoreListeners};
